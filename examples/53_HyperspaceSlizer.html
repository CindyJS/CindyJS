<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
            <title>Cindy JS</title>
            
            <script type="text/javascript" src="../build/js/quickhull3d/quickhull3d.nocache.js"></script>
            <script type="text/javascript" src="../build/js/Cindy.js"></script>
            <link rel="stylesheet" href="../css/cindy.css">
            </head>
    
	<body style="font-family:Arial;">
        
        <h1>CindyJS: Convex Hull</h1>
        
        
        <script id='mouseDrag' type='cindyscript'>
        if(mover()!=B,        
        
        xx=mouse().x;
yy=mouse().y;
 wy=(startx-xx)*.3;
 wx=-(starty-yy)*.3;

mmmx=[
  [1,0,0],
  [0,cos(wx),sin(wx)],
  [0,-sin(wx),cos(wx)]
];


mmmy=[
  [cos(wy),0,-sin(wy)],
  [0,1,0],
  [sin(wy),0,cos(wy)]
];



  mat=mmmx*mmmy*mat;
  
          startx=mouse().x;
starty=mouse().y;

);
        </script>

        <script id='mouseUp' type='cindyscript'>
                if(mover()!=B,        


        xx=mouse().x;
yy=mouse().y;
 wy=(startx-xx)*.3;
 wx=-(starty-yy)*.3;

mmmx=[
  [1,0,0],
  [0,cos(wx),sin(wx)],
  [0,-sin(wx),cos(wx)]
];


mmmy=[
  [cos(wy),0,-sin(wy)],
  [0,1,0],
  [sin(wy),0,cos(wy)]
];



  mat=mmmx*mmmy*mat;
  
  )
        </script>

        <script id='mouseDown' type='cindyscript'>
                errc("DOWN");
if(|spos0-mouse().xy|<1.5,setstate(0));
if(|spos1-mouse().xy|<1.5,setstate(1));
if(|spos2-mouse().xy|<1.5,setstate(2));
        startx=mouse().x;
starty=mouse().y;
        </script>


        
        
<script id='init' type='cindyscript'>
 firsttime=true;
 setstate(i):=(
 errc("SETSTATE"+i);
     state=i;
     if(state==0,
        obj=obj1;
        calc();repaint();
     );
     if(state==1,
        obj=obj2;
        calc();repaint();
     );
     if(state==2,
        obj=obj3;
        calc();repaint();
     );
 
 );
state=1;

spos0=(14,7);
spos1=(17,7);
spos2=(20,7);

mat=[ 
    [1,0,0],
    [0,1,0],
    [0,0,1]
    ];

mat0=[
    [1,0,0],
    [0,1,0],
    [0,0,1]
    ];



mmmx=mat0;
mmmy=mat0;



obj1=((-1,-1,-1),(-1,1,1),(1,-1,1),(1,1,-1))*8;
num=4;





obj2=((1,0,0),(-1,0,0),(0,-1,0),(0,1,0),(0,0,-1),(0,0,1))*12;
num=8;

gg=(1-sqrt(5))/2 ;

obj3=(
      (1,gg,0),
      (1,-gg,0),
      (-1,gg,0),
      (-1,-gg,0),
      (0,1,gg),
      (0,1,-gg),
      (0,-1,gg),
      (0,-1,-gg),
      (gg,0,1),
      (-gg,0,1),
      (gg,0,-1),
      (-gg,0,-1)
      )*8; 
      
      obj=obj2;




ma(p):=[p_1,p_2+2];

pos1=(10,-10,-10); 
pos1=pos1/|pos1|;
pos2=(-10,-10,-10); 
pos2=pos2/|pos2|;
col1=(1,-10,0);
col2=(0,-10,1);

drawfaceB(f,nn,objc):=(
                  if(area(f_1,f_2,f_3)<0,
                  nn=-nn;
                     col=-(pos1*nn*col1+pos2*nn*col2);
                     col=objc*(pos1*nn+pos2*nn+.8);
                     col=objc*.4;//*(pos1*nn+pos2*nn+.8);
                     ff=f++[f_1];
                    fillpoly(f,color->col);
                     apply(1..(length(ff)-1),
                           
                           draw(ff_#,ff_(#+1),size->2,color->(0,0,0))
                           )
                     )
                  );

drawfaceF(f,nn,objc):=(
                  if(area(f_1,f_2,f_3)>0,
                     col=(pos1*nn*col1+pos2*nn*col2);
                     col=objc*(pos1*nn+pos2*nn+.5);
                    // ff=f++[f_1];
                           fillpoly(f,color->col,alpha->.8);
                           
                       //    draw(ff_#,ff_(#+1),size->2,color->(0,0,0))
                        
                     )
                  );


drawfaceFEd(f,nn):=(
                  if(area(f_1,f_2,f_3)>0,
                     col=(pos1*nn*col1+pos2*nn*col2);
                     ff=f++[f_1];
                     apply(1..(length(ff)-1),
                           
                           draw(ff_#,ff_(#+1),size->4,color->(0,0,0))
                           )
                     )
                  );

bary(ch):=(

   barfc=[];
   apply(ch_2,fa,
      p1=(ch_1)_(fa_1);
      p2=(ch_1)_(fa_2);
      p3=(ch_1)_(fa_3);
      errc("****"+p1+" "+p2+" "+p3);
      mid=(p1+p2+p3)/3; 
      s12=(p1+p2)/2; 
      s23=(p2+p3)/2; 
      s31=(p1+p3)/2; 
      barfc=barfc++[[p1,s12,mid]]; 
      barfc=barfc++[[p2,s12,mid]]; 
      barfc=barfc++[[p2,s23,mid]]; 
      barfc=barfc++[[p3,s23,mid]]; 
      barfc=barfc++[[p3,s31,mid]]; 
      barfc=barfc++[[p1,s31,mid]]; 
   
   );
   barfc;

);


calc():=(

ch=convexhull3d(obj);



bar=bary(ch);

);

flatten(xi):=(
ergc=[];
apply(xi,ell,
  apply(ell,
    ergc=ergc++[#];
  )
);
ergc);


choice=2;
tchoice=1;
perm3all(a,b,c,d):=(
 (a,b,c,d),
 (a,b,d,c),
 (a,c,b,d),
 (a,c,d,b),
 (a,d,b,c),
 (a,d,c,b)
);

perm4(a,b,c,d):=
perm3all(a,b,c,d)++
perm3all(b,a,d,c)++
perm3all(c,d,a,b)++
perm3all(d,c,b,a);

perm3ev(a,b,c,d):=(
 (a,b,c,d),
 (a,c,d,b),
 (a,d,b,c)
);

perm4ev(a,b,c,d):=
perm3ev(a,b,c,d)++
perm3ev(b,a,d,c)++
perm3ev(c,d,a,b)++
perm3ev(d,c,b,a);


pm1(a,b,c,d):=(
  (a,b,c,d),
  (-a,b,c,d));

pm2(a,b,c,d):=
pm1(a,b,c,d)++pm1(a,-b,c,d);
pm3(a,b,c,d):=
pm2(a,b,c,d)++pm2(a,b,-c,d);
pm4(a,b,c,d):=
pm3(a,b,c,d)++pm3(a,b,c,-d);

tau=(sqrt(5)-1)/2;

cell5=(
  (1,1,1,0),
  (1,-1,-1,0),
  (-1,1,-1,0),
  (-1,-1,1,0),
  (0,0,0,sqrt(5))
)*1.6;

cell5=apply(cell5, #-sum(cell5)/5);

cell16=set(flatten(apply(pm1(1,0,0,0),perm4(#_1,#_2,#_3,#_4))));
cell16=cell16*2.5;


cell8=set(flatten(apply(pm4(0.5,0.5,0.5,0.5),perm4(#_1,#_2,#_3,#_4))));
cell8=cell8*2.5;

cell24=
set(flatten(apply(pm1(1,0,0,0),perm4(#_1,#_2,#_3,#_4))))
++
set(flatten(apply(pm4(0.5,0.5,0.5,0.5),perm4(#_1,#_2,#_3,#_4))))
;
errc(cell24);


cell600=cell24++
set(flatten(apply(pm3(tau/2,0.5,0.5/tau,0),perm4ev(#_1,#_2,#_3,#_4))));

cell24=cell24*2.5;

cell600=cell600*2.3;



cell120=
set(flatten(apply(pm2(1,1,0,0),perm4(#_1,#_2,#_3,#_4)),levels->1))
++
set(flatten(apply(pm4(1/2,1/2,1/2,sqrt(5)/2),perm4(#_1,#_2,#_3,#_4))))
++
set(flatten(apply(pm4(1/(2*tau^2),tau/2,tau/2,tau/2),perm4(#_1,#_2,#_3,#_4))))
++
set(flatten(apply(pm4((tau^2)/2,1/(2*tau),1/(2*tau),1/(2*tau)),perm4(#_1,#_2,#_3,#_4))))
++
set(flatten(apply(pm4(0,1/(2*tau^2),1/2,(tau^2)/2),perm4ev(#_1,#_2,#_3,#_4))))
++
set(flatten(apply(pm4(0,1/(2*tau),tau/2,sqrt(5)/2),perm4ev(#_1,#_2,#_3,#_4))))
++
set(flatten(apply(pm4(1/(2*tau),1/2,tau/2,1),perm4ev(#_1,#_2,#_3,#_4))));
cell120=cell120*1.5;



segsbod(body):=(
  sdist=sort(apply(body,|#,body_1|))_2;
  
  segs=[];
  forall(body,pp1,
    forall(body,pp2,
       if(|pp1,pp2|~=sdist,segs=segs++[(pp1,pp2)])
    )    
  );
  segs
);

tau=(sqrt(5)-1)/2;

        d = sqrt(5);

  d1 = (3 * d + 1.0) * 0.5;
         d2 = (3D * d - 1.0) * 0.5;
        d3 = (d + 1.0) * 0.5;
taup = d3 * (4 - d1);


b5=(cell5,pairs(cell5),
 cell5_1+cell5_2+cell5_3+cell5_4,
 cell5_1+cell5_2+cell5_3,
 cell5_1+cell5_2,
 cell5_1
);
errc("DONE b5");

b16=(cell16,segsbod(cell16),(1,0,0,0),(1,1,0,0),(1,1,1,0),(1,1,1,1));
errc("DONE b16");

b8=(cell8,segsbod(cell8),(1,1,1,1),(1,1,1,0),(1,1,0,0),(1,0,0,0));
errc("DONE b8");
b24=(cell24,segsbod(cell24),(1,1,1,1),(1,1,1,0),(1,.5,.5,0),(1,1,0,0));
errc("DONE b24");

b120=(cell120,segsbod(cell120),(1,1,0,0),(1,tau^2,0,0),(1,tau,0,0),(1,0,0,0));
errc("DONE b120");

b600=(cell600,segsbod(cell600),(1,0,0,0),(1,tau,0,0),(1,tau^2,0,0),(1,1,0,0));
errc("DONE b600");







spanfactor=(
(1,1,1,1),
(1,.55,.33,.37),
(.24,.16,.16,1),
(.54,.24,.08,.37),
(.24,.16,.16,.8),
(1.85,.21,.16,.24)
);


definebody(zell):=(
  body=zell_1;
  segs=zell_2;
  rf1=zell_3;
  rf2=zell_4;
  rf3=zell_5;
  rf4=zell_6;
);









        </script>

        
             <script id='tick' type='cindyscript'>

        </script>


        
<script id='firstDrawing' type='cindyscript'>
PA=(13,-5);
PC=(13,5);

draw(PA,PC,color->(0,0,0),size->2);
bx=B.x;
by=B.y;
if(by>5,by=5);
if(by<-5,by=-5);
B.xy=(13,by);
B.color=(1,1,1);

w1=1/3;
w2=1/3;
w3=1/3;
A.xy=(0,0);
//translate((2,2));

if(choice==0,definebody(b5));
if(choice==1,definebody(b16));
if(choice==2,definebody(b8));
if(choice==3,definebody(b24));
if(choice==4,definebody(b120));
if(choice==5,definebody(b600));

if(tchoice==1,dir=rf1);
if(tchoice==2,dir=rf2);
if(tchoice==3,dir=rf3);
if(tchoice==4,dir=rf4);


nn(x):=x/|x|;

n1=nn(dir);
n2=(-n1_2,n1_1,-n1_4,n1_3);
n3=(-n1_3,n1_4,n1_1,-n1_2);
n4=(-n1_4,-n1_3,n1_2,n1_1);
par=(B.x+5)/10;


max=sort(apply(body,dir*#))_1; 

pts=select(body,dir*#~=max);
sp=sum(pts)/length(pts);
max=|sp|;
w=-max*.999;
w=0;
ls(m,v):=(
 dd=m_1_1*m_2_2-m_1_2*m_2_1;
 [(m_2_2*v_1-m_1_2*v_2)/dd,(m_2_1*v_1-m_1_1*v_2)/dd] 
);
w=(par*2-1)*max*0.999+.000001;

ss=select(segs,(n1*#_1-w)*(n1*#_2-w)~<0);
ss=apply(ss,
  erg=ls(((#_1*n1,#_2*n1),(1,1)),(w,1));
  erg_1*#_1+erg_2*#_2;
);

objx=apply(ss,(#*n2,#*n3,#*n4))*.5*200;


//if(or(mover()==B,firsttime),

   a=convexhull3d(objx);
//);

points=a_1*transpose(mat);  
faces=a_2;  



apply(faces,f,
      fa=points_f; 
      org=(a_1)_f;
      nn=cross( fa_2-fa_1,fa_2-fa_3);
      nn=nn/|nn|;
      
      mm=cross( org_2-org_1,org_2-org_3);
      mm=mm/|mm|;
      objcol=(.5,.5,1);      
      if(length(f)==4,
         objcol=(0.5,1,0.5);      
      );
      if(length(f)==6,
         objcol=(1,0.5,0.5);      
      );
objcol=objcol*.7;
      erg=apply(fa,p,ma(p));
      
      drawfaceB(erg,nn,objcol);
      );


apply(faces,f,
      fa=points_f; 
      org=(a_1)_f;
      nn=cross( fa_2-fa_1,fa_2-fa_3);
      nn=nn/|nn|;
      
      mm=cross( org_2-org_1,org_2-org_3);
      mm=mm/|mm|;
      objcol=(.5,.5,1);      
      if(length(f)==4,
         objcol=(0.5,1,0.5);      
      );
      if(length(f)==6,
         objcol=(1,0.5,0.5);      
      );
      objcol=objcol*.7;
      erg=apply(fa,p,ma(p));
      
      drawfaceF(erg,nn,objcol);
      );
apply(faces,f,
      fa=points_f; 
      nn=cross( fa_2-fa_1,fa_2-fa_3);
      nn=nn/|nn|;
      erg=apply(fa,p,ma(p));
      
      
      drawfaceFEd(erg,nn);
      );
      
      
drawcircle(spos0,1.2,size->if(state==0,6,2));
drawcircle(spos1,1.2,size->if(state==1,6,2));
drawcircle(spos2,1.2,size->if(state==2,6,2));
drawtext(spos0-(.5,.7),3,size->45);
drawtext(spos1-(.5,.7),4,size->45);
drawtext(spos2-(.5,.7),5,size->45);
        </script>
        
        
       <script id='timer' type='cindyscript'>
wx=wx*0.998;
 wy=wy*0.998;
 wx=.01;
 wy=.01;
sp=0.8;
mmmx=[
  [1,0,0],
  [0,cos(wx*sp),sin(wx*sp)],
  [0,-sin(wx*sp),cos(wx*sp)]

];


mmmy=[
  [cos(wy*sp),0,-sin(wy*sp)],
  [0,1,0],
  [sin(wy*sp),0,cos(wy*sp)]
];


mat=mmmx*mmmy*mat;
        </script> 
        
        <canvas  id="CSCanvas" width=800 height=600  style="border:2px solid #000000"></canvas>
        
        <script type="text/javascript">
            
            var gslp=[
                      {name:"A", kind:"P", type:"Free",alpha:0, sx:-1000,sy:-1000,sz:1,alpha:.001} ,
                      {name:"B", kind:"P", type:"Free",alpha:0, sx:15,sy:-3,sz:1},
                      
                                           ];
            
                          console.log("*****************");

  setTimeout(function(){
  evokeCS('calc();repaint()');
    }, 3000);
            createCindy({canvasname:"CSCanvas",
                        movescript:"firstDrawing",
                        initscript:"init",
                        mousedownscript:"mouseDown",
                        mouseupscript:"mouseUp",
                        tickscript:"timer",
                        mousedragscript:"mouseDrag",
                        geometry:gslp});

            
            </script>
             <button onclick="csplay()" type="button" style="position:absolute; top:640px;left:60px" >Play</button>
        <button onclick="csstop()" type="button" style="position:absolute; top:640px;left:150px" >Stop</button>

       	</body>
</html>
