<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
    <title>Cindy JS</title>
    <script type="text/javascript" src="../../build/js/Cindy.js"></script>
    <script type="text/javascript" src="../../build/js/CindyGL.js"></script>
    <link rel="stylesheet" href="../../css/cindy.css">
  </head>
    
	<body style="font-family:Arial;">
    
    <h1>CindyJS: Reactionâ€“diffusion system</h1>
     <script id="csinit" type="cindyscript">
      use("CindyGL");
      
      
      L = [0, 0]; //bottom left corner
      R = [512, 0]; //bottom right corner
      
      createimage("gol", 512, 512);
      createimage("biggol", 512, 512);
      
      colorplot(L, R, "gol", if(abs(#.x-256)<30 &abs(#.y-256)<30 ,.7*(random(),random(),0),(1,0,0));
 
      );
      pressed=0;
   
    </script>
    
    <script id="csmousedown" type="cindyscript">
    pressed=1;
</script>
    <script id="csmouseup" type="cindyscript">
    pressed=0;
</script>

 <script id="cskeydown" type="cindyscript">
      print("pressed key" + keycode());
      if(keycode()==32, colorplot(L, R, "gol", 0)); //space -> black
      if(keycode()==82, colorplot(L, R, "gol", if(abs(#.x-256)<30 &abs(#.y-256)<30 ,.7*(random(),random(),0),(1,0,0)))); //R -> random image
    </script>

 <script id="csmove" type="cindyscript">
        y=CA.y; y = max(200,min(450,y)); CA.xy=(500,y);
        f = y*0.0001
</script>

        
<script id="csdraw" type="cindyscript">
      
      get(x, y) :=  imagergb((0,0), (512,0), "gol", (mod(x,512),mod(y,512)));
      pp=mouse().xy;
da=0.2;
db=0.1;


//k=0.06;
//f=0.024;
k=0.06;
      newstate(x, y) := (

laplacian=-4*get(x,y)+get(x-1,y)+get(x,y-1)+get(x+1,y)+get(x,y+1);      
val=get(x,y);
deltax = da * laplacian.x - val.x*val.y*val.y + f * (1.0-val.x);
deltay = db * laplacian.y + val.x*val.y*val.y - (k+f) * val.y;
(val.x+deltax,val.y+deltay,0);
      );
 

        repeat(10,
          colorplot(L, R, "gol", if(pressed==1 & abs(pp-#)<3, (get(#.x, #.y).x,.6,0), newstate(#.x, #.y)), nocopy->true);
        );
    //copy to render texture
      colorplot(L, R, "biggol", imagergb(L, R, "gol", #)_1);
      drawimage(L, R, "biggol");
      
       draw((500,200),(500,450),color->(0,0,0),size->2);
    </script>

    <canvas  id="CSCanvas"></canvas>
    <script type="text/javascript">
        
        cdy = createCindy({canvasname:"CSCanvas",
                    scripts: "cs*",
                    geometry:[
                    
    {name:"CA", type:"Free", pos:[500,350],color:[1,0,0],pinned:false,size:6},
                    ],
                    autoplay: true,
                    ports: [{
                      id: "CSCanvas",
                      width: 512,
                      height: 512,
                      transform: [ { visibleRect: [0, 0, 512, 512] } ]
                    }]
                  });
    </script>              
	</body>
</html>
