<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
            <title>Cindy JS</title>
            <!--script type="text/javascript" src="js/Cindy.js"></script-->
            
            <script type="text/javascript" src="js/libgeo/GeoState.js"></script>
            <script type="text/javascript" src="js/libgeo/GeoBasics.js"></script>
            <script type="text/javascript" src="js/libgeo/GeoOps.js"></script>
            <script type="text/javascript" src="js/Setup.js"></script>
            <script type="text/javascript" src="js/Events.js"></script>

            <script type="text/javascript" src="js/libcs/Namespace.js"></script>
            <script type="text/javascript" src="js/libcs/Accessors.js"></script>
            <script type="text/javascript" src="js/libcs/CSNumber.js"></script>
            <script type="text/javascript" src="js/libcs/List.js"></script>
            <script type="text/javascript" src="js/libcs/Essentials.js"></script>
            <script type="text/javascript" src="js/libcs/General.js"></script>
            <script type="text/javascript" src="js/libcs/Operators.js"></script>
            <script type="text/javascript" src="js/libcs/OpDrawing.js"></script>
            <script type="text/javascript" src="js/libcs/OpImageDrawing.js"></script>
            <script type="text/javascript" src="js/libcs/Parser.js"></script>
            
            
            <script type="text/javascript" src="js/lib/d3.js"></script>
            <script type="text/javascript" src="js/lib/numeric-1.2.6.js"></script>
            <script type="text/javascript" src="js/lib/clipper.js"></script>
            <link rel="stylesheet" href="css/cindy.css">

                
            </head>
    
	<body style="font-family:Arial;">
        
        <h1>CindyJS: Schleppkurve</h1>
   
        
             <script id='keyup' type='cindyscript'>
forall(1..length(pts),(pts_#).xy=(-7+0.5*#,0));
old=allpoints();
 old=apply(2..length(old),old_#);

oldpts=apply(old,#.xy);
</script>
     
<script id='up' type='cindyscript'>
//forall(1..length(pts),(pts_#).xy=(-7+0.5*#,0));
//old=allpoints();
//oldpts=apply(old,#.xy);

 old=allpoints();
 pts=allpoints();
 old=apply(2..length(old),old_#);
 pts=apply(2..length(pts),pts_#);
        oldpts=apply(old,#.xy);
</script>

<script id='init' type='cindyscript'>
 old=allpoints();
  old=apply(2..length(old),old_#);

        oldpts=apply(old,#.xy);
        
        
               split(pts,oldpts,m):=(
                              
                              i=1;
                              while(pts_i!=m,i=i+1);
                              errc(i);
                              l=apply(1..i,(pts_(i-#+1)));
                              r=apply(i..length(pts),(pts_#));
                              ol=apply(1..i,oldpts_(i-#+1));
                              or=apply(i..length(oldpts),oldpts_#);
                              [l,r,ol,or];
                              
                              );
                     
                     
                     antiprismc(a,b,c):=(
                                         xx=|a-b|^2;
                                         yy=|a-c|^2;
                                         if(yy==0,
                                            d=b,
                                            d=((a*b*xx)-(b*c*xx)-(a*c*yy)+(b*c*yy))/(a*xx-c*xx-a*yy+b*yy)
                                            );
                                         d;
                                         );
                                         
                                         tractrix(a,b,c):=(
                                        
                                                           bb=a+(b-a)*2;
                                                           dd=antiprismc(a,bb,c);
                                                           (c+dd)/2;
                                                           );
                                                           
                                                           
                                                           
                                                           
                                                           
                                                           
                                                           
            transf(pts,pt):=(
                             newpts=pts;
                             newpts_1=pt;
                             forall(1..(length(pts)-1),
                                    newpts_(#+1)=gauss(tractrix(complex(pts_#),complex(pts_(#+1)),complex(newpts_#)));

                                    );

                             newpts;
                             );
                             
                                            finished=true;
      
                             
                         

</script>
        <script id='firstDrawing' type='cindyscript'>
            pts=allpoints();
             pts=apply(2..length(pts),pts_#);

            apply(pts,#.size=3;#.color=(1,0,0));
    i=0;
    mover=mover();
        
        
     
                     
               if(mover!=A & isreal(mover.x)&finished,
                  finished=false;
                  errc("MOVE");
               m=mover;
                  if(m.xy!=start,
                     start=m.xy;
                     sp=split(pts,oldpts,m);
                     l=sp_1;
                     r=sp_2;
                     ol=sp_3;
                     or=sp_4;
                     
                     newptsl=transf(ol,start);
                     newptsr=transf(or,start);
                     
                     forall(1..length(l),(l_#).xy=newptsl_#);
                     forall(1..length(r),(r_#).xy=newptsr_#);
                     
                     oldpts=apply(pts,#.xy);
                     draw(mover.xy,size->5);
                     );
                     finished=true;
                  );
               
               connect(pts,color->(1,1,1)*0,size->3);
apply(1..length(tr),draw(pts_#,tr_#,alpha->0.3));

tr=transf(oldpts,A.xy);
               connect(tr,color->(1,1,1)*0,size->4);
               drawall(tr,color->(1,.7,0),size->4);

        </script>
        

        <canvas  id="CSCanvas" align="left" valign = "top" width=500 height=500  style="border:2px solid #000000"></canvas>

        <script>
            defaultAppearance.clip="inci";
            defaultAppearance.overhangLine=1.2;

            var gslp=[];
            gslp.push({name:"A", type:"Free", pos:[-2,1],color:[1,.7,0],size:8});

            for(var i=0;i<30;i++){

               gslp.push({name:"A"+i, type:"Free", pos:[-7+i*0.5,0],color:[1,1,1]});
            }
                      createCindy({canvasname:"CSCanvas",
                        movescript:"firstDrawing",
                        mouseupscript:"up",
                        keydownscript:"keyup",
                        initscript:"init",
                        geometry:gslp});
    
        </script>

	</body>
</html>