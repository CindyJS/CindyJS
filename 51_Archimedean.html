<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
            <title>Cindy JS</title>
            
            <script type="text/javascript" src="js/lib/martin/qh/test1.nocache.js"></script>

            <script type="text/javascript" src="js/libgeo/GeoState.js"></script>
            <script type="text/javascript" src="js/libgeo/GeoBasics.js"></script>
            <script type="text/javascript" src="js/libgeo/GeoOps.js"></script>
            <script type="text/javascript" src="js/Setup.js"></script>
            <script type="text/javascript" src="js/Events.js"></script>
            
            <script type="text/javascript" src="js/libcs/Namespace.js"></script>
            <script type="text/javascript" src="js/libcs/Accessors.js"></script>
            <script type="text/javascript" src="js/libcs/CSNumber.js"></script>
            <script type="text/javascript" src="js/libcs/List.js"></script>
            <script type="text/javascript" src="js/libcs/Essentials.js"></script>
            <script type="text/javascript" src="js/libcs/General.js"></script>
            <script type="text/javascript" src="js/libcs/Operators.js"></script>
            <script type="text/javascript" src="js/libcs/OpDrawing.js"></script>
            <script type="text/javascript" src="js/libcs/OpImageDrawing.js"></script>
            <script type="text/javascript" src="js/libcs/Parser.js"></script>
            
            <script type="text/javascript" src="js/lib/d3.js"></script>
            <script type="text/javascript" src="js/lib/numeric-1.2.6.js"></script>
            <script type="text/javascript" src="js/lib/clipper.js"></script>
     
            <link rel="stylesheet" href="css/cindy.css">
            </head>
    
	<body style="font-family:Arial;">
        
        <h1>CindyJS: Convex Hull</h1>
        
        
        <script id='mouseDrag' type='cindyscript'>
        errc("Draw");
        xx=mouse().x;
yy=mouse().y;
 wy=(startx-xx)*.3;
 wx=-(starty-yy)*.3;

mmmx=[
  [1,0,0],
  [0,cos(wx),sin(wx)],
  [0,-sin(wx),cos(wx)]
];


mmmy=[
  [cos(wy),0,-sin(wy)],
  [0,1,0],
  [sin(wy),0,cos(wy)]
];



  mat=mmmx*mmmy*mat;
  
          startx=mouse().x;
starty=mouse().y;
        </script>

        <script id='mouseUp' type='cindyscript'>
                errc("Up");

        xx=mouse().x;
yy=mouse().y;
 wy=(startx-xx)*.3;
 wx=-(starty-yy)*.3;

mmmx=[
  [1,0,0],
  [0,cos(wx),sin(wx)],
  [0,-sin(wx),cos(wx)]
];


mmmy=[
  [cos(wy),0,-sin(wy)],
  [0,1,0],
  [sin(wy),0,cos(wy)]
];



  mat=mmmx*mmmy*mat;
        </script>

        <script id='mouseDown' type='cindyscript'>
                errc("DOWN");

        startx=mouse().x;
starty=mouse().y;
        </script>


        
        
<script id='init' type='cindyscript'>
 
 
mat=[ 
  [1,0,0],
  [0,1,0],
  [0,0,1]
];

mat0=[
  [1,0,0],
  [0,1,0],
  [0,0,1]
];



mmmx=mat0;
mmmy=mat0;


        
        obj1=((-1,-1,-1),(-1,1,1),(1,-1,1),(1,1,-1));
 num=4;





 obj2=((1,0,0),(-1,0,0),(0,-1,0),(0,1,0),(0,0,-1),(0,0,1))*1.6;
 num=8;

 gg=(1-sqrt(5))/2 ;

 obj3=(
   (1,gg,0),
   (1,-gg,0),
   (-1,gg,0),
   (-1,-gg,0),
   (0,1,gg),
   (0,1,-gg),
   (0,-1,gg),
   (0,-1,-gg),
   (gg,0,1),
   (-gg,0,1),
   (gg,0,-1),
   (-gg,0,-1)
 )*8; 
 
 ma(p):=[p_1,p_2];
 
pos1=(10,-10,-10); 
pos1=pos1/|pos1|;
pos2=(-10,-10,-10); 
pos2=pos2/|pos2|;
 col1=(1,0,0);
 col2=(0,0,1);

drawfaceB(f,nn):=(
   if(area(f_1,f_2,f_3)<0,
      col=-(pos1*nn*col1+pos2*nn*col2);
      col=(1,0,0);
      ff=f++[f_1];
      apply(1..(length(ff)-1),
              //  fillpoly(f,color->col);

          draw(ff_#,ff_(#+1),size->2,color->(0,0,0))
      )
   )
);

drawfaceF(f,nn):=(
   if(area(f_1,f_2,f_3)>0,
      col=(pos1*nn*col1+pos2*nn*col2);
            col=(0,0,1);

      ff=f++[f_1];
      apply(1..(length(ff)-1),
                fillpoly(f,color->col);

          draw(ff_#,ff_(#+1),size->2,color->(0,0,0))
      )
   )
)




        </script>

        
             <script id='tick' type='cindyscript'>
             errc("HALLO");

        </script>


        
        <script id='firstDrawing' type='cindyscript'>
translate((2,2));

           a=convexhull3d(obj3);
           points=a_1*transpose(mat);  
           faces=a_2;  
         
           apply(faces,f,
               fa=points_f; 
                nn=cross( fa_2-fa_1,fa_2-fa_3);
nn=nn/|nn|;
               erg=apply(fa,p,ma(p));
               drawfaceB(erg,nn);

               drawfaceF(erg,nn);
           );
         
        </script>
        
        
        <canvas  id="CSCanvas" width=800 height=600  style="border:2px solid #000000"></canvas>
        
        <script type="text/javascript">
            
            var gslp=[
                      {name:"A", kind:"P", type:"Free",alpha:0, sx:-1000,sy:-1000,sz:1}                      ];
            
                          console.log("*****************");

  setTimeout(function(){
  evokeCS('repaint()');

    }, 1000);
            createCindy({canvasname:"CSCanvas",
                        movescript:"firstDrawing",
                        initscript:"init",
                        mousedownscript:"mouseDown",
                        mouseupscript:"mouseUp",
                        mousedragscript:"mouseDrag",
                        geometry:gslp});

            
            </script>
        
       	</body>
</html>