var csgstorage={},csport={drawingstate:{}};csport.drawingstate.linecolor="rgb(0,0,255)";csport.drawingstate.linecolorraw=[0,0,1];csport.drawingstate.pointcolor="rgb(255,200,0)";csport.drawingstate.pointcolorraw=[1,.78,0];csport.drawingstate.textcolor="rgb(0,0,0)";csport.drawingstate.textcolorraw=[0,0,0];csport.drawingstate.alpha=1;csport.drawingstate.pointsize=4;csport.drawingstate.linesize=1;csport.drawingstate.textsize=20;csport.drawingstate.matrix={};csport.drawingstate.matrix.a=25;
csport.drawingstate.matrix.b=0;csport.drawingstate.matrix.c=0;csport.drawingstate.matrix.d=25;csport.drawingstate.matrix.tx=250;csport.drawingstate.matrix.ty=250;csport.drawingstate.matrix.det=csport.drawingstate.matrix.a*csport.drawingstate.matrix.d-csport.drawingstate.matrix.b*csport.drawingstate.matrix.c;csport.drawingstate.matrix.sdet=Math.sqrt(csport.drawingstate.matrix.det);csport.drawingstate.initialmatrix={};csport.drawingstate.initialmatrix.a=csport.drawingstate.matrix.a;
csport.drawingstate.initialmatrix.b=csport.drawingstate.matrix.b;csport.drawingstate.initialmatrix.c=csport.drawingstate.matrix.c;csport.drawingstate.initialmatrix.d=csport.drawingstate.matrix.d;csport.drawingstate.initialmatrix.tx=csport.drawingstate.matrix.tx;csport.drawingstate.initialmatrix.ty=csport.drawingstate.matrix.ty;csport.drawingstate.initialmatrix.det=csport.drawingstate.matrix.det;csport.drawingstate.initialmatrix.sdet=csport.drawingstate.matrix.sdet;
csport.clone=function(c){if(null==c||"object"!=typeof c)return c;var e=c.constructor(),d;for(d in c)e[d]=csport.clone(c[d]);return e};csgstorage.backup=csport.clone(csport.drawingstate);csgstorage.stack=[];var back=csport.clone(csport.drawingstate);
csport.reset=function(){csport.drawingstate.matrix.a=csport.drawingstate.initialmatrix.a;csport.drawingstate.matrix.b=csport.drawingstate.initialmatrix.b;csport.drawingstate.matrix.c=csport.drawingstate.initialmatrix.c;csport.drawingstate.matrix.d=csport.drawingstate.initialmatrix.d;csport.drawingstate.matrix.tx=csport.drawingstate.initialmatrix.tx;csport.drawingstate.matrix.ty=csport.drawingstate.initialmatrix.ty;csport.drawingstate.matrix.det=csport.drawingstate.initialmatrix.det;csport.drawingstate.matrix.sdet=
csport.drawingstate.initialmatrix.sdet};csport.from=function(c,e,d){c/=d;e/=d;d=csport.drawingstate.matrix;return[c*d.a-e*d.b+d.tx,c*d.c-e*d.d-d.ty]};csport.to=function(c,e){var d=csport.drawingstate.matrix,f=c-d.tx,g=e+d.ty;return[(f*d.d-g*d.b)/d.det,-(-f*d.c+g*d.a)/d.det,1]};csport.dumpTrafo=function(){var c=function(c){return Math.round(1E3*c)/1E3};m=csport.drawingstate.matrix;console.log("a:"+c(m.a)+" b:"+c(m.b)+" c:"+c(m.c)+" d:"+c(m.d)+" tx:"+c(m.ty)+" ty:"+c(m.tx))};
csport.applyMat=function(c,e,d,f,g,h){m=csport.drawingstate.matrix;var k=m.b*c+m.d*e,p=m.a*d+m.c*f;d=m.b*d+m.d*f;f=m.a*g+m.c*h+m.tx;g=m.b*g+m.d*h+m.ty;m.a=m.a*c+m.c*e;m.b=k;m.c=p;m.d=d;m.tx=f;m.ty=g;m.det=csport.drawingstate.matrix.a*csport.drawingstate.matrix.d-csport.drawingstate.matrix.b*csport.drawingstate.matrix.c;m.sdet=Math.sqrt(csport.drawingstate.matrix.det)};csport.translate=function(c,e){csport.applyMat(1,0,0,1,c,e)};
csport.rotate=function(c){var e=Math.cos(c);c=Math.sin(c);csport.applyMat(e,c,-c,e,0,0)};csport.scale=function(c){csport.applyMat(c,0,0,c,0,0)};csport.gsave=function(){csgstorage.stack.push(csport.clone(csport.drawingstate))};csport.grestore=function(){0!=csgstorage.stack.length&&(csport.drawingstate=csgstorage.stack.pop())};csport.greset=function(){csport.drawingstate=csport.clone(csgstorage.backup);csport.drawingstate.matrix.ty-=csh;csport.drawingstate.initialmatrix.ty-=csh;csgstorage.stack=[]};
csport.createnewbackup=function(){csport.drawingstate.initialmatrix.a=csport.drawingstate.matrix.a;csport.drawingstate.initialmatrix.b=csport.drawingstate.matrix.b;csport.drawingstate.initialmatrix.c=csport.drawingstate.matrix.c;csport.drawingstate.initialmatrix.d=csport.drawingstate.matrix.d;csport.drawingstate.initialmatrix.tx=csport.drawingstate.matrix.tx;csport.drawingstate.initialmatrix.ty=csport.drawingstate.matrix.ty;csport.drawingstate.initialmatrix.det=csport.drawingstate.matrix.det;csport.drawingstate.initialmatrix.sdet=
csport.drawingstate.matrix.sdet;csgstorage.backup=csport.clone(csport.drawingstate)};
csport.setcolor=function(c){var e=c.value[0].value.real,d=c.value[1].value.real;c=c.value[2].value.real;1==csport.drawingstate.alpha?(csport.drawingstate.linecolor="rgb("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+")",csport.drawingstate.linecolorraw=[e,d,c],csport.drawingstate.pointcolor="rgb("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+")"):(csport.drawingstate.linecolor="rgb("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+","+csport.drawingstate.alpha+
")",csport.drawingstate.linecolorraw=[e,d,c],csport.drawingstate.pointcolor="rgb("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+","+csport.drawingstate.alpha+")");csport.drawingstate.pointcolorraw=[e,d,c]};
csport.setlinecolor=function(c){var e=c.value[0].value.real,d=c.value[1].value.real;c=c.value[2].value.real;csport.drawingstate.linecolor=1==csport.drawingstate.alpha?"rgb("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+")":"rgba("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+","+csport.drawingstate.alpha+")";csport.drawingstate.linecolorraw=[e,d,c]};
csport.settextcolor=function(c){var e=c.value[0].value.real,d=c.value[1].value.real;c=c.value[2].value.real;csport.drawingstate.textcolor=1==csport.drawingstate.alpha?"rgb("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+")":"rgba("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+","+csport.drawingstate.alpha+")";csport.drawingstate.textcolorraw=[e,d,c]};
csport.setpointcolor=function(c){var e=c.value[0].value.real,d=c.value[1].value.real;c=c.value[2].value.real;csport.drawingstate.linecolor=1==csport.drawingstate.alpha?"rgb("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+")":"rgba("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+","+csport.drawingstate.alpha+")";csport.drawingstate.pointcolorraw=[e,d,c]};
csport.setalpha=function(c){c=c.value.real;var e=csport.drawingstate.linecolorraw[0],d=csport.drawingstate.linecolorraw[1],f=csport.drawingstate.linecolorraw[2];csport.drawingstate.linecolor="rgba("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*f)+","+c+")";e=csport.drawingstate.pointcolorraw[0];d=csport.drawingstate.pointcolorraw[1];f=csport.drawingstate.pointcolorraw[2];csport.drawingstate.pointcolor="rgba("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*f)+","+c+")";e=
csport.drawingstate.textcolorraw[0];d=csport.drawingstate.textcolorraw[1];f=csport.drawingstate.textcolorraw[2];csport.drawingstate.textcolor="rgba("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*f)+","+c+")";csport.drawingstate.alpha=c};csport.setpointsize=function(c){csport.drawingstate.pointsize=c.value.real};csport.setlinesize=function(c){csport.drawingstate.linesize=c.value.real};csport.settextsize=function(c){csport.drawingstate.textsize=c.value.real};var defaultAppearance={clip:"none",pointColor:[1,0,0],lineColor:[0,0,1],pointSize:5,lineSize:2,alpha:1,overhangLine:1.1,overhangSeg:1,dimDependent:1};
function csinit(c){function e(c){c.size=CSNumber.real(c.size||defaultAppearance.pointSize);"Free"!=c.type?(c.color=List.realVector(c.color||defaultAppearance.pointColor),c.color=List.scalmult(CSNumber.real(defaultAppearance.dimDependent),c.color)):c.color=List.realVector(c.color||defaultAppearance.pointColor);c.alpha=CSNumber.real(c.alpha||defaultAppearance.alpha)}function d(c){c.size=CSNumber.real(c.size||defaultAppearance.lineSize);c.color=List.realVector(c.color||defaultAppearance.lineColor);c.alpha=
CSNumber.real(c.alpha||defaultAppearance.alpha);c.clip=General.string(c.clip||defaultAppearance.clip);c.overhang=CSNumber.real(c.overhang||defaultAppearance.overhangLine)}function f(c){d(c);c.clip=General.string("end");c.overhang=CSNumber.real(c.overhang||defaultAppearance.overhangSeg)}csgeo.gslp=c;csgeo.csnames={};for(var g=0;g<csgeo.gslp.length;g++)csgeo.csnames[csgeo.gslp[g].name]=csgeo.gslp[g],csgeo.gslp[g].kind=geoOpMap[csgeo.gslp[g].type],csgeo.gslp[g].incidences=[],csgeo.gslp[g].isshowing=
!0,csgeo.gslp[g].movable=!1,csgeo.gslp[g].inited=!1;csgeo.points=[];csgeo.lines=[];csgeo.conics=[];csgeo.free=[];csgeo.ctp=0;csgeo.ctf=0;csgeo.ctl=0;for(g=csgeo.ctc=0;g<csgeo.gslp.length;g++){if("P"==csgeo.gslp[g].kind){var h=csgeo.gslp[g];csgeo.points[csgeo.ctp]=h;e(h);csgeo.ctp+=1}"L"==csgeo.gslp[g].kind&&(h=csgeo.gslp[g],csgeo.lines[csgeo.ctl]=h,d(h),csgeo.ctl+=1);"C"==csgeo.gslp[g].kind&&(h=csgeo.gslp[g],csgeo.conics[csgeo.ctc]=h,d(h),csgeo.ctc+=1);"S"==csgeo.gslp[g].kind&&(h=csgeo.gslp[g],csgeo.lines[csgeo.ctl]=
h,f(h),csgeo.ctl+=1);h=csgeo.gslp[g].type;if("Free"==h||"PointOnLine"==h||"PointOnCircle"==h||"PointOnSegment"==h){var k=csgeo.gslp[g];k.pos&&(2==k.pos.length&&(k.sx=k.pos[0],k.sy=k.pos[1],k.sz=1),3==k.pos.length&&(k.sx=k.pos[0],k.sy=k.pos[1],k.sz=k.pos[2]));k.homog=List.realVector([c[g].sx,c[g].sy,c[g].sz]);k.isfinite=0!=k.sz;k.ismovable=!0;"PointOnCircle"==h&&(k.angle=CSNumber.real(k.angle));csgeo.free[csgeo.ctf]=k;csgeo.ctf+=1}if("CircleMr"==h||"CircleMFixedr"==h)k=csgeo.gslp[g],k.radius=CSNumber.real(k.radius),
csgeo.free[csgeo.ctf]=k,csgeo.ctf+=1;"Through"==h&&(k=csgeo.gslp[g],k.dir=General.wrap(k.dir),csgeo.free[csgeo.ctf]=k,csgeo.ctf+=1)}guessIncidences()}
function onSegment(c,e){var d=csgeo.csnames[e.args[0]].homog,f=csgeo.csnames[e.args[1]].homog,g=c.homog,h=CSNumber.div(d.value[0],d.value[2]),k=CSNumber.div(d.value[1],d.value[2]),d=CSNumber.div(f.value[0],f.value[2]),f=CSNumber.div(f.value[1],f.value[2]),p=CSNumber.div(g.value[0],g.value[2]),n=CSNumber.div(g.value[1],g.value[2]);return CSNumber._helper.isAlmostReal(h)&&CSNumber._helper.isAlmostReal(k)&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(f)&&CSNumber._helper.isAlmostReal(p)&&
CSNumber._helper.isAlmostReal(n)?(h=h.value.real,k=k.value.real,d=d.value.real,f=f.value.real,p=p.value.real,n=n.value.real,g=Math.sqrt((h-d)*(h-d)+(k-f)*(k-f)),h=Math.sqrt((h-p)*(h-p)+(k-n)*(k-n)),d=Math.sqrt((d-p)*(d-p)+(f-n)*(f-n)),h=g-h-d,1E-15>h*h):!1}function isShowing(c,e){c.isshowing=!0;if(c.args)for(var d=0;d<c.args.length;d++)if(!csgeo.csnames[c.args[d]].isshowing){c.isshowing=!1;return}e.visiblecheck&&e.visiblecheck(c)}
function recalc(){csport.reset();for(var c=csgeo.gslp,e=0;e<c.length;e++){var d=c[e],f=geoOps[d.type];f(d);isShowing(d,f)}}function guessIncidences(){recalc();for(var c=0;c<csgeo.lines.length;c++)for(var e=csgeo.lines[c],d=0;d<csgeo.points.length;d++){var f=csgeo.points[d],g=List.scaldiv(List.abs(f.homog),f.homog),h=List.scaldiv(List.abs(e.homog),e.homog);1E-13>CSNumber.abs(List.scalproduct(g,h)).value.real&&(f.incidences.push(e.name),e.incidences.push(f.name))}}
function render(){for(var c=function(c){if(c.isshowing&&List._helper.isAlmostReal(c.homog)){var d=c.color;c.behavior&&(d=c.color);evaluator.draw([c.homog],{size:c.size,color:d,alpha:c.alpha})}},e=function(c){if(c.isshowing){var d=c.matrix,e=d.value[2].value[0].value.real,f=d.value[0].value[0].value.real,n=d.value[2].value[1].value.real,q=-e/f,r=-n/d.value[1].value[1].value.real,d=(f*(q*q+r*r)+2*e*q+2*n*r+d.value[2].value[2].value.real)/f,d=Math.sqrt(0<d?d:-d);evaluator.drawcircle([List.realVector([q,
r]),CSNumber.real(d)],{size:c.size,color:c.color,alpha:c.alpha})}},d=function(c){if(c.isshowing&&List._helper.isAlmostReal(c.homog)){"none"==c.clip.value&&evaluator.draw([c.homog],{size:c.size,color:c.color,alpha:c.alpha});if("end"==c.clip.value){var d=csgeo.csnames[c.args[0]],e=csgeo.csnames[c.args[1]];evaluator.draw([d.homog,e.homog],{size:c.size,color:c.color,alpha:c.alpha})}if("inci"==c.clip.value){for(var d=[1E6,0],e=[-1E6,0],f=[1E6,0],n=[-1E6,0],q=0;q<c.incidences.length;q++){var r=csgeo.csnames[c.incidences[q]].homog,
s=r.value[0],t=r.value[1],v=r.value[2];CSNumber._helper.isAlmostZero(v)||(s=CSNumber.div(s,v),t=CSNumber.div(t,v),CSNumber._helper.isAlmostReal(s)&&CSNumber._helper.isAlmostReal(t)&&(s.value.real<d[0]&&(d=[s.value.real,r]),s.value.real>e[0]&&(e=[s.value.real,r]),t.value.real<f[0]&&(f=[t.value.real,r]),t.value.real>n[0]&&(n=[t.value.real,r])))}e[0]-d[0]>n[0]-f[0]?(d=d[1],e=e[1]):(d=f[1],e=n[1]);d!=e?evaluator.draw([d,e],{size:c.size,color:c.color,alpha:c.alpha,overhang:c.overhang}):evaluator.draw([c.homog],
{size:c.size,color:c.color,alpha:c.alpha})}}},f=0;f<csgeo.conics.length;f++)e(csgeo.conics[f]);for(f=0;f<csgeo.lines.length;f++)d(csgeo.lines[f]);for(f=0;f<csgeo.points.length;f++)c(csgeo.points[f])};geoOps={_helper:{}};var geoOpMap={};geoOps.Join=function(c){c.homog=List.cross(csgeo.csnames[c.args[0]].homog,csgeo.csnames[c.args[1]].homog);c.homog=List.normalizeMax(c.homog);c.homog.usage="Line"};geoOpMap.Join="L";geoOps.Segment=function(c){c.homog=List.cross(csgeo.csnames[c.args[0]].homog,csgeo.csnames[c.args[1]].homog);c.homog=List.normalizeMax(c.homog);c.homog.usage="Line"};geoOpMap.Segment="S";
geoOps.Meet=function(c){c.homog=List.cross(csgeo.csnames[c.args[0]].homog,csgeo.csnames[c.args[1]].homog);c.homog=List.normalizeMax(c.homog);c.homog.usage="Point"};geoOps.Meet.visiblecheck=function(c){var e=!0,d=csgeo.csnames[c.args[0]],f=csgeo.csnames[c.args[1]];"Segment"==d.type&&(e=onSegment(c,d));e&&"Segment"==d.type&&(e=onSegment(c,f));c.isshowing=e};geoOpMap.Meet="P";
geoOps.Mid=function(c){var e=csgeo.csnames[c.args[0]].homog,d=csgeo.csnames[c.args[1]].homog,f=List.cross(e,d),g=List.cross(f,List.linfty),h=List.det3(e,g,f),f=List.det3(d,g,f),e=List.scalmult(f,e),d=List.scalmult(h,d);c.homog=List.add(e,d);c.homog=List.normalizeMax(c.homog);c.homog.usage="Point"};geoOpMap.Mid="P";
geoOps.Perp=function(c){var e=csgeo.csnames[c.args[1]].homog,d=List.cross(List.linfty,csgeo.csnames[c.args[0]].homog);d.value=[d.value[1],CSNumber.neg(d.value[0]),d.value[2]];c.homog=List.cross(d,e);c.homog=List.normalizeMax(c.homog);c.homog.usage="Line"};geoOpMap.Perp="L";geoOps.Para=function(c){var e=csgeo.csnames[c.args[1]].homog;c.homog=List.cross(List.cross(List.linfty,csgeo.csnames[c.args[0]].homog),e);c.homog=List.normalizeMax(c.homog);c.homog.usage="Line"};geoOpMap.Para="L";
geoOps.Horizontal=function(c){c.homog=List.cross(List.ex,csgeo.csnames[c.args[0]].homog);c.homog=List.normalizeMax(c.homog);c.homog.usage="Line"};geoOpMap.Horizontal="L";geoOps.Vertical=function(c){c.homog=List.cross(List.ey,csgeo.csnames[c.args[0]].homog);c.homog=List.normalizeMax(c.homog);c.homog.usage="Line"};geoOpMap.Vertical="L";
geoOps.Through=function(c){var e=List.normalizeZ(csgeo.csnames[c.args[0]].homog);move&&move.mover==c&&(c.dir=List.realVector([e.value[0].value.real-mouse.x+move.offset.x,e.value[1].value.real-mouse.y+move.offset.y,0]));c.homog=List.cross(c.dir,e);c.homog=List.normalizeMax(c.homog);c.homog.usage="Line"};geoOpMap.Through="L";geoOps.Free=function(c){};geoOpMap.Free="P";
geoOps.PointOnLine=function(c){var e=csgeo.csnames[c.args[0]].homog,d=c.homog,f=List.cross(List.linfty,e);f.value=[f.value[1],CSNumber.neg(f.value[0]),f.value[2]];d=List.cross(f,d);c.homog=List.cross(d,e);c.homog=List.normalizeMax(c.homog);c.homog.usage="Point";e=CSNumber.div(c.homog.value[0],c.homog.value[2]);d=CSNumber.div(c.homog.value[1],c.homog.value[2]);c.sx=e.value.real;c.sy=d.value.real;c.sz=1};geoOpMap.PointOnLine="P";
geoOps.PointOnCircle=function(c){var e=csgeo.csnames[c.args[0]],d=geoOps._helper.IntersectLC(List.linfty,e.matrix),f=General.mult(e.matrix,d[0]),d=General.mult(e.matrix,d[1]),d=List.normalizeZ(List.cross(f,d));move&&move.mover==c&&(c.angle=CSNumber.real(Math.atan2(-(d.value[1].value.real-mouse.y-move.offset.y),-(d.value[0].value.real-mouse.x-move.offset.x))));f=c.angle;f=List.turnIntoCSList([CSNumber.cos(f),CSNumber.sin(f),CSNumber.real(0)]);f=List.scalmult(CSNumber.real(10),f);f=List.add(d,f);ln=
List.cross(f,d);var e=geoOps._helper.IntersectLC(ln,e.matrix),d=List.normalizeZ(e[0]),g=List.normalizeZ(e[1]),d=List.abs2(List.sub(f,d)),f=List.abs2(List.sub(f,g)),g=e[0];d.value.real>f.value.real&&(g=e[1]);c.homog=g;c.homog=List.normalizeMax(c.homog);c.homog.usage="Point";e=CSNumber.div(c.homog.value[0],c.homog.value[2]);f=CSNumber.div(c.homog.value[1],c.homog.value[2]);c.sx=e.value.real;c.sy=f.value.real;c.sz=1};geoOpMap.PointOnCircle="P";
geoOps.PointOnSegment=function(c){var e=csgeo.csnames[c.args[0]].homog,d=csgeo.csnames[csgeo.csnames[c.args[0]].args[0]].homog,f=csgeo.csnames[csgeo.csnames[c.args[0]].args[1]].homog,g=c.homog,h=CSNumber.div(d.value[0],d.value[2]),d=CSNumber.div(d.value[1],d.value[2]),k=CSNumber.div(f.value[0],f.value[2]),f=CSNumber.div(f.value[1],f.value[2]),p=CSNumber.div(g.value[0],g.value[2]),g=CSNumber.div(g.value[1],g.value[2]);if(!move||move.mover==c){var n=c.homog,q=List.cross(List.linfty,e);q.value=[q.value[1],
CSNumber.neg(q.value[0]),q.value[2]];n=List.cross(q,n);c.homog=List.cross(n,e);c.homog=List.normalizeMax(c.homog);c.homog.usage="Point";var q=h.value.real,r=d.value.real,e=k.value.real,n=f.value.real,s=p.value.real,g=g.value.real,p=Math.sqrt((q-e)*(q-e)+(r-n)*(r-n)),q=Math.sqrt((q-s)*(q-s)+(r-g)*(r-g)),g=Math.sqrt((e-s)*(e-s)+(n-g)*(n-g)),e=q/p;q>p&&(e=1);g>p&&(e=0);c.param=CSNumber.real(e)}k=CSNumber.sub(k,h);h=CSNumber.add(h,CSNumber.mult(c.param,k));f=CSNumber.sub(f,d);d=CSNumber.add(d,CSNumber.mult(c.param,
f));f=CSNumber.real(1);c.homog=List.turnIntoCSList([h,d,f]);c.homog=List.normalizeMax(c.homog);c.homog.usage="Point";d=CSNumber.div(c.homog.value[0],c.homog.value[2]);h=CSNumber.div(c.homog.value[1],c.homog.value[2]);c.sx=d.value.real;c.sy=h.value.real;c.sz=1};geoOpMap.PointOnSegment="P";geoOps._helper.CenterOfConic=function(c){var e=geoOps._helper.IntersectLC(List.linfty,c),d=General.mult(c,e[0]);c=General.mult(c,e[1]);return List.cross(d,c)};
geoOps.CenterOfConic=function(c){var e=geoOps._helper.CenterOfConic(csgeo.csnames[c.args[0]].matrix);c.homog=e;c.homog=List.normalizeMax(c.homog);c.homog.usage="Point"};geoOpMap.CenterOfConic="P";geoOps._helper.CircleMP=function(c,e){var d=List.crossOperator(c),f=List.transpose(d),d=General.mult(f,General.mult(List.fundDual,d)),g=General.mult(General.mult(e,d),e),f=General.mult(General.mult(e,List.fund),e),g=General.mult(g,List.fund),d=General.mult(f,d);return List.sub(g,d)};
geoOps.CircleMP=function(c){c.matrix=geoOps._helper.CircleMP(csgeo.csnames[c.args[0]].homog,csgeo.csnames[c.args[1]].homog);c.matrix=List.normalizeMax(c.matrix);c.matrix.usage="Circle"};geoOpMap.CircleMP="C";
geoOps.CircleMr=function(c){var e=csgeo.csnames[c.args[0]].homog,e=List.scaldiv(e.value[2],e);if(move&&move.mover==c){var d=e.value[0].value.real-mouse.x,f=e.value[1].value.real-mouse.y;rad=Math.sqrt(d*d+f*f);c.radius=CSNumber.real(rad+move.offsetrad)}d=List.turnIntoCSList([c.radius,CSNumber.real(0),CSNumber.real(0)]);d=List.add(d,e);c.matrix=geoOps._helper.CircleMP(e,d);c.matrix=List.normalizeMax(c.matrix);c.matrix.usage="Circle"};geoOpMap.CircleMr="C";
geoOps.CircleMFixedr=function(c){var e=csgeo.csnames[c.args[0]].homog,e=List.scaldiv(e.value[2],e),d=List.turnIntoCSList([c.radius,CSNumber.real(0),CSNumber.real(0)]),d=List.add(d,e);c.matrix=geoOps._helper.CircleMP(e,d);c.matrix=List.normalizeMax(c.matrix);c.matrix.usage="Circle"};geoOpMap.CircleMFixedr="C";
geoOps._helper.ConicBy5=function(c,e,d,f,g,h){c=List.turnIntoCSList([List.cross(d,f)]);var k=List.turnIntoCSList([List.cross(e,g)]);e=List.turnIntoCSList([List.cross(e,d)]);g=List.turnIntoCSList([List.cross(f,g)]);f=General.mult(List.transpose(k),c);g=General.mult(List.transpose(g),e);f=List.add(f,List.transpose(f));g=List.add(g,List.transpose(g));c=General.mult(General.mult(h,f),h);h=General.mult(General.mult(h,g),h);g=General.mult(c,g);h=General.mult(h,f);return List.sub(g,h)};
geoOps.ConicBy5=function(c){var e=geoOps._helper.ConicBy5(c,csgeo.csnames[c.args[0]].homog,csgeo.csnames[c.args[1]].homog,csgeo.csnames[c.args[2]].homog,csgeo.csnames[c.args[3]].homog,csgeo.csnames[c.args[4]].homog);c.matrix=e;c.matrix=List.normalizeMax(c.matrix);c.matrix.usage="Conic"};geoOpMap.ConicBy5="C";
geoOps.CircleBy3=function(c){var e=geoOps._helper.ConicBy5(c,csgeo.csnames[c.args[0]].homog,csgeo.csnames[c.args[1]].homog,List.ii,List.jj,csgeo.csnames[c.args[2]].homog);c.matrix=List.normalizeMax(e);c.matrix.usage="Circle"};geoOpMap.CircleBy3="C";
geoOps._helper.tracing2=function(c,e,d,f,g){var h=List.projectiveDistMinScal(d,c);d=List.projectiveDistMinScal(d,e);var k=List.projectiveDistMinScal(f,c);f=List.projectiveDistMinScal(f,e);g.results=h+f<d+k?List.turnIntoCSList([c,e]):List.turnIntoCSList([e,c])};
geoOps._helper.tracing2X=function(c,e,d,f,g){var h=0,k=List.projectiveDistMinScal(d,c),p=List.projectiveDistMinScal(d,e),n=List.projectiveDistMinScal(f,c),q=List.projectiveDistMinScal(f,e);d=List.projectiveDistMinScal(d,f);f=List.projectiveDistMinScal(c,e);var r=1E-6<d;return d/3>k+q&&f/3>k+q?(g.results=List.turnIntoCSList([c,e]),0+h):d/3>p+n&&f/3>p+n?(g.results=List.turnIntoCSList([e,c]),0+h):1E-5>f?(r&&(h=2),g.results=List.turnIntoCSList([c,e]),0+h):r&&2!=h?1+h:(g.results=List.turnIntoCSList([c,
e]),0+h)};
geoOps._helper.IntersectLC=function(c,e){var d=CSNumber,f=List.crossOperator(c),g=List.transpose(f),g=General.mult(g,General.mult(e,f)),h=g.value[0].value[0],k=g.value[0].value[1],p=g.value[0].value[2],n=g.value[1].value[0],q=g.value[1].value[1],r=g.value[1].value[2],s=g.value[2].value[0],t=g.value[2].value[1],v=g.value[2].value[2],u=c.value[0],x=c.value[1],y=c.value[2],l=d.abs(u).value.real,A=d.abs(x).value.real,z=d.abs(y).value.real,C;z>=l&&z>=A&&(C=d.div(d.sqrt(d.sub(d.mult(k,n),d.mult(h,q))),
y));l>=A&&l>=z&&(C=d.div(d.sqrt(d.sub(d.mult(r,t),d.mult(q,v))),u));A>=l&&A>=z&&(C=d.div(d.sqrt(d.sub(d.mult(s,p),d.mult(v,h))),x));f=List.add(g,List.scalmult(C,f));d=f.value[0];d=List.normalizeMax(d);d.usage="Point";f=List.transpose(f);f=f.value[0];f=List.normalizeMax(f);f.usage="Point";return[d,f]};
geoOps.IntersectLC=function(c){var e=geoOps._helper.IntersectLC(csgeo.csnames[c.args[0]].homog,csgeo.csnames[c.args[1]].matrix),d=e[0],e=e[1];c.inited?(geoOps._helper.tracing2(d,e,c.check1,c.check2,c),List._helper.isNaN(c.results.value[0])||List._helper.isNaN(c.results.value[1])||(c.check1=c.results.value[0],c.check2=c.results.value[1])):(c.check1=d,c.check2=e,c.inited=!0,c.results=List.turnIntoCSList([d,e]))};geoOpMap.IntersectLC="T";
geoOps.IntersectCirCir=function(c){var e=csgeo.csnames[c.args[0]].matrix,d=csgeo.csnames[c.args[1]].matrix,f=List.scalmult(d.value[0].value[0],e.value[2]),d=List.scalmult(e.value[0].value[0],d.value[2]),f=List.sub(f,d);f.value[2]=CSNumber.mult(CSNumber.real(.5),f.value[2]);f=List.normalizeMax(f);f=geoOps._helper.IntersectLC(f,e);e=f[0];f=f[1];c.inited?(geoOps._helper.tracing2(e,f,c.check1,c.check2,c),c.check1=c.results.value[0],c.check2=c.results.value[1]):(c.check1=e,c.check2=f,c.inited=!0,c.results=
List.turnIntoCSList([e,f]))};geoOpMap.IntersectCirCir="T";geoOps.SelectP=function(c){var e=csgeo.csnames[c.args[0]];c.inited||(c.inited=!0);c.homog=e.results.value[c.index-1]};geoOpMap.SelectP="P";var geoscripts={};var csconsole,cslib,cscompiled={},csanimating=!1,csticking=!1,csscale=0,csgridsize=0,csgridscript,cssnap=!1;dump=function(c){console.log(JSON.stringify(c))};dumpcs=function(c){console.log(niceprint(c))};evalcs=function(c){c=evaluator.parse([General.wrap(c)],[]);c=evaluate(c);dumpcs(c)};evokeCS=function(c){c=condense(c);c=analyse(c,!1);console.log(c);evaluate(c);evaluate(cscompiled.draw)};
var initialTransformation=function(c){if(c.transform){c=c.transform;for(var e=0;e<c.length;e++){var d=c[e],f=Object.keys(d)[0];"scale"==f&&(csscale=d.scale,csport[f](d.scale));if("translate"==f)csport[f](d.translate[0],d.translate[1])}csport.createnewbackup()}};
createCindy=function(c){csmouse=[100,100];cscount=0;var e,d=document.getElementById(c.canvasname);csctx=d.getContext("2d");e=condense(initialscript);var f=analyse(e,!1);evaluate(f);"move keydown mousedown mouseup mousedrag init tick".split(" ").forEach(function(d){var f=d+"script";c[f]&&(e=document.getElementById(c[f]).text,e=condense(e),cscompiled[d]=analyse(e,!1))});c.grid&&0!=c.grid&&(csgridsize=c.grid,csgridscript=analyse("#drawgrid("+csgridsize+")",!1));c.snap&&(cssnap=c.snap);initialTransformation(c);
csw=d.width;csh=d.height;csport.drawingstate.matrix.ty-=csh;csport.drawingstate.initialmatrix.ty-=csh;csgeo={};images={};c.geometry||(c.geometry=[]);csinit(c.geometry);c.behavior||(c.behavior=[]);"function"==typeof csinitphys&&csinitphys(c.behavior);for(var g in c.images)d=c.images[g],images[g]=new Image,images[g].ready=!1,images[g].onload=function(){images[g].ready=!0;updateCindy()},images[g].src=d;evaluate(cscompiled.init);setuplisteners(document.getElementById(c.canvasname))};backup=[];
var backupGeo=function(){backup=[];for(var c=0;c<csgeo.points.length;c++){var e=csgeo.points[c],d={name:JSON.stringify(e.name),homog:JSON.stringify(e.homog),sx:JSON.stringify(e.sx),sy:JSON.stringify(e.sy),sz:JSON.stringify(e.sz)};"undefined"!==typeof e.behavior&&(d.vx=JSON.stringify(e.behavior.vx),d.vy=JSON.stringify(e.behavior.vy),d.vz=JSON.stringify(e.behavior.vz));backup.push(d)}},restoreGeo=function(){for(var c=0;c<backup.length;c++){name=JSON.parse(backup[c].name);var e=csgeo.csnames[name];e.homog=
JSON.parse(backup[c].homog);e.sx=JSON.parse(backup[c].sx);e.sy=JSON.parse(backup[c].sy);e.sz=JSON.parse(backup[c].sz);"undefined"!==typeof e.behavior&&(e.behavior.vx=JSON.parse(backup[c].vx),e.behavior.vy=JSON.parse(backup[c].vy),e.behavior.vz=JSON.parse(backup[c].vz),e.behavior.fx=0,e.behavior.fy=0,e.behavior.fz=0)}},csplay=function(){csanimating=!0;backupGeo();startit()},cspause=function(){csanimating=!1},csstop=function(){csanimating=!1;restoreGeo()},initialscript="           #drawgrid(s):=(              regional(b,xmin,xmax,ymin,ymax,nx,ny);              b=screenbounds();              xmin=b_4_1-s;              xmax=b_2_1+s;              ymin=b_4_2-s;              ymax=b_2_2+s;              nx=round((xmax-xmin)/s);              ny=round((ymax-ymin)/s);              xmin=floor(xmin/s)*s;              ymin=floor(ymin/s)*s;              repeat(nx,x,                 draw((xmin+x*s,ymin),(xmin+x*s,ymax),color->(1,1,1)*.9,size->1);              );              repeat(ny,y,                 draw((xmin,ymin+y*s),(xmax,ymin+y*s),color->(1,1,1)*.9,size->1);              )            );";var mouse={},move,cskey="",cskeycode=0;movepoint=function(c){if(void 0!=c.mover&&(m=c.mover,!m.pinned)){m.sx=mouse.x+c.offset.x;m.sy=mouse.y+c.offset.y;if(cssnap&&0!=csgridsize){c=Math.round(m.sx/csgridsize)*csgridsize;var e=Math.round(m.sy/csgridsize)*csgridsize;.2>Math.abs(c-m.sx)&&.2>Math.abs(e-m.sy)&&(m.sx=c,m.sy=e)}m.sz=1;m.homog=List.realVector([m.sx,m.sy,m.sz])}};movepointscr=function(c,e){m=c;m.sx=e.value[0].value.real;m.sy=e.value[1].value.real;m.sz=1;m.homog=e};
getmover=function(c){for(var e,d=1E6,f,g,h=0;h<csgeo.free.length;h++){var k=csgeo.free[h];if(!k.pinned){var p,n;if("P"==k.kind){p=k.sx-c.x;n=k.sy-c.y;var q=Math.sqrt(p*p+n*n);k.narrow&q>20/csport.drawingstate.matrix.sdet&&(q=1E4)}"C"==k.kind&&(n=csgeo.csnames[k.args[0]],g=k.radius,p=CSNumber.div(n.homog.value[0],n.homog.value[2]).value.real,n=CSNumber.div(n.homog.value[1],n.homog.value[2]).value.real,p-=c.x,n-=c.y,q=Math.sqrt(p*p+n*n)-g.value.real,g=-q,n=p=0,0>q&&(q=-q),q+=1);"L"==k.kind&&(p=List.normalizeZ(k.homog),
n=CSNumber,q=n.add(n.mult(p.value[0],n.conjugate(p.value[0])),n.mult(p.value[1],n.conjugate(p.value[1]))),n=List.scaldiv(n.sqrt(q),p),q=n.value[0].value.real*c.x+n.value[1].value.real*c.y+n.value[2].value.real,p=n.value[0].value.real*q,n=n.value[1].value.real*q,0>q&&(q=-q),q+=1);q<d+.2&&(d=q,e=k,f={x:p,y:n})}}return{mover:e,offset:f,offsetrad:g}};
setuplisteners=function(c){function e(c){mouse.down=!1;updateCindy();cs_mouseup();c.preventDefault()}updatePostition=function(c,e){var g=csport.to(c,e);mouse.prevx=mouse.x;mouse.prevy=mouse.y;mouse.x=g[0];mouse.y=g[1];csmouse[0]=mouse.x;csmouse[1]=mouse.y};document.onkeydown=function(c){cs_keypressed(c);return!1};c.onmousedown=function(d){mouse.button=d.which;var e=c.getBoundingClientRect();updatePostition(d.clientX-e.left,d.clientY-e.top);cs_mousedown();move=getmover(mouse);startit();mouse.down=
!0;d.preventDefault()};c.onmouseup=function(c){mouse.down=!1;cs_mouseup();updateCindy();c.preventDefault()};c.onmousemove=function(d){var e=c.getBoundingClientRect();updatePostition(d.clientX-e.left,d.clientY-e.top);mouse.down?(movepoint(move),cs_mousedrag()):cs_mousemove();d.preventDefault()};c.addEventListener("touchstart",function(d){d||(d=event);updatePostition(d.targetTouches[0].pageX-c.offsetLeft,d.targetTouches[0].pageY-c.offsetTop);cs_mousedown();mouse.down=!0;move=getmover(mouse);startit();
d.preventDefault()},!1);c.addEventListener("touchmove",function(d){d||(d=event);updatePostition(d.targetTouches[0].pageX-c.offsetLeft,d.targetTouches[0].pageY-c.offsetTop);mouse.down?(movepoint(move),cs_mousedrag()):cs_mousemove();d.preventDefault()},!0);c.addEventListener("touchend",e,!1);document.body.addEventListener("touchcancel",e,!1);updateCindy()};
window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c){window.setTimeout(c,0)};var doit=function(){csanimating&&cs_tick();updateCindy();csticking=csanimating||mouse.down;return!csticking},startit=function(){csticking||(csticking=!0,d3.timer(doit))};
function updateCindy(){recalc();csctx.save();csctx.clearRect(0,0,csw,csh);0!=csgridsize&&evaluate(csgridscript);evaluate(cscompiled.move);csport.greset();render();csctx.restore()}function update(){updateCindy();mouse.down&&requestAnimFrame(update)}
var cs_keypressed=function(c){c=window.event?event:c;c=c.charCode?c.charCode:c.keyCode;cskey=String.fromCharCode(c);cskeycode=c;evaluate(cscompiled.keydown);updateCindy()},cs_mousedown=function(c){evaluate(cscompiled.mousedown)},cs_mouseup=function(c){evaluate(cscompiled.mouseup)},cs_mousedrag=function(c){evaluate(cscompiled.mousedrag)},cs_mousemove=function(c){evaluate(cscompiled.mousemove)},cs_tick=function(c){"undefined"!==typeof lab&&lab.tick();csanimating&&evaluate(cscompiled.tick)};var d3_arraySlice=[].slice,d3_array=function(c){return d3_arraySlice.call(c)},d3_document=document,d3_documentElement=d3_document.documentElement,d3_window=window;try{d3_array(d3_documentElement.childNodes)[0].nodeType}catch(e$$17){d3_array=function(c){for(var e=c.length,d=Array(e);e--;)d[e]=c[e];return d}}function d3_vendorSymbol(c,e){if(e in c)return e;e=e.charAt(0).toUpperCase()+e.substring(1);for(var d=0,f=d3_vendorPrefixes.length;d<f;++d){var g=d3_vendorPrefixes[d]+e;if(g in c)return g}}
var d3_vendorPrefixes="webkit ms moz Moz o O".split(" "),d3={},d3_timer_queueHead,d3_timer_queueTail,d3_timer_interval,d3_timer_timeout,d3_timer_active,d3_timer_frame=d3_window[d3_vendorSymbol(d3_window,"requestAnimationFrame")]||function(c){setTimeout(c,17)};
d3.timer=function(c,e,d){var f=arguments.length;2>f&&(e=0);3>f&&(d=Date.now());f={c:c,t:d+e,f:!1,n:null};d3_timer_queueTail?d3_timer_queueTail.n=f:d3_timer_queueHead=f;d3_timer_queueTail=f;d3_timer_interval||(d3_timer_timeout=clearTimeout(d3_timer_timeout),d3_timer_interval=1,d3_timer_frame(d3_timer_step))};
function d3_timer_step(){var c=d3_timer_mark(),c=d3_timer_sweep()-c;24<c?(isFinite(c)&&(clearTimeout(d3_timer_timeout),d3_timer_timeout=setTimeout(d3_timer_step,c)),d3_timer_interval=0):(d3_timer_interval=1,d3_timer_frame(d3_timer_step))}d3.timer.flush=function(){d3_timer_mark();d3_timer_sweep()};
function d3_timer_mark(){var c=Date.now();for(d3_timer_active=d3_timer_queueHead;d3_timer_active;)c>=d3_timer_active.t&&(d3_timer_active.f=d3_timer_active.c(c-d3_timer_active.t)),d3_timer_active=d3_timer_active.n;return c}function d3_timer_sweep(){for(var c,e=d3_timer_queueHead,d=Infinity;e;)e.f?e=c?c.n=e.n:d3_timer_queueHead=e.n:(e.t<d&&(d=e.t),e=(c=e).n);d3_timer_queueTail=c;return d};function Nada(){this.ctype="undefined"}function Void(){this.ctype="void"}function CError(c){this.ctype="error";this.message=c}var nada=new Nada;
function Namespace(){this.vars={pi:{ctype:"variable",stack:[{ctype:"number",value:{real:Math.PI,imag:0}}],name:"pi"},i:{ctype:"variable",stack:[{ctype:"number",value:{real:0,imag:1}}],name:"i"},"true":{ctype:"variable",stack:[{ctype:"boolean",value:!0}],name:"true"},"false":{ctype:"variable",stack:[{ctype:"boolean",value:!1}],name:"false"},"#":{ctype:"variable",stack:[nada],name:"#"}};this.isVariable=function(c){return void 0!==this.vars[c]};this.isVariableName=function(c){if("#"==c||"#1"==c||"#2"==
c)return!0;var e=/^[a-z,A-Z]+$/.test(c[0]);c=/^[0-9,a-z,A-Z]+$/.test(c);return e&&c};this.create=function(c){this.vars[c]={ctype:"variable",stack:[],name:c};return this.vars[c]};this.newvar=function(c){if(void 0===this.vars[c])return this.create(c);this.vars[c].stack.push(nada);return this.vars[c]};this.removevar=function(c){this.vars[c].stack.pop()};this.setvar=function(c,e){var d=this.vars[c].stack;if("undefined"==e.ctype)d[d.length-1]=e;else{var f=evaluator._helper.clone(e);d[d.length-1]=f}};this.setvarnocopy=
function(c,e){var d=this.vars[c].stack;d[d.length-1]=e};this.getvar=function(c){var e=this.vars[c].stack;return 0==e.length&&e[e.length-1]==nada&&"undefined"!==typeof csgeo.csnames[c]?{ctype:"geo",value:csgeo.csnames[c]}:e[e.length-1]};this.dump=function(c){var e=this.vars[c].stack;console.log("*** Dump "+c);for(c=0;c<e.length;c++)console.log(c+":> "+niceprint(e[c]))};this.vstack=[];this.pushVstack=function(c){this.vstack.push(c)};this.popVstack=function(){this.vstack.pop()};this.cleanVstack=function(){for(var c=
this.vstack;0<c.length&&"*"!=c[c.length-1];)this.removevar(c[c.length-1]),c.pop();0<c.length&&c.pop()}}var namespace=new Namespace;var Accessor={generalFields:{color:"color",colorhsb:"",size:"size",alpha:"alpha",isshowing:"isshowing",visible:"visible",name:"name",caption:"caption",trace:"trace",tracelength:"",selected:""},getGeoField:function(c,e){return"undefined"!==typeof csgeo.csnames[c]?Accessor.getField(csgeo.csnames[c],e):nada},setGeoField:function(c,e,d){return"undefined"!==typeof csgeo.csnames[c]?Accessor.setField(csgeo.csnames[c],e,d):nada},getField:function(c,e){if("P"==c.kind){if("xy"==e){var d=CSNumber.div(c.homog.value[0],
c.homog.value[2]),f=CSNumber.div(c.homog.value[1],c.homog.value[2]),d=List.turnIntoCSList([d,f]);d.usage="Point";return d}if("homog"==e)return d=List.clone(c.homog),d.usage="Point",d;if("x"==e)return CSNumber.div(c.homog.value[0],c.homog.value[2]);if("y"==e)return CSNumber.div(c.homog.value[1],c.homog.value[2])}if("L"==c.kind){if("homog"==e)return d=List.clone(c.homog),d.usage="Line",d;if("angle"==e)return d=List.eucangle(List.ey,c.homog),d.usage="Angle",d}if(Accessor.generalFields[e])return(d=c[Accessor.generalFields[e]])?
d=General.clone(d):nada;if(c.behavior){if("mass"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.mass);if("radius"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.radius);if("charge"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.charge);if("friction"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.friction);if("vx"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.vx);if("vy"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.vy);
if("v"==e&&"Mass"==c.behavior.type)return List.realVector([c.behavior.vx,c.behavior.vy]);if("fx"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.fx);if("fy"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.fy);if("f"==e&&"Mass"==c.behavior.type)return List.realVector([c.behavior.fx,c.behavior.fy])}return nada},setField:function(c,e,d){"color"==e&&(c.color=List.clone(d));"size"==e&&(c.size=General.clone(d));"xy"==e&&"P"==c.kind&&c.ismovable&&List._helper.isNumberVecN(d,2)&&(movepointscr(c,
List.turnIntoCSList([d.value[0],d.value[1],CSNumber.real(1)])),recalc());"homog"==e&&"P"==c.kind&&c.ismovable&&List._helper.isNumberVecN(d,2)&&(movepointscr(c,General.clone(d)),recalc());if("angle"==e&&"L"==c.kind){var f=CSNumber.cos(d),g=CSNumber.sin(d),f=List.turnIntoCSList([f,g,CSNumber.real(0)]);c.dir=f;recalc()}c.behavior&&("mass"==e&&"Mass"==c.behavior.type&&"number"==d.ctype&&(c.behavior.mass=d.value.real),"friction"==e&&"Mass"==c.behavior.type&&"number"==d.ctype&&(c.behavior.friction=d.value.real),
"charge"==e&&"Mass"==c.behavior.type&&"number"==d.ctype&&(c.behavior.charge=d.value.real),"radius"==e&&"Mass"==c.behavior.type&&"number"==d.ctype&&(c.behavior.radius=d.value.real),"vx"==e&&"Mass"==c.behavior.type&&"number"==d.ctype&&(c.behavior.vx=d.value.real),"vy"==e&&"Mass"==c.behavior.type&&"number"==d.ctype&&(c.behavior.vy=d.value.real),"v"==e&&"Mass"==c.behavior.type&&List._helper.isNumberVecN(d,2)&&(c.behavior.vx=d.value[0].value.real,c.behavior.vy=d.value[1].value.real))}};var CSNumber={niceprint:function(c){return 0==c.value.imag?""+c.value.real:0<c.value.imag?""+c.value.real+" + i*"+c.value.imag:""+c.value.real+" - i*"+-c.value.imag},complex:function(c,e){return{ctype:"number",value:{real:c,imag:e}}},real:function(c){return{ctype:"number",value:{real:c,imag:0}}},clone:function(c){return{ctype:"number",value:{real:c.value.real,imag:c.value.imag},usage:c.usage}},argmax:function(c,e){return c.value.real*c.value.real+c.value.imag*c.value.imag<e.value.real*e.value.real+
e.value.imag*e.value.imag?e:c},max:function(c,e){return{ctype:"number",value:{real:Math.max(c.value.real,e.value.real),imag:Math.max(c.value.imag,e.value.imag)}}},min:function(c,e){return{ctype:"number",value:{real:Math.min(c.value.real,e.value.real),imag:Math.min(c.value.imag,e.value.imag)}}},add:function(c,e){return{ctype:"number",value:{real:c.value.real+e.value.real,imag:c.value.imag+e.value.imag}}},sub:function(c,e){return{ctype:"number",value:{real:c.value.real-e.value.real,imag:c.value.imag-
e.value.imag}}},neg:function(c){return{ctype:"number",value:{real:-c.value.real,imag:-c.value.imag}}},re:function(c){return{ctype:"number",value:{real:c.value.real,imag:0}}},im:function(c){return{ctype:"number",value:{real:c.value.imag,imag:0}}},conjugate:function(c){return{ctype:"number",value:{real:c.value.real,imag:-c.value.imag}}},round:function(c){return{ctype:"number",value:{real:Math.round(c.value.real),imag:Math.round(c.value.imag)}}},ceil:function(c){return{ctype:"number",value:{real:Math.ceil(c.value.real),
imag:Math.ceil(c.value.imag)}}},floor:function(c){return{ctype:"number",value:{real:Math.floor(c.value.real),imag:Math.floor(c.value.imag)}}},mult:function(c,e){return{ctype:"number",value:{real:c.value.real*e.value.real-c.value.imag*e.value.imag,imag:c.value.real*e.value.imag+c.value.imag*e.value.real}}},abs2:function(c,e){return{ctype:"number",value:{real:c.value.real*c.value.real+c.value.imag*c.value.imag,imag:0}}},abs:function(c){return CSNumber.sqrt(CSNumber.abs2(c))},inv:function(c){var e=c.value.real*
c.value.real+c.value.imag*c.value.imag;0==e&&console.log("DIVISION BY ZERO");return{ctype:"number",value:{real:c.value.real/e,imag:-c.value.imag/e}}},div:function(c,e){return CSNumber.mult(c,CSNumber.inv(e))},eps:1E-7,snap:function(c){var e=c.value.real;c=c.value.imag;Math.floor(e+CSNumber.eps)!=Math.floor(e-CSNumber.eps)&&(e=Math.round(e));Math.floor(c+CSNumber.eps)!=Math.floor(c-CSNumber.eps)&&(c=Math.round(c));return{ctype:"number",value:{real:e,imag:c}}},exp:function(c){var e=Math.exp(c.value.real),
d=e*Math.cos(c.value.imag);c=e*Math.sin(c.value.imag);return{ctype:"number",value:{real:d,imag:c}}},cos:function(c){var e=c.value.real,d=c.value.imag,f=Math.exp(d);c=f*Math.sin(-e);var g=f*Math.cos(-e),f=Math.exp(-d),d=f*Math.sin(e),e=f*Math.cos(e);return{ctype:"number",value:{real:(g+e)/2,imag:(c+d)/2}}},sin:function(c){var e=c.value.real,d=c.value.imag,f=Math.exp(d);c=f*Math.sin(-e);var g=f*Math.cos(-e),f=Math.exp(-d),d=f*Math.sin(e),e=f*Math.cos(e);return{ctype:"number",value:{real:-(c-d)/2,imag:(g-
e)/2}}},tan:function(c){var e=CSNumber.sin(c);c=CSNumber.cos(c);return CSNumber.div(e,c)},arccos:function(c){var e=CSNumber.mult(c,CSNumber.neg(c)),e=CSNumber.sqrt(CSNumber.add(CSNumber.real(1),e));c=CSNumber.add(CSNumber.mult(c,CSNumber.complex(0,1)),e);c=CSNumber.add(CSNumber.mult(CSNumber.log(c),CSNumber.complex(0,1)),CSNumber.real(.5*Math.PI));c.usage="angle";return c},arcsin:function(c){var e=CSNumber.mult(c,CSNumber.neg(c)),e=CSNumber.sqrt(CSNumber.add(CSNumber.real(1),e));c=CSNumber.add(CSNumber.mult(c,
CSNumber.complex(0,1)),e);c=CSNumber.mult(CSNumber.log(c),CSNumber.complex(0,-1));c.usage="angle";return c},arctan:function(c){var e=CSNumber.log(CSNumber.add(CSNumber.mult(c,CSNumber.complex(0,-1)),CSNumber.real(1)));c=CSNumber.log(CSNumber.add(CSNumber.mult(c,CSNumber.complex(0,1)),CSNumber.real(1)));e=CSNumber.mult(CSNumber.sub(e,c),CSNumber.complex(0,.5));e.usage="angle";return e},arctan2:function(c,e){var d=CSNumber.real(Math.atan2(e.value.real,c.value.real));d.usage="angle";return d},sqrt:function(c){var e=
c.value.real,d=c.value.imag;c=Math.sqrt(Math.sqrt(e*e+d*d));e=Math.atan2(d,e);d=c*Math.sin(e/2);return{ctype:"number",value:{real:c*Math.cos(e/2),imag:d}}},log:function(c){var e=c.value.real,d=c.value.imag,f=Math.sqrt(e*e+d*d);c=Math.atan2(d,e);0>d&&(c+=2*Math.PI);0==d&&0>e&&(c=Math.PI);c>Math.PI&&(c-=2*Math.PI);e=Math.log(f);return CSNumber.snap({ctype:"number",value:{real:e,imag:c}})},pow:function(c,e){if(e.value.real==Math.round(e.value.real)&&0==e.value.imag){for(var d={ctype:"number",value:{real:1,
imag:0}},f=0;f<Math.abs(e.value.real);f++)d=CSNumber.mult(d,c);return 0>e.value.real?CSNumber.inv(d):d}return CSNumber.exp(CSNumber.mult(CSNumber.log(c),e))},mod:function(c,e){var d=c.value.real,f=e.value.real,g=c.value.imag,h=e.value.imag,d=d-Math.floor(d/f)*f,g=g-Math.floor(g/h)*h;0==f&&(d=0);0==h&&(g=0);return CSNumber.snap({ctype:"number",value:{real:d,imag:g}})},_helper:{}};CSNumber._helper.seed="NO";CSNumber.eps=1E-10;CSNumber.epsbig=1E-6;
CSNumber._helper.seedrandom=function(c){c-=Math.floor(c);CSNumber._helper.seed=.8*c+.1};CSNumber._helper.rand=function(){if("NO"==CSNumber._helper.seed)return Math.random();var c=CSNumber._helper.seed,c=1E3*Math.sin(1E3*c),c=c-Math.floor(c);return CSNumber._helper.seed=c};CSNumber._helper.randnormal=function(){var c=CSNumber._helper.rand(),e=CSNumber._helper.rand();return Math.sqrt(-2*Math.log(c))*Math.cos(2*Math.PI*e)};
CSNumber._helper.isEqual=function(c,e){return c.value.real==e.value.real&&c.value.imag==e.value.imag};CSNumber._helper.isLessThan=function(c,e){return c.value.real<e.value.real||c.value.real==e.value.real&&c.value.imag<e.value.imag};CSNumber._helper.compare=function(c,e){return CSNumber._helper.isLessThan(c,e)?-1:CSNumber._helper.isEqual(c,e)?0:1};
CSNumber._helper.isAlmostEqual=function(c,e){var d=c.value.real-e.value.real,f=c.value.imag-e.value.imag;return d<CSNumber.eps&&d>-CSNumber.eps&&f<CSNumber.eps&&f>-CSNumber.eps};CSNumber._helper.isZero=function(c){return 0==c.value.real&&0==c.value.imag};CSNumber._helper.isAlmostZero=function(c){var e=c.value.real;c=c.value.imag;return e<CSNumber.eps&&e>-CSNumber.eps&&c<CSNumber.eps&&c>-CSNumber.eps};CSNumber._helper.isReal=function(c){return 0==c.value.imag};
CSNumber._helper.isAlmostReal=function(c){c=c.value.imag;return c<CSNumber.epsbig&&c>-CSNumber.epsbig};CSNumber._helper.isNaN=function(c){return isNaN(c.value.real)||isNaN(c.value.imag)};CSNumber._helper.isAlmostImag=function(c){c=c.value.real;return c<CSNumber.epsbig&&c>-CSNumber.epsbig};var List={_helper:{},turnIntoCSList:function(c){return{ctype:"list",value:c}},realVector:function(c){for(var e=[],d=0;d<c.length;d++)e[e.length]={ctype:"number",value:{real:c[d],imag:0}};return{ctype:"list",value:e}},realMatrix:function(c){for(var e=[],d=0;d<c.length;d++)e[e.length]=List.realVector(c[d]);return List.turnIntoCSList(e)}};List.ex=List.realVector([1,0,0]);List.ey=List.realVector([0,1,0]);List.ez=List.realVector([0,0,1]);List.linfty=List.realVector([0,0,1]);
List.ii=List.turnIntoCSList([CSNumber.complex(1,0),CSNumber.complex(0,1),CSNumber.complex(0,0)]);List.jj=List.turnIntoCSList([CSNumber.complex(1,0),CSNumber.complex(0,-1),CSNumber.complex(0,0)]);List.fundDual=List.realMatrix([[1,0,0],[0,1,0],[0,0,0]]);List.fund=List.realMatrix([[0,0,0],[0,0,0],[0,0,1]]);List.sequence=function(c,e){for(var d=[],f=Math.round(c.value.real);f<Math.round(e.value.real)+1;f++)d[d.length]={ctype:"number",value:{real:f,imag:0}};return{ctype:"list",value:d}};
List.pairs=function(c){for(var e=[],d=0;d<c.value.length-1;d++)for(var f=d+1;f<c.value.length;f++)e[e.length]={ctype:"list",value:[c.value[d],c.value[f]]};return{ctype:"list",value:e}};List.triples=function(c){for(var e=[],d=0;d<c.value.length-2;d++)for(var f=d+1;f<c.value.length-1;f++)for(var g=f+1;g<c.value.length;g++)e[e.length]={ctype:"list",value:[c.value[d],c.value[f],c.value[g]]};return{ctype:"list",value:e}};
List.triples=function(c){for(var e=[],d=0;d<c.value.length-2;d++)for(var f=d+1;f<c.value.length-1;f++)for(var g=f+1;g<c.value.length;g++)e[e.length]={ctype:"list",value:[c.value[d],c.value[f],c.value[g]]};return{ctype:"list",value:e}};List.cycle=function(c){for(var e=[],d=0;d<c.value.length-1;d++)e[e.length]={ctype:"list",value:[c.value[d],c.value[d+1]]};e[e.length]={ctype:"list",value:[c.value[c.value.length-1],c.value[0]]};return{ctype:"list",value:e}};
List.consecutive=function(c){for(var e=[],d=0;d<c.value.length-1;d++)e[e.length]={ctype:"list",value:[c.value[d],c.value[d+1]]};return{ctype:"list",value:e}};List.reverse=function(c){for(var e=[],d=c.value.length-1;0<=d;d--)e[e.length]=c.value[d];return{ctype:"list",value:e}};List.directproduct=function(c,e){for(var d=[],f=0;f<c.value.length;f++)for(var g=0;g<e.value.length;g++)d[d.length]={ctype:"list",value:[c.value[f],e.value[g]]};return{ctype:"list",value:d}};
List.concat=function(c,e){for(var d=[],f=0;f<c.value.length;f++)d[d.length]=c.value[f];for(f=0;f<e.value.length;f++)d[d.length]=e.value[f];return{ctype:"list",value:d}};List.prepend=function(c,e){var d=[];d[d.length]=c;for(var f=0;f<e.value.length;f++)d[d.length]=e.value[f];return{ctype:"list",value:d}};List.append=function(c,e){for(var d=[],f=0;f<c.value.length;f++)d[d.length]=c.value[f];d[d.length]=e;return{ctype:"list",value:d}};
List.contains=function(c,e){for(var d=0;d<c.value.length;d++)if(evaluator._helper.equals(c.value[d],e).value)return{ctype:"boolean",value:!0};return{ctype:"boolean",value:!1}};List.common=function(c,e){for(var d=[],f=0;f<c.value.length;f++){for(var g=!1,h=c.value[f],k=0;k<e.value.length;k++)g=g||evaluator._helper.equals(h,e.value[k]).value;g&&(d[d.length]=c.value[f])}return{ctype:"list",value:d}};
List.remove=function(c,e){for(var d=[],f=0;f<c.value.length;f++){for(var g=!1,h=c.value[f],k=0;k<e.value.length;k++)g=g||evaluator._helper.equals(h,e.value[k]).value;g||(d[d.length]=c.value[f])}return{ctype:"list",value:d}};List._helper.compare=function(c,e){return"number"==c.ctype&&"number"==e.ctype?c.value.real-e.value.real:-1};List.sort1=function(c){c=c.value.sort(General.compare);return List.turnIntoCSList(c)};List._helper.isEqual=function(c,e){return List.equals(c,e).value};
List._helper.isLessThan=function(c,e){for(var d=c.value.length,f=e.value.length,g=0;!(g>=d||g>=f)&&General.isEqual(c.value[g],e.value[g]);)g++;return g==d&&g<f?!0:g==f&&g<d||g==d&&g==f?!1:General.isLessThan(c.value[g],e.value[g])};List._helper.compare=function(c,e){return List._helper.isLessThan(c,e)?-1:List._helper.isEqual(c,e)?0:1};
List.equals=function(c,e){if(c.value.length!=e.value.length)return{ctype:"boolean",value:!1};for(var d=!0,f=0;f<c.value.length;f++)var g=c.value[f],h=e.value[f],d="list"==g.ctype&&"list"==h.ctype?d&&List.equals(g,h).value:d&&evaluator.comp_equals([g,h],[]).value;return{ctype:"boolean",value:d}};
List.almostequals=function(c,e){if(c.value.length!=e.value.length)return{ctype:"boolean",value:!1};for(var d=!0,f=0;f<c.value.length;f++)var g=c.value[f],h=e.value[f],d="list"==g.ctype&&"list"==h.ctype?d&&List.comp_almostequals(g,h).value:d&&evaluator.comp_almostequals([g,h],[]).value;return{ctype:"boolean",value:d}};List._helper.isAlmostReal=function(c){for(var e=!0,d=0;d<c.value.length;d++)var f=c.value[d],e="list"==f.ctype?e&&List._helper.isAlmostReal(f):e&&CSNumber._helper.isAlmostReal(f);return e};
List._helper.isNaN=function(c){for(var e=!1,d=0;d<c.value.length;d++)var f=c.value[d],e="list"==f.ctype?e||List._helper.isNaN(f):e||CSNumber._helper.isNaN(f);return e};List.set=function(c){var e=[];c=c.value.sort(General.compare);for(var d=0;d<c.length;d++)0!=d&&evaluator.comp_equals([e[e.length-1],c[d]],[]).value||(e[e.length]=c[d]);return{ctype:"list",value:e}};
List.genericListMath=function(c,e){if(0==c.value.length)return nada;for(var d=c.value[0],f=1;f<c.value.length;f++)d=General[e](d,c.value[f]);return d};List.maxval=function(c){for(var e=CSNumber.real(0),d=0;d<c.value.length;d++){var f=c.value[d];"number"==f.ctype&&(e=CSNumber.argmax(e,f));"list"==f.ctype&&(e=CSNumber.argmax(e,List.maxval(f)))}return CSNumber.clone(e)};List.normalizeMax=function(c){var e=CSNumber.inv(List.maxval(c));return List.scalmult(e,c)};
List.normalizeZ=function(c){var e=CSNumber.inv(c.value[2]);return List.scalmult(e,c)};List.max=function(c,e){if(c.value.length!=e.value.length)return nada;for(var d=[],f=0;f<c.value.length;f++)d[d.length]=General.max(c.value[f],e.value[f]);return{ctype:"list",value:d}};List.min=function(c,e){if(c.value.length!=e.value.length)return nada;for(var d=[],f=0;f<c.value.length;f++)d[d.length]=General.min(c.value[f],e.value[f]);return{ctype:"list",value:d}};
List.scaldiv=function(c,e){if("number"!=c.ctype)return nada;for(var d=[],f=0;f<e.value.length;f++){var g=e.value[f];d[d.length]="number"==g.ctype?General.div(g,c):"list"==g.ctype?List.scaldiv(c,g):nada}return{ctype:"list",value:d}};List.scalmult=function(c,e){if("number"!=c.ctype)return nada;for(var d=[],f=0;f<e.value.length;f++){var g=e.value[f];d[d.length]="number"==g.ctype?General.mult(g,c):"list"==g.ctype?List.scalmult(c,g):nada}return{ctype:"list",value:d}};
List.add=function(c,e){if(c.value.length!=e.value.length)return nada;for(var d=[],f=0;f<c.value.length;f++){var g=c.value[f],h=e.value[f];d[d.length]="number"==g.ctype&&"number"==h.ctype?General.add(g,h):"list"==g.ctype&&"list"==h.ctype?List.add(g,h):nada}return{ctype:"list",value:d}};
List.sub=function(c,e){if(c.value.length!=e.value.length)return nada;for(var d=[],f=0;f<c.value.length;f++){var g=c.value[f],h=e.value[f];d[d.length]="number"==g.ctype&&"number"==h.ctype?CSNumber.sub(g,h):"list"==g.ctype&&"list"==h.ctype?List.sub(g,h):nada}return{ctype:"list",value:d}};
List.abs2=function(c){for(var e=0,d=0;d<c.value.length;d++){var f=c.value[d];if("number"==f.ctype)e+=CSNumber.abs2(f).value.real;else if("list"==f.ctype)e+=List.abs2(f).value.real;else return nada}return{ctype:"number",value:{real:e,imag:0}}};List.abs=function(c){return CSNumber.sqrt(List.abs2(c))};List.normalizeMaxXX=function(c){for(var e=-1E4,d=CSNumber.real(1),f=0;f<c.value.length;f++){var g=CSNumber.abs(c.value[f]);g.value.real>e&&(d=c.value[f],e=g.value.real)}return List.scaldiv(d,c)};
List.recursive=function(c,e){for(var d=[],f=0;f<c.value.length;f++){var g=evaluateAndVal(c.value[f]);d[d.length]="number"==g.ctype?CSNumber[e](g):"list"==g.ctype?List[e](g):nada}return{ctype:"list",value:d}};List.re=function(c){return List.recursive(c,"re")};List.neg=function(c){return List.recursive(c,"neg")};List.im=function(c){return List.recursive(c,"im")};List.conjugate=function(c){return List.recursive(c,"conjugate")};List.round=function(c){return List.recursive(c,"round")};
List.ceil=function(c){return List.recursive(c,"ceil")};List.floor=function(c){return List.recursive(c,"floor")};List._helper.colNumb=function(c){if("list"!=c.ctype)return-1;for(var e=-1,d=0;d<c.value.length;d++){if("list"!=c.value[d].ctype)return-1;if(0==d)e=c.value[d].value.length;else if(e!=c.value[d].value.length)return-1}return e};List._helper.isNumberVecN=function(c,e){if("list"!=c.ctype||c.value.length!=e)return!1;for(var d=0;d<c.value.length;d++)if("number"!=c.value[d].ctype)return!1;return!0};
List.isNumberVector=function(c){if("list"!=c.ctype)return{ctype:"boolean",value:!1};for(var e=0;e<c.value.length;e++)if("number"!=c.value[e].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};List.isNumberVectorN=function(c,e){if("list"!=c.ctype)return{ctype:"boolean",value:!1};if(c.value)for(var d=0;d<c.value.length;d++)if("number"!=c.value[d].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};
List.isNumberMatrix=function(c){if(-1==List._helper.colNumb(c))return{ctype:"boolean",value:!1};for(var e=0;e<c.value.length;e++)if(!List.isNumberVector(c.value[e]).value)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};List.scalproduct=function(c,e){if(c.value.length!=e.value.length)return nada;for(var d={ctype:"number",value:{real:0,imag:0}},f=0;f<e.value.length;f++){var g=c.value[f],h=e.value[f];if("number"==g.ctype&&"number"==h.ctype)d=CSNumber.add(CSNumber.mult(g,h),d);else return nada}return d};
List.productMV=function(c,e){if(c.value[0].value.length!=e.value.length)return nada;for(var d=[],f=0;f<c.value.length;f++){for(var g={ctype:"number",value:{real:0,imag:0}},h=c.value[f],k=0;k<e.value.length;k++){var p=h.value[k],n=e.value[k];if("number"==p.ctype&&"number"==n.ctype)g=CSNumber.add(CSNumber.mult(p,n),g);else return nada}d[d.length]=g}return List.turnIntoCSList(d)};
List.productVM=function(c,e){if(c.value.length!=e.value.length)return nada;for(var d=[],f=0;f<e.value[0].value.length;f++){for(var g={ctype:"number",value:{real:0,imag:0}},h=0;h<c.value.length;h++){var k=c.value[h],p=e.value[h].value[f];if("number"==k.ctype&&"number"==p.ctype)g=CSNumber.add(CSNumber.mult(k,p),g);else return nada}d[d.length]=g}return List.turnIntoCSList(d)};
List.productMM=function(c,e){if(c.value[0].value.length!=e.value.length)return nada;for(var d=[],f=0;f<c.value.length;f++){var g=List.productVM(c.value[f],e);d[d.length]=g}return List.turnIntoCSList(d)};
List.mult=function(c,e){return c.value.length==e.value.length&&List.isNumberVector(c).value&&List.isNumberVector(e).value?List.scalproduct(c,e):List.isNumberMatrix(c).value&&e.value.length==c.value[0].value.length&&List.isNumberVector(e).value?List.productMV(c,e):List.isNumberMatrix(e).value&&c.value.length==e.value.length&&List.isNumberVector(c).value?List.productVM(c,e):List.isNumberMatrix(c).value&&List.isNumberMatrix(e)&&e.value.length==c.value[0].value.length?List.productMM(c,e):nada};
List.projectiveDistMinScal=function(c,e){var d=List.abs(c),f=List.abs(e);if(0==d.value.real||0==f.value.real)return 0;var g=List.conjugate(e),g=List.scalproduct(c,g),g=CSNumber.div(g,CSNumber.abs(g)),d=List.scaldiv(d,c),f=List.scaldiv(f,e),d=List.scalmult(g,d),g=List.abs(List.add(d,f)),f=List.abs(List.sub(d,f));return Math.min(g.value.real,f.value.real)};
List.crossOperator=function(c){var e=CSNumber.clone(c.value[0]),d=CSNumber.clone(c.value[1]);c=CSNumber.clone(c.value[2]);return List.turnIntoCSList([List.turnIntoCSList([CSNumber.real(0),CSNumber.neg(c),d]),List.turnIntoCSList([c,CSNumber.real(0),CSNumber.neg(e)]),List.turnIntoCSList([CSNumber.neg(d),e,CSNumber.real(0)])])};
List.cross=function(c,e){var d=CSNumber.sub(CSNumber.mult(c.value[1],e.value[2]),CSNumber.mult(c.value[2],e.value[1])),f=CSNumber.sub(CSNumber.mult(c.value[2],e.value[0]),CSNumber.mult(c.value[0],e.value[2])),g=CSNumber.sub(CSNumber.mult(c.value[0],e.value[1]),CSNumber.mult(c.value[1],e.value[0]));return List.turnIntoCSList([d,f,g])};
List.veronese=function(c){var e=CSNumber.mult(c.value[0],c.value[0]),d=CSNumber.mult(c.value[1],c.value[1]),f=CSNumber.mult(c.value[2],c.value[2]),g=CSNumber.mult(c.value[0],c.value[1]),h=CSNumber.mult(c.value[0],c.value[2]);c=CSNumber.mult(c.value[1],c.value[2]);return List.turnIntoSCList([e,d,f,g,h,c])};
List.matrixFromVeronese=function(c){var e=CSNumber.clone(c.value[0]),d=CSNumber.clone(c.value[1]),f=CSNumber.clone(c.value[2]),g=CSNumber.div(c.value[3],CSNumber.real(2)),h=CSNumber.div(c.value[4],CSNumber.real(2));c=CSNumber.div(c.value[5],CSNumber.real(2));var k=CSNumber.clone(g),p=CSNumber.clone(h),n=CSNumber.clone(c);return List.turnIntoCSList([List.turnIntoCSList([e,g,h]),List.turnIntoCSList([k,d,c]),List.turnIntoCSList([p,n,f])])};
List.det3=function(c,e,d){return CSNumber.complex(c.value[0].value.real*e.value[1].value.real*d.value[2].value.real-c.value[0].value.imag*e.value[1].value.imag*d.value[2].value.real-c.value[0].value.imag*e.value[1].value.real*d.value[2].value.imag-c.value[0].value.real*e.value[1].value.imag*d.value[2].value.imag+c.value[2].value.real*e.value[0].value.real*d.value[1].value.real-c.value[2].value.imag*e.value[0].value.imag*d.value[1].value.real-c.value[2].value.imag*e.value[0].value.real*d.value[1].value.imag-
c.value[2].value.real*e.value[0].value.imag*d.value[1].value.imag+c.value[1].value.real*e.value[2].value.real*d.value[0].value.real-c.value[1].value.imag*e.value[2].value.imag*d.value[0].value.real-c.value[1].value.imag*e.value[2].value.real*d.value[0].value.imag-c.value[1].value.real*e.value[2].value.imag*d.value[0].value.imag-c.value[0].value.real*e.value[2].value.real*d.value[1].value.real+c.value[0].value.imag*e.value[2].value.imag*d.value[1].value.real+c.value[0].value.imag*e.value[2].value.real*
d.value[1].value.imag+c.value[0].value.real*e.value[2].value.imag*d.value[1].value.imag-c.value[2].value.real*e.value[1].value.real*d.value[0].value.real+c.value[2].value.imag*e.value[1].value.imag*d.value[0].value.real+c.value[2].value.imag*e.value[1].value.real*d.value[0].value.imag+c.value[2].value.real*e.value[1].value.imag*d.value[0].value.imag-c.value[1].value.real*e.value[0].value.real*d.value[2].value.real+c.value[1].value.imag*e.value[0].value.imag*d.value[2].value.real+c.value[1].value.imag*
e.value[0].value.real*d.value[2].value.imag+c.value[1].value.real*e.value[0].value.imag*d.value[2].value.imag,-c.value[0].value.imag*e.value[1].value.imag*d.value[2].value.imag+c.value[0].value.imag*e.value[1].value.real*d.value[2].value.real+c.value[0].value.real*e.value[1].value.real*d.value[2].value.imag+c.value[0].value.real*e.value[1].value.imag*d.value[2].value.real-c.value[2].value.imag*e.value[0].value.imag*d.value[1].value.imag+c.value[2].value.imag*e.value[0].value.real*d.value[1].value.real+
c.value[2].value.real*e.value[0].value.real*d.value[1].value.imag+c.value[2].value.real*e.value[0].value.imag*d.value[1].value.real-c.value[1].value.imag*e.value[2].value.imag*d.value[0].value.imag+c.value[1].value.imag*e.value[2].value.real*d.value[0].value.real+c.value[1].value.real*e.value[2].value.real*d.value[0].value.imag+c.value[1].value.real*e.value[2].value.imag*d.value[0].value.real+c.value[0].value.imag*e.value[2].value.imag*d.value[1].value.imag-c.value[0].value.imag*e.value[2].value.real*
d.value[1].value.real-c.value[0].value.real*e.value[2].value.real*d.value[1].value.imag-c.value[0].value.real*e.value[2].value.imag*d.value[1].value.real+c.value[2].value.imag*e.value[1].value.imag*d.value[0].value.imag-c.value[2].value.imag*e.value[1].value.real*d.value[0].value.real-c.value[2].value.real*e.value[1].value.real*d.value[0].value.imag-c.value[2].value.real*e.value[1].value.imag*d.value[0].value.real+c.value[1].value.imag*e.value[0].value.imag*d.value[2].value.imag-c.value[1].value.imag*
e.value[0].value.real*d.value[2].value.real-c.value[1].value.real*e.value[0].value.real*d.value[2].value.imag-c.value[1].value.real*e.value[0].value.imag*d.value[2].value.real)};
List.eucangle=function(c,e){var d=List.cross(c,List.linfty),f=List.cross(e,List.linfty),g=List.det3(List.ez,d,List.ii),d=List.det3(List.ez,d,List.jj),h=List.det3(List.ez,f,List.ii),f=List.det3(List.ez,f,List.jj),g=CSNumber.div(CSNumber.mult(g,f),CSNumber.mult(h,d)),g=CSNumber.log(g);return g=CSNumber.mult(g,CSNumber.complex(0,.5))};List.clone=function(c){for(var e=[],d=0;d<c.value.length;d++)e[e.length]=evaluator._helper.clone(c.value[d]);return{ctype:"list",value:e,usage:c.usage}};
List.zerovector=function(c){for(var e=[],d=0;d<Math.floor(c.value.real);d++)e[e.length]=0;return List.realVector(e)};List.zeromatrix=function(c,e){for(var d=[],f=0;f<Math.floor(c.value.real);f++)d[d.length]=List.zerovector(e);return List.turnIntoCSList(d)};List.transpose=function(c){for(var e=[],d=c.value[0].value.length,f=c.value.length,g=0;g<d;g++){for(var h=[],k=0;k<f;k++)h[h.length]=c.value[k].value[g];e[e.length]=List.turnIntoCSList(h)}return List.turnIntoCSList(e)};
List.column=function(c,e){for(var d=[],f=c.value.length,g=Math.floor(e.value.real-1),h=0;h<f;h++)d[d.length]=c.value[h].value[g];return List.turnIntoCSList(d)};List.row=function(c,e){for(var d=[],f=c.value[0].value.length,g=Math.floor(e.value.real-1),h=0;h<f;h++)d[d.length]=c.value[g].value[h];return List.turnIntoCSList(d)};
List.inverse=function(c){for(var e=[],d=[],f=c.value.length,g=0;g<f;g++){for(var h=[],k=[],p=0;p<f;p++)h[h.length]=c.value[g].value[p].value.real,k[k.length]=c.value[g].value[p].value.imag;e[e.length]=h;d[d.length]=k}g=new numeric.T(e,d);c=g.inv(g);e=[];for(g=0;g<f;g++){d=[];for(p=0;p<f;p++)d[d.length]=CSNumber.complex(c.x[g][p],c.y[g][p]);e[e.length]=List.turnIntoCSList(d)}return List.turnIntoCSList(e)};
List.linearsolve=function(c,e){for(var d=[],f=[],g=c.value.length,h=0;h<g;h++){for(var k=[],p=0;p<g;p++)k[k.length]=c.value[h].value[p].value.real;d[d.length]=k;f[f.length]=e.value[h].value.real}d=numeric.solve(d,f);return List.realVector(d)};List.det=function(c){for(var e=[],d=[],f=c.value.length,g=0;g<f;g++){for(var h=[],k=[],p=0;p<f;p++)h[h.length]=c.value[g].value[p].value.real,k[k.length]=c.value[g].value[p].value.imag;e[e.length]=h;d[d.length]=k}new numeric.T(e,d);c=numeric.det(e);return CSNumber.real(c)};
List.getField=function(c,e){if("homog"==e){if(List._helper.isNumberVecN(c,3))return c;if(List._helper.isNumberVecN(c,2)){var d=General.clone(c);d.value[2]=CSNumber.real(1);return d}return nada}if("xy"==e)return List._helper.isNumberVecN(c,2)?c:List._helper.isNumberVecN(c,3)?(d=General.clone(c),d.value.pop(),List.scaldiv(c.value[2],d)):nada;if("x"==e){if(List.isNumberVector(c)){d=c.value.length;if(0<d&&3!=d)return CSNumber.clone(c.value[0]);if(3==d)return"Point"==c.usage?CSNumber.div(c.value[0],c.value[2]):
CSNumber.clone(c.value[0])}return nada}if("y"==e){if(List.isNumberVector(c)){d=c.value.length;if(1<d&&3!=d)return CSNumber.clone(c.value[1]);if(3==d)return"Point"==c.usage?CSNumber.div(c.value[1],c.value[2]):CSNumber.clone(c.value[1])}return nada}return"z"==e&&List.isNumberVector(c)&&(d=c.value.length,2<d)?CSNumber.clone(c.value[2]):nada};var operators={":":20,".":25,"\u00b0":25,_:50,"^":50,"*":100,"/":100,"+":200,"-":200,"!":200,"==":300,"~=":300,"~<":300,"~>":300,"=:=":300,">=":300,"<=":300,"~>=":300,"~<=":300,">":300,"<":300,"<>":300,"&":350,"%":350,"!=":350,"~!=":350,"..":350,"++":370,"--":370,"~~":370,":>":370,"<:":370,"=":400,":=":400,":=_":400,"::=":400,"->":400,",":500,";":500},infixmap={"+":"add","-":"minus","*":"mult","/":"div","^":"pow","\u00b0":"numb_degree",";":"semicolon","=":"assign","..":"sequence",":=":"define","==":"comp_equals",
"!=":"comp_notequals","~=":"comp_almostequals","~!=":"comp_notalmostequals",">":"comp_gt","<":"comp_lt",">=":"comp_ge","<=":"comp_le","~>":"comp_ugt","~<":"comp_ult","~>=":"comp_uge","~<=":"comp_ule","&":"and","%":"or","!":"not",_:"take","++":"concat","~~":"common","--":"remove",":>":"append","<:":"prepend"},niceprint=function(c){if("undefined"===typeof c)return"_??_";if("undefined"==c.ctype)return"_?_";if("number"==c.ctype)return CSNumber.niceprint(c);if("string"==c.ctype||"boolean"==c.ctype)return c.value;
if("list"==c.ctype){for(var e="[",d=0;d<c.value.length;d++)e+=niceprint(evaluate(c.value[d])),d!=c.value.length-1&&(e+=", ");return e+"]"}return"function"==c.ctype?"FUNCTION":"infix"==c.ctype?"INFIX":"modifier"==c.ctype?c.key+"->"+niceprint(c.value):"shape"==c.ctype?c.type:"error"==c.ctype?"Error: "+c.message:"variable"==c.ctype?(console.log("HALLO"),niceprint(c.stack[length.stack])):"geo"==c.ctype?c.value.name:"__"},myfunctions=function(c,e,d){c=myfunctions[c];if(void 0===c)return nada;var f=[];
for(d=0;d<c.arglist.length;d++)f[f.length]=evaluate(e[d]);for(d=0;d<c.arglist.length;d++)namespace.newvar(c.arglist[d].name),namespace.setvar(c.arglist[d].name,f[d]);namespace.pushVstack("*");e=evaluate(c.body);namespace.cleanVstack();for(d=0;d<c.arglist.length;d++)namespace.removevar(c.arglist[d].name);return e},evaluator={_helper:{}};evaluator._helper.eval=function(c,e,d){var f=evaluator[c];return void 0===f?myfunctions(c+e.length,e,d):f(e,d)};
evaluator._helper.clone=function(c){return"list"==c.ctype?List.clone(c):"number"==c.ctype?CSNumber.clone(c):c};evaluator._helper.equals=function(c,e){return"number"==c.ctype&&"number"==e.ctype?{ctype:"boolean",value:c.value.real==e.value.real&&c.value.imag==e.value.imag}:"string"==c.ctype&&"string"==e.ctype||"boolean"==c.ctype&&"boolean"==e.ctype?{ctype:"boolean",value:c.value==e.value}:"list"==c.ctype&&"list"==e.ctype?List.equals(c,e):{ctype:"boolean",value:!1}};var General={_helper:{},order:{undefined:0,boolean:1,number:2,term:3,atomic:4,variable:5,geo:6,string:7,list:8},string:function(c){return{ctype:"string",value:c}},bool:function(c){return{ctype:"boolean",value:c}},isLessThan:function(c,e){return-1==General.compare(c,e)},isEqual:function(c,e){return 0==General.compare(c,e)},compareResults:function(c,e){return General.compare(c.result,e.result)},compare:function(c,e){if(c.ctype!=e.ctype)return General.order[c.ctype]-General.order[e.ctype];if("number"==
c.ctype)return CSNumber._helper.compare(c,e);if("list"==c.ctype)return List._helper.compare(c,e);if("string"==c.ctype)return c.value==e.value?0:c.value<e.value?-1:1;if("boolean"==c.ctype)return c.value==e.value?0:0==c.value?-1:1},add:function(c,e){return"void"==c.ctype&&"number"==e.ctype?CSNumber.clone(e):"number"==c.ctype&&"number"==e.ctype?CSNumber.add(c,e):"string"==c.ctype||"string"==e.ctype?{ctype:"string",value:niceprint(c)+niceprint(e)}:"list"==c.ctype&&"list"==e.ctype?List.add(c,e):nada},
mult:function(c,e){return"number"==c.ctype&&"number"==e.ctype?CSNumber.mult(c,e):"number"==c.ctype&&"list"==e.ctype?List.scalmult(c,e):"list"==c.ctype&&"number"==e.ctype?List.scalmult(e,c):"list"==c.ctype&&"list"==e.ctype?List.mult(c,e):nada},div:function(c,e){return"number"==c.ctype&&"number"==e.ctype?CSNumber.div(c,e):"list"==c.ctype&&"number"==e.ctype?List.scaldiv(e,c):nada},max:function(c,e){return"number"==c.ctype&&"number"==e.ctype?CSNumber.max(c,e):"list"==c.ctype&&"list"==e.ctype?List.max(c,
e):nada},min:function(c,e){return"number"==c.ctype&&"number"==e.ctype?CSNumber.min(c,e):"list"==c.ctype&&"list"==e.ctype?List.min(c,e):nada},clone:function(c){return"number"==c.ctype?CSNumber.clone(c):"list"==c.ctype?List.clone(c):"boolean"==c.ctype?{ctype:"boolean",value:c.value}:"string"==c.ctype?{ctype:"string",value:c.value}:General.wrap(c)},wrap:function(c){if("number"==typeof c)return CSNumber.real(c);if("object"==typeof c&&void 0!=c.length){for(var e=[],d=0;d<c.length;d++)e[d]=General.wrap(c[d]);
return List.turnIntoCSList(e)}return"string"==typeof c?{ctype:"string",value:c}:"boolean"==typeof c?{ctype:"boolean",value:c}:nada}};evaluator.seconds=function(c,e){return{ctype:"number",value:{real:(new Date).getTime()/1E3,imag:0}}};
evaluator.err=function(c,e){"undefined"==typeof csconsole&&(csconsole=window.open("","","width=200,height=100"));if("variable"==c[0].ctype){var d=evaluate(namespace.getvar(c[0].name));console.log(c[0].name+" ==> "+niceprint(d));csconsole.document.write(c[0].name+" ==> "+niceprint(d)+"<br>")}else d=evaluate(c[0]),console.log(" ==> "+niceprint(d)),csconsole.document.writeln(" ==> "+niceprint(d)+"<br>");return nada};
evaluator.errc=function(c,e){if("variable"==c[0].ctype){var d=evaluate(namespace.getvar(c[0].name));console.log(c[0].name+" ==> "+niceprint(d))}else d=evaluate(c[0]),console.log(" ==> "+niceprint(d));return nada};evaluator.dump=function(c,e){dump(c[0]);return nada};
evaluator.repeat=function(c,e){var d=evaluateAndVal(c[0]),f=c.length-1,g="#";3==c.length&&"variable"==c[1].ctype&&(g=c[1].name);if("number"!=d.ctype)return nada;var d=Math.round(d.value.real),h=1,k=1,p=d+1,n=!1,q=!1,r=!1;if(void 0!==e.start){var s=evaluate(e.start);"number"==s.ctype&&(n=!0,k=s.value.real)}void 0!==e.step&&(s=evaluate(e.step),"number"==s.ctype&&(r=!0,h=s.value.real));void 0!==e.stop&&(s=evaluate(e.stop),"number"==s.ctype&&(q=!0,p=s.value.real));!n||q||r||(p=h*d+k);n||!q||r||(k=-h*
(d-1)+p,p+=h);n||q||!r||(p=h*d+k);n&&q&&!r&&(h=(p-k)/(d-1),p+=h);n&&!q&&r&&(p=h*d+k);!n&&q&&r&&(k=-h*(d-1)+p,p+=h);n&&q&&r&&(p+=h);(k<=p&&0<h||k>=p&&0>h)&&n&&q&&r&&(d=Math.floor((p-k)/h));namespace.newvar(g);for(var t,p=0;p<d;p++)namespace.setvar(g,{ctype:"number",value:{real:p*h+k,imag:0}}),t=evaluate(c[f]);namespace.removevar(g);return t};evaluator.while=function(c,e){for(var d=c[1],f=c[0],g=evaluate(f),h=nada;"list"!=g.ctype&&g.value;)h=evaluate(d),g=evaluate(f);return h};
evaluator.apply=function(c,e){var d=evaluateAndVal(c[0]);if("list"!=d.ctype)return nada;var f=c.length-1,g="#";3==c.length&&"variable"==c[1].ctype&&(g=c[1].name);var d=d.value,h=[];namespace.newvar(g);for(var k=0;k<d.length;k++)namespace.setvar(g,d[k]),h[h.length]=evaluate(c[f]);namespace.removevar(g);return{ctype:"list",value:h}};
evaluator.forall=function(c,e){var d=evaluateAndVal(c[0]);if("list"!=d.ctype)return nada;var f=c.length-1,g="#";3==c.length&&"variable"==c[1].ctype&&(g=c[1].name);d=d.value;namespace.newvar(g);for(var h,k=0;k<d.length;k++)namespace.setvar(g,d[k]),h=evaluate(c[f]);namespace.removevar(g);return h};
evaluator.select=function(c,e){var d=evaluateAndVal(c[0]);if("list"!=d.ctype)return nada;var f=c.length-1,g="#";3==c.length&&"variable"==c[1].ctype&&(g=c[1].name);var d=d.value,h=[];namespace.newvar(g);for(var k=0;k<d.length;k++){namespace.setvar(g,d[k]);var p=evaluate(c[f]);"boolean"==p.ctype&&1==p.value&&(h[h.length]=d[k])}namespace.removevar(g);return{ctype:"list",value:h}};
evaluator.semicolon=function(c,e){var d="void"==c[0].ctype,f="void"==c[1].ctype;if(d&&f)return nada;if(!d&&f)return evaluate(c[0]);d||f||evaluate(c[0]);return f?nada:evaluate(c[1])};evaluator.createvar=function(c,e){1==c.length&&"variable"==c[0].ctype&&namespace.newvar(c[0].name);return nada};evaluator.local=function(c,e){for(var d=0;d<c.length;d++)"variable"==c[d].ctype&&namespace.newvar(c[d].name);return nada};
evaluator.removevar=function(c,e){if(1==c.length){var d=evaluate(c[0]);"variable"==c[0].ctype&&namespace.removevar(c[0].name);return d}return nada};evaluator.release=function(c,e){if(0==c.length)return nada;for(var d=evaluate(c[c.length-1]),f=0;f<c.length;f++)"variable"==c[f].ctype&&namespace.removevar(c[f].name);return d};evaluator.regional=function(c,e){for(var d=0;d<c.length;d++)if("variable"==c[d].ctype){var f=c[d].name;namespace.newvar(f);namespace.pushVstack(f)}return nada};
evaluator.genList=function(c,e){for(var d=[],f=0;f<c.length;f++)d[d.length]=evaluate(c[f]);return{ctype:"list",value:d}};evaluator._helper.assigntake=function(c,e){var d=evaluate(c.args[0]),f=evaluateAndVal(c.args[1]);if("list"==d.ctype||"string"==d.ctype)if(f=Math.floor(f.value.real),0>f&&(f=d.value.length+f+1),0<f&&f<d.value.length+1)if("list"==d.ctype)d.value[f-1]=evaluate(e);else{var g=d.value,g=g.substring(0,f-1)+niceprint(evaluate(e))+g.substring(f,g.length);d.value=g}return nada};
evaluator._helper.assigndot=function(c,e){var d=evaluate(c.obj),f=c.key;d&&f&&Accessor.setField(d.value,f,evaluate(e));return nada};evaluator._helper.assignlist=function(c,e){var d=c.length,f=e.length;f<d&&(d=f);for(f=0;f<d;f++)evaluator.assign([c[f],e[f]],[])};
evaluator.assign=function(c,e){var d="undefined"==c[1].ctype;if("undefined"==c[0].ctype||d)return nada;"variable"==c[0].ctype&&namespace.setvar(c[0].name,evaluate(c[1]));"infix"==c[0].ctype&&"_"==c[0].oper&&evaluator._helper.assigntake(c[0],c[1]);"field"==c[0].ctype&&evaluator._helper.assigndot(c[0],c[1]);"function"==c[0].ctype&&"genList"==c[0].oper&&(d=evaluate(c[1]),"list"==d.ctype&&evaluator._helper.assignlist(c[0].args,d.value));return c[0].value};
evaluator.define=function(c,e){var d="undefined"==c[1].ctype;if("undefined"==c[0].ctype||d)return nada;if("function"==c[0].ctype){var d=c[0].oper,f=c[0].args;myfunctions[d+f.length]={oper:d,body:c[1],arglist:f}}return nada};evaluator.if=function(c,e){var d=evaluateAndVal(c[0]);if("boolean"==d.ctype){if(1==d.value)return evaluate(c[1]);if(3==c.length)return evaluate(c[2])}return nada};
evaluator.comp_equals=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype?{ctype:"boolean",value:d.value.real==f.value.real&&d.value.imag==f.value.imag}:"string"==d.ctype&&"string"==f.ctype||"boolean"==d.ctype&&"boolean"==f.ctype?{ctype:"boolean",value:d.value==f.value}:"list"==d.ctype&&"list"==f.ctype?List.equals(d,f):{ctype:"boolean",value:!1}};evaluator.comp_notequals=function(c,e){var d=evaluator.comp_equals(c,e);d.value=!d.value;return d};
evaluator.comp_almostequals=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype?{ctype:"boolean",value:CSNumber._helper.isAlmostEqual(d,f)}:"string"==d.ctype&&"string"==f.ctype||"boolean"==d.ctype&&"boolean"==f.ctype?{ctype:"boolean",value:d.value==f.value}:"list"==d.ctype&&"list"==f.ctype?List.almostequals(d,f):{ctype:"boolean",value:!1}};
evaluator.and=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"boolean"==d.ctype&&"boolean"==f.ctype?{ctype:"boolean",value:d.value&&f.value}:nada};evaluator.or=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"boolean"==d.ctype&&"boolean"==f.ctype?{ctype:"boolean",value:d.value||f.value}:nada};
evaluator.xor=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"boolean"==d.ctype&&"boolean"==f.ctype?{ctype:"boolean",value:d.value!=f.value}:nada};evaluator.not=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"void"==d.ctype&&"boolean"==f.ctype?{ctype:"boolean",value:!f.value}:nada};evaluator.numb_degree=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"void"==f.ctype?CSNumber.mult(d,CSNumber.real(Math.PI/180)):nada};
evaluator.comp_notalmostequals=function(c,e){var d=evaluator.comp_almostequals(c,e);d.value=!d.value;return d};evaluator.comp_ugt=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real>f.value.real+CSNumber.eps}:nada};
evaluator.comp_uge=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real>f.value.real-CSNumber.eps}:nada};
evaluator.comp_ult=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real<f.value.real-CSNumber.eps}:nada};
evaluator.comp_ule=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real<f.value.real+CSNumber.eps}:nada};
evaluator.comp_gt=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real>f.value.real}:"string"==d.ctype&&"string"==f.ctype?{ctype:"boolean",value:d.value>f.value}:nada};
evaluator.comp_ge=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real>=f.value.real}:"string"==d.ctype&&"string"==f.ctype?{ctype:"boolean",value:d.value>=f.value}:nada};
evaluator.comp_le=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real<=f.value.real}:"string"==d.ctype&&"string"==f.ctype?{ctype:"boolean",value:d.value<=f.value}:nada};
evaluator.comp_lt=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real<f.value.real}:"string"==d.ctype&&"string"==f.ctype?{ctype:"boolean",value:d.value<f.value}:nada};evaluator.sequence=function(c,e){var d=evaluate(c[0]),f=evaluate(c[1]);return"number"==d.ctype&&"number"==f.ctype?List.sequence(d,f):nada};
evaluator._helper.genericListMath1=function(c,e){var d=evaluateAndVal(c[0]);if("list"!=d.ctype)return nada;var f=c.length-1,g="#";3==c.length&&"variable"==c[1].ctype&&(g=c[1].name);d=d.value;if(0==d.length)return nada;namespace.newvar(g);namespace.setvar(g,d[0]);for(var h=evaluate(c[f]),k=1;k<d.length;k++){namespace.setvar(g,d[k]);var p=evaluate(c[f]),h=General[e](h,p)}namespace.removevar(g);return h};
evaluator._helper.genericListMath=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return erg=List.genericListMath(d,e)}return evaluator._helper.genericListMath1(c,e)};evaluator.product=function(c,e){return evaluator._helper.genericListMath(c,"mult")};evaluator.sum=function(c,e){return evaluator._helper.genericListMath(c,"add")};evaluator.max=function(c,e){return evaluator._helper.genericListMath(c,"max")};
evaluator.min=function(c,e){return evaluator._helper.genericListMath(c,"min")};evaluator.add=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return General.add(d,f)};evaluator.minus=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"void"==d.ctype&&"number"==f.ctype?CSNumber.neg(f):"void"==d.ctype&&"list"==f.ctype?List.neg(f):"number"==d.ctype&&"number"==f.ctype?CSNumber.sub(d,f):"list"==d.ctype&&"list"==f.ctype?List.sub(d,f):nada};
evaluator.mult=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return General.mult(d,f)};evaluator.div=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return General.div(d,f)};evaluator.mod=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype?CSNumber.mod(d,f):nada};evaluator.pow=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype?CSNumber.pow(d,f):nada};
evaluator.exp=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.exp(d):nada};evaluator.sin=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.sin(d):nada};evaluator.sqrt=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.sqrt(d):nada};evaluator.cos=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.cos(d):nada};
evaluator.tan=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.tan(d):nada};evaluator.arccos=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.arccos(d):nada};evaluator.arcsin=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.arcsin(d):nada};evaluator.arctan=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.arctan(d):nada};
evaluator.arctan2=function(c,e){if(2==c.length){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);if("number"==d.ctype&&"number"==f.ctype)return CSNumber.arctan2(d,f)}return 1==c.length&&(d=evaluateAndVal(c[0]),"list"==d.ctype&&2==d.value.length&&(d=d.value,"number"==d[0].ctype&&"number"==d[1].ctype))?evaluator.arctan2(d,e):nada};evaluator.log=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.log(d):nada};
evaluator.recursive=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber[e](d):"list"==d.ctype?List[e](d):nada};evaluator.im=function(c,e){return evaluator.recursive(c,"im")};evaluator.re=function(c,e){return evaluator.recursive(c,"re")};evaluator.conjugate=function(c,e){return evaluator.recursive(c,"conjugate")};evaluator.round=function(c,e){return evaluator.recursive(c,"round")};evaluator.ceil=function(c,e){return evaluator.recursive(c,"ceil")};
evaluator.floor=function(c,e){return evaluator.recursive(c,"floor")};evaluator.abs=function(c,e){return evaluator.recursive(c,"abs")};evaluator.random=function(c,e){if(0==c.length)return CSNumber.real(CSNumber._helper.rand());if(1==c.length){var d=evaluateAndVal(c[0]);if("number"==d.ctype)return CSNumber.complex(d.value.real*CSNumber._helper.rand(),d.value.imag*CSNumber._helper.rand())}return nada};
evaluator.random=function(c,e){if(0==c.length)return CSNumber.real(CSNumber._helper.rand());if(1==c.length){var d=evaluateAndVal(c[0]);if("number"==d.ctype)return CSNumber.complex(d.value.real*CSNumber._helper.rand(),d.value.imag*CSNumber._helper.rand())}return nada};evaluator.seedrandom=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"number"==d.ctype&&CSNumber._helper.seedrandom(d.value.real)}return nada};
evaluator.randomnormal=function(c,e){return 0==c.length?CSNumber.real(CSNumber._helper.randnormal()):nada};evaluator.randominteger=function(c,e){return evaluator.randomint(c,e)};evaluator.randombool=function(c,e){return 0==c.length?.5<CSNumber._helper.rand()?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}:nada};evaluator.isreal=function(c,e){if(1==c.length){var d=evaluate(c[0]);return"number"==d.ctype&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}}return nada};
evaluator.isinteger=function(c,e){if(1==c.length){var d=evaluate(c[0]);return"number"==d.ctype&&CSNumber._helper.isAlmostReal(d)&&d.value.real==Math.floor(d.value.real)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}}return nada};evaluator.iseven=function(c,e){if(1==c.length){var d=evaluate(c[0]);return"number"==d.ctype&&CSNumber._helper.isAlmostReal(d)&&d.value.real/2==Math.floor(d.value.real/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}}return nada};
evaluator.isodd=function(c,e){if(1==c.length){var d=evaluate(c[0]);return"number"==d.ctype&&CSNumber._helper.isAlmostReal(d)&&(d.value.real-1)/2==Math.floor((d.value.real-1)/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}}return nada};evaluator.iscomplex=function(c,e){return 1==c.length?"number"==evaluate(c[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}:nada};
evaluator.isstring=function(c,e){return 1==c.length?"string"==evaluate(c[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}:nada};evaluator.islist=function(c,e){return 1==c.length?"list"==evaluate(c[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}:nada};evaluator.ismatrix=function(c,e){if(1==c.length){var d=evaluate(c[0]);return-1!=List._helper.colNumb(d)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}}return nada};
evaluator.isnumbermatrix=function(c,e){if(1==c.length){var d=evaluate(c[0]);return List.isNumberMatrix(d).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}}return nada};evaluator.isnumbervector=function(c,e){if(1==c.length){var d=evaluate(c[0]);return List.isNumberVector(d).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}}return nada};
evaluator.matrixrowcolumn=function(c,e){if(1==c.length){var d=evaluate(c[0]);if(-1!=List._helper.colNumb(d))return List.realVector([d.value.length,d.value[0].value.length])}return nada};
evaluator.complex=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);if("list"==d.ctype&&List.isNumberVector(d)){if(2==d.value.length){var f=d.value[0],g=d.value[1];return CSNumber.complex(f.value.real-g.value.imag,g.value.real+f.value.imag)}if(3==d.value.length)return f=d.value[0],g=d.value[1],d=d.value[2],f=CSNumber.div(f,d),g=CSNumber.div(g,d),CSNumber.complex(f.value.real-g.value.imag,g.value.real+f.value.imag)}}return nada};
evaluator.gauss=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);if("number"==d.ctype)return List.realVector([d.value.real,d.value.imag])}return nada};evaluator.cross=function(c,e){if(2==c.length){var d=evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]);if(d!=nada&&f!=nada){var g=List.cross(d,f);g.usage="None";"Point"==d.usage&&"Point"==f.usage&&(g.usage="Line");"Line"==d.usage&&"Line"==f.usage&&(g.usage="Point");return g}}return nada};
evaluator.cross=function(c,e){if(2==c.length){var d=evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]);if(d!=nada&&f!=nada){var g=List.cross(d,f);g.usage="None";"Point"==d.usage&&"Point"==f.usage&&(g.usage="Line");"Line"==d.usage&&"Line"==f.usage&&(g.usage="Point");return g}}return nada};
evaluator.para=function(c,e){if(2==c.length){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]),g=evaluateAndHomog(d),h=evaluateAndHomog(f);if(d!=nada&&f!=nada){var f=f.usage,k=g,p=h;if("Line"==d.usage||"Point"==f)k=h,p=g;d=List.cross(List.cross(List.linfty,p),k);d.usage="Line";return d}}return nada};
evaluator.perp=function(c,e){if(2==c.length){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]),g=evaluateAndHomog(d),h=evaluateAndHomog(f);if(d!=nada&&f!=nada){var k=f.usage,f=g,p=h;if("Line"==d.usage||"Point"==k)f=h,p=g;d=List.cross(List.linfty,p);d.value=[d.value[1],CSNumber.neg(d.value[0]),d.value[2]];d=List.cross(d,f);d.usage="Line";return d}}return 1==c.length&&(d=evaluateAndVal(c[0]),List._helper.isNumberVecN(d,2))?(d.value=[CSNumber.neg(d.value[1]),d.value[0]],d):nada};
evaluator.parallel=function(c,e){return evaluator.para(c,e)};evaluator.perpendicular=function(c,e){return evaluator.perp(c,e)};evaluator.meet=function(c,e){if(2==c.length){var d=evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]);if(d!=nada&&f!=nada)return d=List.cross(d,f),d.usage="Point",d}return nada};evaluator.join=function(c,e){if(2==c.length){var d=evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]);if(d!=nada&&f!=nada)return d=List.cross(d,f),d.usage="Line",d}return nada};
evaluator.dist=function(c,e){if(2==c.length){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]),d=evaluator.minus([d,f],[]);return evaluator.abs([d],[])}return nada};evaluator.point=function(c,e){if(1==c.length){var d=evaluate(c[0]);if(List._helper.isNumberVecN(d,3)||List._helper.isNumberVecN(d,2))d.usage="Point"}return d};evaluator.line=function(c,e){if(1==c.length){var d=evaluate(c[0]);List._helper.isNumberVecN(d,3)&&(d.usage="Line")}return d};
evaluator.det=function(c,e){if(3==c.length){var d=evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]),g=evaluateAndHomog(c[2]);if(d!=nada&&f!=nada&&g!=nada)return List.det3(d,f,g)}return 1==c.length&&(d=evaluateAndVal(c[0]),"list"==d.ctype&&(f=List._helper.colNumb(d),-1!=f&&f==d.value.length))?List.det(d):nada};
evaluator.area=function(c,e){if(3==c.length){var d=evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]),g=evaluateAndHomog(c[2]);if(d!=nada&&f!=nada&&g!=nada){var h=d.value[2],k=f.value[2],p=g.value[2];if(!CSNumber._helper.isAlmostZero(h)&&!CSNumber._helper.isAlmostZero(k)&&!CSNumber._helper.isAlmostZero(p))return d=List.scaldiv(h,d),f=List.scaldiv(k,f),g=List.scaldiv(p,g),d=List.det3(d,f,g),d.value.real*=.5,d.value.imag*=.5,d}}return nada};
evaluator.inverse=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);if("list"==d.ctype){var f=List._helper.colNumb(d);if(-1!=f&&f==d.value.length)return List.inverse(d)}}return nada};evaluator.linearsolve=function(c,e){if(2==c.length){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);if("list"==d.ctype){var g=List._helper.colNumb(d);if(-1!=g&&g==d.value.length&&List._helper.isNumberVecN(f,g))return List.linearsolve(d,f)}}return nada};
evaluator.take=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluateAndVal(c[1]);if("number"==f.ctype){var g=Math.floor(f.value.real);if("list"==d.ctype||"string"==d.ctype)return 0>g&&(g=d.value.length+g+1),0<g&&g<d.value.length+1?"list"==d.ctype?d.value[g-1]:{ctype:"string",value:d.value.charAt(g-1)}:nada}if("list"==f.ctype){for(var g=[],h=0;h<f.value.length;h++){var k=evaluateAndVal(f.value[h]);g[h]=evaluator.take([d,k],[])}return List.turnIntoCSList(g)}}return nada};
evaluator.length=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype||"string"==d.ctype)return CSNumber.real(d.value.length)}return nada};evaluator.pairs=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return List.pairs(d)}return nada};evaluator.triples=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return List.triples(d)}return nada};evaluator.cycle=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return List.cycle(d)}return nada};
evaluator.consecutive=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return List.consecutive(d)}return nada};evaluator.reverse=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return List.reverse(d)}return nada};evaluator.directproduct=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("list"==d.ctype&&"list"==f.ctype)return List.directproduct(d,f)}return nada};
evaluator.concat=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("list"==d.ctype&&"list"==f.ctype)return List.concat(d,f);if("shape"==d.ctype&&"shape"==f.ctype)return evaluator._helper.shapeconcat(d,f)}return nada};evaluator.common=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("list"==d.ctype&&"list"==f.ctype)return List.common(d,f);if("shape"==d.ctype&&"shape"==f.ctype)return evaluator._helper.shapecommon(d,f)}return nada};
evaluator.remove=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("list"==d.ctype&&"list"==f.ctype)return List.remove(d,f);if("shape"==d.ctype&&"shape"==f.ctype)return evaluator._helper.shaperemove(d,f)}return nada};evaluator.append=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("list"==d.ctype)return List.append(d,f)}return nada};
evaluator.prepend=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("list"==f.ctype)return List.prepend(d,f)}return nada};evaluator.contains=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("list"==d.ctype)return List.contains(d,f)}return nada};
evaluator._helper.sort2=function(c,e){var d=evaluateAndVal(c[0]);if("list"!=d.ctype)return nada;var f=c.length-1,g="#";3==c.length&&"variable"==c[1].ctype&&(g=c[1].name);var d=d.value,h=[];namespace.newvar(g);for(var k=0;k<d.length;k++)namespace.setvar(g,d[k]),h[h.length]={val:d[k],result:evaluate(c[f])};namespace.removevar(g);h.sort(General.compareResults);f=[];for(k=0;k<d.length;k++)f[f.length]=h[f.length].val;return{ctype:"list",value:f}};
evaluator.sort=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return List.sort1(d)}return evaluator._helper.sort2(c,e)};evaluator.set=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return List.set(d)}return nada};evaluator.zeromatrix=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype?List.zeromatrix(d,f):nada};
evaluator.zerovector=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?List.zerovector(d):nada};evaluator.transpose=function(c,e){var d=evaluateAndVal(c[0]);return"list"==d.ctype&&-1!=List._helper.colNumb(d)?List.transpose(d):nada};evaluator.row=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==f.ctype&&"list"==d.ctype&&-1!=List._helper.colNumb(d)?List.row(d,f):nada};
evaluator.column=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==f.ctype&&"list"==d.ctype&&-1!=List._helper.colNumb(d)?List.column(d,f):nada};evaluator.red=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("number"==d.ctype)return d=Math.min(1,Math.max(0,d.value.real)),List.realVector([d,0,0])}return nada};evaluator.green=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("number"==d.ctype)return d=Math.min(1,Math.max(0,d.value.real)),List.realVector([0,d,0])}return nada};
evaluator.blue=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("number"==d.ctype)return d=Math.min(1,Math.max(0,d.value.real)),List.realVector([0,0,d])}return nada};evaluator.grey=function(c,e){return evaluator.gray(c,e)};evaluator.gray=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("number"==d.ctype)return d=Math.min(1,Math.max(0,d.value.real)),List.realVector([d,d,d])}return nada};
evaluator._helper.HSVtoRGB=function(c,e,d){var f,g,h,k,p,n;c&&void 0===e&&void 0===d&&(e=c.s,d=c.v,c=c.h);k=Math.floor(6*c);p=6*c-k;c=d*(1-e);n=d*(1-p*e);e=d*(1-(1-p)*e);switch(k%6){case 0:f=d;g=e;h=c;break;case 1:f=n;g=d;h=c;break;case 2:f=c;g=d;h=e;break;case 3:f=c;g=n;h=d;break;case 4:f=e;g=c;h=d;break;case 5:f=d,g=c,h=n}return List.realVector([f,g,h])};
evaluator.hue=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("number"==d.ctype)return d=d.value.real,d-=Math.floor(d),evaluator._helper.HSVtoRGB(d,1,1)}return nada};
evaluator._helper.shapeconvert=function(c){if("circle"==c.type){var e=c.value.value[0],d=General.div(e,e.value[2]),e=d.value[0].value.real,f=d.value[1].value.real;c=c.value.value[1].value.real;for(var d=[],g=2*Math.PI/36,h=0;36>h;h++)d[h]={X:e+Math.cos(h*g)*c,Y:f+Math.sin(h*g)*c};return[d]}if("polygon"==c.type){erg=[];for(h=0;h<c.value.length;h++){pol=c.value[h];d=[];for(e=0;e<pol.length;e++)d[e]={X:pol[e].X,Y:pol[e].Y};erg[h]=d}return erg}};
evaluator._helper.shapeop=function(c,e,d){c=evaluator._helper.shapeconvert(c);var f=evaluator._helper.shapeconvert(e);ClipperLib.JS.ScaleUpPaths(c,1E3);ClipperLib.JS.ScaleUpPaths(f,1E3);e=new ClipperLib.Clipper;e.AddPaths(c,ClipperLib.PolyType.ptSubject,!0);e.AddPaths(f,ClipperLib.PolyType.ptClip,!0);var f=c=ClipperLib.PolyFillType.pftNonZero,g=new ClipperLib.Paths;e.Execute(d,g,c,f);ClipperLib.JS.ScaleDownPaths(g,1E3);return{ctype:"shape",type:"polygon",value:g}};
evaluator._helper.shapecommon=function(c,e){return evaluator._helper.shapeop(c,e,ClipperLib.ClipType.ctIntersection)};evaluator._helper.shaperemove=function(c,e){return evaluator._helper.shapeop(c,e,ClipperLib.ClipType.ctDifference)};evaluator._helper.shapeconcat=function(c,e){return evaluator._helper.shapeop(c,e,ClipperLib.ClipType.ctUnion)};evaluator.key=function(c,e){return 0==c.length?{ctype:"string",value:cskey}:nada};
evaluator.keycode=function(c,e){return 0==c.length?CSNumber.real(cskeycode):nada};evaluator.mouse=function(c,e){return 0==c.length?List.realVector([csmouse[0],csmouse[1]]):nada};evaluator.mover=function(c,e){return 0==c.length&&move&&move.mover?{ctype:"geo",value:move.mover,type:"P"}:nada};evaluator.translate=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"list"==d.ctype&&List.isNumberVector(d)&&2==d.value.length&&csport.translate(d.value[0].value.real,d.value[1].value.real)}return nada};
evaluator.rotate=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"number"==d.ctype&&csport.rotate(d.value.real)}return nada};evaluator.scale=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"number"==d.ctype&&csport.scale(d.value.real)}return nada};evaluator.greset=function(c,e){if(0==c.length){var d=csgstorage.stack.length;csport.greset();for(var f=0;f<d;f++)csctx.restore()}return nada};evaluator.gsave=function(c,e){0==c.length&&(csport.gsave(),csctx.save());return nada};
evaluator.grestore=function(c,e){0==c.length&&(csport.grestore(),csctx.restore());return nada};evaluator.color=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"list"==d.ctype&&List.isNumberVector(d).value&&csport.setcolor(d)}return nada};evaluator.linecolor=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"list"==d.ctype&&List.isNumberVector(d).value&&csport.setlinecolor(d)}return nada};
evaluator.pointcolor=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"list"==d.ctype&&List.isNumberVector(d).value&&csport.setpointcolor(d)}return nada};evaluator.alpha=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"number"==d.ctype&&csport.setalpha(d)}return nada};evaluator.pointsize=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"number"==d.ctype&&csport.setpointsize(d)}return nada};
evaluator.linesize=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"number"==d.ctype&&csport.setlinesize(d)}return nada};evaluator.textsize=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"number"==d.ctype&&csport.settextsize(d)}return nada};
evaluator.replace=function(c,e){if(3==c.length){var d=evaluate(c[0]),f=evaluate(c[1]),g=evaluate(c[2]);if("string"==d.ctype&&"string"==f.ctype&&"string"==g.ctype){var h=d.value,h=h.replace(new RegExp(f.value,"g"),g.value);return{ctype:"string",value:h}}}if(2==c.length){var k,p,g=function(c,d,e){var f="";p=k=-1;for(var g=0;g<d.length;g++){var h=d[g][0],n=c.indexOf(h,e);-1!=n&&(-1==k?(f=h,k=n,p=g):n<k&&(f=h,k=n,p=g))}return f},d=evaluate(c[0]),f=evaluate(c[1]);if("string"==d.ctype&&"list"==f.ctype){for(var h=
d.value,d=[],n=0;n<f.value.length;n++){var q=f.value[n];"list"==q.ctype&&2==q.value.length&&"string"==q.value[0].ctype&&"string"==q.value[1].ctype&&(d[d.length]=[q.value[0].value,q.value[1].value])}k=-1;for(f=g(h,d,0);-1!=k;)h=h.substring(0,k)+d[p][1]+h.substring(k+f.length,h.length),f=k+d[p][1].length,f=g(h,d,f)}return{ctype:"string",value:h}}return nada};
evaluator.substring=function(c,e){if(3==c.length){var d=evaluate(c[0]),f=evaluateAndVal(c[1]),g=evaluateAndVal(c[2]);if("string"==d.ctype&&"number"==f.ctype&&"number"==g.ctype)return{ctype:"string",value:d.value.substring(Math.floor(f.value.real),Math.floor(g.value.real))}}return nada};
evaluator.tokenize=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("string"==d.ctype&&"string"==f.ctype){var g=!0;if(void 0!==e.autoconvert){var h=evaluate(e.autoconvert);"boolean"==h.ctype&&(g=h.value)}f=d.value.split(f.value);d=[];for(h=0;h<f.length;h++){var k=f[h];if(g){var p=parseFloat(k);isNaN(p)||(k=p)}d[h]={ctype:"string",value:k}}return List.turnIntoCSList(d)}if("string"==d.ctype&&"list"==f.ctype){if(0==f.value.length)return d;d=f.value[0];tli=List.turnIntoCSList(g);
k=evaluator.tokenize([c[0],d],e).value;d=[];for(h=0;h<k.length;h++){g=[];for(p=1;p<f.value.length;p++)g[p-1]=f.value[p];tli=List.turnIntoCSList(g);d[h]=evaluator.tokenize([k[h],tli],e)}return List.turnIntoCSList(d)}}return nada};
evaluator.indexof=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("string"==d.ctype&&"string"==f.ctype)return d=d.value,f=f.value,d=d.indexOf(f),CSNumber.real(d+1)}if(3==c.length){var d=evaluate(c[0]),f=evaluate(c[1]),g=evaluate(c[2]);if("string"==d.ctype&&"string"==f.ctype&&"number"==g.ctype)return d=d.value,f=f.value,g=Math.round(g.value.real),d=d.indexOf(f,g-1),CSNumber.real(d+1)}return nada};
evaluator.parse=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("string"==d.ctype)return d=condense(d.value),d=analyse(d),evaluate(d)}return nada};evaluator._helper.basismap=function(c,e,d,f){var g=List.turnIntoCSList([c,e,d]),g=List.inverse(List.transpose(g));f=General.mult(g,f);g=List.turnIntoCSList([General.mult(f.value[0],c),General.mult(f.value[1],e),General.mult(f.value[2],d)]);return List.transpose(g)};
evaluator.map=function(c,e){if(8==c.length){var d=evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]),g=evaluateAndHomog(c[2]),h=evaluateAndHomog(c[3]),k=evaluateAndHomog(c[4]),p=evaluateAndHomog(c[5]),n=evaluateAndHomog(c[6]),q=evaluateAndHomog(c[7]);if(k!=nada&&p!=nada&&n!=nada&&q!=nada&&d!=nada&&f!=nada&&g!=nada&&h!=nada)return k=evaluator._helper.basismap(k,p,n,q),d=evaluator._helper.basismap(d,f,g,h),erg=General.mult(k,List.inverse(d)),List.normalizeMax(erg)}if(6==c.length){var d=evaluateAndHomog(c[0]),
f=evaluateAndHomog(c[1]),g=evaluateAndHomog(c[2]),q=List.realVector([0,0,1]),r=List.cross,h=r(r(g,r(q,r(d,f))),r(f,r(q,r(d,g)))),k=evaluateAndHomog(c[3]),p=evaluateAndHomog(c[4]),n=evaluateAndHomog(c[5]),q=r(r(n,r(q,r(k,p))),r(p,r(q,r(k,n))));if(k!=nada&&p!=nada&&n!=nada&&q!=nada&&d!=nada&&f!=nada&&g!=nada&&h!=nada)return k=evaluator._helper.basismap(k,p,n,q),d=evaluator._helper.basismap(d,f,g,h),erg=General.mult(k,List.inverse(d)),List.normalizeMax(erg)}return 4==c.length&&(g=List.ii,h=List.jj,d=
evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]),k=evaluateAndHomog(c[2]),p=evaluateAndHomog(c[3]),k!=nada&&p!=nada&&d!=nada&&f!=nada)||2==c.length&&(g=List.ii,h=List.jj,d=evaluateAndHomog(c[0]),f=General.add(List.realVector([1,0,0]),d),k=evaluateAndHomog(c[1]),p=General.add(List.realVector([1,0,0]),k),k!=nada&&p!=nada&&d!=nada&&f!=nada)?(k=evaluator._helper.basismap(k,p,g,h),d=evaluator._helper.basismap(d,f,g,h),erg=General.mult(k,List.inverse(d)),List.normalizeMax(erg)):nada};
evaluator.pointreflect=function(c,e){if(1==c.length){var d=List.ii,f=List.jj,g=evaluateAndHomog(c[0]),h=General.add(List.realVector([1,0,0]),g),k=General.add(List.realVector([-1,0,0]),g);if(k!=nada&&g!=nada&&h!=nada)return k=evaluator._helper.basismap(g,k,d,f),d=evaluator._helper.basismap(g,h,d,f),erg=General.mult(k,List.inverse(d)),List.normalizeMax(erg)}return nada};
evaluator.linereflect=function(c,e){if(1==c.length){var d=List.ii,f=List.jj,g=evaluateAndHomog(c[0]),h=List.realVector([Math.random(),Math.random(),Math.random()]),k=List.realVector([Math.random(),Math.random(),Math.random()]),h=List.cross(h,g),k=List.cross(k,g);if(g!=nada&&h!=nada)return g=evaluator._helper.basismap(h,k,d,f),d=evaluator._helper.basismap(h,k,f,d),d=General.mult(g,List.inverse(d)),List.normalizeMax(d)}return nada};
evaluator._helper.extractPointVec=function(c){var e={ok:!1};if("geo"==c.ctype){var d=c.value;if("P"==d.kind)return e.x=Accessor.getField(d,"x"),e.y=Accessor.getField(d,"y"),e.z=CSNumber.real(1),e.ok=!0,e}if("list"!=c.ctype)return e;var f=c.value;if(2==f.length&&(c=f[0],d=f[1],"number"==c.ctype&&"number"==d.ctype))return e.x=CSNumber.clone(c),e.y=CSNumber.clone(d),e.z=CSNumber.real(1),e.ok=!0,e;3==f.length&&(c=f[0],d=f[1],f=f[2],"number"==c.ctype&&"number"==d.ctype&&"number"==f.ctype&&(e.x=CSNumber.div(c,
f),e.y=CSNumber.div(d,f),e.z=CSNumber.real(1),e.ok=!0));return e};evaluator.polygon=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype){for(var f=[],g=0;g<d.value.length;g++){var h=evaluator._helper.extractPoint(d.value[g]);if(!h.ok)return nada;f[f.length]={X:h.x,Y:h.y}}return{ctype:"shape",type:"polygon",value:[f]}}}return nada};
evaluator.circle=function(c,e){if(2==c.length){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]),d=evaluator._helper.extractPointVec(d);if(!d.ok||"number"!=f.ctype)return nada;d=List.turnIntoCSList([d.x,d.y,d.z]);return{ctype:"shape",type:"circle",value:List.turnIntoCSList([d,f])}}return nada};
evaluator.screen=function(c,e){if(0==c.length){var d=csport.drawingstate.initialmatrix,f=function(c,e){var f=c-d.tx,p=e+d.ty;return{X:(f*d.d-p*d.b)/d.det,Y:-(-f*d.c+p*d.a)/d.det}};return{ctype:"shape",type:"polygon",value:[[f(0,0),f(csw,0),f(csw,csh),f(0,csh)]]}}return nada};evaluator.allpoints=function(c,e){if(0==c.length){erg=[];for(var d=0;d<csgeo.points.length;d++)erg[d]={ctype:"geo",value:csgeo.points[d],type:"P"};return{ctype:"list",value:erg}}return nada};
evaluator.allmasses=function(c,e){if(0==c.length){erg=[];for(var d=0;d<masses.length;d++)erg[d]={ctype:"geo",value:masses[d],type:"P"};return{ctype:"list",value:erg}}return nada};evaluator.alllines=function(c,e){if(0==c.length){erg=[];for(var d=0;d<csgeo.lines.length;d++)erg[d]={ctype:"geo",value:csgeo.lines[d],type:"L"};return{ctype:"list",value:erg}}return nada};
evaluator.halfplane=function(c,e){if(2==c.length){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]),g=evaluateAndHomog(d),h=evaluateAndHomog(f);if(d!=nada&&f!=nada){var k=f.usage,f=h;if("Line"==d.usage||"Point"==k)g=h,f=d;d=List.realVector([0,0,1]);d=List.cross(d,f);d.value=[d.value[1],CSNumber.neg(d.value[0]),d.value[2]];d=List.cross(d,g);d=List.cross(f,d);d=General.div(d,d.value[2]);g=General.div(g,g.value[2]);g=List.sub(g,d);f=List.abs(g);g=General.div(g,f);f=d.value[0].value.real;d=d.value[1].value.real;
h=1E3*g.value[0].value.real;g=1E3*g.value[1].value.real;return{ctype:"shape",type:"polygon",value:[[{X:f+g/2,Y:d-h/2},{X:f+g/2+h,Y:d-h/2+g},{X:f-g/2+h,Y:d+h/2+g},{X:f-g/2,Y:d+h/2}]]}}}return nada};
evaluator.convexhull3d=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype){for(var f=d.value,g=[],d=0;d<f.length;d++)if(List._helper.isNumberVecN(f[d],3))for(var h=0;3>h;h++)g.push(f[d].value[h].value.real);h=convexhull(g);f=h[0];g=[];for(d=0;d<f.length;d+=3)g.push(List.realVector([f[d],f[d+1],f[d+2]]));for(var f=List.turnIntoCSList(g),g=h[1],k=[],d=0;d<g.length;d++){for(h=0;h<g[d].length;h++)g[d][h]++;k.push(List.realVector(g[d]))}d=List.turnIntoCSList(k);return List.turnIntoCSList([f,
d])}}return nada};evaluator.javascript=function(c,e){if(1==c.length){var d=evaluate(c[0]);"string"==d.ctype&&eval(d.value)}return nada};evaluator._helper.extractPoint=function(c){var e={ok:!1};if("geo"==c.ctype){var d=c.value;if("P"==d.kind)return e.x=Accessor.getField(d,"x").value.real,e.y=Accessor.getField(d,"y").value.real,e.ok=!0,e}if("list"!=c.ctype)return e;var f=c.value;if(2==f.length&&(c=f[0],d=f[1],"number"==c.ctype&&"number"==d.ctype))return e.x=c.value.real,e.y=d.value.real,e.ok=!0,e;3==f.length&&(c=f[0],d=f[1],f=f[2],"number"==c.ctype&&"number"==d.ctype&&"number"==f.ctype&&(c=CSNumber.div(c,f),d=CSNumber.div(d,f),e.x=
c.value.real,e.y=d.value.real,e.ok=!0));return e};
evaluator.draw=function(c,e){var d,f=csport.drawingstate.pointsize,g=csport.drawingstate.linesize;0>f&&(f=0);0>g&&(g=0);var h=1,k=!1,p,n="rgb(0,0,0)";1!=csport.drawingstate.alpha&&(n="rgba(0,0,0,"+csport.drawingstate.alpha+")");var q=function(c){void 0!==e.size&&(d=evaluate(e.size),"number"==d.ctype&&("P"==c&&(f=d.value.real,0>f&&(f=0)),"L"==c&&(g=d.value.real,0>g&&(g=0))));if("L"==c){if(void 0!==e.dashpattern&&(d=evaluate(e.dashpattern),"list"==d.ctype)){for(var q=[],r=0;r<d.value.length;r++)q[r]=
d.value[r].value.real;evaluator._helper.setDash(q,g);k=!0}void 0!==e.dashtype&&(d=evaluate(e.dashtype),"number"==d.ctype&&(c=Math.floor(d.value.real),evaluator._helper.setDashType(c,g),k=!0));void 0!==e.dashing&&(d=evaluate(e.dashing),"number"==d.ctype&&(q=Math.floor(d.value.real),evaluator._helper.setDash([2*q,q],g),k=!0));void 0!==e.overhang&&(d=evaluate(e.overhang),"number"==d.ctype&&(h=d.value.real))}if(void 0!==e.color||void 0!==e.alpha){var l=r=q=0,s=csport.drawingstate.alpha;"P"==c&&(q=255*
csport.drawingstate.pointcolorraw[0],r=255*csport.drawingstate.pointcolorraw[1],l=255*csport.drawingstate.pointcolorraw[2]);"L"==c&&(q=255*csport.drawingstate.linecolorraw[0],r=255*csport.drawingstate.linecolorraw[1],l=255*csport.drawingstate.linecolorraw[2]);void 0!==e.color&&(d=evaluate(e.color),List.isNumberVector(d).value&&3==d.value.length&&(q=Math.floor(255*d.value[0].value.real),r=Math.floor(255*d.value[1].value.real),l=Math.floor(255*d.value[2].value.real)));void 0!==e.alpha&&(d=evaluate(e.alpha),
"number"==d.ctype&&(s=d.value.real));p="rgba("+q+","+r+","+l+","+s+")";n="rgba(0,0,0,"+s+")"}},r=function(c,d){var e=csport.drawingstate.matrix,f=c.x*e.a-c.y*e.b+e.tx,n=c.x*e.c-c.y*e.d-e.ty,r=d.x*e.a-d.y*e.b+e.tx,s=d.x*e.c-d.y*e.d-e.ty;p=csport.drawingstate.linecolor;q("L");var e=h*f+(1-h)*r,t=h*n+(1-h)*s,f=h*r+(1-h)*f,n=h*s+(1-h)*n;csctx.beginPath();csctx.moveTo(e,t);csctx.lineTo(f,n);csctx.lineWidth=g;csctx.lineCap="round";csctx.strokeStyle=p;csctx.stroke();k&&evaluator._helper.unSetDash()},s=function(c,
d){var e=evaluateAndVal(c),f=evaluateAndVal(d),e=evaluator._helper.extractPoint(e),f=evaluator._helper.extractPoint(f);if(!e.ok||!f.ok)return nada;r(e,f);return nada},t=function(){var c=CSNumber.abs(v.value[0]).value.real,d=CSNumber.abs(v.value[1]).value.real,e=CSNumber.abs(v.value[2]).value.real,f;c>=d&&c>=e&&(f=v.value[0]);d>=c&&d>=e&&(f=v.value[1]);e>=d&&e>=c&&(f=v.value[2]);c=CSNumber.div(v.value[0],f);d=CSNumber.div(v.value[1],f);f=CSNumber.div(v.value[2],f);f=[c.value.real,d.value.real,f.value.real];
Math.abs(f[0])<Math.abs(f[1])?(d=[1,0,30],c=[-1,0,30]):(d=[0,1,30],c=[0,-1,30]);d=[f[1]*d[2]-f[2]*d[1],f[2]*d[0]-f[0]*d[2],f[0]*d[1]-f[1]*d[0]];f=[f[1]*c[2]-f[2]*c[1],f[2]*c[0]-f[0]*c[2],f[0]*c[1]-f[1]*c[0]];r({x:d[0]/d[2],y:d[1]/d[2]},{x:f[0]/f[2],y:f[1]/f[2]})};if(2==c.length)return s(c[0],c[1]);var v=evaluateAndVal(c[0]);return"shape"==v.ctype?evaluator._helper.drawshape(v,e):"Line"==v.usage?t():function(){var c=evaluator._helper.extractPoint(v);if(!c.ok&&"undefined"!==typeof v.value){if(2==v.value.length){s(v.value[0],
v.value[1]);return}return nada}var d=csport.drawingstate.matrix,e=c.x*d.a-c.y*d.b+d.tx,c=c.x*d.c-c.y*d.d-d.ty;p=csport.drawingstate.pointcolor;q("P");csctx.lineWidth=.3*f;csctx.beginPath();csctx.arc(e,c,f,0,2*Math.PI);csctx.fillStyle=p;csctx.fill();csctx.beginPath();csctx.arc(e,c,1.15*f,0,2*Math.PI);csctx.fillStyle=n;csctx.strokeStyle=n;csctx.stroke()}()};evaluator.drawcircle=function(c,e){evaluator._helper.drawcircle(c,e,"D")};evaluator.fillcircle=function(c,e){evaluator._helper.drawcircle(c,e,"F")};
evaluator._helper.drawcircle=function(c,e,d){var f,g=4,h;if(2==c.length){var k=evaluateAndVal(c[0]);c=evaluateAndVal(c[1]);f=evaluator._helper.extractPoint(k);if(f.ok&&"number"==c.ctype){var k=csport.drawingstate.matrix,p=f.x*k.a-f.y*k.b+k.tx,n=f.x*k.c-f.y*k.d-k.ty;h=csport.drawingstate.linecolor;void 0!==e.size&&(f=evaluate(e.size),"number"==f.ctype&&(g=f.value.real,0>g&&(g=0)));if(void 0!==e.color||void 0!==e.alpha){var q=h=0,r=0,s=csport.drawingstate.alpha;h=255*csport.drawingstate.linecolorraw[0];
q=255*csport.drawingstate.linecolorraw[1];r=255*csport.drawingstate.linecolorraw[2];void 0!==e.color&&(f=evaluate(e.color),List.isNumberVector(f).value&&3==f.value.length&&(h=Math.floor(255*f.value[0].value.real),q=Math.floor(255*f.value[1].value.real),r=Math.floor(255*f.value[2].value.real)));void 0!==e.alpha&&(f=evaluate(e.alpha),"number"==f.ctype&&(s=f.value.real));h="rgba("+h+","+q+","+r+","+s+")"}csctx.lineWidth=.3*g;csctx.beginPath();csctx.lineWidth=.4*g;csctx.arc(p,n,c.value.real*k.sdet,0,
2*Math.PI);"D"==d&&(csctx.strokeStyle=h,csctx.stroke());"F"==d&&(csctx.fillStyle=h,csctx.fill());"C"==d&&csctx.clip();e=void 0}else e=nada;return e}return nada};evaluator.drawall=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)for(var f=0;f<d.value.length;f++)evaluator.draw([d.value[f]],e)}return nada};evaluator.connect=function(c,e){evaluator._helper.drawpolygon(c,e,"D",0)};evaluator.drawpoly=function(c,e){evaluator._helper.drawpolygon(c,e,"D",1)};
evaluator.fillpoly=function(c,e){evaluator._helper.drawpolygon(c,e,"F",1)};evaluator.drawpolygon=function(c,e){evaluator._helper.drawpolygon(c,e,"D",1)};evaluator.fillpolygon=function(c,e){evaluator._helper.drawpolygon(c,e,"F",1)};
evaluator._helper.drawpolygon=function(c,e,d,f){var g,h=4,k,p=function(){void 0!==e.size&&(g=evaluate(e.size),"number"==g.ctype&&(h=g.value.real,0>h&&(h=0)));if(void 0!==e.color||void 0!==e.alpha){var c=0,d=0,f=0,n=csport.drawingstate.alpha,c=255*csport.drawingstate.linecolorraw[0],d=255*csport.drawingstate.linecolorraw[1],f=255*csport.drawingstate.linecolorraw[2];void 0!==e.color&&(g=evaluate(e.color),List.isNumberVector(g).value&&3==g.value.length&&(c=Math.floor(255*g.value[0].value.real),d=Math.floor(255*
g.value[1].value.real),f=Math.floor(255*g.value[2].value.real)));void 0!==e.alpha&&(g=evaluate(e.alpha),"number"==g.ctype&&(n=g.value.real));k="rgba("+c+","+d+","+f+","+n+")"}},n=function(){var c=csport.drawingstate.matrix,e=r.value;"D"!=d&&csctx.beginPath();for(var f=0;f<e.length;f++){for(var g=e[f],n=[],q=0;q<g.length;q++){var l=g[q];n[n.length]=[l.X*c.a-l.Y*c.b+c.tx,l.X*c.c-l.Y*c.d-c.ty]}k=csport.drawingstate.linecolor;p();csctx.lineWidth=.3*h;csctx.mozFillRule="evenodd";csctx.lineJoin="round";
"D"==d&&csctx.beginPath();csctx.lineWidth=.4*h;csctx.moveTo(n[0][0],n[0][1]);for(q=1;q<n.length;q++)csctx.lineTo(n[q][0],n[q][1]);"D"==d&&(csctx.closePath(),csctx.strokeStyle=k,csctx.stroke())}"D"!=d&&csctx.closePath();"F"==d&&(csctx.fillStyle=k,csctx.fill());"C"==d&&csctx.clip()},q=function(){for(var c=csport.drawingstate.matrix,e=[],g=0;g<r.value.length;g++){var n=evaluator._helper.extractPoint(r.value[g]);if(!n.ok)return nada;e[e.length]=[n.x*c.a-n.y*c.b+c.tx,n.x*c.c-n.y*c.d-c.ty]}k=csport.drawingstate.linecolor;
p();csctx.lineWidth=.3*h;csctx.mozFillRule="evenodd";csctx.beginPath();csctx.lineWidth=.4*h;csctx.moveTo(e[0][0],e[0][1]);for(g=1;g<e.length;g++)csctx.lineTo(e[g][0],e[g][1]);1==f&&csctx.closePath();"D"==d&&(csctx.strokeStyle=k,csctx.stroke());"F"==d&&(csctx.fillStyle=k,csctx.fill());"C"==d&&csctx.clip()};if(1==c.length){var r=evaluate(c[0]);if("list"==r.ctype)return q();if("shape"==r.ctype)return n()}return nada};
evaluator.drawtext=function(c,e){var d=csport.drawingstate.textsize;0>d&&(d=0);var f="",g="",h="Arial",k=0,p=0,n=0;if(2==c.length){var q=evaluateAndVal(c[0]),r=evaluate(c[1]),s=evaluator._helper.extractPoint(q);if(!s.ok)return nada;var t=csport.drawingstate.matrix,q=s.x*t.a-s.y*t.b+t.tx,s=s.x*t.c-s.y*t.d-t.ty;col=csport.drawingstate.textcolor;void 0!==e.size&&(erg=evaluate(e.size),"number"==erg.ctype&&(d=erg.value.real,0>d&&(d=0)));void 0!==e.bold&&(erg=evaluate(e.bold),"boolean"==erg.ctype&&erg.value&&
(f="bold "));void 0!==e.italics&&(erg=evaluate(e.italics),"boolean"==erg.ctype&&erg.value&&(g="italic "));void 0!==e.family&&(erg=evaluate(e.family),"string"==erg.ctype&&(h=erg.value));void 0!==e.align&&(erg=evaluate(e.align),"string"==erg.ctype&&("left"==erg.value&&(k=0),"right"==erg.value&&(k=1),"mid"==erg.value&&(k=.5)));void 0!==e.x_offset&&(erg=evaluate(e.x_offset),"number"==erg.ctype&&(p=erg.value.real));void 0!==e.y_offset&&(erg=evaluate(e.y_offset),"number"==erg.ctype&&(n=erg.value.real));
void 0!==e.offset&&(erg=evaluate(e.offset),"list"==erg.ctype&&2==erg.value.length&&"number"==erg.value[0].ctype&&"number"==erg.value[1].ctype&&(p=erg.value[0].value.real,n=erg.value[1].value.real));if(void 0!==e.color||void 0!==e.alpha){var v=t=0,u=0,x=csport.drawingstate.alpha,t=255*csport.drawingstate.textcolorraw[0],v=255*csport.drawingstate.textcolorraw[1],u=255*csport.drawingstate.textcolorraw[2];void 0!==e.color&&(erg=evaluate(e.color),List.isNumberVector(erg).value&&3==erg.value.length&&(t=
Math.floor(255*erg.value[0].value.real),v=Math.floor(255*erg.value[1].value.real),u=Math.floor(255*erg.value[2].value.real)));void 0!==e.alpha&&(erg=evaluate(e.alpha),"number"==erg.ctype&&(x=erg.value.real));col="rgba("+t+","+v+","+u+","+x+")"}csctx.fillStyle=col;csctx.font=f+g+Math.round(10*d)/10+"px "+h;d=niceprint(r);f=csctx.measureText(d).width;csctx.fillText(d,q-f*k+p,s-n)}return nada};
evaluator._helper.drawshape=function(c,e){return"polygon"==c.type?evaluator._helper.drawpolygon([c],e,"D",1):"circle"==c.type?evaluator._helper.drawcircle([c.value.value[0],c.value.value[1]],e,"D"):nada};evaluator._helper.fillshape=function(c,e){return"polygon"==c.type?evaluator._helper.drawpolygon([c],e,"F",1):"circle"==c.type?evaluator._helper.drawcircle([c.value.value[0],c.value.value[1]],e,"F"):nada};
evaluator._helper.clipshape=function(c,e){return"polygon"==c.type?evaluator._helper.drawpolygon([c],e,"C",1):"circle"==c.type?evaluator._helper.drawcircle([c.value.value[0],c.value.value[1]],e,"C"):nada};evaluator.fill=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("shape"==d.ctype)return evaluator._helper.fillshape(d,e)}return nada};
evaluator.clip=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("shape"==d.ctype)return evaluator._helper.clipshape(d,e);if("list"==d.ctype)return erg=evaluator.polygon(c,[]),evaluator.clip([erg],[])}return nada};evaluator._helper.setDash=function(c,e){for(var d=Math.sqrt(e),f=0;f<c.length;f++)c[f]*=d;csctx.setLineDash||(csctx.setLineDash=function(){});csctx.webkitLineDash=c;csctx.setLineDash(c);csctx.mozDash=c};
evaluator._helper.unSetDash=function(){csctx.setLineDash||(csctx.setLineDash=function(){});csctx.webkitLineDash=[];csctx.setLineDash([]);csctx.mozDash=[]};evaluator._helper.setDashType=function(c,e){0==c&&evaluator._helper.setDash([]);1==c&&evaluator._helper.setDash([10,10],e);2==c&&evaluator._helper.setDash([10,4],e);3==c&&evaluator._helper.setDash([1,3],e);4==c&&evaluator._helper.setDash([10,5,1,5],e)};
evaluator.plot=function(c,e){var d=!1,f=!1,g=.2/csscale,h=0,k=!1,p=-10,n=10,q=1,r=1E3,s=c[0];if(2==c.length&&"variable"==c[1].ctype)v=c[1].name;else{var t=evaluator._helper.plotvars(s),v="#";-1!=t.indexOf("t")&&(v="t");-1!=t.indexOf("z")&&(v="z");-1!=t.indexOf("y")&&(v="y");-1!=t.indexOf("x")&&(v="x")}namespace.newvar(v);var u=csport.drawingstate.matrix,x=csport.drawingstate.linecolor,y=1;(function(c){void 0!==e.size&&(G=evaluate(e.size),"number"==G.ctype&&(y=G.value.real,0>y&&(y=0)));if(void 0!==
e.dashpattern&&(G=evaluate(e.dashpattern),"list"==G.ctype)){c=[];for(var g=0;g<G.value.length;g++)c[g]=G.value[g].value.real;evaluator._helper.setDash(c,y);d=!0}void 0!==e.dashtype&&(G=evaluate(e.dashtype),"number"==G.ctype&&(c=Math.floor(G.value.real),evaluator._helper.setDashType(c,y),d=!0));void 0!==e.dashing&&(G=evaluate(e.dashing),"number"==G.ctype&&(c=Math.floor(G.value.real),evaluator._helper.setDash([2*c,c],y),d=!0));void 0!==e.connect&&(G=evaluate(e.connect),"boolean"==G.ctype&&(f=G.value));
void 0!==e.start&&(G=evaluate(e.start),"number"==G.ctype&&(p=G.value.real));void 0!==e.stop&&(G=evaluate(e.stop),"number"==G.ctype&&(n=G.value.real));void 0!==e.steps&&(G=evaluate(e.steps),"number"==G.ctype&&(r=G.value.real));if(void 0!==e.color||void 0!==e.alpha){var h=g=c=0,k=csport.drawingstate.alpha;c=255*csport.drawingstate.linecolorraw[0];g=255*csport.drawingstate.linecolorraw[1];h=255*csport.drawingstate.linecolorraw[2];void 0!==e.color&&(G=evaluate(e.color),List.isNumberVector(G).value&&3==
G.value.length&&(c=Math.floor(255*G.value[0].value.real),g=Math.floor(255*G.value[1].value.real),h=Math.floor(255*G.value[2].value.real)));void 0!==e.alpha&&(G=evaluate(e.alpha),"number"==G.ctype&&(k=G.value.real));x="rgba("+c+","+g+","+h+","+k+")"}})();csctx.strokeStyle=x;csctx.lineWidth=y;csctx.lineCap="round";csctx.lineJoin="round";var l=function(c){return"number"==c.ctype&&CSNumber._helper.isAlmostReal(c)},A=function(c,d,e,f,g){},A=function(c,d,e,f,g){h++;d=+d.value.real;g=+f.value.real;f=d*u.a-
g*u.b+u.tx;d=d*u.c-g*u.d-u.ty;c=+c.value.real;g=+e.value.real;e=c*u.a-g*u.b+u.tx;c=c*u.c-g*u.d-u.ty;k?(csctx.lineTo(e,c),csctx.lineTo(f,d)):(csctx.beginPath(),csctx.moveTo(e,c),csctx.lineTo(f,d),k=!0)},z=function(c,d,e,h,n){var p=l(e),q=l(h);if(.001>n)!f&&k&&(csctx.stroke(),k=!1);else if(p||q){var Q=CSNumber.real((c.value.real+d.value.real)/2);namespace.setvar(v,Q);var X=evaluate(s),W=l(X);if(p&&q&&W){var O=e.value.real,q=X.value.real,W=h.value.real;if(p=1>Math.abs(O+W-2*q)/g){var P=CSNumber.real((c.value.real+
Q.value.real)/2);namespace.setvar(v,P);var P=evaluate(s),r=CSNumber.real((Q.value.real+d.value.real)/2);namespace.setvar(v,r);r=evaluate(s).value.real;O=Math.abs(O+q-2*P.value.real)/g;q=Math.abs(q+W-2*r)/g;p=p&&1>O&&1>q}p?(A(c,Q,e,X,n/2),A(Q,d,X,h,n/2)):(z(c,Q,e,X,n/2),z(Q,d,X,h,n/2))}else z(c,Q,e,X,n/2),z(Q,d,X,h,n/2)}},C,B,H,k=!1,t=CSNumber.real(14.32);namespace.setvar(v,t);H=evaluate(s);if("number"!=H.ctype){if(List.isNumberVector(H).value&&2==H.value.length){k=!1;q=(n-p)/r;for(t=p;t<n;t+=q){namespace.setvar(v,
CSNumber.real(t));var G=evaluate(s);if(List.isNumberVector(G).value&&2==G.value.length){C=+G.value[0].value.real;B=+G.value[1].value.real;var L=C*u.a-B*u.b+u.tx;C=C*u.c-B*u.d-u.ty;k?csctx.lineTo(L,C):(csctx.beginPath(),csctx.moveTo(L,C),k=!0)}}csctx.stroke();namespace.removevar(v)}d&&evaluator._helper.unSetDash();return nada}for(L=p;L<n+q;L+=q)t=CSNumber.real(L),namespace.setvar(v,t),H=evaluate(s),t.value.real>p&&z(C,t,B,H,q),C=t,B=H;namespace.removevar(v);k&&csctx.stroke();d&&evaluator._helper.unSetDash();
return nada};
evaluator.plotX=function(c,e){var d=c[0],f=evaluator._helper.plotvars(d),g="#";-1!=f.indexOf("t")&&(g="t");-1!=f.indexOf("z")&&(g="z");-1!=f.indexOf("y")&&(g="y");-1!=f.indexOf("x")&&(g="x");namespace.newvar(g);f=csport.drawingstate.matrix;csctx.fillStyle=csport.drawingstate.linecolor;csctx.lineWidth=1;csctx.lineCap="round";for(var h=!1,k=-10;10>k;k+=.01){namespace.setvar(g,CSNumber.real(k));var p=evaluate(d);if("number"==p.ctype){var n=+p.value.real,p=k*f.a-n*f.b+f.tx,n=k*f.c-n*f.d-f.ty;h?csctx.lineTo(p,
n):(csctx.beginPath(),csctx.moveTo(p,n),h=!0)}}csctx.stroke();namespace.removevar(g);return nada};
evaluator._helper.plotvars=function(c){var e=function(c,d){for(var e={},f=c.length-1;0<=f;--f)e[c[f]]=c[f];for(f=d.length-1;0<=f;--f)e[d[f]]=d[f];var f=[],g;for(g in e)e.hasOwnProperty(g)&&f.push(e[g]);return f},d=function(c,d){for(var e=0;e<c.length;e++)c[e]===d&&(c.splice(e,1),e--);return c};if("variable"==c.ctype)return[c.name];if("infix"==c.ctype){var f=evaluator._helper.plotvars(c.args[0]);c=evaluator._helper.plotvars(c.args[1]);return e(f,c)}if("list"==c.ctype){for(var g=c.value,h=[],k=0;k<
g.length;k++)f=evaluator._helper.plotvars(g[k]),h=e(h,f);return h}if("function"==c.ctype){g=c.args;h=[];for(k=0;k<g.length;k++)f=evaluator._helper.plotvars(g[k]),h=e(h,f);"apply"!=c.oper&&"select"!=c.oper&&"forall"!=c.oper&&"sum"!=c.oper&&"product"!=c.oper&&"repeat"!=c.oper&&"min"!=c.oper&&"max"!=c.oper&&"sort"!=c.oper||"variable"!=c.args[1].ctype||(h=d(h,c.args[1].name));return h}return[]};
evaluator.clrscr=function(c,e){0==c.length&&"undefined"!=typeof csw&&"undefined"!=typeof csh&&csctx.clearRect(0,0,csw,csh);return nada};evaluator.repaint=function(c,e){console.log("REPAINT");0==c.length&&updateCindy();return nada};
evaluator.screenbounds=function(c,e){if(0==c.length){var d=List.realVector(csport.to(0,0));d.usage="Point";var f=List.realVector(csport.to(csw,0));f.usage="Point";var g=List.realVector(csport.to(csw,csh));g.usage="Point";var h=List.realVector(csport.to(0,csh));h.usage="Point";return List.turnIntoCSList([d,f,g,h])}return nada};evaluator._helper.extractReferenceX=function(c,e){};
evaluator.drawimage=function(c,e){var d=function(){var c=1,d=1,f=1,k=1,p=0,v=1,u=evaluator._helper.extractPoint(g);if(!u.ok||"string"!=h.ctype)return nada;csctx.save();void 0!==e.angle&&(erg=evaluate(e.angle),"number"==erg.ctype&&(p=erg.value.real));void 0!==e.rotation&&(erg=evaluate(e.rotation),"number"==erg.ctype&&(p=erg.value.real));void 0!==e.scale&&(erg=evaluateAndVal(e.scale),"number"==erg.ctype&&(d=c=erg.value.real),List.isNumberVector(erg).value&&2==erg.value.length&&(c=erg.value[0].value.real,
d=erg.value[1].value.real));void 0!==e.scalex&&(erg=evaluate(e.scalex),"number"==erg.ctype&&(c=erg.value.real));void 0!==e.scaley&&(erg=evaluate(e.scaley),"number"==erg.ctype&&(d=erg.value.real));void 0!==e.flipx&&(erg=evaluate(e.flipx),"boolean"==erg.ctype&&erg.value&&(f=-1));void 0!==e.flipy&&(erg=evaluate(e.flipy),"boolean"==erg.ctype&&erg.value&&(k=-1));void 0!==e.alpha&&(erg=evaluate(e.alpha),"number"==erg.ctype&&(v=erg.value.real));var x=csport.drawingstate.matrix,y=csport.drawingstate.initialmatrix,
l=images[h.value].width,A=images[h.value].height,z=u.x*x.a-u.y*x.b+x.tx,C=u.x*x.c-u.y*x.d-x.ty,B=(u.x+1)*x.a-u.y*x.b+x.tx-z,x=(u.x+1)*x.c-u.y*x.d-x.ty-C,H=(u.x+1)*y.a-u.y*y.b+y.tx-(u.x*y.a-u.y*y.b+y.tx),y=(u.x+1)*y.c-u.y*y.d-y.ty-(u.x*y.c-u.y*y.d-y.ty),u=Math.sqrt(B*B+x*x)/Math.sqrt(H*H+y*y),B=-Math.atan2(B,x)+Math.atan2(H,y);1!=v&&(csctx.globalAlpha=v);csctx.translate(z,C);csctx.scale(c*f*u,d*k*u);csctx.rotate(p+B);csctx.translate(-z,-C);csctx.translate(-l/2,-A/2);csctx.drawImage(images[h.value],
z,C);csctx.globalAlpha=1;csctx.restore()},f=function(){var c=1,d=1,f=1,s=1,t=evaluator._helper.extractPoint(g),v=evaluator._helper.extractPoint(k),u;if(!t.ok||!v.ok||"string"!=h.ctype)return nada;if(void 0!==images&&"undefined"!=images[h.value]){var x=images[h.value].width,y=images[h.value].height;if(0==p)u={},u.x=t.x-(v.y-t.y),u.y=t.y+(v.x-t.x),s=y/x;else if(u=evaluator._helper.extractPoint(p),!t.ok)return nada;csctx.save();void 0!==e.alpha&&(erg=evaluate(e.alpha),"number"==erg.ctype&&(c=erg.value.real));
void 0!==e.aspect&&(erg=evaluate(e.aspect),"number"==erg.ctype&&(s=erg.value.real));void 0!==e.flipx&&(erg=evaluate(e.flipx),"boolean"==erg.ctype&&erg.value&&(d=-1));void 0!==e.flipy&&(erg=evaluate(e.flipy),"boolean"==erg.ctype&&erg.value&&(f=-1));var l=csport.drawingstate.matrix;1!=c&&(csctx.globalAlpha=c);c=t.x*l.a-t.y*l.b+l.tx;t=t.x*l.c-t.y*l.d-l.ty;csctx.transform(v.x*l.a-v.y*l.b+l.tx-c,v.x*l.c-v.y*l.d-l.ty-t,u.x*l.a-u.y*l.b+l.tx-c,u.x*l.c-u.y*l.d-l.ty-t,c,t);csctx.scale(1/x,-1/y*s);csctx.translate(x/
2,-y/2);csctx.scale(d,f);csctx.translate(-x/2,y/2);csctx.translate(0,-y);csctx.drawImage(images[h.value],0,0);csctx.globalAlpha=1;csctx.restore()}};if(2==c.length){var g=evaluateAndVal(c[0]),h=evaluateAndVal(c[1]);return d()}if(3==c.length){var g=evaluateAndVal(c[0]),k=evaluateAndVal(c[1]),p=0,h=evaluateAndVal(c[2]);return f()}return 4==c.length?(g=evaluateAndVal(c[0]),k=evaluateAndVal(c[1]),p=evaluateAndVal(c[2]),h=evaluateAndVal(c[3]),f()):nada};var evaluate=function(c){if("undefined"===typeof c)return nada;if("infix"==c.ctype)return evaluator._helper.eval(infixmap[c.oper],c.args,[]);if("variable"==c.ctype)return namespace.getvar(c.name);if("void"==c.ctype||"geo"==c.ctype||"number"==c.ctype||"boolean"==c.ctype||"string"==c.ctype||"list"==c.ctype||"undefined"==c.ctype||"shape"==c.ctype)return c;if("field"==c.ctype){var e=evaluate(c.obj);return"geo"==e.ctype?Accessor.getField(e.value,c.key):"list"==e.ctype?List.getField(e,c.key):nada}return"function"==
c.ctype?evaluator._helper.eval(c.oper,c.args,c.modifs):nada},evaluateAndVal=function(c){c=evaluate(c);if("geo"==c.ctype){var e=c.value;if("P"==e.kind)return Accessor.getField(e,"xy")}return c},evaluateAndHomog=function(c){c=evaluate(c);if("geo"==c.ctype){var e=c.value;if("P"==e.kind)return Accessor.getField(e,"homog");if("L"==e.kind)return c}return List._helper.isNumberVecN(c,3)?c:List._helper.isNumberVecN(c,2)?(c=General.clone(c),c.value[2]=CSNumber.real(1),c):nada},condense=function(c){for(var e=
!1,d=!1,f="",g=0;g<c.length;g++){var h=c[g];'"'!=h||d||(e=!e);"/"==h&&g!=c.length-1&&"/"==c[g+1]&&(d=!0);"\n"==h&&(d=!1);if(" "!==h&&"\t"!==h&&"\n"!==h&&"\f"!==h&&"\r"!==h&&!d||e)f+=h}return f},report=function(c,e){var d=Array(e+1).join(".");"infix"==c.ctype&&(console.log(d+"INFIX: "+c.oper),console.log(d+"ARG 1 "),report(c.args[0],e+1),console.log(d+"ARG 2 "),report(c.args[1],e+1));"number"==c.ctype&&console.log(d+"NUMBER: "+CSNumber.niceprint(c));"variable"==c.ctype&&console.log(d+"VARIABLE: "+
c.name);"undefined"==c.ctype&&console.log(d+"UNDEF");"void"==c.ctype&&console.log(d+"VOID");"string"==c.ctype&&console.log(d+"STRING: "+c.value);"shape"==c.ctype&&console.log(d+"SHAPE: "+c.type);"modifier"==c.ctype&&console.log(d+"MODIF: "+c.key);if("list"==c.ctype){console.log(d+"LIST ");for(var f=c.value,g=0;g<f.length;g++)console.log(d+"EL"+g),report(f[g],e+1)}if("function"==c.ctype){console.log(d+"FUNCTION: "+c.oper);f=c.args;for(g=0;g<f.length;g++)console.log(d+"ARG"+g),report(f[g],e+1);var f=
c.modifs,h;for(h in f)console.log(d+"MODIF:"+h),report(f[h],e+1)}"error"==c.ctype&&console.log(d+"ERROR: "+c.message)},generateInfix=function(c,e,d){var f={ctype:"infix"};f.oper=c;f.args=[e,d];return f},modifierOp=function(c,e,d){var f=c.substring(0,e);c=analyse(c.substring(e+d.length),!1);return"error"==c.ctype?c:{ctype:"modifier",key:f,value:c}},definitionDot=function(c,e,d){if(isNumber(c)){var f={};f.value={real:parseFloat(c),imag:0};f.ctype="number";return f}f=analyse(c.substring(0,e),!1);c=c.substring(e+
d.length);return{ctype:"field",obj:f,key:c}},validDefinabaleFunction=function(c){if("function"!=c.ctype)return!1;for(var e=0;e<c.args.length;e++)if("variable"!=c.args[e].ctype)return!1;for(e=0;e<c.args.length-1;e++)for(var d=e+1;d<c.args.length;d++)if(c.args[e].name==c.args[d].name)return!1;return!0},definitionOp=function(c,e,d){var f=c.substring(0,e),f=analyse(f,!0);return"error"==f.ctype?f:"variable"==f.cstring||validDefinabaleFunction(f)?(c=c.substring(e+d.length),c=analyse(c,!1),"error"==c.ctype?
c:generateInfix(d,f,c)):new CError("Function not definable")},infixOp=function(c,e,d){var f=analyse(c.substring(0,e),!1);c=analyse(c.substring(e+d.length),!1);return"error"==f.ctype?f:"error"==c.ctype?c:generateInfix(d,f,c)},isPureNumber=function(c){return""!=c&&!isNaN(c)},isNumber=function(c){var e=c.indexOf("."),d=c.lastIndexOf(".");return e!=d?!1:-1==e?isPureNumber(c):isPureNumber(c.substring(0,e))||isPureNumber(c.substring(e+1))},somethingelse=function(c){if(""==c)return new Void;if('"'==c.charAt(0)&&
'"'==c.charAt(c.length-1))return{ctype:"string",value:c.substring(1,c.length-1)};if(isPureNumber(c))return{ctype:"number",value:{real:parseInt(c),imag:0}};if(namespace.isVariable(c))return namespace.vars[c];if(namespace.isVariableName(c)){var e=namespace.create(c);namespace.setvar(c,nada);return e}return nada},isOpener=function(c){return"["==c||"("==c||"{"==c||"|"==c},isCloser=function(c){return"]"==c||")"==c||"}"==c||"|"==c},isBracketPair=function(c){return"[]"==c||"()"==c||"{}"==c||"||"==c},funct=
function(c,e,d){var f=[];d=[];var g={},h=c.substring(0,e),k=c.length,p=0,n=e+1,q=!1,r=!1;for(e=n;e<k;e++){var s=c[e];'"'==s&&(q=!q);!q&&(!isOpener(s)||"|"==s&&r?isCloser(s)&&("|"!=s||r)&&(p--,"|"==s&&(r=!1)):(p++,"|"==s&&(r=!0)),","==s&&0==p||-1==p)&&(n=c.substring(n,e),f[f.length]=n,1!=f.length||-1!=p||f[0].length||(f=[]),n=e+1)}for(e=0;e<f.length;e++){c=analyse(f[e],!1);if("error"==c.ctype)return c;"modifier"==c.ctype?g[c.key]=c.value:d[d.length]=c}c={ctype:"function"};c.oper=h;c.args=d;c.modifs=
g;return c},parseList=function(c){var e,d=[],f=[];e=c+",";var g=e.length,h=0,k=0,p=!1,n=!1;for(c=k;c<g;c++){var q;q=e[c];'"'==q&&(n=!n);!n&&(!isOpener(q)||"|"==q&&p?isCloser(q)&&("|"!=q||p)&&(h--,"|"==q&&(p=!1)):(h++,"|"==q&&(p=!0)),","==q&&0==h||-1==h)&&(k=e.substring(k,c),d[d.length]=k,k=c+1)}for(c=0;c<d.length;c++)if(e=d[c],""==e)f[f.length]="nil";else{e=analyse(e,!1);if("error"==e.ctype)return e;f[f.length]=e}d={ctype:"function",oper:"genList"};d.args=f;d.modifs=[];return d},bracket=function(c){if("|"==
c[0]){c=parseList(c.substring(1,c.length-1));var e=c.args.length;return 1==e?(c.oper="abs",c):2==e?(c.oper="dist",c):nada}return"()"==c||"[]"==c?e={ctype:"list",value:[]}:"["==c[0]?parseList(c.substring(1,c.length-1)):"("==c[0]&&(e=parseList(c.substring(1,c.length-1)),1<e.args.length)?e:e=analyse(c.substring(1,c.length-1),!1)},analyse=function(c,e){for(var d=!1,f="",g=-1,h=-1,k="",p=0,n=0,q=" ",r=" ",s=0,t=!1,v=c.length,u=0;u<v;u++){var x,y=" ",l=" ";0<s&&s--;x=c[u];u+1<v&&(y=c[u+1]);u+2<v&&(l=c[u+
2]);'"'==x&&(d=!d);if(!d){if(isOpener(x)&&("|"!=x||!t))"|"==x&&(t=!0),f+=x,p++,1==p&&n++," "==q&&(q=x);else if(isCloser(x)&&("|"!=x||t)){"|"==x&&(t=!1);if(0==p)return new CError("close without open");if(isBracketPair(f[f.length-1]+x))p--,f=f.substring(0,f.length-1),r=x;else return new CError("unmatched brackets")}if(0==f.length){var A=-1,z="";"undefined"!=typeof operators[x+y+l]&&0==s?(z=x+y+l,s=3):"undefined"!=typeof operators[x+y]&&0==s?(z=""+x+y,s=2):"undefined"!=typeof operators[x]&&0==s&&(z=
""+x,s=1);""!=z&&(A=operators[z]);A>=h&&(h=A,g=u,k=z,0<=A&&(u+=z.length-1))}}}if(0!=p)return new CError("open without close");d=c.indexOf(q);r=c.lastIndexOf(r);return 0==p&&-1<h?"->"==k?modifierOp(c,g,k):"."==k?definitionDot(c,g,k):":="==k?definitionOp(c,g,k):infixOp(c,g,k):0==p&&1==n&&r==c.length-1?0==d?bracket(c,this):funct(c,d,e):somethingelse(c)};evaluator.sound={};evaluator.sound.lines=[0,0,0,0,0,0,0,0,0,0,0,0];evaluator.playsin=function(c,e){var d=evaluateAndVal(c[0]),f=0;if("number"==d.ctype){void 0!==e.line&&(erg=evaluate(e.line),"number"==erg.ctype&&(f=Math.floor(erg.value.real),0>f&&(f=0),10<f&&(inenumber=10)));var g=evaluator.sound.lines,d=d.value.real;0==g[f]?g[f]=T("sin",{freq:d,mul:.6}).play():g[f].set({freq:d})}return nada};var lab={},doPri45={a:[[],[.2],[.075,.225],[44/45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/6784,11/84]],dt:[0,.2,.3,.8,8/9,1,1],b1:[35/384,0,500/1113,125/192,-2187/6784,11/84,0],b2:[5179/57600,0,7571/16695,.6140625,-92097/339200,187/2100,.025],size:7},rk=doPri45,behaviors,masses=[];
function csinitphys(c){behaviors=c;masses=[];behaviors.forEach(function(c){if(c.name){var d=c.name;csgeo.csnames[d]&&(csgeo.csnames[d].behavior=c.behavior,labObjects[c.behavior.type].init(c.behavior,csgeo.csnames[d]),"Mass"==c.behavior.type&&masses.push(csgeo.csnames[d]))}else labObjects[c.behavior.type].init(c.behavior)})}lab.tick=function(){for(var c=0;c<labObjects.env.accuracy;c++)lab.tick1(labObjects.env.deltat/labObjects.env.accuracy)};
lab.tick1=function(c){for(var e=c,d=0;0<c&&d<.999*c||0>c&&d>.999*c;)e=lab.oneRKStep(e),d+=e,e=Math.min(2*e,c-d),e=Math.max(e,1E-16),lab.restorePosition(),lab.doCollisions(),lab.calculateForces(),lab.moveToFinalPos();return!0};lab.restorePosition=function(){behaviors.forEach(function(c){beh=c.behavior;labObjects[beh.type].restorePos(beh,rk.size+2)})};lab.doCollisions=function(){behaviors.forEach(function(c){beh=c.behavior;labObjects[beh.type].doCollisions(beh)})};
lab.calculateForces=function(){behaviors.forEach(function(c){beh=c.behavior;labObjects[beh.type].calculateForces(beh)})};lab.moveToFinalPos=function(){behaviors.forEach(function(c){beh=c.behavior;labObjects[beh.type].move(beh)})};
lab.oneRKStep=function(c){for(var e=function(c){behaviors.forEach(function(d){beh=d.behavior;labObjects[beh.type].initRK(beh,c);labObjects[beh.type].storePosition(beh)})},d=function(c){behaviors.forEach(function(d){beh=d.behavior;labObjects[beh.type].setToTimestep(beh,rk.dt[c])})},f=function(c){behaviors.forEach(function(d){beh=d.behavior;labObjects[beh.type].proceedMotion(beh,rk.dt[c],c,rk.a[c])})},g=function(){behaviors.forEach(function(c){beh=c.behavior;labObjects[beh.type].resetForces(beh)})},
h=function(c){behaviors.forEach(function(d){beh=d.behavior;labObjects[beh.type].calculateDelta(beh,c)})},k=function(d){var e=0;behaviors.forEach(function(c){beh=c.behavior;c=rk.size;labObjects[beh.type].proceedMotion(beh,rk.dt[c-1],c,rk.b1);labObjects[beh.type].savePos(beh,c+1);labObjects[beh.type].proceedMotion(beh,rk.dt[c-1],c,rk.b2);labObjects[beh.type].savePos(beh,c+2);e+=labObjects[beh.type].sqDist(beh,c+1,c+2)});return e=Math.sqrt(e)/c},p=function(c){behaviors.forEach(function(c){beh=c.behavior;
labObjects[beh.type].recallPosition(beh)})},n=rk.size,q=!1;!q;){e(c);for(var r=0;r<n;r++)d(r),f(r),g(),lab.calculateForces(),h(r);.001<k(c)&&1E-7<c?(c/=2,p()):q=!0}return c};labObjects={Mass:{init:function(c,e){c.vel=[0,0,0];c.pos=[0,0,0,0];c.el=e;"undefined"===typeof c.mass&&(c.mass=1);"undefined"===typeof c.charge&&(c.charge=0);"undefined"===typeof c.friction&&(c.friction=0);c.lnfrict=0;"undefined"===typeof c.limitspeed&&(c.limitspeed=!1);"undefined"===typeof c.fixed&&(c.fixed=!1);"undefined"===typeof c.radius&&(c.radius=1);c.internalmove=!1;c.fx=0;c.fy=0;c.fz=0;c.vx=c.vx||0;c.vy=c.vy||0;c.vz=c.vz||0;c.mtype=0;c.env=labObjects.env;c.deltat=0;c.mx=0;c.my=0;c.mz=0;c.mvx=
0;c.mvy=0;c.mvz=0;c.dx=[0,0,0,0,0,0,0,0,0,0];c.dy=[0,0,0,0,0,0,0,0,0,0];c.dz=[0,0,0,0,0,0,0,0,0,0];c.dvx=[0,0,0,0,0,0,0,0,0,0];c.dvy=[0,0,0,0,0,0,0,0,0,0];c.dvz=[0,0,0,0,0,0,0,0,0,0];c.midx=0;c.midy=0;c.midz=0;c.lx=0;c.ly=0;c.lz=0},resetForces:function(c){c.fx=0;c.fy=0;c.fz=0},getBlock:!1,setToTimestep:function(c,e,d){},initRK:function(c,e){var d=evaluator._helper.extractPoint(c.el.homog);c.x=d.x;c.y=d.y;c.z=0;c.xo=c.x;c.yo=c.y;c.zo=c.z;c.vxo=c.vx;c.vyo=c.vy;c.vzo=c.vz;c.deltat=e;c.fx=0;c.fy=0;c.fz=
0},setVelocity:function(c,e,d,f){f||(f=0);c.vx=e;c.vy=d;c.vz=f},move:function(c){c.pos=[c.x,c.y,1];c.internalmove=!0;move&&mouse.down&&c.el==move.mover||(c.el.homog=List.realVector(c.pos));c.el.sx=c.x;c.el.sy=c.y;c.internalmove=!1},proceedMotion:function(c,e,d,f){if(!c.fixed)for(c.x=c.mx,c.y=c.my,c.z=c.mz,c.vx=c.mvx,c.vy=c.mvy,c.vz=c.mvz,e=0;e<d;e++)c.x+=f[e]*c.dx[e]*c.deltat,c.y+=f[e]*c.dy[e]*c.deltat,c.z+=f[e]*c.dz[e]*c.deltat,c.vx+=f[e]*c.dvx[e]*c.deltat,c.vy+=f[e]*c.dvy[e]*c.deltat,c.vz+=f[e]*
c.dvz[e]*c.deltat},calculateForces:function(c){var e=Math.sqrt(c.vx*c.vx+c.vy*c.vy+c.vz*c.vz);c.lnfrict=-Math.log((1-c.friction)*(1-c.env.friction)*(.1<e&&c.limitSpeed?.1/e:1));c.fx+=-c.vx*c.lnfrict*c.mass;c.fy+=-c.vy*c.lnfrict*c.mass;c.fz+=-c.vz*c.lnfrict*c.mass},calculateDelta:function(c,e){c.dx[e]=c.vx;c.dy[e]=c.vy;c.dz[e]=c.vz;c.dvx[e]=c.fx/c.mass;c.dvy[e]=c.fy/c.mass;c.dvz[e]=c.fz/c.mass},savePos:function(c,e){c.dx[e]=c.x;c.dy[e]=c.y;c.dz[e]=c.z;c.dvx[e]=c.vx;c.dvy[e]=c.vy;c.dvz[e]=c.vz},restorePos:function(c,
e){c.fixed||(c.x=c.dx[e],c.y=c.dy[e],c.z=c.dz[e],c.vx=c.dvx[e],c.vy=c.dvy[e],c.vz=c.dvz[e])},sqDist:function(c,e,d){var f=(c.dx[e]-c.dx[d])*(c.dx[e]-c.dx[d]),f=f+(c.dy[e]-c.dy[d])*(c.dy[e]-c.dy[d]),f=f+(c.dz[e]-c.dz[d])*(c.dz[e]-c.dz[d]),f=f+(c.dvx[e]-c.dvx[d])*(c.dvx[e]-c.dvx[d]),f=f+(c.dvy[e]-c.dvy[d])*(c.dvy[e]-c.dvy[d]);return f+=(c.dvz[e]-c.dvz[d])*(c.dvz[e]-c.dvz[d])},kineticEnergy:function(c){return.5*c.mass*(c.vx[i]*c.vx[i]+c.vy[i]*c.vy[i]+c.vz[i]*c.vz[i])},storePosition:function(c){c.mx=
c.x;c.my=c.y;c.mz=c.z;c.mvx=c.vx;c.mvy=c.vy;c.mvz=c.vz},recallPosition:function(c){c.fixed||(c.x=c.mx,c.y=c.my,c.z=c.mz,c.vx=c.mvx,c.vy=c.mvy,c.vz=c.mvz)},doCollisions:function(c){}},Sun:{init:function(c,e){c.vel=[0,0,0];c.pos=[0,0,0,0];c.el=e;"undefined"===typeof c.mass&&(c.mass=10);"undefined"===typeof c.friction&&(c.friction=0);c.charge=0;c.x=0;c.y=0;c.z=0},resetForces:function(c){},getBlock:!1,setToTimestep:function(c,e,d){},initRK:function(c,e){var d=evaluator._helper.extractPoint(c.el.homog);
c.x=d.x;c.y=d.y;c.z=0},setVelocity:function(c,e,d,f){},move:function(c){},proceedMotion:function(c,e,d,f){},calculateDelta:function(c,e){},calculateForces:function(c){for(var e=c.x,d=c.y,f=c.z,g=0;g<masses.length;g++){var h=masses[g],k=h.behavior.x,p=h.behavior.y,n=h.behavior.z,q=Math.sqrt((e-k)*(e-k)+(d-p)*(d-p)+(f-n)*(f-n)),p=(d-p)*c.mass*h.behavior.mass/(q*q*q),n=(f-n)*c.mass*h.behavior.mass/(q*q*q);h.behavior.fx+=(e-k)*c.mass*h.behavior.mass/(q*q*q)*h.behavior.mass;h.behavior.fy+=p*h.behavior.mass;
h.behavior.fz+=n*h.behavior.mass}},savePos:function(c,e){},restorePos:function(c,e){},sqDist:function(c,e,d){},kineticEnergy:function(c){},storePosition:function(c){},recallPosition:function(c){},doCollisions:function(c){}},Spring:{init:function(c,e){c.el=e;"undefined"===typeof c.strength&&(c.strength=1);"undefined"===typeof c.amplitude&&(c.amplitude=0);"undefined"===typeof c.phase&&(c.phase=0);"undefined"===typeof c.speed&&(c.speed=1);"undefined"===typeof c.l0&&(c.l0=0);"undefined"===typeof c.stype&&
(c.stype=1);"undefined"===typeof c.readOnInit&&(c.readOnInit=!1);c.namea=e.args[0];c.nameb=e.args[1];c.ma=csgeo.csnames[c.namea];c.mb=csgeo.csnames[c.nameb];var d=evaluator._helper.extractPoint(c.ma.homog),f=evaluator._helper.extractPoint(c.mb.homog);c.l0=Math.sqrt((d.x-f.x)*(d.x-f.x)+(d.y-f.y)*(d.y-f.y));c.env=labObjects.env},resetForces:function(c){},getBlock:!1,setToTimestep:function(c,e,d){},initRK:function(c,e){},setVelocity:function(c,e,d,f){},move:function(c){},proceedMotion:function(c,e,d,
f){},calculateForces:function(c){var e,d,f,g;!c.ma.behavior||move&&mouse.down&&c.ma==move.mover?(d=evaluator._helper.extractPoint(c.ma.homog),e=d.x,f=d.y):(e=c.ma.behavior.x,f=c.ma.behavior.y);!c.mb.behavior||move&&mouse.down&&c.mb==move.mover?(g=evaluator._helper.extractPoint(c.mb.homog),d=g.x,g=g.y):(d=c.mb.behavior.x,g=c.mb.behavior.y);var h=Math.sqrt((e-d)*(e-d)+(f-g)*(f-g)),k=c.l0,p=c.stype;1==p&&(k=0);var n=0;if(2==p||3==p)n=c.ma.behavior.mass*c.mb.behavior.mass*c.strength;2==p&&(n=-n);if(0==
h||0!=p&&1!=p)if(null!=a&&null!=b&&0!=h){if(h*=h*h,2==p||3==p)fx=(e-d)*n/h,fy=(f-g)*n/h}else fx=fy=0;else fx=-(e-d)*c.strength*(h-k)/h*c.env.springstrength,fy=-(f-g)*c.strength*(h-k)/h*c.env.springstrength;c.ma.behavior&&(c.ma.behavior.fx+=fx,c.ma.behavior.fy+=fy);c.mb.behavior&&(c.mb.behavior.fx-=fx,c.mb.behavior.fy-=fy)},calculateDelta:function(c,e){},savePos:function(c,e){},restorePos:function(c,e){},sqDist:function(c,e,d){},kineticEnergy:function(c){},storePosition:function(c){},recallPosition:function(c){},
doCollisions:function(c){}},det:function(c,e,d,f,g,h){return d*h-g*f+g*e-c*h+c*f-d*e},Bouncer:{init:function(c,e){c.el=e;"undefined"===typeof c.xdamp&&(c.xdamp=0);"undefined"===typeof c.ydamp&&(c.ydamp=0);"undefined"===typeof c.motorchanger&&(c.motorchanger=!0);c.namea=e.args[0];c.nameb=e.args[1];c.ma=csgeo.csnames[c.namea];c.mb=csgeo.csnames[c.nameb];var d=evaluator._helper.extractPoint(c.ma.homog),f=evaluator._helper.extractPoint(c.mb.homog);c.x1o=d.x;c.y1o=d.y;c.x2o=f.x;c.y2o=f.y;c.env=labObjects.env},
resetForces:function(c){},getBlock:!1,setToTimestep:function(c,e,d){},initRK:function(c,e){c.deltat=e},setVelocity:function(c,e,d,f){},move:function(c){},proceedMotion:function(c,e,d,f){},calculateForces:function(c){},calculateDelta:function(c,e){},savePos:function(c,e){},restorePos:function(c,e){},sqDist:function(c,e,d){},kineticEnergy:function(c){},storePosition:function(c){},recallPosition:function(c){},doCollisions:function(c){for(var e=evaluator._helper.extractPoint(c.ma.homog),d=evaluator._helper.extractPoint(c.mb.homog),
f=e.x,e=e.y,g=d.x,d=d.y,h=c.x1o,k=c.y1o,p=c.x2o,n=c.y2o,q=Math.sqrt((f-g)*(f-g)+(e-d)*(e-d)),r=(f-g)/q,q=(e-d)/q,s=0;s<masses.length;s++){var t=masses[s],v=t.behavior.xo,u=t.behavior.yo,x=t.behavior.x,y=t.behavior.y,l=CSNumber.mult(CSNumber.complex(h,k),CSNumber.complex(g,d)),A=CSNumber.mult(CSNumber.complex(p,n),CSNumber.complex(f,e)),l=CSNumber.sub(l,A),A=CSNumber.mult(CSNumber.complex(v,u),CSNumber.complex(f,e)),l=CSNumber.add(l,A),A=CSNumber.mult(CSNumber.complex(v,u),CSNumber.complex(g,d)),l=
CSNumber.sub(l,A),A=CSNumber.sub(CSNumber.complex(h,k),CSNumber.complex(p,n)),l=CSNumber.div(l,A);0>labObjects.det(f,e,g,d,x,y)*labObjects.det(f,e,g,d,l.value.real,l.value.imag)&&0>labObjects.det(f,e,x,y,l.value.real,l.value.imag)*labObjects.det(g,d,x,y,l.value.real,l.value.imag)&&(u=t.behavior.mvx+c.deltat*(-l.value.real+t.behavior.xo),x=t.behavior.mvy+c.deltat*(-l.value.imag+t.behavior.yo),v=r*u+q*x,u=q*u-r*x,t.behavior.x=l.value.real,t.behavior.y=l.value.imag,t.behavior.vx=r*v*(1-c.xdamp),t.behavior.vy=
q*v*(1-c.xdamp),t.behavior.vx+=-q*u*(1-c.ydamp),t.behavior.vy+=r*u*(1-c.ydamp))}c.x1o=f;c.y1o=e;c.x2o=g;c.y2o=d}},Environment:{init:function(c){"undefined"===typeof c.gravity&&(c.gravity=0);"undefined"===typeof c.friction&&(c.friction=0);"undefined"===typeof c.springstrength&&(c.springstrength=1);"undefined"===typeof c.accuracy&&(c.accuracy=10);"undefined"===typeof c.deltat&&(c.deltat=.3);"undefined"===typeof c.charges&&(c.charges=!1);"undefined"===typeof c.balls&&(c.balls=!1);"undefined"===typeof c.newton&&
(c.newton=!1);"undefined"===typeof c.ballInteractionBoosting&&(c.ballInteractionBoosting=0);labObjects.env=c},resetForces:function(c){},getBlock:!1,setToTimestep:function(c,e,d){},initRK:function(c,e){},setVelocity:function(c,e,d,f){},move:function(c){},proceedMotion:function(c,e,d,f){},calculateForces:function(c){if(c.newton)for(var e=0;e<masses.length-1;e++)for(var d=masses[e],f=d.behavior.x,g=d.behavior.y,h=e+1;h<masses.length;h++){var k=masses[h],p=k.behavior.x,n=k.behavior.y,q=Math.sqrt((f-p)*
(f-p)+(g-n)*(g-n)),p=(f-p)*d.behavior.mass*k.behavior.mass/(q*q*q),n=(g-n)*d.behavior.mass*k.behavior.mass/(q*q*q);d.behavior.fx-=p;d.behavior.fy-=n;k.behavior.fx+=p;k.behavior.fy+=n}if(c.charges)for(e=0;e<masses.length-1;e++)for(d=masses[e],f=d.behavior.x,g=d.behavior.y,h=e+1;h<masses.length;h++)k=masses[h],p=k.behavior.x,n=k.behavior.y,q=Math.sqrt((f-p)*(f-p)+(g-n)*(g-n)),p=(f-p)*d.behavior.charge*k.behavior.charge/(q*q*q),n=(g-n)*d.behavior.charge*k.behavior.charge/(q*q*q),d.behavior.fx+=p,d.behavior.fy+=
n,k.behavior.fx-=p,k.behavior.fy-=n;if(c.balls)for(e=0;e<masses.length-1;e++)if(d=masses[e],0!=d.behavior.radius)for(f=d.behavior.x,g=d.behavior.y,h=e+1;h<masses.length;h++)if(k=masses[h],0!=k.behavior.radius){var p=k.behavior.x,n=k.behavior.y,r=d.behavior.radius+k.behavior.radius,q=Math.sqrt((f-p)*(f-p)+(g-n)*(g-n));0==c.ballInteractionBoosting?(p=(f-p)/(q*q*q)*(q>r?0:(q-r)*(q-r)),n=(g-n)/(q*q*q)*(q>r?0:(q-r)*(q-r))):1==ballInteractionBoosting?(p=(f-p)/(q*q*q*q)*(q>r?0:(q-r)*(q-r)),n=(g-n)/(q*q*
q*q)*(q>r?0:(q-r)*(q-r))):(p=(f-p)/(q*q*q*q*q)*(q>r?0:(q-r)*(q-r)),n=(g-n)/(q*q*q*q*q)*(q>r?0:(q-r)*(q-r)));d.behavior.fx+=p;d.behavior.fy+=n;k.behavior.fx-=p;k.behavior.fy-=n}for(e=0;e<masses.length;e++)d=masses[e],d.behavior.fx+=0,d.behavior.fy+=c.gravity,d.behavior.fz+=0},calculateDelta:function(c,e){},savePos:function(c,e){},restorePos:function(c,e){},sqDist:function(c,e,d){},kineticEnergy:function(c){},storePosition:function(c){},recallPosition:function(c){},doCollisions:function(c){}}};var numeric="undefined"===typeof exports?function(){}:exports;"undefined"!==typeof global&&(global.numeric=numeric);numeric.version="1.2.6";numeric.bench=function(c,e){var d,f,g;"undefined"===typeof e&&(e=15);g=.5;for(d=new Date;;){for(f=g*=2;3<f;f-=4)c(),c(),c(),c();for(;0<f;)c(),f--;f=new Date;if(f-d>e)break}for(f=g;3<f;f-=4)c(),c(),c(),c();for(;0<f;)c(),f--;f=new Date;return 1E3*(3*g-1)/(f-d)};numeric._myIndexOf=function(c){var e=this.length,d;for(d=0;d<e;++d)if(this[d]===c)return d;return-1};
numeric.myIndexOf=Array.prototype.indexOf?Array.prototype.indexOf:numeric._myIndexOf;numeric.Function=Function;numeric.precision=4;numeric.largeArray=50;
numeric.prettyPrint=function(c){function e(c){if(0===c)return"0";if(isNaN(c))return"NaN";if(0>c)return"-"+e(-c);if(isFinite(c)){var d=Math.floor(Math.log(c)/Math.log(10));c/=Math.pow(10,d);c=c.toPrecision(numeric.precision);10===parseFloat(c)&&(d++,c=(1).toPrecision(numeric.precision));return parseFloat(c).toString()+"e"+d.toString()}return"Infinity"}function d(c){var h;if("undefined"===typeof c)return f.push(Array(numeric.precision+8).join(" ")),!1;if("string"===typeof c)return f.push('"'+c+'"'),
!1;if("boolean"===typeof c)return f.push(c.toString()),!1;if("number"===typeof c){var k=e(c);h=c.toPrecision(numeric.precision);c=parseFloat(c.toString()).toString();c=[k,h,c,parseFloat(h).toString(),parseFloat(c).toString()];for(h=1;h<c.length;h++)c[h].length<k.length&&(k=c[h]);f.push(Array(numeric.precision+8-k.length).join(" ")+k);return!1}if(null===c)return f.push("null"),!1;if("function"===typeof c){f.push(c.toString());k=!1;for(h in c)c.hasOwnProperty(h)&&(k?f.push(",\n"):f.push("\n{"),k=!0,
f.push(h),f.push(": \n"),d(c[h]));k&&f.push("}\n");return!0}if(c instanceof Array){if(c.length>numeric.largeArray)return f.push("...Large Array..."),!0;k=!1;f.push("[");for(h=0;h<c.length;h++)0<h&&(f.push(","),k&&f.push("\n ")),k=d(c[h]);f.push("]");return!0}f.push("{");k=!1;for(h in c)c.hasOwnProperty(h)&&(k&&f.push(",\n"),k=!0,f.push(h),f.push(": \n"),d(c[h]));f.push("}");return!0}var f=[];d(c);return f.join("")};
numeric.parseDate=function(c){function e(c){if("string"===typeof c)return Date.parse(c.replace(/-/g,"/"));if(!(c instanceof Array))throw Error("parseDate: parameter must be arrays of strings");var f=[],g;for(g=0;g<c.length;g++)f[g]=e(c[g]);return f}return e(c)};numeric.parseFloat=function(c){function e(c){if("string"===typeof c)return parseFloat(c);if(!(c instanceof Array))throw Error("parseFloat: parameter must be arrays of strings");var f=[],g;for(g=0;g<c.length;g++)f[g]=e(c[g]);return f}return e(c)};
numeric.parseCSV=function(c){c=c.split("\n");var e,d,f=[],g=/(([^'",]*)|('[^']*')|("[^"]*")),/g,h=/^\s*(([+-]?[0-9]+(\.[0-9]*)?(e[+-]?[0-9]+)?)|([+-]?[0-9]*(\.[0-9]+)?(e[+-]?[0-9]+)?))\s*$/,k=0;for(d=0;d<c.length;d++){var p=(c[d]+",").match(g),n;if(0<p.length){f[k]=[];for(e=0;e<p.length;e++)n=p[e],n=n.substr(0,n.length-1),h.test(n)?f[k][e]=parseFloat(n):f[k][e]=n;k++}}return f};
numeric.toCSV=function(c){var e,d,f,g,h;f=numeric.dim(c)[0];h=[];for(e=0;e<f;e++){g=[];for(d=0;d<f;d++)g[d]=c[e][d].toString();h[e]=g.join(", ")}return h.join("\n")+"\n"};numeric.getURL=function(c){var e=new XMLHttpRequest;e.open("GET",c,!1);e.send();return e};
numeric.imageURL=function(c){function e(c,d,e){"undefined"===typeof d&&(d=0);"undefined"===typeof e&&(e=c.length);for(var f=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,
1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,
4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,
62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,
3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,
2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918E3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117],g=-1,h=0;d<e;d++)h=(g^c[d])&255,g=g>>>8^f[h];return g^-1}var d=c[0].length,f=c[0][0].length,g,h,k,p,n,q,r=[137,80,78,71,13,10,26,10,0,0,0,13,73,72,68,82,f>>
24&255,f>>16&255,f>>8&255,f&255,d>>24&255,d>>16&255,d>>8&255,d&255,8,2,0,0,0,-1,-2,-3,-4,-5,-6,-7,-8,73,68,65,84,8,29];g=e(r,12,29);r[29]=g>>24&255;r[30]=g>>16&255;r[31]=g>>8&255;r[32]=g&255;g=1;for(n=h=0;n<d;n++){n<d-1?r.push(0):r.push(1);p=3*f+1+(0===n)&255;k=3*f+1+(0===n)>>8&255;r.push(p);r.push(k);r.push(~p&255);r.push(~k&255);0===n&&r.push(0);for(q=0;q<f;q++)for(k=0;3>k;k++)p=c[k][n][q],p=255<p?255:0>p?0:Math.round(p),g=(g+p)%65521,h=(h+g)%65521,r.push(p);r.push(0)}c=(h<<16)+g;r.push(c>>24&255);
r.push(c>>16&255);r.push(c>>8&255);r.push(c&255);c=r.length-41;r[33]=c>>24&255;r[34]=c>>16&255;r[35]=c>>8&255;r[36]=c&255;g=e(r,37);r.push(g>>24&255);r.push(g>>16&255);r.push(g>>8&255);r.push(g&255);r.push(0);r.push(0);r.push(0);r.push(0);r.push(73);r.push(69);r.push(78);r.push(68);r.push(174);r.push(66);r.push(96);r.push(130);return"data:image/png;base64,"+function(c){var d=c.length,e,f,g,h,k,n="";for(e=0;e<d;e+=3)f=c[e],g=c[e+1],h=c[e+2],k=f>>2,f=((f&3)<<4)+(g>>4),g=((g&15)<<2)+(h>>6),h&=63,e+1>=
d?g=h=64:e+2>=d&&(h=64),n+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(k)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(f)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(g)+"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(h);return n}(r)};numeric._dim=function(c){for(var e=[];"object"===typeof c;)e.push(c.length),c=c[0];return e};
numeric.dim=function(c){var e,d;return"object"===typeof c?(e=c[0],"object"===typeof e?(d=e[0],"object"===typeof d?numeric._dim(c):[c.length,e.length]):[c.length]):[]};
numeric.mapreduce=function(c,e){return Function("x","accum","_s","_k",'if(typeof accum === "undefined") accum = '+e+';\nif(typeof x === "number") { var xi = x; '+c+'; return accum; }\nif(typeof _s === "undefined") _s = numeric.dim(x);\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i,xi;\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) {\n        accum = arguments.callee(x[i],accum,_s,_k+1);\n    }    return accum;\n}\nfor(i=_n-1;i>=1;i-=2) { \n    xi = x[i];\n    '+c+";\n    xi = x[i-1];\n    "+
c+";\n}\nif(i === 0) {\n    xi = x[i];\n    "+c+"\n}\nreturn accum;")};numeric.mapreduce2=function(c,e){return Function("x","var n = x.length;\nvar i,xi;\n"+e+";\nfor(i=n-1;i!==-1;--i) { \n    xi = x[i];\n    "+c+";\n}\nreturn accum;")};numeric.same=function same(e,d){var f,g;if(!(e instanceof Array&&d instanceof Array))return!1;g=e.length;if(g!==d.length)return!1;for(f=0;f<g;f++)if(e[f]!==d[f])if("object"===typeof e[f]){if(!same(e[f],d[f]))return!1}else return!1;return!0};
numeric.rep=function(c,e,d){"undefined"===typeof d&&(d=0);var f=c[d],g=Array(f);if(d===c.length-1){for(f-=2;0<=f;f-=2)g[f+1]=e,g[f]=e;-1===f&&(g[0]=e);return g}for(f-=1;0<=f;f--)g[f]=numeric.rep(c,e,d+1);return g};numeric.dotMMsmall=function(c,e){var d,f,g,h,k,p,n,q,r,s;d=c.length;h=e.length;k=e[0].length;p=Array(d);for(d-=1;0<=d;d--){n=Array(k);q=c[d];for(g=k-1;0<=g;g--){r=q[h-1]*e[h-1][g];for(f=h-2;1<=f;f-=2)s=f-1,r+=q[f]*e[f][g]+q[s]*e[s][g];0===f&&(r+=q[0]*e[0][g]);n[g]=r}p[d]=n}return p};
numeric._getCol=function(c,e,d){var f;for(f=c.length-1;0<f;--f)d[f]=c[f][e],--f,d[f]=c[f][e];0===f&&(d[0]=c[0][e])};numeric.dotMMbig=function(c,e){var d=numeric._getCol,f=Array(e.length),g=c.length,h=e[0].length,k=Array(g),p=numeric.dotVV,n,q;--g;for(n=g;-1!==n;--n)k[n]=Array(h);--h;for(n=h;-1!==n;--n)for(d(e,n,f),q=g;-1!==q;--q)h=c[q],k[q][n]=p(h,f);return k};numeric.dotMV=function(c,e){for(var d=c.length,f=Array(d),g=numeric.dotVV,d=d-1;0<=d;d--)f[d]=g(c[d],e);return f};
numeric.dotVM=function(c,e){var d,f,g,h,k,p;g=c.length;d=e[0].length;h=Array(d);for(f=d-1;0<=f;f--){k=c[g-1]*e[g-1][f];for(d=g-2;1<=d;d-=2)p=d-1,k+=c[d]*e[d][f]+c[p]*e[p][f];0===d&&(k+=c[0]*e[0][f]);h[f]=k}return h};numeric.dotVV=function(c,e){var d;d=c.length;var f,g=c[d-1]*e[d-1];for(d-=2;1<=d;d-=2)f=d-1,g+=c[d]*e[d]+c[f]*e[f];0===d&&(g+=c[0]*e[0]);return g};
numeric.dot=function(c,e){var d=numeric.dim;switch(1E3*d(c).length+d(e).length){case 2002:return 10>e.length?numeric.dotMMsmall(c,e):numeric.dotMMbig(c,e);case 2001:return numeric.dotMV(c,e);case 1002:return numeric.dotVM(c,e);case 1001:return numeric.dotVV(c,e);case 1E3:return numeric.mulVS(c,e);case 1:return numeric.mulSV(c,e);case 0:return c*e;default:throw Error("numeric.dot only works on vectors and matrices");}};
numeric.diag=function(c){var e,d,f,g=c.length,h=Array(g),k;for(e=g-1;0<=e;e--){k=Array(g);d=e+2;for(f=g-1;f>=d;f-=2)k[f]=0,k[f-1]=0;f>e&&(k[f]=0);k[e]=c[e];for(f=e-1;1<=f;f-=2)k[f]=0,k[f-1]=0;0===f&&(k[0]=0);h[e]=k}return h};numeric.getDiag=function(c){for(var e=Math.min(c.length,c[0].length),d=Array(e),e=e-1;1<=e;--e)d[e]=c[e][e],--e,d[e]=c[e][e];0===e&&(d[0]=c[0][0]);return d};numeric.identity=function(c){return numeric.diag(numeric.rep([c],1))};
numeric.pointwise=function(c,e,d){"undefined"===typeof d&&(d="");var f=[],g,h=/\[i\]$/,k,p="",n=!1;for(g=0;g<c.length;g++)h.test(c[g])?p=k=c[g].substring(0,c[g].length-3):k=c[g],"ret"===k&&(n=!0),f.push(k);f[c.length]="_s";f[c.length+1]="_k";f[c.length+2]='if(typeof _s === "undefined") _s = numeric.dim('+p+');\nif(typeof _k === "undefined") _k = 0;\nvar _n = _s[_k];\nvar i'+(n?"":", ret = Array(_n)")+";\nif(_k < _s.length-1) {\n    for(i=_n-1;i>=0;i--) ret[i] = arguments.callee("+c.join(",")+",_s,_k+1);\n    return ret;\n}\n"+
d+"\nfor(i=_n-1;i!==-1;--i) {\n    "+e+"\n}\nreturn ret;";return Function.apply(null,f)};numeric.pointwise2=function(c,e,d){"undefined"===typeof d&&(d="");var f=[],g,h=/\[i\]$/,k,p="",n=!1;for(g=0;g<c.length;g++)h.test(c[g])?p=k=c[g].substring(0,c[g].length-3):k=c[g],"ret"===k&&(n=!0),f.push(k);f[c.length]="var _n = "+p+".length;\nvar i"+(n?"":", ret = Array(_n)")+";\n"+d+"\nfor(i=_n-1;i!==-1;--i) {\n"+e+"\n}\nreturn ret;";return Function.apply(null,f)};
numeric._biforeach=function _biforeach(e,d,f,g,h){if(g===f.length-1)h(e,d);else{var k;for(k=f[g]-1;0<=k;k--)_biforeach("object"===typeof e?e[k]:e,"object"===typeof d?d[k]:d,f,g+1,h)}};numeric._biforeach2=function _biforeach2(e,d,f,g,h){if(g===f.length-1)return h(e,d);var k;k=f[g];var p=Array(k);for(k-=1;0<=k;--k)p[k]=_biforeach2("object"===typeof e?e[k]:e,"object"===typeof d?d[k]:d,f,g+1,h);return p};
numeric._foreach=function _foreach(e,d,f,g){if(f===d.length-1)g(e);else{var h;for(h=d[f]-1;0<=h;h--)_foreach(e[h],d,f+1,g)}};numeric._foreach2=function _foreach2(e,d,f,g){if(f===d.length-1)return g(e);var h;h=d[f];var k=Array(h);for(h-=1;0<=h;h--)k[h]=_foreach2(e[h],d,f+1,g);return k};numeric.ops2={add:"+",sub:"-",mul:"*",div:"/",mod:"%",and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">=",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};
numeric.opseq={addeq:"+=",subeq:"-=",muleq:"*=",diveq:"/=",modeq:"%=",lshifteq:"<<=",rshifteq:">>=",rrshifteq:">>>=",bandeq:"&=",boreq:"|=",bxoreq:"^="};numeric.mathfuns="abs acos asin atan ceil cos exp floor log round sin sqrt tan isNaN isFinite".split(" ");numeric.mathfuns2=["atan2","pow","max","min"];numeric.ops1={neg:"-",not:"!",bnot:"~",clone:""};
numeric.mapreducers={any:["if(xi) return true;","var accum = false;"],all:["if(!xi) return false;","var accum = true;"],sum:["accum += xi;","var accum = 0;"],prod:["accum *= xi;","var accum = 1;"],norm2Squared:["accum += xi*xi;","var accum = 0;"],norminf:["accum = max(accum,abs(xi));","var accum = 0, max = Math.max, abs = Math.abs;"],norm1:["accum += abs(xi)","var accum = 0, abs = Math.abs;"],sup:["accum = max(accum,xi);","var accum = -Infinity, max = Math.max;"],inf:["accum = min(accum,xi);","var accum = Infinity, min = Math.min;"]};
(function(){var c,e;for(c=0;c<numeric.mathfuns2.length;++c)e=numeric.mathfuns2[c],numeric.ops2[e]=e;for(c in numeric.ops2)if(numeric.ops2.hasOwnProperty(c)){e=numeric.ops2[c];var d,f,g="";-1!==numeric.myIndexOf.call(numeric.mathfuns2,c)?(g="var "+e+" = Math."+e+";\n",d=function(c,d,f){return c+" = "+e+"("+d+","+f+")"},f=function(c,d){return c+" = "+e+"("+c+","+d+")"}):(d=function(c,d,f){return c+" = "+d+" "+e+" "+f},f=numeric.opseq.hasOwnProperty(c+"eq")?function(c,d){return c+" "+e+"= "+d}:function(c,
d){return c+" = "+c+" "+e+" "+d});numeric[c+"VV"]=numeric.pointwise2(["x[i]","y[i]"],d("ret[i]","x[i]","y[i]"),g);numeric[c+"SV"]=numeric.pointwise2(["x","y[i]"],d("ret[i]","x","y[i]"),g);numeric[c+"VS"]=numeric.pointwise2(["x[i]","y"],d("ret[i]","x[i]","y"),g);numeric[c]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar VV = numeric."+c+"VV, VS = numeric."+c+"VS, SV = numeric."+c+'SV;\nvar dim = numeric.dim;\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof x === "object") {\n      if(typeof y === "object") x = numeric._biforeach2(x,y,dim(x),0,VV);\n      else x = numeric._biforeach2(x,y,dim(x),0,VS);\n  } else if(typeof y === "object") x = numeric._biforeach2(x,y,dim(y),0,SV);\n  else '+
f("x","y")+"\n}\nreturn x;\n");numeric[e]=numeric[c];numeric[c+"eqV"]=numeric.pointwise2(["ret[i]","x[i]"],f("ret[i]","x[i]"),g);numeric[c+"eqS"]=numeric.pointwise2(["ret[i]","x"],f("ret[i]","x"),g);numeric[c+"eq"]=Function("var n = arguments.length, i, x = arguments[0], y;\nvar V = numeric."+c+"eqV, S = numeric."+c+'eqS\nvar s = numeric.dim(x);\nfor(i=1;i!==n;++i) { \n  y = arguments[i];\n  if(typeof y === "object") numeric._biforeach(x,y,s,0,V);\n  else numeric._biforeach(x,y,s,0,S);\n}\nreturn x;\n')}for(c=
0;c<numeric.mathfuns2.length;++c)e=numeric.mathfuns2[c],delete numeric.ops2[e];for(c=0;c<numeric.mathfuns.length;++c)e=numeric.mathfuns[c],numeric.ops1[e]=e;for(c in numeric.ops1)numeric.ops1.hasOwnProperty(c)&&(g="",e=numeric.ops1[c],-1!==numeric.myIndexOf.call(numeric.mathfuns,c)&&Math.hasOwnProperty(e)&&(g="var "+e+" = Math."+e+";\n"),numeric[c+"eqV"]=numeric.pointwise2(["ret[i]"],"ret[i] = "+e+"(ret[i]);",g),numeric[c+"eq"]=Function("x",'if(typeof x !== "object") return '+e+"x\nvar i;\nvar V = numeric."+
c+"eqV;\nvar s = numeric.dim(x);\nnumeric._foreach(x,s,0,V);\nreturn x;\n"),numeric[c+"V"]=numeric.pointwise2(["x[i]"],"ret[i] = "+e+"(x[i]);",g),numeric[c]=Function("x",'if(typeof x !== "object") return '+e+"(x)\nvar i;\nvar V = numeric."+c+"V;\nvar s = numeric.dim(x);\nreturn numeric._foreach2(x,s,0,V);\n"));for(c=0;c<numeric.mathfuns.length;++c)e=numeric.mathfuns[c],delete numeric.ops1[e];for(c in numeric.mapreducers)numeric.mapreducers.hasOwnProperty(c)&&(e=numeric.mapreducers[c],numeric[c+"V"]=
numeric.mapreduce2(e[0],e[1]),numeric[c]=Function("x","s","k",e[1]+'if(typeof x !== "object") {    xi = x;\n'+e[0]+';\n    return accum;\n}if(typeof s === "undefined") s = numeric.dim(x);\nif(typeof k === "undefined") k = 0;\nif(k === s.length-1) return numeric.'+c+"V(x);\nvar xi;\nvar n = x.length, i;\nfor(i=n-1;i!==-1;--i) {\n   xi = arguments.callee(x[i]);\n"+e[0]+";\n}\nreturn accum;\n"))})();numeric.truncVV=numeric.pointwise(["x[i]","y[i]"],"ret[i] = round(x[i]/y[i])*y[i];","var round = Math.round;");
numeric.truncVS=numeric.pointwise(["x[i]","y"],"ret[i] = round(x[i]/y)*y;","var round = Math.round;");numeric.truncSV=numeric.pointwise(["x","y[i]"],"ret[i] = round(x/y[i])*y[i];","var round = Math.round;");numeric.trunc=function(c,e){return"object"===typeof c?"object"===typeof e?numeric.truncVV(c,e):numeric.truncVS(c,e):"object"===typeof e?numeric.truncSV(c,e):Math.round(c/e)*e};
numeric.inv=function(c){var e=numeric.dim(c),d=Math.abs,f=e[0],e=e[1],g=numeric.clone(c),h,k,p=numeric.identity(f),n,q,r,s,t;for(s=0;s<e;++s){k=c=-1;for(r=s;r!==f;++r)t=d(g[r][s]),t>k&&(c=r,k=t);k=g[c];g[c]=g[s];g[s]=k;q=p[c];p[c]=p[s];p[s]=q;c=k[s];for(t=s;t!==e;++t)k[t]/=c;for(t=e-1;-1!==t;--t)q[t]/=c;for(r=f-1;-1!==r;--r)if(r!==s){h=g[r];n=p[r];c=h[s];for(t=s+1;t!==e;++t)h[t]-=k[t]*c;for(t=e-1;0<t;--t)n[t]-=q[t]*c,--t,n[t]-=q[t]*c;0===t&&(n[0]-=q[0]*c)}}return p};
numeric.det=function(c){var e=numeric.dim(c);if(2!==e.length||e[0]!==e[1])throw Error("numeric: det() only works on square matrices");var e=e[0],d=1,f,g,h=numeric.clone(c),k,p,n,q;for(c=0;c<e-1;c++){g=c;for(f=c+1;f<e;f++)Math.abs(h[f][c])>Math.abs(h[g][c])&&(g=f);g!==c&&(f=h[g],h[g]=h[c],h[c]=f,d*=-1);k=h[c];for(f=c+1;f<e;f++){p=h[f];n=p[c]/k[c];for(g=c+1;g<e-1;g+=2)q=g+1,p[g]-=k[g]*n,p[q]-=k[q]*n;g!==e&&(p[g]-=k[g]*n)}if(0===k[c])return 0;d*=k[c]}return d*h[c][c]};
numeric.transpose=function(c){var e,d;e=c.length;var f=c[0].length,g=Array(f),h,k,p;for(d=0;d<f;d++)g[d]=Array(e);for(e-=1;1<=e;e-=2){k=c[e];h=c[e-1];for(d=f-1;1<=d;--d)p=g[d],p[e]=k[d],p[e-1]=h[d],--d,p=g[d],p[e]=k[d],p[e-1]=h[d];0===d&&(p=g[0],p[e]=k[0],p[e-1]=h[0])}if(0===e){h=c[0];for(d=f-1;1<=d;--d)g[d][0]=h[d],--d,g[d][0]=h[d];0===d&&(g[0][0]=h[0])}return g};
numeric.negtranspose=function(c){var e,d;e=c.length;var f=c[0].length,g=Array(f),h,k,p;for(d=0;d<f;d++)g[d]=Array(e);for(e-=1;1<=e;e-=2){k=c[e];h=c[e-1];for(d=f-1;1<=d;--d)p=g[d],p[e]=-k[d],p[e-1]=-h[d],--d,p=g[d],p[e]=-k[d],p[e-1]=-h[d];0===d&&(p=g[0],p[e]=-k[0],p[e-1]=-h[0])}if(0===e){h=c[0];for(d=f-1;1<=d;--d)g[d][0]=-h[d],--d,g[d][0]=-h[d];0===d&&(g[0][0]=-h[0])}return g};
numeric._random=function _random(e,d){var f;f=e[d];var g=Array(f),h;if(d===e.length-1){h=Math.random;for(f-=1;1<=f;f-=2)g[f]=h(),g[f-1]=h();0===f&&(g[0]=h());return g}for(f-=1;0<=f;f--)g[f]=_random(e,d+1);return g};numeric.random=function(c){return numeric._random(c,0)};numeric.norm2=function(c){return Math.sqrt(numeric.norm2Squared(c))};
numeric.linspace=function(c,e,d){"undefined"===typeof d&&(d=Math.max(Math.round(e-c)+1,1));if(2>d)return 1===d?[c]:[];var f,g=Array(d);d--;for(f=d;0<=f;f--)g[f]=(f*e+(d-f)*c)/d;return g};numeric.getBlock=function(c,e,d){function f(c,k){var p,n=e[k];p=d[k]-n;var q=Array(p);if(k===g.length-1){for(;0<=p;p--)q[p]=c[p+n];return q}for(;0<=p;p--)q[p]=f(c[p+n],k+1);return q}var g=numeric.dim(c);return f(c,0)};
numeric.setBlock=function(c,e,d,f){function g(c,f,n){var q,r=e[n],s=d[n]-r;if(n===h.length-1)for(q=s;0<=q;q--)c[q+r]=f[q];for(q=s;0<=q;q--)g(c[q+r],f[q],n+1)}var h=numeric.dim(c);g(c,f,0);return c};numeric.getRange=function(c,e,d){for(var f=e.length,g=d.length,h,k=Array(f),p,n,f=f-1;-1!==f;--f)for(k[f]=Array(g),p=k[f],n=c[e[f]],h=g-1;-1!==h;--h)p[h]=n[d[h]];return k};
numeric.blockMatrix=function(c){var e=numeric.dim(c);if(4>e.length)return numeric.blockMatrix([c]);var d=e[0],e=e[1],f,g,h,k;for(h=g=f=0;h<d;++h)f+=c[h][0].length;for(k=0;k<e;++k)g+=c[0][k][0].length;var p=Array(f);for(h=0;h<f;++h)p[h]=Array(g);var n=0,q,r,s,t,v;for(h=0;h<d;++h){q=g;for(k=e-1;-1!==k;--k)for(f=c[h][k],q-=f[0].length,s=f.length-1;-1!==s;--s)for(v=f[s],r=p[n+s],t=v.length-1;-1!==t;--t)r[q+t]=v[t];n+=c[h][0].length}return p};
numeric.tensor=function(c,e){if("number"===typeof c||"number"===typeof e)return numeric.mul(c,e);var d=numeric.dim(c),f=numeric.dim(e);if(1!==d.length||1!==f.length)throw Error("numeric: tensor product is only defined for vectors");var g=d[0],f=f[0],d=Array(g),h,k,p;for(h=g-1;0<=h;h--){g=Array(f);p=c[h];for(k=f-1;3<=k;--k)g[k]=p*e[k],--k,g[k]=p*e[k],--k,g[k]=p*e[k],--k,g[k]=p*e[k];for(;0<=k;)g[k]=p*e[k],--k;d[h]=g}return d};numeric.T=function(c,e){this.x=c;this.y=e};
numeric.t=function(c,e){return new numeric.T(c,e)};
numeric.Tbinop=function(c,e,d,f,g){if("string"!==typeof g){var h;g="";for(h in numeric)numeric.hasOwnProperty(h)&&(0<=c.indexOf(h)||0<=e.indexOf(h)||0<=d.indexOf(h)||0<=f.indexOf(h))&&1<h.length&&(g+="var "+h+" = numeric."+h+";\n")}return Function(["y"],"var x = this;\nif(!(y instanceof numeric.T)) { y = new numeric.T(y); }\n"+g+"\nif(x.y) {  if(y.y) {    return new numeric.T("+f+");\n  }\n  return new numeric.T("+d+");\n}\nif(y.y) {\n  return new numeric.T("+e+");\n}\nreturn new numeric.T("+c+");\n")};
numeric.T.prototype.add=numeric.Tbinop("add(x.x,y.x)","add(x.x,y.x),y.y","add(x.x,y.x),x.y","add(x.x,y.x),add(x.y,y.y)");numeric.T.prototype.sub=numeric.Tbinop("sub(x.x,y.x)","sub(x.x,y.x),neg(y.y)","sub(x.x,y.x),x.y","sub(x.x,y.x),sub(x.y,y.y)");numeric.T.prototype.mul=numeric.Tbinop("mul(x.x,y.x)","mul(x.x,y.x),mul(x.x,y.y)","mul(x.x,y.x),mul(x.y,y.x)","sub(mul(x.x,y.x),mul(x.y,y.y)),add(mul(x.x,y.y),mul(x.y,y.x))");
numeric.T.prototype.reciprocal=function(){var c=numeric.mul,e=numeric.div;return this.y?(c=numeric.add(c(this.x,this.x),c(this.y,this.y)),new numeric.T(e(this.x,c),e(numeric.neg(this.y),c))):new T(e(1,this.x))};numeric.T.prototype.div=function(c){c instanceof numeric.T||(c=new numeric.T(c));if(c.y)return this.mul(c.reciprocal());var e=numeric.div;return this.y?new numeric.T(e(this.x,c.x),e(this.y,c.x)):new numeric.T(e(this.x,c.x))};
numeric.T.prototype.dot=numeric.Tbinop("dot(x.x,y.x)","dot(x.x,y.x),dot(x.x,y.y)","dot(x.x,y.x),dot(x.y,y.x)","sub(dot(x.x,y.x),dot(x.y,y.y)),add(dot(x.x,y.y),dot(x.y,y.x))");numeric.T.prototype.transpose=function(){var c=numeric.transpose,e=this.x,d=this.y;return d?new numeric.T(c(e),c(d)):new numeric.T(c(e))};numeric.T.prototype.transjugate=function(){var c=numeric.transpose,e=this.x,d=this.y;return d?new numeric.T(c(e),numeric.negtranspose(d)):new numeric.T(c(e))};
numeric.Tunop=function(c,e,d){"string"!==typeof d&&(d="");return Function("var x = this;\n"+d+"\nif(x.y) {  "+e+";\n}\n"+c+";\n")};numeric.T.prototype.exp=numeric.Tunop("return new numeric.T(ex)","return new numeric.T(mul(cos(x.y),ex),mul(sin(x.y),ex))","var ex = numeric.exp(x.x), cos = numeric.cos, sin = numeric.sin, mul = numeric.mul;");numeric.T.prototype.conj=numeric.Tunop("return new numeric.T(x.x);","return new numeric.T(x.x,numeric.neg(x.y));");
numeric.T.prototype.neg=numeric.Tunop("return new numeric.T(neg(x.x));","return new numeric.T(neg(x.x),neg(x.y));","var neg = numeric.neg;");numeric.T.prototype.sin=numeric.Tunop("return new numeric.T(numeric.sin(x.x))","return x.exp().sub(x.neg().exp()).div(new numeric.T(0,2));");numeric.T.prototype.cos=numeric.Tunop("return new numeric.T(numeric.cos(x.x))","return x.exp().add(x.neg().exp()).div(2);");
numeric.T.prototype.abs=numeric.Tunop("return new numeric.T(numeric.abs(x.x));","return new numeric.T(numeric.sqrt(numeric.add(mul(x.x,x.x),mul(x.y,x.y))));","var mul = numeric.mul;");numeric.T.prototype.log=numeric.Tunop("return new numeric.T(numeric.log(x.x));","var theta = new numeric.T(numeric.atan2(x.y,x.x)), r = x.abs();\nreturn new numeric.T(numeric.log(r.x),theta.x);");numeric.T.prototype.norm2=numeric.Tunop("return numeric.norm2(x.x);","var f = numeric.norm2Squared;\nreturn Math.sqrt(f(x.x)+f(x.y));");
numeric.T.prototype.inv=function(){if("undefined"===typeof this.y)return new numeric.T(numeric.inv(this.x));var c=this.x.length,e,d,f,g=numeric.identity(c),h=numeric.rep([c,c],0),k=numeric.clone(this.x),p=numeric.clone(this.y),n,q,r,s,t,v,u,x,y,l,A,z;for(e=0;e<c;e++){y=k[e][e];l=p[e][e];r=y*y+l*l;f=e;for(d=e+1;d<c;d++)y=k[d][e],l=p[d][e],n=y*y+l*l,n>r&&(f=d,r=n);f!==e&&(d=k[e],k[e]=k[f],k[f]=d,d=p[e],p[e]=p[f],p[f]=d,d=g[e],g[e]=g[f],g[f]=d,d=h[e],h[e]=h[f],h[f]=d);n=k[e];q=p[e];t=g[e];v=h[e];y=n[e];
l=q[e];for(d=e+1;d<c;d++)A=n[d],z=q[d],n[d]=(A*y+z*l)/r,q[d]=(z*y-A*l)/r;for(d=0;d<c;d++)A=t[d],z=v[d],t[d]=(A*y+z*l)/r,v[d]=(z*y-A*l)/r;for(d=e+1;d<c;d++){r=k[d];s=p[d];u=g[d];x=h[d];y=r[e];l=s[e];for(f=e+1;f<c;f++)A=n[f],z=q[f],r[f]-=A*y-z*l,s[f]-=z*y+A*l;for(f=0;f<c;f++)A=t[f],z=v[f],u[f]-=A*y-z*l,x[f]-=z*y+A*l}}for(e=c-1;0<e;e--)for(t=g[e],v=h[e],d=e-1;0<=d;d--)for(u=g[d],x=h[d],y=k[d][e],l=p[d][e],f=c-1;0<=f;f--)A=t[f],z=v[f],u[f]-=y*A-l*z,x[f]-=y*z+l*A;return new numeric.T(g,h)};
numeric.T.prototype.get=function(c){var e=this.x,d=this.y,f=0,g,h=c.length;if(d){for(;f<h;)g=c[f],e=e[g],d=d[g],f++;return new numeric.T(e,d)}for(;f<h;)g=c[f],e=e[g],f++;return new numeric.T(e)};
numeric.T.prototype.set=function(c,e){var d=this.x,f=this.y,g=0,h,k=c.length,p=e.x,n=e.y;if(0===k)return n?this.y=n:f&&(this.y=void 0),this.x=d,this;if(n){f||(this.y=f=numeric.rep(numeric.dim(d),0));for(;g<k-1;)h=c[g],d=d[h],f=f[h],g++;h=c[g];d[h]=p;f[h]=n;return this}if(f){for(;g<k-1;)h=c[g],d=d[h],f=f[h],g++;h=c[g];d[h]=p;f[h]=p instanceof Array?numeric.rep(numeric.dim(p),0):0;return this}for(;g<k-1;)h=c[g],d=d[h],g++;h=c[g];d[h]=p;return this};
numeric.T.prototype.getRows=function(c,e){var d=e-c+1,f,g=Array(d),h=this.x,k=this.y;for(f=c;f<=e;f++)g[f-c]=h[f];if(k){d=Array(d);for(f=c;f<=e;f++)d[f-c]=k[f];return new numeric.T(g,d)}return new numeric.T(g)};numeric.T.prototype.setRows=function(c,e,d){var f=this.x,g=this.y,h=d.x,k=d.y;for(d=c;d<=e;d++)f[d]=h[d-c];if(k)for(g||(this.y=g=numeric.rep(numeric.dim(f),0)),d=c;d<=e;d++)g[d]=k[d-c];else if(g)for(d=c;d<=e;d++)g[d]=numeric.rep([h[d-c].length],0);return this};
numeric.T.prototype.getRow=function(c){var e=this.x,d=this.y;return d?new numeric.T(e[c],d[c]):new numeric.T(e[c])};numeric.T.prototype.setRow=function(c,e){var d=this.x,f=this.y,g=e.x,h=e.y;d[c]=g;h?(f||(this.y=f=numeric.rep(numeric.dim(d),0)),f[c]=h):f&&numeric.rep([g.length],0);return this};numeric.T.prototype.getBlock=function(c,e){var d=this.x,f=this.y,g=numeric.getBlock;return f?new numeric.T(g(d,c,e),g(f,c,e)):new numeric.T(g(d,c,e))};
numeric.T.prototype.setBlock=function(c,e,d){d instanceof numeric.T||(d=new numeric.T(d));var f=this.x,g=this.y,h=numeric.setBlock,k=d.x;if(d=d.y)return g||(g=this.y=numeric.rep(numeric.dim(this),0)),h(f,c,e,k),h(g,c,e,d),this;h(f,c,e,k);g&&h(g,c,e,numeric.rep(numeric.dim(k),0))};numeric.T.rep=function(c,e){var d=numeric.T;e instanceof d||(e=new d(e));var f=e.x,g=e.y,h=numeric.rep;return g?new d(h(c,f),h(c,g)):new d(h(c,f))};
numeric.T.diag=function(c){c instanceof numeric.T||(c=new numeric.T(c));var e=c.x;c=c.y;var d=numeric.diag;return c?new numeric.T(d(e),d(c)):new numeric.T(d(e))};numeric.T.eig=function(){if(this.y)throw Error("eig: not implemented for complex matrices.");return numeric.eig(this.x)};numeric.T.identity=function(c){return new numeric.T(numeric.identity(c))};numeric.T.prototype.getDiag=function(){var c=numeric,e=this.x,d=this.y;return d?new c.T(c.getDiag(e),c.getDiag(d)):new c.T(c.getDiag(e))};
numeric.house=function(c){var e=numeric.clone(c);c=(0<=c[0]?1:-1)*numeric.norm2(c);e[0]+=c;c=numeric.norm2(e);if(0===c)throw Error("eig: internal error");return numeric.div(e,c)};
numeric.toUpperHessenberg=function(c){var e=numeric.dim(c);if(2!==e.length||e[0]!==e[1])throw Error("numeric: toUpperHessenberg() only works on square matrices");var e=e[0],d,f,g,h=numeric.clone(c),k,p,n,q=numeric.identity(e);for(d=0;d<e-2;d++){f=Array(e-d-1);for(c=d+1;c<e;c++)f[c-d-1]=h[c][d];if(0<numeric.norm2(f)){g=numeric.house(f);f=numeric.getBlock(h,[d+1,d],[e-1,e-1]);k=numeric.tensor(g,numeric.dot(g,f));for(c=d+1;c<e;c++)for(p=h[c],n=k[c-d-1],f=d;f<e;f++)p[f]-=2*n[f-d];f=numeric.getBlock(h,
[0,d+1],[e-1,e-1]);k=numeric.tensor(numeric.dot(f,g),g);for(c=0;c<e;c++)for(p=h[c],n=k[c],f=d+1;f<e;f++)p[f]-=2*n[f-d-1];f=Array(e-d-1);for(c=d+1;c<e;c++)f[c-d-1]=q[c];k=numeric.tensor(g,numeric.dot(g,f));for(c=d+1;c<e;c++)for(g=q[c],n=k[c-d-1],f=0;f<e;f++)g[f]-=2*n[f]}}return{H:h,Q:q}};numeric.epsilon=2.220446049250313E-16;
numeric.QRFrancis=function(c,e){"undefined"===typeof e&&(e=1E4);c=numeric.clone(c);numeric.clone(c);var d=numeric.dim(c)[0],f,g,h,k,p,n,q=numeric.identity(d),r,s,t;if(3>d)return{Q:q,B:[[0,d-1]]};var v=numeric.epsilon;for(t=0;t<e;t++){for(h=0;h<d-1;h++)if(Math.abs(c[h+1][h])<v*(Math.abs(c[h][h])+Math.abs(c[h+1][h+1]))){t=numeric.QRFrancis(numeric.getBlock(c,[0,0],[h,h]),e);v=numeric.QRFrancis(numeric.getBlock(c,[h+1,h+1],[d-1,d-1]),e);k=Array(h+1);for(n=0;n<=h;n++)k[n]=q[n];k=numeric.dot(t.Q,k);for(n=
0;n<=h;n++)q[n]=k[n];k=Array(d-h-1);for(n=h+1;n<d;n++)k[n-h-1]=q[n];k=numeric.dot(v.Q,k);for(n=h+1;n<d;n++)q[n]=k[n-h-1];return{Q:q,B:t.B.concat(numeric.add(v.B,h+1))}}h=c[d-2][d-2];f=c[d-2][d-1];k=c[d-1][d-2];p=c[d-1][d-1];n=h+p;k=h*p-f*k;h=numeric.getBlock(c,[0,0],[2,2]);n*n>=4*k?(f=.5*(n+Math.sqrt(n*n-4*k)),n=.5*(n-Math.sqrt(n*n-4*k)),h=numeric.add(numeric.sub(numeric.dot(h,h),numeric.mul(h,f+n)),numeric.diag(numeric.rep([3],f*n)))):h=numeric.add(numeric.sub(numeric.dot(h,h),numeric.mul(h,n)),
numeric.diag(numeric.rep([3],k)));f=[h[0][0],h[1][0],h[2][0]];g=numeric.house(f);k=[c[0],c[1],c[2]];k=numeric.tensor(g,numeric.dot(g,k));for(n=0;3>n;n++)for(r=c[n],s=k[n],f=0;f<d;f++)r[f]-=2*s[f];k=numeric.getBlock(c,[0,0],[d-1,2]);k=numeric.tensor(numeric.dot(k,g),g);for(n=0;n<d;n++)for(r=c[n],s=k[n],f=0;3>f;f++)r[f]-=2*s[f];k=[q[0],q[1],q[2]];k=numeric.tensor(g,numeric.dot(g,k));for(n=0;3>n;n++)for(g=q[n],s=k[n],f=0;f<d;f++)g[f]-=2*s[f];for(h=0;h<d-2;h++){for(f=h;f<=h+1;f++)if(Math.abs(c[f+1][f])<
v*(Math.abs(c[f][f])+Math.abs(c[f+1][f+1]))){t=numeric.QRFrancis(numeric.getBlock(c,[0,0],[f,f]),e);v=numeric.QRFrancis(numeric.getBlock(c,[f+1,f+1],[d-1,d-1]),e);k=Array(f+1);for(n=0;n<=f;n++)k[n]=q[n];k=numeric.dot(t.Q,k);for(n=0;n<=f;n++)q[n]=k[n];k=Array(d-f-1);for(n=f+1;n<d;n++)k[n-f-1]=q[n];k=numeric.dot(v.Q,k);for(n=f+1;n<d;n++)q[n]=k[n-f-1];return{Q:q,B:t.B.concat(numeric.add(v.B,f+1))}}p=Math.min(d-1,h+3);f=Array(p-h);for(n=h+1;n<=p;n++)f[n-h-1]=c[n][h];g=numeric.house(f);k=numeric.getBlock(c,
[h+1,h],[p,d-1]);k=numeric.tensor(g,numeric.dot(g,k));for(n=h+1;n<=p;n++)for(r=c[n],s=k[n-h-1],f=h;f<d;f++)r[f]-=2*s[f-h];k=numeric.getBlock(c,[0,h+1],[d-1,p]);k=numeric.tensor(numeric.dot(k,g),g);for(n=0;n<d;n++)for(r=c[n],s=k[n],f=h+1;f<=p;f++)r[f]-=2*s[f-h-1];k=Array(p-h);for(n=h+1;n<=p;n++)k[n-h-1]=q[n];k=numeric.tensor(g,numeric.dot(g,k));for(n=h+1;n<=p;n++)for(g=q[n],s=k[n-h-1],f=0;f<d;f++)g[f]-=2*s[f]}}throw Error("numeric: eigenvalue iteration does not converge -- increase maxiter?");};
numeric.eig=function(c,e){for(var d=numeric.toUpperHessenberg(c),f=numeric.QRFrancis(d.H,e),g=numeric.T,h=c.length,k,h=f.B,p=numeric.dot(f.Q,numeric.dot(d.H,numeric.transpose(f.Q))),f=new g(numeric.dot(f.Q,d.Q)),n,q=h.length,r,s,t,v,u,x,y,l,A=Math.sqrt,d=0;d<q;d++)if(k=h[d][0],k!==h[d][1]&&(r=k+1,s=p[k][k],t=p[k][r],v=p[r][k],u=p[r][r],0!==t||0!==v))n=-s-u,x=s*u-t*v,x=n*n-4*x,0<=x?(n=0>n?-.5*(n-A(x)):-.5*(n+A(x)),y=(s-n)*(s-n)+t*t,l=v*v+(u-n)*(u-n),y>l?(y=A(y),s=(s-n)/y,t/=y):(l=A(l),s=v/l,t=(u-n)/
l),n=new g([[t,-s],[s,t]])):(n*=-.5,x=.5*A(-x),y=(s-n)*(s-n)+t*t,l=v*v+(u-n)*(u-n),y>l?(y=A(y+x*x),s=(s-n)/y,t/=y,n=0,x/=y):(l=A(l+x*x),s=v/l,t=(u-n)/l,n=x/l,x=0),n=new g([[t,-s],[s,t]],[[n,x],[x,-n]])),f.setRows(k,r,n.dot(f.getRows(k,r)));g=f.dot(c).dot(f.transjugate());h=c.length;p=numeric.T.identity(h);for(r=0;r<h;r++)if(0<r)for(d=r-1;0<=d;d--)k=g.get([d,d]),q=g.get([r,r]),numeric.neq(k.x,q.x)||numeric.neq(k.y,q.y)?(n=g.getRow(d).getBlock([d],[r-1]),x=p.getRow(r).getBlock([d],[r-1]),p.set([r,d],
g.get([d,r]).neg().sub(n.dot(x)).div(k.sub(q)))):p.setRow(r,p.getRow(d));for(r=0;r<h;r++)n=p.getRow(r),p.setRow(r,n.div(n.norm2()));p=p.transpose();p=f.transjugate().dot(p);return{lambda:g.getDiag(),E:p}};
numeric.ccsSparse=function(c){var e=c.length,d,f,g,h=[];for(f=e-1;-1!==f;--f)for(g in d=c[f],d){for(g=parseInt(g);g>=h.length;)h[h.length]=0;0!==d[g]&&h[g]++}d=h.length;var k=Array(d+1);for(f=k[0]=0;f<d;++f)k[f+1]=k[f]+h[f];var p=Array(k[d]),n=Array(k[d]);for(f=e-1;-1!==f;--f)for(g in d=c[f],d)0!==d[g]&&(h[g]--,p[k[g]+h[g]]=f,n[k[g]+h[g]]=d[g]);return[k,p,n]};
numeric.ccsFull=function(c){var e=c[0],d=c[1],f=c[2],g=numeric.ccsDim(c);c=g[1];for(var h,k,p=numeric.rep([g[0],c],0),g=0;g<c;g++)for(h=e[g],k=e[g+1];h<k;++h)p[d[h]][g]=f[h];return p};
numeric.ccsTSolve=function(c,e,d,f,g){function h(c){var e;if(0===d[c]){d[c]=1;for(e=k[c];e<k[c+1];++e)h(p[e]);g[r]=c;++r}}var k=c[0],p=c[1];c=c[2];var n=k.length-1,q=Math.max,r=0;"undefined"===typeof f&&(d=numeric.rep([n],0));"undefined"===typeof f&&(f=numeric.linspace(0,d.length-1));"undefined"===typeof g&&(g=[]);for(var s,t,v,n=f.length-1;-1!==n;--n)h(f[n]);g.length=r;for(n=g.length-1;-1!==n;--n)d[g[n]]=0;for(n=f.length-1;-1!==n;--n)s=f[n],d[s]=e[s];for(n=g.length-1;-1!==n;--n){s=g[n];t=k[s];e=
q(k[s+1],t);for(f=t;f!==e;++f)if(p[f]===s){d[s]/=c[f];break}v=d[s];for(f=t;f!==e;++f)t=p[f],t!==s&&(d[t]-=v*c[f])}return d};numeric.ccsDFS=function(c){this.k=Array(c);this.k1=Array(c);this.j=Array(c)};numeric.ccsDFS.prototype.dfs=function(c,e,d,f,g,h){var k=0,p=g.length,n=this.k,q=this.k1,r=this.j,s,t;if(0===f[c])for(f[c]=1,r[0]=c,n[0]=s=e[c],q[0]=t=e[c+1];;)if(s>=t){g[p]=r[k];if(0===k)break;++p;--k;s=n[k];t=q[k]}else c=h[d[s]],0===f[c]?(f[c]=1,n[k]=s,++k,r[k]=c,s=e[c],q[k]=t=e[c+1]):++s};
numeric.ccsLPSolve=function(c,e,d,f,g,h,k){var p=c[0],n=c[1];c=c[2];var q=e[0],r=e[1];e=e[2];var s;s=q[g];q=q[g+1];f.length=0;for(g=s;g<q;++g)k.dfs(h[r[g]],p,n,d,f,h);for(g=f.length-1;-1!==g;--g)d[f[g]]=0;for(g=s;g!==q;++g)k=h[r[g]],d[k]=e[g];for(g=f.length-1;-1!==g;--g){k=f[g];q=p[k];r=p[k+1];for(e=q;e<r;++e)if(h[n[e]]===k){d[k]/=c[e];break}s=d[k];for(e=q;e<r;++e)q=h[n[e]],q!==k&&(d[q]-=s*c[e])}return d};
numeric.ccsLUP1=function(c,e){var d=c[0].length-1,f=[numeric.rep([d+1],0),[],[]],g=[numeric.rep([d+1],0),[],[]],h=f[0],k=f[1],p=f[2],n=g[0],q=g[1],r=g[2],s=numeric.rep([d],0),t=numeric.rep([d],0),v,u,x,y,l,A,z,C=numeric.ccsLPSolve,B=Math.abs,H=numeric.linspace(0,d-1),G=numeric.linspace(0,d-1),L=new numeric.ccsDFS(d);"undefined"===typeof e&&(e=1);for(v=0;v<d;++v){C(f,c,s,t,v,G,L);l=y=-1;for(u=t.length-1;-1!==u;--u)x=t[u],x<=v||(A=B(s[x]),A>y&&(l=x,y=A));B(s[v])<e*y&&(u=H[v],y=H[l],H[v]=y,G[y]=v,H[l]=
u,G[u]=l,y=s[v],s[v]=s[l],s[l]=y);y=h[v];l=n[v];z=s[v];k[y]=H[v];p[y]=1;++y;for(u=t.length-1;-1!==u;--u)x=t[u],A=s[x],t[u]=0,s[x]=0,x<=v?(q[l]=x,r[l]=A,++l):(k[y]=H[x],p[y]=A/z,++y);h[v+1]=y;n[v+1]=l}for(u=k.length-1;-1!==u;--u)k[u]=G[k[u]];return{L:f,U:g,P:H,Pinv:G}};numeric.ccsDFS0=function(c){this.k=Array(c);this.k1=Array(c);this.j=Array(c)};
numeric.ccsDFS0.prototype.dfs=function(c,e,d,f,g,h,k){k=0;var p=g.length,n=this.k,q=this.k1,r=this.j,s,t;if(0===f[c])for(f[c]=1,r[0]=c,n[0]=s=e[h[c]],q[0]=t=e[h[c]+1];;){if(isNaN(s))throw Error("Ow!");if(s>=t){g[p]=h[r[k]];if(0===k)break;++p;--k;s=n[k];t=q[k]}else c=d[s],0===f[c]?(f[c]=1,n[k]=s,++k,r[k]=c,c=h[c],s=e[c],q[k]=t=e[c+1]):++s}};
numeric.ccsLPSolve0=function(c,e,d,f,g,h,k,p){var n=c[0],q=c[1];c=c[2];var r=e[0],s=e[1];e=e[2];var t;t=r[g];r=r[g+1];f.length=0;for(g=t;g<r;++g)p.dfs(s[g],n,q,d,f,h,k);for(g=f.length-1;-1!==g;--g)h=f[g],d[k[h]]=0;for(g=t;g!==r;++g)h=s[g],d[h]=e[g];for(g=f.length-1;-1!==g;--g){h=f[g];s=k[h];p=n[h];h=n[h+1];for(e=p;e<h;++e)if(q[e]===s){d[s]/=c[e];break}t=d[s];for(e=p;e<h;++e)d[q[e]]-=t*c[e];d[s]=t}};
numeric.ccsLUP0=function(c,e){var d=c[0].length-1,f=[numeric.rep([d+1],0),[],[]],g=[numeric.rep([d+1],0),[],[]],h=f[0],k=f[1],p=f[2],n=g[0],q=g[1],r=g[2],s=numeric.rep([d],0),t=numeric.rep([d],0),v,u,x,y,l,A,z,C=numeric.ccsLPSolve0,B=Math.abs,H=numeric.linspace(0,d-1),G=numeric.linspace(0,d-1),L=new numeric.ccsDFS0(d);"undefined"===typeof e&&(e=1);for(v=0;v<d;++v){C(f,c,s,t,v,G,H,L);l=y=-1;for(u=t.length-1;-1!==u;--u)x=t[u],x<=v||(A=B(s[H[x]]),A>y&&(l=x,y=A));B(s[H[v]])<e*y&&(u=H[v],y=H[l],H[v]=y,
G[y]=v,H[l]=u,G[u]=l);y=h[v];l=n[v];z=s[H[v]];k[y]=H[v];p[y]=1;++y;for(u=t.length-1;-1!==u;--u)x=t[u],A=s[H[x]],t[u]=0,s[H[x]]=0,x<=v?(q[l]=x,r[l]=A,++l):(k[y]=H[x],p[y]=A/z,++y);h[v+1]=y;n[v+1]=l}for(u=k.length-1;-1!==u;--u)k[u]=G[k[u]];return{L:f,U:g,P:H,Pinv:G}};numeric.ccsLUP=numeric.ccsLUP0;numeric.ccsDim=function(c){return[numeric.sup(c[1])+1,c[0].length-1]};
numeric.ccsGetBlock=function(c,e,d){var f=numeric.ccsDim(c),g=f[0],h=f[1];"undefined"===typeof e?e=numeric.linspace(0,g-1):"number"===typeof e&&(e=[e]);"undefined"===typeof d?d=numeric.linspace(0,h-1):"number"===typeof d&&(d=[d]);var k,f=e.length,p=d.length,n,h=numeric.rep([h],0),q=[],r=[],s=[h,q,r],t=c[0],v=c[1];c=c[2];for(var u=numeric.rep([g],0),x=0,y=numeric.rep([g],0),g=0;g<p;++g){k=d[g];var l=t[k],A=t[k+1];for(k=l;k<A;++k)n=v[k],y[n]=1,u[n]=c[k];for(k=0;k<f;++k)n=e[k],y[n]&&(q[x]=k,r[x]=u[e[k]],
++x);for(k=l;k<A;++k)n=v[k],y[n]=0;h[g+1]=x}return s};
numeric.ccsDot=function(c,e){var d=c[0],f=c[1],g=c[2],h=e[0],k=e[1],p=e[2],n=numeric.ccsDim(c),q=numeric.ccsDim(e),r=n[0],q=q[1],n=numeric.rep([r],0),s=numeric.rep([r],0),r=Array(r),t=numeric.rep([q],0),v=[],u=[],x=[t,v,u],y,l,A,z,C,B,H,G;for(A=0;A!==q;++A){z=h[A];C=h[A+1];H=0;for(l=z;l<C;++l)for(z=k[l],G=p[l],y=d[z],z=d[z+1];y<z;++y)B=f[y],0===s[B]&&(r[H]=B,s[B]=1,H+=1),n[B]+=g[y]*G;z=t[A];C=z+H;t[A+1]=C;for(l=H-1;-1!==l;--l)G=z+l,y=r[l],v[G]=y,u[G]=n[y],s[y]=0,n[y]=0;t[A+1]=t[A]+H}return x};
numeric.ccsLUPSolve=function(c,e){var d=c.L,f=c.U,g=e[0],h=!1;"object"!==typeof g&&(e=[[0,e.length],numeric.linspace(0,e.length-1),e],g=e[0],h=!0);var k=e[1],p=e[2],n=d[0].length-1,q=g.length-1,r=numeric.rep([n],0),s=Array(n),t=numeric.rep([n],0),n=Array(n),v=numeric.rep([q+1],0),u=[],x=[],y=numeric.ccsTSolve,l,A,z,C,B,H=0;for(l=0;l<q;++l){C=0;A=g[l];for(z=g[l+1];A<z;++A)B=c.Pinv[k[A]],n[C]=B,t[B]=p[A],++C;n.length=C;y(d,t,r,n,s);for(A=n.length-1;-1!==A;--A)t[n[A]]=0;y(f,r,t,s,n);if(h)return t;for(A=
s.length-1;-1!==A;--A)r[s[A]]=0;for(A=n.length-1;-1!==A;--A)B=n[A],u[H]=B,x[H]=t[B],t[B]=0,++H;v[l+1]=H}return[v,u,x]};
numeric.ccsbinop=function(c,e){"undefined"===typeof e&&(e="");return Function("X","Y","var Xi = X[0], Xj = X[1], Xv = X[2];\nvar Yi = Y[0], Yj = Y[1], Yv = Y[2];\nvar n = Xi.length-1,m = Math.max(numeric.sup(Xj),numeric.sup(Yj))+1;\nvar Zi = numeric.rep([n+1],0), Zj = [], Zv = [];\nvar x = numeric.rep([m],0),y = numeric.rep([m],0);\nvar xk,yk,zk;\nvar i,j,j0,j1,k,p=0;\n"+e+"for(i=0;i<n;++i) {\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Xj[j];\n    x[k] = 1;\n    Zj[p] = k;\n    ++p;\n  }\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Yj[j];\n    y[k] = Yv[j];\n    if(x[k] === 0) {\n      Zj[p] = k;\n      ++p;\n    }\n  }\n  Zi[i+1] = p;\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = Xv[j];\n  j0 = Zi[i]; j1 = Zi[i+1];\n  for(j=j0;j!==j1;++j) {\n    k = Zj[j];\n    xk = x[k];\n    yk = y[k];\n"+c+
"\n    Zv[j] = zk;\n  }\n  j0 = Xi[i]; j1 = Xi[i+1];\n  for(j=j0;j!==j1;++j) x[Xj[j]] = 0;\n  j0 = Yi[i]; j1 = Yi[i+1];\n  for(j=j0;j!==j1;++j) y[Yj[j]] = 0;\n}\nreturn [Zi,Zj,Zv];")};
(function(){var c,e,d,f;for(c in numeric.ops2)e=isFinite(eval("1"+numeric.ops2[c]+"0"))?"[Y[0],Y[1],numeric."+c+"(X,Y[2])]":"NaN",d=isFinite(eval("0"+numeric.ops2[c]+"1"))?"[X[0],X[1],numeric."+c+"(X[2],Y)]":"NaN",f=isFinite(eval("1"+numeric.ops2[c]+"0"))&&isFinite(eval("0"+numeric.ops2[c]+"1"))?"numeric.ccs"+c+"MM(X,Y)":"NaN",numeric["ccs"+c+"MM"]=numeric.ccsbinop("zk = xk "+numeric.ops2[c]+"yk;"),numeric["ccs"+c]=Function("X","Y",'if(typeof X === "number") return '+e+';\nif(typeof Y === "number") return '+
d+";\nreturn "+f+";\n")})();numeric.ccsScatter=function(c){var e=c[0],d=c[1];c=c[2];var f=numeric.sup(d)+1,g=e.length,h=numeric.rep([f],0),k=Array(g),p=Array(g),n=numeric.rep([f],0),q;for(q=0;q<g;++q)n[d[q]]++;for(q=0;q<f;++q)h[q+1]=h[q]+n[q];var f=h.slice(0),r;for(q=0;q<g;++q)r=d[q],n=f[r],k[n]=e[q],p[n]=c[q],f[r]+=1;return[h,k,p]};
numeric.ccsGather=function(c){var e=c[0],d=c[1];c=c[2];var f=e.length-1,g=d.length,h=Array(g),k=Array(g),g=Array(g),p,n,q,r;for(p=r=0;p<f;++p)for(n=e[p],q=e[p+1];n!==q;++n)k[r]=p,h[r]=d[n],g[r]=c[n],++r;return[h,k,g]};numeric.sdim=function dim(e,d,f){"undefined"===typeof d&&(d=[]);if("object"!==typeof e)return d;"undefined"===typeof f&&(f=0);f in d||(d[f]=0);e.length>d[f]&&(d[f]=e.length);for(var g in e)e.hasOwnProperty(g)&&dim(e[g],d,f+1);return d};
numeric.sclone=function clone(e,d,f){"undefined"===typeof d&&(d=0);"undefined"===typeof f&&(f=numeric.sdim(e).length);var g,h=Array(e.length);if(d===f-1){for(g in e)e.hasOwnProperty(g)&&(h[g]=e[g]);return h}for(g in e)e.hasOwnProperty(g)&&(h[g]=clone(e[g],d+1,f));return h};numeric.sdiag=function(c){for(var e=c.length,d=Array(e),f,e=e-1;1<=e;e-=2)f=e-1,d[e]=[],d[e][e]=c[e],d[f]=[],d[f][f]=c[f];0===e&&(d[0]=[],d[0][0]=c[e]);return d};
numeric.sidentity=function(c){return numeric.sdiag(numeric.rep([c],1))};numeric.stranspose=function(c){var e=[],d,f,g;for(d in c)if(c.hasOwnProperty(d))for(f in g=c[d],g)g.hasOwnProperty(f)&&("object"!==typeof e[f]&&(e[f]=[]),e[f][d]=g[f]);return e};numeric.sLUP=function(c,e){throw Error("The function numeric.sLUP had a bug in it and has been removed. Please use the new numeric.ccsLUP function instead.");};
numeric.sdotMM=function(c,e){var d=c.length,f=numeric.stranspose(e),g=f.length,h,k,p,n,q,r=Array(d),s;for(k=d-1;0<=k;k--){s=[];d=c[k];for(n=g-1;0<=n;n--){q=0;h=f[n];for(p in d)d.hasOwnProperty(p)&&p in h&&(q+=d[p]*h[p]);q&&(s[n]=q)}r[k]=s}return r};numeric.sdotMV=function(c,e){var d=c.length,f,g,h=Array(d),k;for(f=d-1;0<=f;f--){d=c[f];k=0;for(g in d)d.hasOwnProperty(g)&&e[g]&&(k+=d[g]*e[g]);k&&(h[f]=k)}return h};
numeric.sdotVM=function(c,e){var d,f,g,h,k=[];for(d in c)if(c.hasOwnProperty(d))for(f in g=e[d],h=c[d],g)g.hasOwnProperty(f)&&(k[f]||(k[f]=0),k[f]+=h*g[f]);return k};numeric.sdotVV=function(c,e){var d,f=0;for(d in c)c[d]&&e[d]&&(f+=c[d]*e[d]);return f};
numeric.sdot=function(c,e){var d=numeric.sdim(c).length,f=numeric.sdim(e).length;switch(1E3*d+f){case 0:return c*e;case 1001:return numeric.sdotVV(c,e);case 2001:return numeric.sdotMV(c,e);case 1002:return numeric.sdotVM(c,e);case 2002:return numeric.sdotMM(c,e);default:throw Error("numeric.sdot not implemented for tensors of order "+d+" and "+f);}};
numeric.sscatter=function(c){var e,d,f,g=c.length,h=[],k;for(d=c[0].length-1;0<=d;--d)if(c[g-1][d]){k=h;for(f=0;f<g-2;f++)e=c[f][d],k[e]||(k[e]=[]),k=k[e];k[c[f][d]]=c[f+1][d]}return h};
numeric.sgather=function gather(e,d,f){"undefined"===typeof d&&(d=[]);"undefined"===typeof f&&(f=[]);var g,h,k;g=f.length;for(h in e)if(e.hasOwnProperty(h))if(f[g]=parseInt(h),k=e[h],"number"===typeof k){if(k){if(0===d.length)for(h=g+1;0<=h;--h)d[h]=[];for(h=g;0<=h;--h)d[h].push(f[h]);d[g+1].push(k)}}else gather(k,d,f);f.length>g&&f.pop();return d};
numeric.cLU=function(c){var e=c[0],d=c[1],f=c[2],g=e.length;c=0;var h,k,p;for(h=0;h<g;h++)e[h]>c&&(c=e[h]);c++;var n=Array(c),q=Array(c),r=numeric.rep([c],Infinity),s=numeric.rep([c],-Infinity),t,v;for(p=0;p<g;p++)h=e[p],k=d[p],k<r[h]&&(r[h]=k),k>s[h]&&(s[h]=k);for(h=0;h<c-1;h++)s[h]>s[h+1]&&(s[h+1]=s[h]);for(h=c-1;1<=h;h--)r[h]<r[h-1]&&(r[h-1]=r[h]);for(h=0;h<c;h++)q[h]=numeric.rep([s[h]-r[h]+1],0),n[h]=numeric.rep([h-r[h]],0);for(p=0;p<g;p++)h=e[p],q[h][d[p]-r[h]]=f[p];for(h=0;h<c-1;h++)for(e=h-
r[h],f=q[h],k=h+1;r[k]<=h&&k<c;k++)if(d=h-r[k],g=s[h]-h,t=q[k],v=t[d]/f[e]){for(p=1;p<=g;p++)t[p+d]-=v*f[p+e];n[k][h-r[k]]=v}f=[];t=[];p=[];v=[];var u=[],x=[],y,l;for(h=y=g=0;h<c;h++){e=r[h];d=s[h];l=q[h];for(k=h;k<=d;k++)l[k-e]&&(f[g]=h,t[g]=k,p[g]=l[k-e],g++);l=n[h];for(k=e;k<h;k++)l[k-e]&&(v[y]=h,u[y]=k,x[y]=l[k-e],y++);v[y]=h;u[y]=h;x[y]=1;y++}return{U:[f,t,p],L:[v,u,x]}};
numeric.cLUsolve=function(c,e){var d=c.L,f=c.U,g=numeric.clone(e),h=d[1],d=d[2],k=f[1],p=f[2],f=f[0].length,n=g.length,q,r;for(q=r=0;q<n;q++){for(;h[r]<q;)g[q]-=d[r]*g[h[r]],r++;r++}r=f-1;for(q=n-1;0<=q;q--){for(;k[r]>q;)g[q]-=p[r]*g[k[r]],r--;g[q]/=p[r];r--}return g};
numeric.cgrid=function(c,e){"number"===typeof c&&(c=[c,c]);var d=numeric.rep(c,-1),f,g,h;if("function"!==typeof e)switch(e){case "L":e=function(d,e){return d>=c[0]/2||e<c[1]/2};break;default:e=function(c,d){return!0}}h=0;for(f=1;f<c[0]-1;f++)for(g=1;g<c[1]-1;g++)e(f,g)&&(d[f][g]=h,h++);return d};
numeric.cdelsq=function(c){var e=[[-1,0],[0,-1],[0,1],[1,0]],d=numeric.dim(c),f=d[0],d=d[1],g,h,k,p,n,q=[],r=[],s=[];for(g=1;g<f-1;g++)for(h=1;h<d-1;h++)if(!(0>c[g][h])){for(k=0;4>k;k++)p=g+e[k][0],n=h+e[k][1],0>c[p][n]||(q.push(c[g][h]),r.push(c[p][n]),s.push(-1));q.push(c[g][h]);r.push(c[g][h]);s.push(4)}return[q,r,s]};numeric.cdotMV=function(c,e){var d,f=c[0],g=c[1],h=c[2],k,p=f.length;for(k=d=0;k<p;k++)f[k]>d&&(d=f[k]);d++;d=numeric.rep([d],0);for(k=0;k<p;k++)d[f[k]]+=h[k]*e[g[k]];return d};
numeric.Spline=function(c,e,d,f,g){this.x=c;this.yl=e;this.yr=d;this.kl=f;this.kr=g};numeric.Spline.prototype._at=function(c,e){var d=this.x,f=this.yl,g=this.yr,h=this.kr,k,p=numeric.add,n=numeric.sub,q=numeric.mul;k=n(q(this.kl[e],d[e+1]-d[e]),n(g[e+1],f[e]));h=p(q(h[e+1],d[e]-d[e+1]),n(g[e+1],f[e]));d=(c-d[e])/(d[e+1]-d[e]);n=d*(1-d);return p(p(p(q(1-d,f[e]),q(d,g[e+1])),q(k,n*(1-d))),q(h,n*d))};
numeric.Spline.prototype.at=function(c){if("number"===typeof c){var e=this.x,d=e.length,f,g,h=Math.floor;f=0;for(d-=1;1<d-f;)g=h((f+d)/2),e[g]<=c?f=g:d=g;return this._at(c,f)}d=c.length;e=Array(d);for(f=d-1;-1!==f;--f)e[f]=this.at(c[f]);return e};
numeric.Spline.prototype.diff=function(){for(var c=this.x,e=this.yl,d=this.yr,f=this.kl,g=this.kr,h=e.length,k,p,n=Array(h),q=Array(h),r=numeric.add,s=numeric.mul,t=numeric.div,v=numeric.sub,h=h-1;-1!==h;--h)k=c[h+1]-c[h],p=v(d[h+1],e[h]),n[h]=t(r(s(p,6),s(f[h],-4*k),s(g[h+1],-2*k)),k*k),q[h+1]=t(r(s(p,-6),s(f[h],2*k),s(g[h+1],4*k)),k*k);return new numeric.Spline(c,f,g,n,q)};
numeric.Spline.prototype.roots=function(){var c=[],e=this.x,d=this.yl,f=this.yr,g=this.kl,h=this.kr;"number"===typeof d[0]&&(d=[d],f=[f],g=[g],h=[h]);var k=d.length,p=e.length-1,n,q,r,s,t,v,u,c=Array(k),x,y,l,A,z,C,B,H,G=Math.sqrt;for(n=0;n!==k;++n){s=d[n];t=f[n];v=g[n];u=h[n];x=[];for(q=0;q!==p;q++){0<q&&0>t[q]*s[q]&&x.push(e[q]);z=e[q+1]-e[q];r=s[q];A=t[q+1];y=v[q]/z;l=u[q+1]/z;z=y-l+3*(r-A);C=z*z+12*l*r;z=l+3*r+2*y-3*A;r=3*(l+y+2*(r-A));0>=C?(y=z/r,A=y>e[q]&&y<e[q+1]?[e[q],y,e[q+1]]:[e[q],e[q+
1]]):(y=(z-G(C))/r,B=(z+G(C))/r,A=[e[q]],y>e[q]&&y<e[q+1]&&A.push(y),B>e[q]&&B<e[q+1]&&A.push(B),A.push(e[q+1]));C=A[0];y=this._at(C,q);for(r=0;r<A.length-1;r++)if(H=A[r+1],B=this._at(H,q),0===y)x.push(C),C=H,y=B;else if(0===B||0<y*B)C=H,y=B;else{for(var L=0;;){l=(y*H-B*C)/(y-B);if(l<=C||l>=H)break;z=this._at(l,q);if(0<z*B)H=l,B=z,-1===L&&(y*=.5),L=-1;else if(0<z*y)C=l,y=z,1===L&&(B*=.5),L=1;else break}x.push(l);C=A[r+1];y=this._at(C,q)}0===B&&x.push(H)}c[n]=x}return"number"===typeof this.yl[0]?c[0]:
c};
numeric.spline=function(c,e,d,f){var g=c.length,h=[],k=[],p=[],n,q=numeric.sub,r=numeric.mul,s=numeric.add;for(n=g-2;0<=n;n--)k[n]=c[n+1]-c[n],p[n]=q(e[n+1],e[n]);if("string"===typeof d||"string"===typeof f)d=f="periodic";q=[[],[],[]];switch(typeof d){case "undefined":h[0]=r(3/(k[0]*k[0]),p[0]);q[0].push(0,0);q[1].push(0,1);q[2].push(2/k[0],1/k[0]);break;case "string":h[0]=s(r(3/(k[g-2]*k[g-2]),p[g-2]),r(3/(k[0]*k[0]),p[0]));q[0].push(0,0,0);q[1].push(g-2,0,1);q[2].push(1/k[g-2],2/k[g-2]+2/k[0],1/
k[0]);break;default:h[0]=d,q[0].push(0),q[1].push(0),q[2].push(1)}for(n=1;n<g-1;n++)h[n]=s(r(3/(k[n-1]*k[n-1]),p[n-1]),r(3/(k[n]*k[n]),p[n])),q[0].push(n,n,n),q[1].push(n-1,n,n+1),q[2].push(1/k[n-1],2/k[n-1]+2/k[n],1/k[n]);switch(typeof f){case "undefined":h[g-1]=r(3/(k[g-2]*k[g-2]),p[g-2]);q[0].push(g-1,g-1);q[1].push(g-2,g-1);q[2].push(1/k[g-2],2/k[g-2]);break;case "string":q[1][q[1].length-1]=0;break;default:h[g-1]=f,q[0].push(g-1),q[1].push(g-1),q[2].push(1)}h="number"!==typeof h[0]?numeric.transpose(h):
[h];f=Array(h.length);if("string"===typeof d)for(n=f.length-1;-1!==n;--n)f[n]=numeric.ccsLUPSolve(numeric.ccsLUP(numeric.ccsScatter(q)),h[n]),f[n][g-1]=f[n][0];else for(n=f.length-1;-1!==n;--n)f[n]=numeric.cLUsolve(numeric.cLU(q),h[n]);f="number"===typeof e[0]?f[0]:numeric.transpose(f);return new numeric.Spline(c,e,e,f,f)};
numeric.fftpow2=function fftpow2(e,d){var f=e.length;if(1!==f){var g=Math.cos,h=Math.sin,k,p,n=Array(f/2),q=Array(f/2),r=Array(f/2),s=Array(f/2);p=f/2;for(k=f-1;-1!==k;--k)--p,r[p]=e[k],s[p]=d[k],--k,n[p]=e[k],q[p]=d[k];fftpow2(n,q);fftpow2(r,s);p=f/2;var t,v=-6.283185307179586/f,u;for(k=f-1;-1!==k;--k)--p,-1===p&&(p=f/2-1),t=v*k,u=g(t),t=h(t),e[k]=n[p]+u*r[p]-t*s[p],d[k]=q[p]+u*s[p]+t*r[p]}};
numeric._ifftpow2=function _ifftpow2(e,d){var f=e.length;if(1!==f){var g=Math.cos,h=Math.sin,k,p,n=Array(f/2),q=Array(f/2),r=Array(f/2),s=Array(f/2);p=f/2;for(k=f-1;-1!==k;--k)--p,r[p]=e[k],s[p]=d[k],--k,n[p]=e[k],q[p]=d[k];_ifftpow2(n,q);_ifftpow2(r,s);p=f/2;var t,v=6.283185307179586/f,u;for(k=f-1;-1!==k;--k)--p,-1===p&&(p=f/2-1),t=v*k,u=g(t),t=h(t),e[k]=n[p]+u*r[p]-t*s[p],d[k]=q[p]+u*s[p]+t*r[p]}};numeric.ifftpow2=function(c,e){numeric._ifftpow2(c,e);numeric.diveq(c,c.length);numeric.diveq(e,e.length)};
numeric.convpow2=function(c,e,d,f){numeric.fftpow2(c,e);numeric.fftpow2(d,f);var g,h,k,p,n;for(g=c.length-1;-1!==g;--g)h=c[g],p=e[g],k=d[g],n=f[g],c[g]=h*k-p*n,e[g]=h*n+p*k;numeric.ifftpow2(c,e)};
numeric.T.prototype.fft=function(){var c=this.x,e=this.y,d=c.length,f=Math.log,g=f(2),f=Math.ceil(f(2*d-1)/g),h=Math.pow(2,f),f=numeric.rep([h],0),g=numeric.rep([h],0),k=Math.cos,p=Math.sin,n,q=-3.141592653589793/d,r=numeric.rep([h],0),s=numeric.rep([h],0);for(n=0;n<d;n++)r[n]=c[n];if("undefined"!==typeof e)for(n=0;n<d;n++)s[n]=e[n];for(n=f[0]=1;n<=h/2;n++)c=q*n*n,f[n]=k(c),g[n]=p(c),f[h-n]=k(c),g[h-n]=p(c);c=new numeric.T(r,s);e=new numeric.T(f,g);c=c.mul(e);numeric.convpow2(c.x,c.y,numeric.clone(e.x),
numeric.neg(e.y));c=c.mul(e);c.x.length=d;c.y.length=d;return c};
numeric.T.prototype.ifft=function(){var c=this.x,e=this.y,d=c.length,f=Math.log,g=f(2),f=Math.ceil(f(2*d-1)/g),h=Math.pow(2,f),f=numeric.rep([h],0),g=numeric.rep([h],0),k=Math.cos,p=Math.sin,n,q=3.141592653589793/d,r=numeric.rep([h],0),s=numeric.rep([h],0);for(n=0;n<d;n++)r[n]=c[n];if("undefined"!==typeof e)for(n=0;n<d;n++)s[n]=e[n];for(n=f[0]=1;n<=h/2;n++)c=q*n*n,f[n]=k(c),g[n]=p(c),f[h-n]=k(c),g[h-n]=p(c);c=new numeric.T(r,s);e=new numeric.T(f,g);c=c.mul(e);numeric.convpow2(c.x,c.y,numeric.clone(e.x),
numeric.neg(e.y));c=c.mul(e);c.x.length=d;c.y.length=d;return c.div(d)};
numeric.gradient=function(c,e){var d=e.length,f=c(e);if(isNaN(f))throw Error("gradient: f(x) is a NaN!");var g=Math.max,h,k=numeric.clone(e),p,n,q=Array(d),r,g=Math.max,s=Math.abs,t=Math.min,v,u,x,y=0,l;for(h=0;h<d;h++)for(var A=g(1E-6*f,1E-8);;){++y;if(20<y)throw Error("Numerical gradient fails");k[h]=e[h]+A;p=c(k);k[h]=e[h]-A;n=c(k);k[h]=e[h];if(isNaN(p)||isNaN(n))A/=16;else if(q[h]=(p-n)/(2*A),v=e[h]-A,u=e[h],x=e[h]+A,r=(p-f)/A,l=(f-n)/A,p=g(s(q[h]),s(f),s(p),s(n),s(v),s(u),s(x),1E-8),r=t(g(s(r-
q[h]),s(l-q[h]),s(r-l))/p,A/p),.001<r)A/=16;else break}return q};
numeric.uncmin=function(c,e,d,f,g,h,k){var p=numeric.gradient;"undefined"===typeof k&&(k={});"undefined"===typeof d&&(d=1E-8);"undefined"===typeof f&&(f=function(d){return p(c,d)});"undefined"===typeof g&&(g=1E3);e=numeric.clone(e);var n=e.length,q=c(e),r,s;if(isNaN(q))throw Error("uncmin: f(x0) is a NaN!");var t=Math.max,v=numeric.norm2;d=t(d,numeric.epsilon);var u,x;k=k.Hinv||numeric.identity(n);var n=numeric.dot,t=numeric.sub,y=numeric.add,l=numeric.tensor,A=numeric.div,z=numeric.mul,C=numeric.all,
B=numeric.isFinite,H=numeric.neg,G=0,L,w,D,F,I="";for(x=f(e);G<g;){if("function"===typeof h&&h(G,e,q,x,k)){I="Callback returned true";break}if(!C(B(x))){I="Gradient has Infinity or NaN";break}u=H(n(k,x));if(!C(B(u))){I="Search direction has Infinity or NaN";break}F=v(u);if(F<d){I="Newton step smaller than tol";break}D=1;s=n(x,u);for(w=e;G<g&&!(D*F<d);)if(L=z(u,D),w=y(e,L),r=c(w),r-q>=.1*D*s||isNaN(r))D*=.5,++G;else break;if(D*F<d){I="Line search step size smaller than tol";break}if(G===g){I="maxit reached during line search";
break}s=f(w);e=t(s,x);x=n(e,L);q=n(k,e);k=t(y(k,z((x+n(e,q))/(x*x),l(L,L))),A(y(l(q,L),l(L,q)),x));e=w;q=r;x=s;++G}return{solution:e,f:q,gradient:x,invHessian:k,iterations:G,message:I}};numeric.Dopri=function(c,e,d,f,g,h,k){this.x=c;this.y=e;this.f=d;this.ymid=f;this.iterations=g;this.events=k;this.message=h};
numeric.Dopri.prototype._at=function(c,e){function d(c){return c*c}var f=this.x,g=this.y,h=this.f,k=this.ymid,p,n,q,r=numeric.add,s=numeric.mul,t=numeric.sub,v;p=f[e];n=f[e+1];f=g[e];g=g[e+1];q=p+.5*(n-p);k=k[e];v=t(h[e],s(f,1/(p-q)+2/(p-n)));h=t(h[e+1],s(g,1/(n-q)+2/(n-p)));p=[d(c-n)*(c-q)/d(p-n)/(p-q),d(c-p)*d(c-n)/d(p-q)/d(n-q),d(c-p)*(c-q)/d(n-p)/(n-q),(c-p)*d(c-n)*(c-q)/d(p-n)/(p-q),(c-n)*d(c-p)*(c-q)/d(p-n)/(n-q)];return r(r(r(r(s(f,p[0]),s(k,p[1])),s(g,p[2])),s(v,p[3])),s(h,p[4]))};
numeric.Dopri.prototype.at=function(c){var e,d,f,g=Math.floor;if("number"!==typeof c){e=c.length;d=Array(e);for(e-=1;-1!==e;--e)d[e]=this.at(c[e]);return d}var h=this.x;e=0;for(d=h.length-1;1<d-e;)f=g(.5*(e+d)),h[f]<=c?e=f:d=f;return this._at(c,e)};
numeric.dopri=function(c,e,d,f,g,h,k){"undefined"===typeof g&&(g=1E-6);"undefined"===typeof h&&(h=1E3);var p=[c],n=[d],q=[f(c,d)],r,s,t,v,u,x,y=[],l=[.075,.225],A=[44/45,-56/15,32/9],z=[19372/6561,-25360/2187,64448/6561,-212/729],C=[9017/3168,-355/33,46732/5247,49/176,-5103/18656],B=[35/384,0,500/1113,125/192,-2187/6784,11/84],H=[.10013431883002395,0,.3918321794184259,-.02982460176594817,.05893268337240795,-.04497888809104361,.023904308236133973],G=[.2,.3,.8,8/9,1,1],L=[-71/57600,0,71/16695,-71/1920,
17253/339200,-22/525,.025],w=0,D,F=(e-c)/10,I=0,J=numeric.add,E=numeric.mul,S=Math.min,Q=Math.abs,X=numeric.norminf,W=Math.pow,O=numeric.any,P=numeric.lt,M=numeric.and,K,U,R=new numeric.Dopri(p,n,q,y,-1,"");for("function"===typeof k&&(K=k(c,d));c<e&&I<h;)if(++I,c+F>e&&(F=e-c),r=f(c+G[0]*F,J(d,E(.2*F,q[w]))),s=f(c+G[1]*F,J(J(d,E(l[0]*F,q[w])),E(l[1]*F,r))),t=f(c+G[2]*F,J(J(J(d,E(A[0]*F,q[w])),E(A[1]*F,r)),E(A[2]*F,s))),v=f(c+G[3]*F,J(J(J(J(d,E(z[0]*F,q[w])),E(z[1]*F,r)),E(z[2]*F,s)),E(z[3]*F,t))),
u=f(c+G[4]*F,J(J(J(J(J(d,E(C[0]*F,q[w])),E(C[1]*F,r)),E(C[2]*F,s)),E(C[3]*F,t)),E(C[4]*F,v))),r=J(J(J(J(J(d,E(q[w],F*B[0])),E(s,F*B[2])),E(t,F*B[3])),E(v,F*B[4])),E(u,F*B[5])),x=f(c+F,r),D=J(J(J(J(J(E(q[w],F*L[0]),E(s,F*L[2])),E(t,F*L[3])),E(v,F*L[4])),E(u,F*L[5])),E(x,F*L[6])),D="number"===typeof D?Q(D):X(D),D>g){if(F=.2*F*W(g/D,.25),c+F===c){R.msg="Step size became too small";break}}else{y[w]=J(J(J(J(J(J(d,E(q[w],F*H[0])),E(s,F*H[2])),E(t,F*H[3])),E(v,F*H[4])),E(u,F*H[5])),E(x,F*H[6]));++w;p[w]=
c+F;n[w]=r;q[w]=x;if("function"===typeof k){var N;s=c;t=c+.5*F;U=k(t,y[w-1]);d=M(P(K,0),P(0,U));O(d)||(s=t,t=c+F,K=U,U=k(t,r),d=M(P(K,0),P(0,U)));if(O(d)){g=0;for(p=h=1;;){if("number"===typeof K)e=(p*U*s-h*K*t)/(p*U-h*K);else for(e=t,n=K.length-1;-1!==n;--n)0>K[n]&&0<U[n]&&(e=S(e,(p*U[n]*s-h*K[n]*t)/(p*U[n]-h*K[n])));if(e<=s||e>=t)break;N=R._at(e,w-1);q=k(e,N);n=M(P(K,0),P(0,q));O(n)?(t=e,U=q,d=n,p=1,h=-1===g?.5*h:1,g=-1):(s=e,K=q,h=1,p=1===g?.5*p:1,g=1)}r=R._at(.5*(c+e),w-1);R.f[w]=f(e,N);R.x[w]=
e;R.y[w]=N;R.ymid[w-1]=r;R.events=d;R.iterations=I;return R}}c+=F;d=r;K=U;F=S(.8*F*W(g/D,.25),4*F)}R.iterations=I;return R};
numeric.LU=function(c,e){var d=Math.abs,f,g,h,k,p,n,q=c.length,r=q-1,s=Array(q);e||(c=numeric.clone(c));for(h=0;h<q;++h){p=h;k=c[h];n=d(k[h]);for(g=h+1;g<q;++g)f=d(c[g][h]),n<f&&(n=f,p=g);s[h]=p;p!=h&&(c[h]=c[p],c[p]=k,k=c[h]);g=k[h];for(f=h+1;f<q;++f)c[f][h]/=g;for(f=h+1;f<q;++f){p=c[f];for(g=h+1;g<r;++g)p[g]-=p[h]*k[g],++g,p[g]-=p[h]*k[g];g===r&&(p[g]-=p[h]*k[g])}}return{LU:c,P:s}};
numeric.LUsolve=function(c,e){var d,f,g=c.LU,h=g.length,k=numeric.clone(e),p=c.P,n;for(d=h-1;-1!==d;--d)k[d]=e[d];for(d=0;d<h;++d)for(f=p[d],p[d]!==d&&(n=k[d],k[d]=k[f],k[f]=n),n=g[d],f=0;f<d;++f)k[d]-=k[f]*n[f];for(d=h-1;0<=d;--d){n=g[d];for(f=d+1;f<h;++f)k[d]-=k[f]*n[f];k[d]/=n[d]}return k};numeric.solve=function(c,e,d){return numeric.LUsolve(numeric.LU(c,d),e)};
numeric.echelonize=function(c){var e=numeric.dim(c),d=e[0],e=e[1],f=numeric.identity(d),g=Array(d),h,k,p,n,q,r,s,t,v=Math.abs,u=numeric.diveq;c=numeric.clone(c);for(h=0;h<d;++h){p=0;q=c[h];r=f[h];for(k=1;k<e;++k)v(q[p])<v(q[k])&&(p=k);g[h]=p;u(r,q[p]);u(q,q[p]);for(k=0;k<d;++k)if(k!==h){s=c[k];t=s[p];for(n=e-1;-1!==n;--n)s[n]-=q[n]*t;s=f[k];for(n=d-1;-1!==n;--n)s[n]-=r[n]*t}}return{I:f,A:c,P:g}};
numeric.__solveLP=function(c,e,d,f,g,h,k){var p=numeric.sum,n=numeric.mul,q=numeric.sub,r=numeric.dot,s=numeric.div,t=numeric.add,v=c.length,u=d.length,x,y=!1,l=1;numeric.transpose(e);var A=numeric.transpose,z=Math.sqrt,C=Math.abs,B=Math.min,H=numeric.all,G=numeric.gt,L=Array(v),w=Array(u);numeric.rep([u],1);var D=numeric.solve,F=q(d,r(e,h)),I,J=r(c,c);for(I=0;I<g;++I){var E;for(E=u-1;-1!==E;--E)w[E]=s(e[E],F[E]);x=A(w);for(E=v-1;-1!==E;--E)L[E]=p(x[E]);l=.25*C(J/r(c,L));E=100*z(J/r(L,L));if(!isFinite(l)||
l>E)l=E;y=t(c,n(l,L));x=r(x,w);for(E=v-1;-1!==E;--E)x[E][E]+=1;x=D(x,s(y,l),!0);var F=s(F,r(e,x)),S=1;for(E=u-1;-1!==E;--E)0>F[E]&&(S=B(S,-.999*F[E]));x=q(h,n(x,S));F=q(d,r(e,x));if(!H(G(F,0)))return{solution:h,message:"",iterations:I};h=x;if(l<f)return{solution:x,message:"",iterations:I};if(k)for(l=r(c,y),S=r(e,y),y=!0,E=u-1;-1!==E;--E){if(0>l*S[E]){y=!1;break}}else y=0<=h[v-1]?!1:!0;if(y)return{solution:x,message:"Unbounded",iterations:I}}return{solution:h,message:"maximum iteration count exceeded",
iterations:I}};
numeric._solveLP=function(c,e,d,f,g){var h=c.length,k=d.length,p=numeric.sub,n=numeric.dot,q=numeric.rep([h],0).concat([1]),k=numeric.rep([k,1],-1),r=numeric.blockMatrix([[e,k]]),k=numeric.rep([h],0).concat(Math.max(0,numeric.sup(numeric.neg(d)))+1),q=numeric.__solveLP(q,r,d,f,g,k,!1),k=numeric.clone(q.solution);k.length=h;if(0>numeric.inf(p(d,n(e,k))))return{solution:NaN,message:"Infeasible",iterations:q.iterations};c=numeric.__solveLP(c,e,d,f,g-q.iterations,k,!0);c.iterations+=q.iterations;return c};
numeric.solveLP=function(c,e,d,f,g,h,k){"undefined"===typeof k&&(k=1E3);"undefined"===typeof h&&(h=numeric.epsilon);if("undefined"===typeof f)return numeric._solveLP(c,e,d,h,k);var p=f.length,n=f[0].length,q=e.length,r=numeric.echelonize(f),s=numeric.rep([n],0),t=r.P,v=[],u;for(u=t.length-1;-1!==u;--u)s[t[u]]=1;for(u=n-1;-1!==u;--u)0===s[u]&&v.push(u);u=numeric.getRange;p=numeric.linspace(0,p-1);q=numeric.linspace(0,q-1);f=u(f,p,v);p=u(e,q,t);u=u(e,q,v);e=numeric.dot;q=numeric.sub;n=e(p,r.I);p=q(u,
e(n,f));d=q(d,e(n,g));n=Array(t.length);s=Array(v.length);for(u=t.length-1;-1!==u;--u)n[u]=c[t[u]];for(u=v.length-1;-1!==u;--u)s[u]=c[v[u]];u=q(s,e(n,e(r.I,f)));h=numeric._solveLP(u,p,d,h,k);k=h.solution;if(k!==k)return h;g=e(r.I,q(g,e(f,k)));c=Array(c.length);for(u=t.length-1;-1!==u;--u)c[t[u]]=g[u];for(u=v.length-1;-1!==u;--u)c[v[u]]=k[u];return{solution:c,message:h.message,iterations:h.iterations}};
numeric.MPStoLP=function(c){function e(e){throw Error("MPStoLP: "+e+"\nLine "+h+": "+c[h]+"\nCurrent state: "+f[d]+"\n");}c instanceof String&&c.split("\n");var d=0,f="Initial state;NAME;ROWS;COLUMNS;RHS;BOUNDS;ENDATA".split(";"),g=c.length,h,k,p,n=0,q={},r=[],s=0,t={},v=0,u,x=[],y=[],l=[];for(h=0;h<g;++h){p=c[h];var A=p.match(/\S*/g),z=[];for(k=0;k<A.length;++k)""!==A[k]&&z.push(A[k]);if(0!==z.length){for(k=0;k<f.length&&p.substr(0,f[k].length)!==f[k];++k);if(k<f.length){if(d=k,1===k&&(u=z[1]),6===
k)return{name:u,c:x,A:numeric.transpose(y),b:l,rows:q,vars:t}}else switch(d){case 0:case 1:e("Unexpected line");case 2:switch(z[0]){case "N":0===n?n=z[1]:e("Two or more N rows");break;case "L":q[z[1]]=s;r[s]=1;l[s]=0;++s;break;case "G":q[z[1]]=s;r[s]=-1;l[s]=0;++s;break;case "E":q[z[1]]=s;r[s]=0;l[s]=0;++s;break;default:e("Parse error "+numeric.prettyPrint(z))}break;case 3:t.hasOwnProperty(z[0])||(t[z[0]]=v,x[v]=0,y[v]=numeric.rep([s],0),++v);p=t[z[0]];for(k=1;k<z.length;k+=2)z[k]===n?x[p]=parseFloat(z[k+
1]):(A=q[z[k]],y[p][A]=(0>r[A]?-1:1)*parseFloat(z[k+1]));break;case 4:for(k=1;k<z.length;k+=2)l[q[z[k]]]=(0>r[q[z[k]]]?-1:1)*parseFloat(z[k+1]);break;case 6:e("Internal error")}}}e("Reached end of file without ENDATA")};numeric.seedrandom={pow:Math.pow,random:Math.random};
(function(c,e,d,f,g,h,k){function p(c){var e,f,g=this,h=c.length,k=0,n=g.i=g.j=g.m=0;g.S=[];g.c=[];for(h||(c=[h++]);k<d;)g.S[k]=k++;for(k=0;k<d;k++)e=g.S[k],n=n+e+c[k%h]&d-1,f=g.S[n],g.S[k]=f,g.S[n]=e;g.g=function(c){var e=g.S,f=g.i+1&d-1,h=e[f],k=g.j+h&d-1,n=e[k];e[f]=n;e[k]=h;for(var p=e[h+n&d-1];--c;)f=f+1&d-1,h=e[f],k=k+h&d-1,n=e[k],e[f]=n,e[k]=h,p=p*d+e[h+n&d-1];g.i=f;g.j=k;return p};g.g(d)}function n(c,d,e,f,g){e=[];g=typeof c;if(d&&"object"==g)for(f in c)if(5>f.indexOf("S"))try{e.push(n(c[f],
d-1))}catch(h){}return e.length?e:c+("string"!=g?"\x00":"")}function q(c,e,f,g){c+="";for(g=f=0;g<c.length;g++){var h=g&d-1,k=(f^=19*e[g&d-1])+c.charCodeAt(g);e[h]=k&d-1}c="";for(g in e)c+=String.fromCharCode(e[g]);return c}e.seedrandom=function(r,s){var t=[],v;r=q(n(s?[r,c]:arguments.length?r:[(new Date).getTime(),c,window],3),t);v=new p(t);q(v.S,c);e.random=function(){for(var c=v.g(f),e=k,n=0;c<g;)c=(c+n)*d,e*=d,n=v.g(1);for(;c>=h;)c/=2,e/=2,n>>>=1;return(c+n)/e};return r};k=e.pow(d,f);g=e.pow(2,
g);h=2*g;q(e.random(),c)})([],numeric.seedrandom,256,6,52);
(function(c){function e(c){if("object"!==typeof c)return c;var d=[],f,g=c.length;for(f=0;f<g;f++)d[f+1]=e(c[f]);return d}function d(c){if("object"!==typeof c)return c;var e=[],f,g=c.length;for(f=1;f<g;f++)e[f-1]=d(c[f]);return e}function f(c,d,e){var f,g,h;for(d=1;d<=e;d+=1){c[d][d]=1/c[d][d];h=-c[d][d];for(f=1;f<d;f+=1)c[f][d]*=h;f=d+1;if(e<f)break;for(g=f;g<=e;g+=1)for(h=c[d][g],c[d][g]=0,f=1;f<=d;f+=1)c[f][g]+=h*c[f][d]}}function g(c,d,e,f){var g,h,k;for(g=1;g<=e;g+=1){k=0;for(d=1;d<g;d+=1)k+=
c[d][g]*f[d];f[g]=(f[g]-k)/c[g][g]}for(h=1;h<=e;h+=1)for(g=e+1-h,f[g]/=c[g][g],k=-f[g],d=1;d<g;d+=1)f[d]+=k*c[d][g]}function h(c,d,e,f){var g,h,k,u,x;for(g=1;g<=e;g+=1){f[1]=g;x=0;h=g-1;if(!(1>h))for(k=1;k<=h;k+=1){u=c[k][g];for(d=1;d<k;d+=1)u-=c[d][g]*c[d][k];u/=c[k][k];c[k][g]=u;x+=u*u}x=c[g][g]-x;if(0>=x)break;c[g][g]=Math.sqrt(x);f[1]=0}}function k(c,d,e,k,s,t,v,u,x,y,l,A,z,C,B,H){function G(){for(w=1;w<=k;w+=1){K=0;for(D=1;D<=k;D+=1)K+=c[D][w]*v[D][P];B[w]=K}I=S;for(w=1;w<=k;w+=1)B[I+w]=0;for(D=
z+1;D<=k;D+=1)for(w=1;w<=k;w+=1)B[I+w]+=c[w][D]*B[D];Z=!0;for(w=z;1<=w;w-=1){K=B[w];F=X+w*(w+3)/2;I=F-w;for(D=w+1;D<=z;D+=1)K-=B[F]*B[Q+D],F+=D;K/=B[I];B[Q+w]=K;if(A[w]<l)break;if(0>K)break;Z=!1;E=w}if(!Z)for(U=B[O+E]/B[Q+E],w=1;w<=z&&!(A[w]<l)&&!(0>B[Q+w]);w+=1)M=B[O+w]/B[Q+w],M<U&&(U=M,E=w);K=0;for(w=S+1;w<=S+k;w+=1)K+=B[w]*B[w];if(Math.abs(K)<=Y){if(Z)return H[1]=1,999;for(w=1;w<=z;w+=1)B[O+w]-=U*B[Q+w];B[O+z+1]+=U;return 700}K=0;for(w=1;w<=k;w+=1)K+=B[S+w]*v[w][P];R=-B[W+P]/K;aa=!0;!Z&&U<R&&(R=
U,aa=!1);for(w=1;w<=k;w+=1)s[w]+=R*B[S+w],Math.abs(s[w])<Y&&(s[w]=0);t[1]+=R*K*(R/2+B[O+z+1]);for(w=1;w<=z;w+=1)B[O+w]-=R*B[Q+w];B[O+z+1]+=R;if(aa){z+=1;A[z]=P;F=X+(z-1)*z/2+1;for(w=1;w<=z-1;w+=1)B[F]=B[w],F+=1;if(z===k)B[F]=B[k];else{for(w=k;w>=z+1&&0!==B[w];w-=1){N=Math.max(Math.abs(B[w-1]),Math.abs(B[w]));V=Math.min(Math.abs(B[w-1]),Math.abs(B[w]));M=0<=B[w-1]?Math.abs(N*Math.sqrt(1+V*V/(N*N))):-Math.abs(N*Math.sqrt(1+V*V/(N*N)));N=B[w-1]/M;V=B[w]/M;if(1===N)break;if(0===N)for(B[w-1]=V*M,D=1;D<=
k;D+=1)M=c[D][w-1],c[D][w-1]=c[D][w],c[D][w]=M;else for(B[w-1]=M,$=V/(1+N),D=1;D<=k;D+=1)M=N*c[D][w-1]+V*c[D][w],c[D][w]=$*(c[D][w-1]+M)-c[D][w],c[D][w-1]=M}B[F]=B[z]}}else{K=-u[P];for(D=1;D<=k;D+=1)K+=s[D]*v[D][P];if(P>l)B[W+P]=K;else if(B[W+P]=-Math.abs(K),0<K){for(D=1;D<=k;D+=1)v[D][P]=-v[D][P];u[P]=-u[P]}return 700}return 0}function L(){F=X+E*(E+1)/2+1;I=F+E;if(0===B[I])return 798;N=Math.max(Math.abs(B[I-1]),Math.abs(B[I]));V=Math.min(Math.abs(B[I-1]),Math.abs(B[I]));M=0<=B[I-1]?Math.abs(N*Math.sqrt(1+
V*V/(N*N))):-Math.abs(N*Math.sqrt(1+V*V/(N*N)));N=B[I-1]/M;V=B[I]/M;if(1===N)return 798;if(0===N){for(w=E+1;w<=z;w+=1)M=B[I-1],B[I-1]=B[I],B[I]=M,I+=w;for(w=1;w<=k;w+=1)M=c[w][E],c[w][E]=c[w][E+1],c[w][E+1]=M}else{$=V/(1+N);for(w=E+1;w<=z;w+=1)M=N*B[I-1]+V*B[I],B[I]=$*(B[I-1]+M)-B[I],B[I-1]=M,I+=w;for(w=1;w<=k;w+=1)M=N*c[w][E]+V*c[w][E+1],c[w][E+1]=$*(c[w][E]+M)-c[w][E+1],c[w][E]=M}return 0}var w,D,F,I,J,E,S,Q,X,W,O,P,M,K,U,R,N,V,$,Z,aa,Y,ba;x=Math.min(k,y);F=2*k+x*(x+5)/2+2*y+1;Y=1E-60;do Y+=Y,J=
1+.1*Y,ba=1+.2*Y;while(1>=J||1>=ba);for(w=1;w<=k;w+=1)B[w]=d[w];for(w=k+1;w<=F;w+=1)B[w]=0;for(w=1;w<=y;w+=1)A[w]=0;J=[];if(0===H[1]){h(c,e,k,J);if(0!==J[1]){H[1]=2;return}g(c,e,k,d);f(c,e,k)}else{for(D=1;D<=k;D+=1)for(s[D]=0,w=1;w<=D;w+=1)s[D]+=c[w][D]*d[w];for(D=1;D<=k;D+=1)for(d[D]=0,w=D;w<=k;w+=1)d[D]+=c[D][w]*s[w]}t[1]=0;for(D=1;D<=k;D+=1)for(s[D]=d[D],t[1]+=B[D]*s[D],B[D]=0,w=D+1;w<=k;w+=1)c[w][D]=0;t[1]=-t[1]/2;H[1]=0;S=k;Q=S+k;O=Q+x;X=O+x+1;W=X+x*(x+1)/2;d=W+y;for(w=1;w<=y;w+=1){K=0;for(D=
1;D<=k;D+=1)K+=v[D][w]*v[D][w];B[d+w]=Math.sqrt(K)}z=0;C[1]=0;for(e=C[2]=0;;){C[1]+=1;F=W;for(w=1;w<=y;w+=1){F+=1;K=-u[w];for(D=1;D<=k;D+=1)K+=v[D][w]*s[D];Math.abs(K)<Y&&(K=0);if(w>l)B[F]=K;else if(B[F]=-Math.abs(K),0<K){for(D=1;D<=k;D+=1)v[D][w]=-v[D][w];u[w]=-u[w]}}for(w=1;w<=z;w+=1)B[W+A[w]]=0;M=P=0;for(w=1;w<=y;w+=1)B[W+w]<M*B[d+w]&&(P=w,M=B[W+w]/B[d+w]);e=0===P?999:0;if(999===e)break;for(;;){e=G();if(0===e)break;if(999===e)return;if(700===e){if(E!==z)for(;;){L();I=F-E;for(w=1;w<=E;w+=1)B[I]=
B[F],F+=1,I+=1;B[O+E]=B[O+E+1];A[E]=A[E+1];E+=1;e=E<z?797:0;if(797!==e)break}B[O+z]=B[O+z+1];B[O+z+1]=0;A[z]=0;z-=1;C[2]+=1}}}}c.solveQP=function(c,f,g,h,s,t){c=e(c);f=e(f);g=e(g);var v,u,x,y,l=[],A=[],z=[],C=[],B=[];s=s||0;t=t?e(t):[void 0,0];h=h?e(h):[];u=c.length-1;x=g[1].length-1;if(!h)for(v=1;v<=x;v+=1)h[v]=0;for(v=1;v<=x;v+=1)A[v]=0;y=Math.min(u,x);for(v=1;v<=u;v+=1)z[v]=0;l[1]=0;for(v=1;v<=2*u+y*(y+5)/2+2*x+1;v+=1)C[v]=0;for(v=1;2>=v;v+=1)B[v]=0;k(c,f,u,u,z,l,g,h,u,x,s,A,0,B,C,t);c="";1===
t[1]&&(c="constraints are inconsistent, no solution!");2===t[1]&&(c="matrix D in quadratic function is not positive definite!");return{solution:d(z),value:d(l),unconstrained_solution:d(f),iterations:d(B),iact:d(A),message:c}}})(numeric);
numeric.svd=function(c){function e(c,d){c=Math.abs(c);d=Math.abs(d);return c>d?c*Math.sqrt(1+d*d/c/c):0==d?c:d*Math.sqrt(1+c*c/d/d)}var d;d=numeric.epsilon;var f=1E-64/d,g=0,h=0,k=0,p=0,n=0;c=numeric.clone(c);var q=c.length,r=c[0].length;if(q<r)throw"Need more rows than columns";for(var s=Array(r),t=Array(r),h=0;h<r;h++)s[h]=t[h]=0;for(var v=numeric.rep([r,r],0),u=0,x=0,y=0,l=0,A=0,z=0,C=0,h=0;h<r;h++){s[h]=x;C=0;n=h+1;for(k=h;k<q;k++)C+=c[k][h]*c[k][h];if(C<=f)x=0;else for(u=c[h][h],x=Math.sqrt(C),
0<=u&&(x=-x),y=u*x-C,c[h][h]=u-x,k=n;k<r;k++){C=0;for(p=h;p<q;p++)C+=c[p][h]*c[p][k];u=C/y;for(p=h;p<q;p++)c[p][k]+=u*c[p][h]}t[h]=x;C=0;for(k=n;k<r;k++)C+=c[h][k]*c[h][k];if(C<=f)x=0;else{u=c[h][h+1];x=Math.sqrt(C);0<=u&&(x=-x);y=u*x-C;c[h][h+1]=u-x;for(k=n;k<r;k++)s[k]=c[h][k]/y;for(k=n;k<q;k++){C=0;for(p=n;p<r;p++)C+=c[k][p]*c[h][p];for(p=n;p<r;p++)c[k][p]+=C*s[p]}}A=Math.abs(t[h])+Math.abs(s[h]);A>l&&(l=A)}for(h=r-1;-1!=h;h+=-1){if(0!=x){y=x*c[h][h+1];for(k=n;k<r;k++)v[k][h]=c[h][k]/y;for(k=n;k<
r;k++){C=0;for(p=n;p<r;p++)C+=c[h][p]*v[p][k];for(p=n;p<r;p++)v[p][k]+=C*v[p][h]}}for(k=n;k<r;k++)v[h][k]=0,v[k][h]=0;v[h][h]=1;x=s[h];n=h}for(h=r-1;-1!=h;h+=-1){n=h+1;x=t[h];for(k=n;k<r;k++)c[h][k]=0;if(0!=x){y=c[h][h]*x;for(k=n;k<r;k++){C=0;for(p=n;p<q;p++)C+=c[p][h]*c[p][k];u=C/y;for(p=h;p<q;p++)c[p][k]+=u*c[p][h]}for(k=h;k<q;k++)c[k][h]/=x}else for(k=h;k<q;k++)c[k][h]=0;c[h][h]+=1}d*=l;for(p=r-1;-1!=p;p+=-1)for(f=0;50>f;f++){h=!1;for(n=p;-1!=n;n+=-1){if(Math.abs(s[n])<=d){h=!0;break}if(Math.abs(t[n-
1])<=d)break}if(!h)for(g=0,C=1,l=n-1,h=n;h<p+1;h++){u=C*s[h];s[h]*=g;if(Math.abs(u)<=d)break;x=t[h];y=e(u,x);t[h]=y;g=x/y;C=-u/y;for(k=0;k<q;k++)A=c[k][l],z=c[k][h],c[k][l]=A*g+z*C,c[k][h]=-A*C+z*g}z=t[p];if(n==p){if(0>z)for(t[p]=-z,k=0;k<r;k++)v[k][p]=-v[k][p];break}if(49<=f)throw"Error: no convergence.";l=t[n];A=t[p-1];x=s[p-1];y=s[p];u=((A-z)*(A+z)+(x-y)*(x+y))/(2*y*A);x=e(u,1);u=0>u?((l-z)*(l+z)+y*(A/(u-x)-y))/l:((l-z)*(l+z)+y*(A/(u+x)-y))/l;C=g=1;for(h=n+1;h<p+1;h++){x=s[h];A=t[h];y=C*x;x*=g;
z=e(u,y);s[h-1]=z;g=u/z;C=y/z;u=l*g+x*C;x=-l*C+x*g;y=A*C;A*=g;for(k=0;k<r;k++)l=v[k][h-1],z=v[k][h],v[k][h-1]=l*g+z*C,v[k][h]=-l*C+z*g;z=e(u,y);t[h-1]=z;g=u/z;C=y/z;u=g*x+C*A;l=-C*x+g*A;for(k=0;k<q;k++)A=c[k][h-1],z=c[k][h],c[k][h-1]=A*g+z*C,c[k][h]=-A*C+z*g}s[n]=0;s[p]=u;t[p]=l}for(h=0;h<t.length;h++)t[h]<d&&(t[h]=0);for(h=0;h<r;h++)for(k=h-1;0<=k;k--)if(t[k]<t[h]){g=t[k];t[k]=t[h];t[h]=g;for(p=0;p<c.length;p++)d=c[p][h],c[p][h]=c[p][k],c[p][k]=d;for(p=0;p<v.length;p++)d=v[p][h],v[p][h]=v[p][k],
v[p][k]=d;h=k}return{U:c,S:t,V:v}};(function(){function c(c,d,e){l.biginteger_used=1;null!=c&&("number"==typeof c&&"undefined"==typeof d?this.fromInt(c):"number"==typeof c?this.fromNumber(c,d,e):null==d&&"string"!=typeof c?this.fromString(c,256):this.fromString(c,d))}function e(){return new c(null)}function d(c,d,e,f,g,h){for(;0<=--h;){var k=d*this[c++]+e[f]+g;g=Math.floor(k/67108864);e[f++]=k&67108863}return g}function f(c,d,e,f,g,h){var k=d&32767;for(d>>=15;0<=--h;){var l=this[c]&32767,n=this[c++]>>15,p=d*l+n*k,l=k*l+((p&32767)<<
15)+e[f]+(g&1073741823);g=(l>>>30)+(p>>>15)+d*n+(g>>>30);e[f++]=l&1073741823}return g}function g(c,d,e,f,g,h){var k=d&16383;for(d>>=14;0<=--h;){var l=this[c]&16383,n=this[c++]>>14,p=d*l+n*k,l=k*l+((p&16383)<<14)+e[f]+g;g=(l>>28)+(p>>14)+d*n;e[f++]=l&268435455}return g}function h(c,d){var e=F[c.charCodeAt(d)];return null==e?-1:e}function k(c){var d=e();d.fromInt(c);return d}function p(c){var d=1,e;0!=(e=c>>>16)&&(c=e,d+=16);0!=(e=c>>8)&&(c=e,d+=8);0!=(e=c>>4)&&(c=e,d+=4);0!=(e=c>>2)&&(c=e,d+=2);0!=
c>>1&&(d+=1);return d}function n(c){this.m=c}function q(c){this.m=c;this.mp=c.invDigit();this.mpl=this.mp&32767;this.mph=this.mp>>15;this.um=(1<<c.DB-15)-1;this.mt2=2*c.t}function r(c,d){return c&d}function s(c,d){return c|d}function t(c,d){return c^d}function v(c,d){return c&~d}function u(){}function x(c){return c}function y(d){this.r2=e();this.q3=e();c.ONE.dlShiftTo(2*d.t,this.r2);this.mu=this.r2.divide(d);this.m=d}var l={},A=!1;"undefined"!==typeof module&&module.exports?(module.exports=l,A=!0):
"undefined"!==typeof document?window.ClipperLib=l:self.ClipperLib=l;var z;if(A)C="chrome",z="Netscape";else{var C=navigator.userAgent.toString().toLowerCase();z=navigator.appName}var B,H,G,L,w,D;B=-1!=C.indexOf("chrome")&&-1==C.indexOf("chromium")?1:0;A=-1!=C.indexOf("chromium")?1:0;H=-1!=C.indexOf("safari")&&-1==C.indexOf("chrome")&&-1==C.indexOf("chromium")?1:0;G=-1!=C.indexOf("firefox")?1:0;C.indexOf("firefox/17");C.indexOf("firefox/15");C.indexOf("firefox/3");L=-1!=C.indexOf("opera")?1:0;C.indexOf("msie 10");
C.indexOf("msie 9");w=-1!=C.indexOf("msie 8")?1:0;D=-1!=C.indexOf("msie 7")?1:0;C=-1!=C.indexOf("msie ")?1:0;l.biginteger_used=null;"Microsoft Internet Explorer"==z?(c.prototype.am=f,z=30):"Netscape"!=z?(c.prototype.am=d,z=26):(c.prototype.am=g,z=28);c.prototype.DB=z;c.prototype.DM=(1<<z)-1;c.prototype.DV=1<<z;c.prototype.FV=Math.pow(2,52);c.prototype.F1=52-z;c.prototype.F2=2*z-52;var F=[],I;z=48;for(I=0;9>=I;++I)F[z++]=I;z=97;for(I=10;36>I;++I)F[z++]=I;z=65;for(I=10;36>I;++I)F[z++]=I;n.prototype.convert=
function(c){return 0>c.s||0<=c.compareTo(this.m)?c.mod(this.m):c};n.prototype.revert=function(c){return c};n.prototype.reduce=function(c){c.divRemTo(this.m,null,c)};n.prototype.mulTo=function(c,d,e){c.multiplyTo(d,e);this.reduce(e)};n.prototype.sqrTo=function(c,d){c.squareTo(d);this.reduce(d)};q.prototype.convert=function(d){var f=e();d.abs().dlShiftTo(this.m.t,f);f.divRemTo(this.m,null,f);0>d.s&&0<f.compareTo(c.ZERO)&&this.m.subTo(f,f);return f};q.prototype.revert=function(c){var d=e();c.copyTo(d);
this.reduce(d);return d};q.prototype.reduce=function(c){for(;c.t<=this.mt2;)c[c.t++]=0;for(var d=0;d<this.m.t;++d){var e=c[d]&32767,f=e*this.mpl+((e*this.mph+(c[d]>>15)*this.mpl&this.um)<<15)&c.DM,e=d+this.m.t;for(c[e]+=this.m.am(0,f,c,d,0,this.m.t);c[e]>=c.DV;)c[e]-=c.DV,c[++e]++}c.clamp();c.drShiftTo(this.m.t,c);0<=c.compareTo(this.m)&&c.subTo(this.m,c)};q.prototype.mulTo=function(c,d,e){c.multiplyTo(d,e);this.reduce(e)};q.prototype.sqrTo=function(c,d){c.squareTo(d);this.reduce(d)};c.prototype.copyTo=
function(c){for(var d=this.t-1;0<=d;--d)c[d]=this[d];c.t=this.t;c.s=this.s};c.prototype.fromInt=function(c){this.t=1;this.s=0>c?-1:0;0<c?this[0]=c:-1>c?this[0]=c+this.DV:this.t=0};c.prototype.fromString=function(d,e){var f;if(16==e)f=4;else if(8==e)f=3;else if(256==e)f=8;else if(2==e)f=1;else if(32==e)f=5;else if(4==e)f=2;else{this.fromRadix(d,e);return}this.s=this.t=0;for(var g=d.length,k=!1,l=0;0<=--g;){var n=8==f?d[g]&255:h(d,g);0>n?"-"==d.charAt(g)&&(k=!0):(k=!1,0==l?this[this.t++]=n:l+f>this.DB?
(this[this.t-1]|=(n&(1<<this.DB-l)-1)<<l,this[this.t++]=n>>this.DB-l):this[this.t-1]|=n<<l,l+=f,l>=this.DB&&(l-=this.DB))}8==f&&0!=(d[0]&128)&&(this.s=-1,0<l&&(this[this.t-1]|=(1<<this.DB-l)-1<<l));this.clamp();k&&c.ZERO.subTo(this,this)};c.prototype.clamp=function(){for(var c=this.s&this.DM;0<this.t&&this[this.t-1]==c;)--this.t};c.prototype.dlShiftTo=function(c,d){var e;for(e=this.t-1;0<=e;--e)d[e+c]=this[e];for(e=c-1;0<=e;--e)d[e]=0;d.t=this.t+c;d.s=this.s};c.prototype.drShiftTo=function(c,d){for(var e=
c;e<this.t;++e)d[e-c]=this[e];d.t=Math.max(this.t-c,0);d.s=this.s};c.prototype.lShiftTo=function(c,d){var e=c%this.DB,f=this.DB-e,g=(1<<f)-1,h=Math.floor(c/this.DB),k=this.s<<e&this.DM,l;for(l=this.t-1;0<=l;--l)d[l+h+1]=this[l]>>f|k,k=(this[l]&g)<<e;for(l=h-1;0<=l;--l)d[l]=0;d[h]=k;d.t=this.t+h+1;d.s=this.s;d.clamp()};c.prototype.rShiftTo=function(c,d){d.s=this.s;var e=Math.floor(c/this.DB);if(e>=this.t)d.t=0;else{var f=c%this.DB,g=this.DB-f,h=(1<<f)-1;d[0]=this[e]>>f;for(var k=e+1;k<this.t;++k)d[k-
e-1]|=(this[k]&h)<<g,d[k-e]=this[k]>>f;0<f&&(d[this.t-e-1]|=(this.s&h)<<g);d.t=this.t-e;d.clamp()}};c.prototype.subTo=function(c,d){for(var e=0,f=0,g=Math.min(c.t,this.t);e<g;)f+=this[e]-c[e],d[e++]=f&this.DM,f>>=this.DB;if(c.t<this.t){for(f-=c.s;e<this.t;)f+=this[e],d[e++]=f&this.DM,f>>=this.DB;f+=this.s}else{for(f+=this.s;e<c.t;)f-=c[e],d[e++]=f&this.DM,f>>=this.DB;f-=c.s}d.s=0>f?-1:0;-1>f?d[e++]=this.DV+f:0<f&&(d[e++]=f);d.t=e;d.clamp()};c.prototype.multiplyTo=function(d,e){var f=this.abs(),g=
d.abs(),h=f.t;for(e.t=h+g.t;0<=--h;)e[h]=0;for(h=0;h<g.t;++h)e[h+f.t]=f.am(0,g[h],e,h,0,f.t);e.s=0;e.clamp();this.s!=d.s&&c.ZERO.subTo(e,e)};c.prototype.squareTo=function(c){for(var d=this.abs(),e=c.t=2*d.t;0<=--e;)c[e]=0;for(e=0;e<d.t-1;++e){var f=d.am(e,d[e],c,2*e,0,1);(c[e+d.t]+=d.am(e+1,2*d[e],c,2*e+1,f,d.t-e-1))>=d.DV&&(c[e+d.t]-=d.DV,c[e+d.t+1]=1)}0<c.t&&(c[c.t-1]+=d.am(e,d[e],c,2*e,0,1));c.s=0;c.clamp()};c.prototype.divRemTo=function(d,f,g){var h=d.abs();if(!(0>=h.t)){var k=this.abs();if(k.t<
h.t)null!=f&&f.fromInt(0),null!=g&&this.copyTo(g);else{null==g&&(g=e());var l=e(),n=this.s;d=d.s;var q=this.DB-p(h[h.t-1]);0<q?(h.lShiftTo(q,l),k.lShiftTo(q,g)):(h.copyTo(l),k.copyTo(g));h=l.t;k=l[h-1];if(0!=k){var r=k*(1<<this.F1)+(1<h?l[h-2]>>this.F2:0),s=this.FV/r,r=(1<<this.F1)/r,t=1<<this.F2,u=g.t,v=u-h,w=null==f?e():f;l.dlShiftTo(v,w);0<=g.compareTo(w)&&(g[g.t++]=1,g.subTo(w,g));c.ONE.dlShiftTo(h,w);for(w.subTo(l,l);l.t<h;)l[l.t++]=0;for(;0<=--v;){var x=g[--u]==k?this.DM:Math.floor(g[u]*s+(g[u-
1]+t)*r);if((g[u]+=l.am(0,x,g,v,0,h))<x)for(l.dlShiftTo(v,w),g.subTo(w,g);g[u]<--x;)g.subTo(w,g)}null!=f&&(g.drShiftTo(h,f),n!=d&&c.ZERO.subTo(f,f));g.t=h;g.clamp();0<q&&g.rShiftTo(q,g);0>n&&c.ZERO.subTo(g,g)}}}};c.prototype.invDigit=function(){if(1>this.t)return 0;var c=this[0];if(0==(c&1))return 0;var d=c&3,d=d*(2-(c&15)*d)&15,d=d*(2-(c&255)*d)&255,d=d*(2-((c&65535)*d&65535))&65535,d=d*(2-c*d%this.DV)%this.DV;return 0<d?this.DV-d:-d};c.prototype.isEven=function(){return 0==(0<this.t?this[0]&1:this.s)};
c.prototype.exp=function(d,f){if(4294967295<d||1>d)return c.ONE;var g=e(),h=e(),k=f.convert(this),l=p(d)-1;for(k.copyTo(g);0<=--l;)if(f.sqrTo(g,h),0<(d&1<<l))f.mulTo(h,k,g);else var n=g,g=h,h=n;return f.revert(g)};c.prototype.toString=function(c){if(0>this.s)return"-"+this.negate().toString(c);if(16==c)c=4;else if(8==c)c=3;else if(2==c)c=1;else if(32==c)c=5;else if(4==c)c=2;else return this.toRadix(c);var d=(1<<c)-1,e,f=!1,g="",h=this.t,k=this.DB-h*this.DB%c;if(0<h--)for(k<this.DB&&0<(e=this[h]>>
k)&&(f=!0,g="0123456789abcdefghijklmnopqrstuvwxyz".charAt(e));0<=h;)k<c?(e=(this[h]&(1<<k)-1)<<c-k,e|=this[--h]>>(k+=this.DB-c)):(e=this[h]>>(k-=c)&d,0>=k&&(k+=this.DB,--h)),0<e&&(f=!0),f&&(g+="0123456789abcdefghijklmnopqrstuvwxyz".charAt(e));return f?g:"0"};c.prototype.negate=function(){var d=e();c.ZERO.subTo(this,d);return d};c.prototype.abs=function(){return 0>this.s?this.negate():this};c.prototype.compareTo=function(c){var d=this.s-c.s;if(0!=d)return d;var e=this.t,d=e-c.t;if(0!=d)return 0>this.s?
-d:d;for(;0<=--e;)if(0!=(d=this[e]-c[e]))return d;return 0};c.prototype.bitLength=function(){return 0>=this.t?0:this.DB*(this.t-1)+p(this[this.t-1]^this.s&this.DM)};c.prototype.mod=function(d){var f=e();this.abs().divRemTo(d,null,f);0>this.s&&0<f.compareTo(c.ZERO)&&d.subTo(f,f);return f};c.prototype.modPowInt=function(c,d){var e;e=256>c||d.isEven()?new n(d):new q(d);return this.exp(c,e)};c.ZERO=k(0);c.ONE=k(1);u.prototype.convert=x;u.prototype.revert=x;u.prototype.mulTo=function(c,d,e){c.multiplyTo(d,
e)};u.prototype.sqrTo=function(c,d){c.squareTo(d)};y.prototype.convert=function(c){if(0>c.s||c.t>2*this.m.t)return c.mod(this.m);if(0>c.compareTo(this.m))return c;var d=e();c.copyTo(d);this.reduce(d);return d};y.prototype.revert=function(c){return c};y.prototype.reduce=function(c){c.drShiftTo(this.m.t-1,this.r2);c.t>this.m.t+1&&(c.t=this.m.t+1,c.clamp());this.mu.multiplyUpperTo(this.r2,this.m.t+1,this.q3);for(this.m.multiplyLowerTo(this.q3,this.m.t+1,this.r2);0>c.compareTo(this.r2);)c.dAddOffset(1,
this.m.t+1);for(c.subTo(this.r2,c);0<=c.compareTo(this.m);)c.subTo(this.m,c)};y.prototype.mulTo=function(c,d,e){c.multiplyTo(d,e);this.reduce(e)};y.prototype.sqrTo=function(c,d){c.squareTo(d);this.reduce(d)};var J=[2,3,5,7,11,13,17,19,23,29,31,37,41,43,47,53,59,61,67,71,73,79,83,89,97,101,103,107,109,113,127,131,137,139,149,151,157,163,167,173,179,181,191,193,197,199,211,223,227,229,233,239,241,251,257,263,269,271,277,281,283,293,307,311,313,317,331,337,347,349,353,359,367,373,379,383,389,397,401,
409,419,421,431,433,439,443,449,457,461,463,467,479,487,491,499,503,509,521,523,541,547,557,563,569,571,577,587,593,599,601,607,613,617,619,631,641,643,647,653,659,661,673,677,683,691,701,709,719,727,733,739,743,751,757,761,769,773,787,797,809,811,821,823,827,829,839,853,857,859,863,877,881,883,887,907,911,919,929,937,941,947,953,967,971,977,983,991,997],E=67108864/J[J.length-1];c.prototype.chunkSize=function(c){return Math.floor(Math.LN2*this.DB/Math.log(c))};c.prototype.toRadix=function(c){null==
c&&(c=10);if(0==this.signum()||2>c||36<c)return"0";var d=this.chunkSize(c),d=Math.pow(c,d),f=k(d),g=e(),h=e(),l="";for(this.divRemTo(f,g,h);0<g.signum();)l=(d+h.intValue()).toString(c).substr(1)+l,g.divRemTo(f,g,h);return h.intValue().toString(c)+l};c.prototype.fromRadix=function(d,e){this.fromInt(0);null==e&&(e=10);for(var f=this.chunkSize(e),g=Math.pow(e,f),k=!1,l=0,n=0,p=0;p<d.length;++p){var q=h(d,p);0>q?"-"==d.charAt(p)&&0==this.signum()&&(k=!0):(n=e*n+q,++l>=f&&(this.dMultiply(g),this.dAddOffset(n,
0),n=l=0))}0<l&&(this.dMultiply(Math.pow(e,l)),this.dAddOffset(n,0));k&&c.ZERO.subTo(this,this)};c.prototype.fromNumber=function(d,e,f){if("number"==typeof e)if(2>d)this.fromInt(1);else for(this.fromNumber(d,f),this.testBit(d-1)||this.bitwiseTo(c.ONE.shiftLeft(d-1),s,this),this.isEven()&&this.dAddOffset(1,0);!this.isProbablePrime(e);)this.dAddOffset(2,0),this.bitLength()>d&&this.subTo(c.ONE.shiftLeft(d-1),this);else{f=[];var g=d&7;f.length=(d>>3)+1;e.nextBytes(f);f[0]=0<g?f[0]&(1<<g)-1:0;this.fromString(f,
256)}};c.prototype.bitwiseTo=function(c,d,e){var f,g,h=Math.min(c.t,this.t);for(f=0;f<h;++f)e[f]=d(this[f],c[f]);if(c.t<this.t){g=c.s&this.DM;for(f=h;f<this.t;++f)e[f]=d(this[f],g);e.t=this.t}else{g=this.s&this.DM;for(f=h;f<c.t;++f)e[f]=d(g,c[f]);e.t=c.t}e.s=d(this.s,c.s);e.clamp()};c.prototype.changeBit=function(d,e){var f=c.ONE.shiftLeft(d);this.bitwiseTo(f,e,f);return f};c.prototype.addTo=function(c,d){for(var e=0,f=0,g=Math.min(c.t,this.t);e<g;)f+=this[e]+c[e],d[e++]=f&this.DM,f>>=this.DB;if(c.t<
this.t){for(f+=c.s;e<this.t;)f+=this[e],d[e++]=f&this.DM,f>>=this.DB;f+=this.s}else{for(f+=this.s;e<c.t;)f+=c[e],d[e++]=f&this.DM,f>>=this.DB;f+=c.s}d.s=0>f?-1:0;0<f?d[e++]=f:-1>f&&(d[e++]=this.DV+f);d.t=e;d.clamp()};c.prototype.dMultiply=function(c){this[this.t]=this.am(0,c-1,this,0,0,this.t);++this.t;this.clamp()};c.prototype.dAddOffset=function(c,d){if(0!=c){for(;this.t<=d;)this[this.t++]=0;for(this[d]+=c;this[d]>=this.DV;)this[d]-=this.DV,++d>=this.t&&(this[this.t++]=0),++this[d]}};c.prototype.multiplyLowerTo=
function(c,d,e){var f=Math.min(this.t+c.t,d);e.s=0;for(e.t=f;0<f;)e[--f]=0;var g;for(g=e.t-this.t;f<g;++f)e[f+this.t]=this.am(0,c[f],e,f,0,this.t);for(g=Math.min(c.t,d);f<g;++f)this.am(0,c[f],e,f,0,d-f);e.clamp()};c.prototype.multiplyUpperTo=function(c,d,e){--d;var f=e.t=this.t+c.t-d;for(e.s=0;0<=--f;)e[f]=0;for(f=Math.max(d-this.t,0);f<c.t;++f)e[this.t+f-d]=this.am(d-f,c[f],e,0,0,this.t+f-d);e.clamp();e.drShiftTo(1,e)};c.prototype.modInt=function(c){if(0>=c)return 0;var d=this.DV%c,e=0>this.s?c-
1:0;if(0<this.t)if(0==d)e=this[0]%c;else for(var f=this.t-1;0<=f;--f)e=(d*e+this[f])%c;return e};c.prototype.millerRabin=function(d){var f=this.subtract(c.ONE),g=f.getLowestSetBit();if(0>=g)return!1;var h=f.shiftRight(g);d=d+1>>1;d>J.length&&(d=J.length);for(var k=e(),l=0;l<d;++l){k.fromInt(J[Math.floor(Math.random()*J.length)]);var n=k.modPow(h,this);if(0!=n.compareTo(c.ONE)&&0!=n.compareTo(f)){for(var p=1;p++<g&&0!=n.compareTo(f);)if(n=n.modPowInt(2,this),0==n.compareTo(c.ONE))return!1;if(0!=n.compareTo(f))return!1}}return!0};
c.prototype.clone=function(){var c=e();this.copyTo(c);return c};c.prototype.intValue=function(){if(0>this.s){if(1==this.t)return this[0]-this.DV;if(0==this.t)return-1}else{if(1==this.t)return this[0];if(0==this.t)return 0}return(this[1]&(1<<32-this.DB)-1)<<this.DB|this[0]};c.prototype.byteValue=function(){return 0==this.t?this.s:this[0]<<24>>24};c.prototype.shortValue=function(){return 0==this.t?this.s:this[0]<<16>>16};c.prototype.signum=function(){return 0>this.s?-1:0>=this.t||1==this.t&&0>=this[0]?
0:1};c.prototype.toByteArray=function(){var c=this.t,d=[];d[0]=this.s;var e=this.DB-c*this.DB%8,f,g=0;if(0<c--)for(e<this.DB&&(f=this[c]>>e)!=(this.s&this.DM)>>e&&(d[g++]=f|this.s<<this.DB-e);0<=c;)if(8>e?(f=(this[c]&(1<<e)-1)<<8-e,f|=this[--c]>>(e+=this.DB-8)):(f=this[c]>>(e-=8)&255,0>=e&&(e+=this.DB,--c)),0!=(f&128)&&(f|=-256),0==g&&(this.s&128)!=(f&128)&&++g,0<g||f!=this.s)d[g++]=f;return d};c.prototype.equals=function(c){return 0==this.compareTo(c)};c.prototype.min=function(c){return 0>this.compareTo(c)?
this:c};c.prototype.max=function(c){return 0<this.compareTo(c)?this:c};c.prototype.and=function(c){var d=e();this.bitwiseTo(c,r,d);return d};c.prototype.or=function(c){var d=e();this.bitwiseTo(c,s,d);return d};c.prototype.xor=function(c){var d=e();this.bitwiseTo(c,t,d);return d};c.prototype.andNot=function(c){var d=e();this.bitwiseTo(c,v,d);return d};c.prototype.not=function(){for(var c=e(),d=0;d<this.t;++d)c[d]=this.DM&~this[d];c.t=this.t;c.s=~this.s;return c};c.prototype.shiftLeft=function(c){var d=
e();0>c?this.rShiftTo(-c,d):this.lShiftTo(c,d);return d};c.prototype.shiftRight=function(c){var d=e();0>c?this.lShiftTo(-c,d):this.rShiftTo(c,d);return d};c.prototype.getLowestSetBit=function(){for(var c=0;c<this.t;++c)if(0!=this[c]){var d=c*this.DB,c=this[c];if(0==c)c=-1;else{var e=0;0==(c&65535)&&(c>>=16,e+=16);0==(c&255)&&(c>>=8,e+=8);0==(c&15)&&(c>>=4,e+=4);0==(c&3)&&(c>>=2,e+=2);0==(c&1)&&++e;c=e}return d+c}return 0>this.s?this.t*this.DB:-1};c.prototype.bitCount=function(){for(var c=0,d=this.s&
this.DM,e=0;e<this.t;++e){for(var f=this[e]^d,g=0;0!=f;)f&=f-1,++g;c+=g}return c};c.prototype.testBit=function(c){var d=Math.floor(c/this.DB);return d>=this.t?0!=this.s:0!=(this[d]&1<<c%this.DB)};c.prototype.setBit=function(c){return this.changeBit(c,s)};c.prototype.clearBit=function(c){return this.changeBit(c,v)};c.prototype.flipBit=function(c){return this.changeBit(c,t)};c.prototype.add=function(c){var d=e();this.addTo(c,d);return d};c.prototype.subtract=function(c){var d=e();this.subTo(c,d);return d};
c.prototype.multiply=function(c){var d=e();this.multiplyTo(c,d);return d};c.prototype.divide=function(c){var d=e();this.divRemTo(c,d,null);return d};c.prototype.remainder=function(c){var d=e();this.divRemTo(c,null,d);return d};c.prototype.divideAndRemainder=function(c){var d=e(),f=e();this.divRemTo(c,d,f);return[d,f]};c.prototype.modPow=function(c,d){var f=c.bitLength(),g,h=k(1),l;if(0>=f)return h;g=18>f?1:48>f?3:144>f?4:768>f?5:6;l=8>f?new n(d):d.isEven()?new y(d):new q(d);var r=[],s=3,t=g-1,u=(1<<
g)-1;r[1]=l.convert(this);if(1<g)for(f=e(),l.sqrTo(r[1],f);s<=u;)r[s]=e(),l.mulTo(f,r[s-2],r[s]),s+=2;for(var v=c.t-1,w,x=!0,z=e(),f=p(c[v])-1;0<=v;){f>=t?w=c[v]>>f-t&u:(w=(c[v]&(1<<f+1)-1)<<t-f,0<v&&(w|=c[v-1]>>this.DB+f-t));for(s=g;0==(w&1);)w>>=1,--s;0>(f-=s)&&(f+=this.DB,--v);if(x)r[w].copyTo(h),x=!1;else{for(;1<s;)l.sqrTo(h,z),l.sqrTo(z,h),s-=2;0<s?l.sqrTo(h,z):(s=h,h=z,z=s);l.mulTo(z,r[w],h)}for(;0<=v&&0==(c[v]&1<<f);)l.sqrTo(h,z),s=h,h=z,z=s,0>--f&&(f=this.DB-1,--v)}return l.revert(h)};c.prototype.modInverse=
function(d){var e=d.isEven();if(this.isEven()&&e||0==d.signum())return c.ZERO;for(var f=d.clone(),g=this.clone(),h=k(1),l=k(0),n=k(0),p=k(1);0!=f.signum();){for(;f.isEven();)f.rShiftTo(1,f),e?(h.isEven()&&l.isEven()||(h.addTo(this,h),l.subTo(d,l)),h.rShiftTo(1,h)):l.isEven()||l.subTo(d,l),l.rShiftTo(1,l);for(;g.isEven();)g.rShiftTo(1,g),e?(n.isEven()&&p.isEven()||(n.addTo(this,n),p.subTo(d,p)),n.rShiftTo(1,n)):p.isEven()||p.subTo(d,p),p.rShiftTo(1,p);0<=f.compareTo(g)?(f.subTo(g,f),e&&h.subTo(n,h),
l.subTo(p,l)):(g.subTo(f,g),e&&n.subTo(h,n),p.subTo(l,p))}if(0!=g.compareTo(c.ONE))return c.ZERO;if(0<=p.compareTo(d))return p.subtract(d);if(0>p.signum())p.addTo(d,p);else return p;return 0>p.signum()?p.add(d):p};c.prototype.pow=function(c){return this.exp(c,new u)};c.prototype.gcd=function(c){var d=0>this.s?this.negate():this.clone();c=0>c.s?c.negate():c.clone();if(0>d.compareTo(c)){var e=d,d=c;c=e}var e=d.getLowestSetBit(),f=c.getLowestSetBit();if(0>f)return d;e<f&&(f=e);for(0<f&&(d.rShiftTo(f,
d),c.rShiftTo(f,c));0<d.signum();)0<(e=d.getLowestSetBit())&&d.rShiftTo(e,d),0<(e=c.getLowestSetBit())&&c.rShiftTo(e,c),0<=d.compareTo(c)?(d.subTo(c,d),d.rShiftTo(1,d)):(c.subTo(d,c),c.rShiftTo(1,c));0<f&&c.lShiftTo(f,c);return c};c.prototype.isProbablePrime=function(c){var d,e=this.abs();if(1==e.t&&e[0]<=J[J.length-1]){for(d=0;d<J.length;++d)if(e[0]==J[d])return!0;return!1}if(e.isEven())return!1;for(d=1;d<J.length;){for(var f=J[d],g=d+1;g<J.length&&f<E;)f*=J[g++];for(f=e.modInt(f);d<g;)if(0==f%J[d++])return!1}return e.millerRabin(c)};
c.prototype.square=function(){var c=e();this.squareTo(c);return c};c.prototype.IsNegative=function(){return-1==this.compareTo(c.ZERO)?!0:!1};c.op_Equality=function(c,d){return 0==c.compareTo(d)?!0:!1};c.op_Inequality=function(c,d){return 0!=c.compareTo(d)?!0:!1};c.op_GreaterThan=function(c,d){return 0<c.compareTo(d)?!0:!1};c.op_LessThan=function(c,d){return 0>c.compareTo(d)?!0:!1};c.op_Addition=function(d,e){return(new c(d)).add(new c(e))};c.op_Subtraction=function(d,e){return(new c(d)).subtract(new c(e))};
c.Int128Mul=function(d,e){return(new c(d)).multiply(new c(e))};c.op_Division=function(c,d){return c.divide(d)};c.prototype.ToDouble=function(){return parseFloat(this.toString())};if("undefined"==typeof S)var S=function(c,d){var e;if("undefined"==typeof Object.getOwnPropertyNames)for(e in d.prototype){if("undefined"==typeof c.prototype[e]||c.prototype[e]==Object.prototype[e])c.prototype[e]=d.prototype[e]}else for(var f=Object.getOwnPropertyNames(d.prototype),g=0;g<f.length;g++)"undefined"==typeof Object.getOwnPropertyDescriptor(c.prototype,
f[g])&&Object.defineProperty(c.prototype,f[g],Object.getOwnPropertyDescriptor(d.prototype,f[g]));for(e in d)"undefined"==typeof c[e]&&(c[e]=d[e]);c.$baseCtor=d};l.Path=function(){return[]};l.Paths=function(){return[]};l.DoublePoint=function(){var c=arguments;this.Y=this.X=0;1==c.length?(this.X=c[0].X,this.Y=c[0].Y):2==c.length&&(this.X=c[0],this.Y=c[1])};l.DoublePoint0=function(){this.Y=this.X=0};l.DoublePoint1=function(c){this.X=c.X;this.Y=c.Y};l.DoublePoint2=function(c,d){this.X=c;this.Y=d};l.PolyNode=
function(){this.m_Parent=null;this.m_polygon=new l.Path;this.m_endtype=this.m_jointype=this.m_Index=0;this.m_Childs=[];this.IsOpen=!1};l.PolyNode.prototype.IsHoleNode=function(){for(var c=!0,d=this.m_Parent;null!==d;)c=!c,d=d.m_Parent;return c};l.PolyNode.prototype.ChildCount=function(){return this.m_Childs.length};l.PolyNode.prototype.Contour=function(){return this.m_polygon};l.PolyNode.prototype.AddChild=function(c){var d=this.m_Childs.length;this.m_Childs.push(c);c.m_Parent=this;c.m_Index=d};l.PolyNode.prototype.GetNext=
function(){return 0<this.m_Childs.length?this.m_Childs[0]:this.GetNextSiblingUp()};l.PolyNode.prototype.GetNextSiblingUp=function(){return null===this.m_Parent?null:this.m_Index==this.m_Parent.m_Childs.length-1?this.m_Parent.GetNextSiblingUp():this.m_Parent.m_Childs[this.m_Index+1]};l.PolyNode.prototype.Childs=function(){return this.m_Childs};l.PolyNode.prototype.Parent=function(){return this.m_Parent};l.PolyNode.prototype.IsHole=function(){return this.IsHoleNode()};l.PolyTree=function(){this.m_AllPolys=
[];l.PolyNode.call(this)};l.PolyTree.prototype.Clear=function(){for(var c=0,d=this.m_AllPolys.length;c<d;c++)this.m_AllPolys[c]=null;this.m_AllPolys.length=0;this.m_Childs.length=0};l.PolyTree.prototype.GetFirst=function(){return 0<this.m_Childs.length?this.m_Childs[0]:null};l.PolyTree.prototype.Total=function(){return this.m_AllPolys.length};S(l.PolyTree,l.PolyNode);l.Math_Abs_Int64=l.Math_Abs_Int32=l.Math_Abs_Double=function(c){return Math.abs(c)};l.Math_Max_Int32_Int32=function(c,d){return Math.max(c,
d)};l.Cast_Int32=C||L||H?function(c){return c|0}:function(c){return~~c};l.Cast_Int64=B?function(c){return-2147483648>c||2147483647<c?0>c?Math.ceil(c):Math.floor(c):~~c}:G&&"function"==typeof Number.toInteger?function(c){return Number.toInteger(c)}:D||w?function(c){return parseInt(c,10)}:C?function(c){return-2147483648>c||2147483647<c?0>c?Math.ceil(c):Math.floor(c):c|0}:function(c){return 0>c?Math.ceil(c):Math.floor(c)};l.Clear=function(c){c.length=0};l.PI=3.141592653589793;l.PI2=6.283185307179586;
l.IntPoint=function(){var c;c=arguments;var d=c.length;this.Y=this.X=0;2==d?(this.X=c[0],this.Y=c[1]):1==d?c[0]instanceof l.DoublePoint?(c=c[0],this.X=l.Clipper.Round(c.X),this.Y=l.Clipper.Round(c.Y)):(c=c[0],this.X=c.X,this.Y=c.Y):this.Y=this.X=0};l.IntPoint.op_Equality=function(c,d){return c.X==d.X&&c.Y==d.Y};l.IntPoint.op_Inequality=function(c,d){return c.X!=d.X||c.Y!=d.Y};l.IntPoint0=function(){this.Y=this.X=0};l.IntPoint1=function(c){this.X=c.X;this.Y=c.Y};l.IntPoint1dp=function(c){this.X=l.Clipper.Round(c.X);
this.Y=l.Clipper.Round(c.Y)};l.IntPoint2=function(c,d){this.X=c;this.Y=d};l.IntRect=function(){var c=arguments,d=c.length;4==d?(this.left=c[0],this.top=c[1],this.right=c[2],this.bottom=c[3]):1==d?(this.left=ir.left,this.top=ir.top,this.right=ir.right,this.bottom=ir.bottom):this.bottom=this.right=this.top=this.left=0};l.IntRect0=function(){this.bottom=this.right=this.top=this.left=0};l.IntRect1=function(c){this.left=c.left;this.top=c.top;this.right=c.right;this.bottom=c.bottom};l.IntRect4=function(c,
d,e,f){this.left=c;this.top=d;this.right=e;this.bottom=f};l.ClipType={ctIntersection:0,ctUnion:1,ctDifference:2,ctXor:3};l.PolyType={ptSubject:0,ptClip:1};l.PolyFillType={pftEvenOdd:0,pftNonZero:1,pftPositive:2,pftNegative:3};l.JoinType={jtSquare:0,jtRound:1,jtMiter:2};l.EndType={etOpenSquare:0,etOpenRound:1,etOpenButt:2,etClosedLine:3,etClosedPolygon:4};l.EdgeSide={esLeft:0,esRight:1};l.Direction={dRightToLeft:0,dLeftToRight:1};l.TEdge=function(){this.Bot=new l.IntPoint;this.Curr=new l.IntPoint;
this.Top=new l.IntPoint;this.Delta=new l.IntPoint;this.Dx=0;this.PolyTyp=l.PolyType.ptSubject;this.Side=l.EdgeSide.esLeft;this.OutIdx=this.WindCnt2=this.WindCnt=this.WindDelta=0;this.PrevInSEL=this.NextInSEL=this.PrevInAEL=this.NextInAEL=this.NextInLML=this.Prev=this.Next=null};l.IntersectNode=function(){this.Edge2=this.Edge1=null;this.Pt=new l.IntPoint};l.MyIntersectNodeSort=function(){};l.MyIntersectNodeSort.Compare=function(c,d){return d.Pt.Y-c.Pt.Y};l.LocalMinima=function(){this.Y=0;this.Next=
this.RightBound=this.LeftBound=null};l.Scanbeam=function(){this.Y=0;this.Next=null};l.OutRec=function(){this.Idx=0;this.IsOpen=this.IsHole=!1;this.PolyNode=this.BottomPt=this.Pts=this.FirstLeft=null};l.OutPt=function(){this.Idx=0;this.Pt=new l.IntPoint;this.Prev=this.Next=null};l.Join=function(){this.OutPt2=this.OutPt1=null;this.OffPt=new l.IntPoint};l.ClipperBase=function(){this.m_CurrentLM=this.m_MinimaList=null;this.m_edges=[];this.PreserveCollinear=this.m_HasOpenPaths=this.m_UseFullRange=!1;this.m_CurrentLM=
this.m_MinimaList=null;this.m_HasOpenPaths=this.m_UseFullRange=!1};l.ClipperBase.horizontal=-9007199254740992;l.ClipperBase.Skip=-2;l.ClipperBase.Unassigned=-1;l.ClipperBase.tolerance=1E-20;l.ClipperBase.loRange=47453132;l.ClipperBase.hiRange=0xfffffffffffff;l.ClipperBase.near_zero=function(c){return c>-l.ClipperBase.tolerance&&c<l.ClipperBase.tolerance};l.ClipperBase.IsHorizontal=function(c){return 0===c.Delta.Y};l.ClipperBase.prototype.PointIsVertex=function(c,d){var e=d;do{if(l.IntPoint.op_Equality(e.Pt,
c))return!0;e=e.Next}while(e!=d);return!1};l.ClipperBase.prototype.PointOnLineSegment=function(d,e,f,g){return g?d.X==e.X&&d.Y==e.Y||d.X==f.X&&d.Y==f.Y||d.X>e.X==d.X<f.X&&d.Y>e.Y==d.Y<f.Y&&c.op_Equality(c.Int128Mul(d.X-e.X,f.Y-e.Y),c.Int128Mul(f.X-e.X,d.Y-e.Y)):d.X==e.X&&d.Y==e.Y||d.X==f.X&&d.Y==f.Y||d.X>e.X==d.X<f.X&&d.Y>e.Y==d.Y<f.Y&&(d.X-e.X)*(f.Y-e.Y)==(f.X-e.X)*(d.Y-e.Y)};l.ClipperBase.prototype.PointOnPolygon=function(c,d,e){for(var f=d;;){if(this.PointOnLineSegment(c,f.Pt,f.Next.Pt,e))return!0;
f=f.Next;if(f==d)break}return!1};l.ClipperBase.prototype.SlopesEqual=l.ClipperBase.SlopesEqual=function(){var d=arguments,e=d.length,f,g,h;if(3==e)return e=d[0],f=d[1],d[2]?c.op_Equality(c.Int128Mul(e.Delta.Y,f.Delta.X),c.Int128Mul(e.Delta.X,f.Delta.Y)):l.Cast_Int64(e.Delta.Y*f.Delta.X)==l.Cast_Int64(e.Delta.X*f.Delta.Y);if(4==e)return e=d[0],f=d[1],g=d[2],d[3]?c.op_Equality(c.Int128Mul(e.Y-f.Y,f.X-g.X),c.Int128Mul(e.X-f.X,f.Y-g.Y)):0===l.Cast_Int64((e.Y-f.Y)*(f.X-g.X))-l.Cast_Int64((e.X-f.X)*(f.Y-
g.Y));e=d[0];f=d[1];g=d[2];h=d[3];return d[4]?c.op_Equality(c.Int128Mul(e.Y-f.Y,g.X-h.X),c.Int128Mul(e.X-f.X,g.Y-h.Y)):0===l.Cast_Int64((e.Y-f.Y)*(g.X-h.X))-l.Cast_Int64((e.X-f.X)*(g.Y-h.Y))};l.ClipperBase.SlopesEqual3=function(d,e,f){return f?c.op_Equality(c.Int128Mul(d.Delta.Y,e.Delta.X),c.Int128Mul(d.Delta.X,e.Delta.Y)):l.Cast_Int64(d.Delta.Y*e.Delta.X)==l.Cast_Int64(d.Delta.X*e.Delta.Y)};l.ClipperBase.SlopesEqual4=function(d,e,f,g){return g?c.op_Equality(c.Int128Mul(d.Y-e.Y,e.X-f.X),c.Int128Mul(d.X-
e.X,e.Y-f.Y)):0===l.Cast_Int64((d.Y-e.Y)*(e.X-f.X))-l.Cast_Int64((d.X-e.X)*(e.Y-f.Y))};l.ClipperBase.SlopesEqual5=function(d,e,f,g,h){return h?c.op_Equality(c.Int128Mul(d.Y-e.Y,f.X-g.X),c.Int128Mul(d.X-e.X,f.Y-g.Y)):0===l.Cast_Int64((d.Y-e.Y)*(f.X-g.X))-l.Cast_Int64((d.X-e.X)*(f.Y-g.Y))};l.ClipperBase.prototype.Clear=function(){this.DisposeLocalMinimaList();for(var c=0,d=this.m_edges.length;c<d;++c){for(var e=0,f=this.m_edges[c].length;e<f;++e)this.m_edges[c][e]=null;l.Clear(this.m_edges[c])}l.Clear(this.m_edges);
this.m_HasOpenPaths=this.m_UseFullRange=!1};l.ClipperBase.prototype.DisposeLocalMinimaList=function(){for(;null!==this.m_MinimaList;){var c=this.m_MinimaList.Next;this.m_MinimaList=null;this.m_MinimaList=c}this.m_CurrentLM=null};l.ClipperBase.prototype.RangeTest=function(c,d){if(d.Value)(c.X>l.ClipperBase.hiRange||c.Y>l.ClipperBase.hiRange||-c.X>l.ClipperBase.hiRange||-c.Y>l.ClipperBase.hiRange)&&l.Error("Coordinate outside allowed range in RangeTest().");else if(c.X>l.ClipperBase.loRange||c.Y>l.ClipperBase.loRange||
-c.X>l.ClipperBase.loRange||-c.Y>l.ClipperBase.loRange)d.Value=!0,this.RangeTest(c,d)};l.ClipperBase.prototype.InitEdge=function(c,d,e,f){c.Next=d;c.Prev=e;c.Curr.X=f.X;c.Curr.Y=f.Y;c.OutIdx=-1};l.ClipperBase.prototype.InitEdge2=function(c,d){c.Curr.Y>=c.Next.Curr.Y?(c.Bot.X=c.Curr.X,c.Bot.Y=c.Curr.Y,c.Top.X=c.Next.Curr.X,c.Top.Y=c.Next.Curr.Y):(c.Top.X=c.Curr.X,c.Top.Y=c.Curr.Y,c.Bot.X=c.Next.Curr.X,c.Bot.Y=c.Next.Curr.Y);this.SetDx(c);c.PolyTyp=d};l.ClipperBase.prototype.FindNextLocMin=function(c){for(var d;;){for(;l.IntPoint.op_Inequality(c.Bot,
c.Prev.Bot)||l.IntPoint.op_Equality(c.Curr,c.Top);)c=c.Next;if(c.Dx!=l.ClipperBase.horizontal&&c.Prev.Dx!=l.ClipperBase.horizontal)break;for(;c.Prev.Dx==l.ClipperBase.horizontal;)c=c.Prev;for(d=c;c.Dx==l.ClipperBase.horizontal;)c=c.Next;if(c.Top.Y!=c.Prev.Bot.Y){d.Prev.Bot.X<c.Bot.X&&(c=d);break}}return c};l.ClipperBase.prototype.ProcessBound=function(c,d){var e=c,f=c,g;c.Dx==l.ClipperBase.horizontal&&(g=d?c.Prev.Bot.X:c.Next.Bot.X,c.Bot.X!=g&&this.ReverseHorizontal(c));if(f.OutIdx!=l.ClipperBase.Skip)if(d){for(;f.Top.Y==
f.Next.Bot.Y&&f.Next.OutIdx!=l.ClipperBase.Skip;)f=f.Next;if(f.Dx==l.ClipperBase.horizontal&&f.Next.OutIdx!=l.ClipperBase.Skip){for(g=f;g.Prev.Dx==l.ClipperBase.horizontal;)g=g.Prev;g.Prev.Top.X==f.Next.Top.X?d||(f=g.Prev):g.Prev.Top.X>f.Next.Top.X&&(f=g.Prev)}for(;c!=f;)c.NextInLML=c.Next,c.Dx==l.ClipperBase.horizontal&&c!=e&&c.Bot.X!=c.Prev.Top.X&&this.ReverseHorizontal(c),c=c.Next;c.Dx==l.ClipperBase.horizontal&&c!=e&&c.Bot.X!=c.Prev.Top.X&&this.ReverseHorizontal(c);f=f.Next}else{for(;f.Top.Y==
f.Prev.Bot.Y&&f.Prev.OutIdx!=l.ClipperBase.Skip;)f=f.Prev;if(f.Dx==l.ClipperBase.horizontal&&f.Prev.OutIdx!=l.ClipperBase.Skip){for(g=f;g.Next.Dx==l.ClipperBase.horizontal;)g=g.Next;g.Next.Top.X==f.Prev.Top.X?d||(f=g.Next):g.Next.Top.X>f.Prev.Top.X&&(f=g.Next)}for(;c!=f;)c.NextInLML=c.Prev,c.Dx==l.ClipperBase.horizontal&&c!=e&&c.Bot.X!=c.Next.Top.X&&this.ReverseHorizontal(c),c=c.Prev;c.Dx==l.ClipperBase.horizontal&&c!=e&&c.Bot.X!=c.Next.Top.X&&this.ReverseHorizontal(c);f=f.Prev}if(f.OutIdx==l.ClipperBase.Skip){c=
f;if(d){for(;c.Top.Y==c.Next.Bot.Y;)c=c.Next;for(;c!=f&&c.Dx==l.ClipperBase.horizontal;)c=c.Prev}else{for(;c.Top.Y==c.Prev.Bot.Y;)c=c.Prev;for(;c!=f&&c.Dx==l.ClipperBase.horizontal;)c=c.Next}c==f?f=d?c.Next:c.Prev:(c=d?f.Next:f.Prev,e=new l.LocalMinima,e.Next=null,e.Y=c.Bot.Y,e.LeftBound=null,e.RightBound=c,e.RightBound.WindDelta=0,f=this.ProcessBound(e.RightBound,d),this.InsertLocalMinima(e))}return f};l.ClipperBase.prototype.AddPath=function(c,d,e){e||d!=l.PolyType.ptClip||l.Error("AddPath: Open paths must be subject.");
var f=c.length-1;if(e)for(;0<f&&l.IntPoint.op_Equality(c[f],c[0]);)--f;for(;0<f&&l.IntPoint.op_Equality(c[f],c[f-1]);)--f;if(e&&2>f||!e&&1>f)return!1;for(var g=[],h=0;h<=f;h++)g.push(new l.TEdge);var k=!0;try{for(g[1].Curr.X=c[1].X,g[1].Curr.Y=c[1].Y,function(){var d={Value:this.m_UseFullRange},e=this.RangeTest(c[0],d);this.m_UseFullRange=d.Value;return e}.call(this),function(){var d={Value:this.m_UseFullRange},e=this.RangeTest(c[f],d);this.m_UseFullRange=d.Value;return e}.call(this),this.InitEdge(g[0],
g[1],g[f],c[0]),this.InitEdge(g[f],g[0],g[f-1],c[f]),h=f-1;1<=h;--h)(function(){var d={Value:this.m_UseFullRange},e=this.RangeTest(c[h],d);this.m_UseFullRange=d.Value;return e}).call(this),this.InitEdge(g[h],g[h+1],g[h-1],c[h])}catch(n){return!1}var p=g[0];e||(p.Prev.OutIdx=l.ClipperBase.Skip);for(var q=p,r=p;;)if(l.IntPoint.op_Equality(q.Curr,q.Next.Curr)){if(q==q.Next)break;q==p&&(p=q.Next);r=q=this.RemoveEdge(q)}else{if(q.Prev==q.Next)break;else if(e&&l.ClipperBase.SlopesEqual(q.Prev.Curr,q.Curr,
q.Next.Curr,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(q.Prev.Curr,q.Curr,q.Next.Curr))){q==p&&(p=q.Next);q=this.RemoveEdge(q);r=q=q.Prev;continue}q=q.Next;if(q==r)break}if(!e&&q==q.Next||e&&q.Prev==q.Next)return!1;e||(this.m_HasOpenPaths=!0);q=p;do this.InitEdge2(q,d),q=q.Next,k&&q.Curr.Y!=p.Curr.Y&&(k=!1);while(q!=p);if(k){if(e)return!1;q.Prev.OutIdx=l.ClipperBase.Skip;q.Prev.Bot.X<q.Prev.Top.X&&this.ReverseHorizontal(q.Prev);d=new l.LocalMinima;d.Next=null;d.Y=
q.Bot.Y;d.LeftBound=null;d.RightBound=q;d.RightBound.Side=l.EdgeSide.esRight;for(d.RightBound.WindDelta=0;q.Next.OutIdx!=l.ClipperBase.Skip;)q.NextInLML=q.Next,q.Bot.X!=q.Prev.Top.X&&this.ReverseHorizontal(q),q=q.Next;this.InsertLocalMinima(d);this.m_edges.push(g);return!0}this.m_edges.push(g);for(k=null;;){q=this.FindNextLocMin(q);if(q==k)break;else null==k&&(k=q);d=new l.LocalMinima;d.Next=null;d.Y=q.Bot.Y;q.Dx<q.Prev.Dx?(d.LeftBound=q.Prev,d.RightBound=q,g=!1):(d.LeftBound=q,d.RightBound=q.Prev,
g=!0);d.LeftBound.Side=l.EdgeSide.esLeft;d.RightBound.Side=l.EdgeSide.esRight;d.LeftBound.WindDelta=e?d.LeftBound.Next==d.RightBound?-1:1:0;d.RightBound.WindDelta=-d.LeftBound.WindDelta;q=this.ProcessBound(d.LeftBound,g);p=this.ProcessBound(d.RightBound,!g);d.LeftBound.OutIdx==l.ClipperBase.Skip?d.LeftBound=null:d.RightBound.OutIdx==l.ClipperBase.Skip&&(d.RightBound=null);this.InsertLocalMinima(d);g||(q=p)}return!0};l.ClipperBase.prototype.AddPaths=function(c,d,e){for(var f=!1,g=0,h=c.length;g<h;++g)this.AddPath(c[g],
d,e)&&(f=!0);return f};l.ClipperBase.prototype.Pt2IsBetweenPt1AndPt3=function(c,d,e){return l.IntPoint.op_Equality(c,e)||l.IntPoint.op_Equality(c,d)||l.IntPoint.op_Equality(e,d)?!1:c.X!=e.X?d.X>c.X==d.X<e.X:d.Y>c.Y==d.Y<e.Y};l.ClipperBase.prototype.RemoveEdge=function(c){c.Prev.Next=c.Next;c.Next.Prev=c.Prev;var d=c.Next;c.Prev=null;return d};l.ClipperBase.prototype.SetDx=function(c){c.Delta.X=c.Top.X-c.Bot.X;c.Delta.Y=c.Top.Y-c.Bot.Y;c.Dx=0===c.Delta.Y?l.ClipperBase.horizontal:c.Delta.X/c.Delta.Y};
l.ClipperBase.prototype.InsertLocalMinima=function(c){if(null===this.m_MinimaList)this.m_MinimaList=c;else if(c.Y>=this.m_MinimaList.Y)c.Next=this.m_MinimaList,this.m_MinimaList=c;else{for(var d=this.m_MinimaList;null!==d.Next&&c.Y<d.Next.Y;)d=d.Next;c.Next=d.Next;d.Next=c}};l.ClipperBase.prototype.PopLocalMinima=function(){null!==this.m_CurrentLM&&(this.m_CurrentLM=this.m_CurrentLM.Next)};l.ClipperBase.prototype.ReverseHorizontal=function(c){var d=c.Top.X;c.Top.X=c.Bot.X;c.Bot.X=d};l.ClipperBase.prototype.Reset=
function(){this.m_CurrentLM=this.m_MinimaList;if(null!=this.m_CurrentLM)for(var c=this.m_MinimaList;null!=c;){var d=c.LeftBound;null!=d&&(d.Curr.X=d.Bot.X,d.Curr.Y=d.Bot.Y,d.Side=l.EdgeSide.esLeft,d.OutIdx=l.ClipperBase.Unassigned);d=c.RightBound;null!=d&&(d.Curr.X=d.Bot.X,d.Curr.Y=d.Bot.Y,d.Side=l.EdgeSide.esRight,d.OutIdx=l.ClipperBase.Unassigned);c=c.Next}};l.Clipper=function(c){"undefined"==typeof c&&(c=0);this.m_PolyOuts=null;this.m_ClipType=l.ClipType.ctIntersection;this.m_IntersectNodeComparer=
this.m_IntersectList=this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_ExecuteLocked=!1;this.m_SubjFillType=this.m_ClipFillType=l.PolyFillType.pftEvenOdd;this.m_GhostJoins=this.m_Joins=null;this.StrictlySimple=this.ReverseSolution=this.m_UsingPolyTree=!1;l.ClipperBase.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.m_IntersectList=[];this.m_IntersectNodeComparer=l.MyIntersectNodeSort.Compare;this.m_UsingPolyTree=this.m_ExecuteLocked=!1;this.m_PolyOuts=[];
this.m_Joins=[];this.m_GhostJoins=[];this.ReverseSolution=0!==(1&c);this.StrictlySimple=0!==(2&c);this.PreserveCollinear=0!==(4&c)};l.Clipper.ioReverseSolution=1;l.Clipper.ioStrictlySimple=2;l.Clipper.ioPreserveCollinear=4;l.Clipper.prototype.Clear=function(){0!==this.m_edges.length&&(this.DisposeAllPolyPts(),l.ClipperBase.prototype.Clear.call(this))};l.Clipper.prototype.DisposeScanbeamList=function(){for(;null!==this.m_Scanbeam;){var c=this.m_Scanbeam.Next;this.m_Scanbeam=null;this.m_Scanbeam=c}};
l.Clipper.prototype.Reset=function(){l.ClipperBase.prototype.Reset.call(this);this.m_SortedEdges=this.m_ActiveEdges=this.m_Scanbeam=null;this.DisposeAllPolyPts();for(var c=this.m_MinimaList;null!==c;)this.InsertScanbeam(c.Y),c=c.Next};l.Clipper.prototype.InsertScanbeam=function(c){if(null===this.m_Scanbeam)this.m_Scanbeam=new l.Scanbeam,this.m_Scanbeam.Next=null,this.m_Scanbeam.Y=c;else if(c>this.m_Scanbeam.Y){var d=new l.Scanbeam;d.Y=c;d.Next=this.m_Scanbeam;this.m_Scanbeam=d}else{for(var e=this.m_Scanbeam;null!==
e.Next&&c<=e.Next.Y;)e=e.Next;c!=e.Y&&(d=new l.Scanbeam,d.Y=c,d.Next=e.Next,e.Next=d)}};l.Clipper.prototype.Execute=function(){var c=arguments,d=c.length,e=c[1]instanceof l.PolyTree;if(4!=d||e){if(4==d&&e){e=c[0];d=c[1];f=c[2];c=c[3];if(this.m_ExecuteLocked)return!1;this.m_ExecuteLocked=!0;this.m_SubjFillType=f;this.m_ClipFillType=c;this.m_ClipType=e;this.m_UsingPolyTree=!0;(c=this.ExecuteInternal())&&this.BuildResult2(d);this.m_ExecuteLocked=!1;return c}if(2==d&&!e||2==d&&e)return e=c[0],d=c[1],
this.Execute(e,d,l.PolyFillType.pftEvenOdd,l.PolyFillType.pftEvenOdd)}else{var e=c[0],d=c[1],f=c[2],c=c[3];if(this.m_ExecuteLocked)return!1;this.m_HasOpenPaths&&l.Error("Error: PolyTree struct is need for open path clipping.");this.m_ExecuteLocked=!0;l.Clear(d);this.m_SubjFillType=f;this.m_ClipFillType=c;this.m_ClipType=e;this.m_UsingPolyTree=!1;(c=this.ExecuteInternal())&&this.BuildResult(d);this.m_ExecuteLocked=!1;return c}};l.Clipper.prototype.FixHoleLinkage=function(c){if(null!==c.FirstLeft&&
(c.IsHole==c.FirstLeft.IsHole||null===c.FirstLeft.Pts)){for(var d=c.FirstLeft;null!==d&&(d.IsHole==c.IsHole||null===d.Pts);)d=d.FirstLeft;c.FirstLeft=d}};l.Clipper.prototype.ExecuteInternal=function(){try{this.Reset();if(null===this.m_CurrentLM)return!1;var c=this.PopScanbeam();do{this.InsertLocalMinimaIntoAEL(c);l.Clear(this.m_GhostJoins);this.ProcessHorizontals(!1);if(null===this.m_Scanbeam)break;var d=this.PopScanbeam();if(!this.ProcessIntersections(c,d))return!1;this.ProcessEdgesAtTopOfScanbeam(d);
c=d}while(null!==this.m_Scanbeam||null!==this.m_CurrentLM);for(var c=0,e=this.m_PolyOuts.length;c<e;c++){var f=this.m_PolyOuts[c];null===f.Pts||f.IsOpen||(f.IsHole^this.ReverseSolution)==0<this.Area(f)&&this.ReversePolyPtLinks(f.Pts)}this.JoinCommonEdges();c=0;for(e=this.m_PolyOuts.length;c<e;c++)f=this.m_PolyOuts[c],null===f.Pts||f.IsOpen||this.FixupOutPolygon(f);this.StrictlySimple&&this.DoSimplePolygons();return!0}finally{l.Clear(this.m_Joins),l.Clear(this.m_GhostJoins)}};l.Clipper.prototype.PopScanbeam=
function(){var c=this.m_Scanbeam.Y;this.m_Scanbeam=this.m_Scanbeam.Next;return c};l.Clipper.prototype.DisposeAllPolyPts=function(){for(var c=0,d=this.m_PolyOuts.length;c<d;++c)this.DisposeOutRec(c);l.Clear(this.m_PolyOuts)};l.Clipper.prototype.DisposeOutRec=function(c){var d=this.m_PolyOuts[c];null!==d.Pts&&this.DisposeOutPts(d.Pts);this.m_PolyOuts[c]=null};l.Clipper.prototype.DisposeOutPts=function(c){if(null!==c)for(c.Prev.Next=null;null!==c;)c=c.Next};l.Clipper.prototype.AddJoin=function(c,d,e){var f=
new l.Join;f.OutPt1=c;f.OutPt2=d;f.OffPt.X=e.X;f.OffPt.Y=e.Y;this.m_Joins.push(f)};l.Clipper.prototype.AddGhostJoin=function(c,d){var e=new l.Join;e.OutPt1=c;e.OffPt.X=d.X;e.OffPt.Y=d.Y;this.m_GhostJoins.push(e)};l.Clipper.prototype.InsertLocalMinimaIntoAEL=function(c){for(;null!==this.m_CurrentLM&&this.m_CurrentLM.Y==c;){var d=this.m_CurrentLM.LeftBound,e=this.m_CurrentLM.RightBound;this.PopLocalMinima();var f=null;null===d?(this.InsertEdgeIntoAEL(e,null),this.SetWindingCount(e),this.IsContributing(e)&&
(f=this.AddOutPt(e,e.Bot))):(null==e?(this.InsertEdgeIntoAEL(d,null),this.SetWindingCount(d),this.IsContributing(d)&&(f=this.AddOutPt(d,d.Bot))):(this.InsertEdgeIntoAEL(d,null),this.InsertEdgeIntoAEL(e,d),this.SetWindingCount(d),e.WindCnt=d.WindCnt,e.WindCnt2=d.WindCnt2,this.IsContributing(d)&&(f=this.AddLocalMinPoly(d,e,d.Bot))),this.InsertScanbeam(d.Top.Y));null!=e&&(l.ClipperBase.IsHorizontal(e)?this.AddEdgeToSEL(e):this.InsertScanbeam(e.Top.Y));if(null!=d&&null!=e){if(null!==f&&l.ClipperBase.IsHorizontal(e)&&
0<this.m_GhostJoins.length&&0!==e.WindDelta)for(var g=0,h=this.m_GhostJoins.length;g<h;g++){var k=this.m_GhostJoins[g];this.HorzSegmentsOverlap(k.OutPt1.Pt,k.OffPt,e.Bot,e.Top)&&this.AddJoin(k.OutPt1,f,k.OffPt)}0<=d.OutIdx&&null!==d.PrevInAEL&&d.PrevInAEL.Curr.X==d.Bot.X&&0<=d.PrevInAEL.OutIdx&&l.ClipperBase.SlopesEqual(d.PrevInAEL,d,this.m_UseFullRange)&&0!==d.WindDelta&&0!==d.PrevInAEL.WindDelta&&(g=this.AddOutPt(d.PrevInAEL,d.Bot),this.AddJoin(f,g,d.Top));if(d.NextInAEL!=e&&(0<=e.OutIdx&&0<=e.PrevInAEL.OutIdx&&
l.ClipperBase.SlopesEqual(e.PrevInAEL,e,this.m_UseFullRange)&&0!==e.WindDelta&&0!==e.PrevInAEL.WindDelta&&(g=this.AddOutPt(e.PrevInAEL,e.Bot),this.AddJoin(f,g,e.Top)),f=d.NextInAEL,null!==f))for(;f!=e;)this.IntersectEdges(e,f,d.Curr,!1),f=f.NextInAEL}}};l.Clipper.prototype.InsertEdgeIntoAEL=function(c,d){if(null===this.m_ActiveEdges)c.PrevInAEL=null,c.NextInAEL=null,this.m_ActiveEdges=c;else if(null===d&&this.E2InsertsBeforeE1(this.m_ActiveEdges,c))c.PrevInAEL=null,c.NextInAEL=this.m_ActiveEdges,
this.m_ActiveEdges=this.m_ActiveEdges.PrevInAEL=c;else{for(null===d&&(d=this.m_ActiveEdges);null!==d.NextInAEL&&!this.E2InsertsBeforeE1(d.NextInAEL,c);)d=d.NextInAEL;c.NextInAEL=d.NextInAEL;null!==d.NextInAEL&&(d.NextInAEL.PrevInAEL=c);c.PrevInAEL=d;d.NextInAEL=c}};l.Clipper.prototype.E2InsertsBeforeE1=function(c,d){return d.Curr.X==c.Curr.X?d.Top.Y>c.Top.Y?d.Top.X<l.Clipper.TopX(c,d.Top.Y):c.Top.X>l.Clipper.TopX(d,c.Top.Y):d.Curr.X<c.Curr.X};l.Clipper.prototype.IsEvenOddFillType=function(c){return c.PolyTyp==
l.PolyType.ptSubject?this.m_SubjFillType==l.PolyFillType.pftEvenOdd:this.m_ClipFillType==l.PolyFillType.pftEvenOdd};l.Clipper.prototype.IsEvenOddAltFillType=function(c){return c.PolyTyp==l.PolyType.ptSubject?this.m_ClipFillType==l.PolyFillType.pftEvenOdd:this.m_SubjFillType==l.PolyFillType.pftEvenOdd};l.Clipper.prototype.IsContributing=function(c){var d,e;c.PolyTyp==l.PolyType.ptSubject?(d=this.m_SubjFillType,e=this.m_ClipFillType):(d=this.m_ClipFillType,e=this.m_SubjFillType);switch(d){case l.PolyFillType.pftEvenOdd:if(0===
c.WindDelta&&1!=c.WindCnt)return!1;break;case l.PolyFillType.pftNonZero:if(1!=Math.abs(c.WindCnt))return!1;break;case l.PolyFillType.pftPositive:if(1!=c.WindCnt)return!1;break;default:if(-1!=c.WindCnt)return!1}switch(this.m_ClipType){case l.ClipType.ctIntersection:switch(e){case l.PolyFillType.pftEvenOdd:case l.PolyFillType.pftNonZero:return 0!==c.WindCnt2;case l.PolyFillType.pftPositive:return 0<c.WindCnt2;default:return 0>c.WindCnt2}case l.ClipType.ctUnion:switch(e){case l.PolyFillType.pftEvenOdd:case l.PolyFillType.pftNonZero:return 0===
c.WindCnt2;case l.PolyFillType.pftPositive:return 0>=c.WindCnt2;default:return 0<=c.WindCnt2}case l.ClipType.ctDifference:if(c.PolyTyp==l.PolyType.ptSubject)switch(e){case l.PolyFillType.pftEvenOdd:case l.PolyFillType.pftNonZero:return 0===c.WindCnt2;case l.PolyFillType.pftPositive:return 0>=c.WindCnt2;default:return 0<=c.WindCnt2}else switch(e){case l.PolyFillType.pftEvenOdd:case l.PolyFillType.pftNonZero:return 0!==c.WindCnt2;case l.PolyFillType.pftPositive:return 0<c.WindCnt2;default:return 0>
c.WindCnt2}case l.ClipType.ctXor:if(0===c.WindDelta)switch(e){case l.PolyFillType.pftEvenOdd:case l.PolyFillType.pftNonZero:return 0===c.WindCnt2;case l.PolyFillType.pftPositive:return 0>=c.WindCnt2;default:return 0<=c.WindCnt2}}return!0};l.Clipper.prototype.SetWindingCount=function(c){for(var d=c.PrevInAEL;null!==d&&(d.PolyTyp!=c.PolyTyp||0===d.WindDelta);)d=d.PrevInAEL;if(null===d)c.WindCnt=0===c.WindDelta?1:c.WindDelta,c.WindCnt2=0,d=this.m_ActiveEdges;else{if(0===c.WindDelta&&this.m_ClipType!=
l.ClipType.ctUnion)c.WindCnt=1;else if(this.IsEvenOddFillType(c))if(0===c.WindDelta){for(var e=!0,f=d.PrevInAEL;null!==f;)f.PolyTyp==d.PolyTyp&&0!==f.WindDelta&&(e=!e),f=f.PrevInAEL;c.WindCnt=e?0:1}else c.WindCnt=c.WindDelta;else 0>d.WindCnt*d.WindDelta?1<Math.abs(d.WindCnt)?c.WindCnt=0>d.WindDelta*c.WindDelta?d.WindCnt:d.WindCnt+c.WindDelta:c.WindCnt=0===c.WindDelta?1:c.WindDelta:c.WindCnt=0===c.WindDelta?0>d.WindCnt?d.WindCnt-1:d.WindCnt+1:0>d.WindDelta*c.WindDelta?d.WindCnt:d.WindCnt+c.WindDelta;
c.WindCnt2=d.WindCnt2;d=d.NextInAEL}if(this.IsEvenOddAltFillType(c))for(;d!=c;)0!==d.WindDelta&&(c.WindCnt2=0===c.WindCnt2?1:0),d=d.NextInAEL;else for(;d!=c;)c.WindCnt2+=d.WindDelta,d=d.NextInAEL};l.Clipper.prototype.AddEdgeToSEL=function(c){null===this.m_SortedEdges?(this.m_SortedEdges=c,c.PrevInSEL=null,c.NextInSEL=null):(c.NextInSEL=this.m_SortedEdges,c.PrevInSEL=null,this.m_SortedEdges=this.m_SortedEdges.PrevInSEL=c)};l.Clipper.prototype.CopyAELToSEL=function(){var c=this.m_ActiveEdges;for(this.m_SortedEdges=
c;null!==c;)c.PrevInSEL=c.PrevInAEL,c=c.NextInSEL=c.NextInAEL};l.Clipper.prototype.SwapPositionsInAEL=function(c,d){if(c.NextInAEL!=c.PrevInAEL&&d.NextInAEL!=d.PrevInAEL){if(c.NextInAEL==d){var e=d.NextInAEL;null!==e&&(e.PrevInAEL=c);var f=c.PrevInAEL;null!==f&&(f.NextInAEL=d);d.PrevInAEL=f;d.NextInAEL=c;c.PrevInAEL=d;c.NextInAEL=e}else d.NextInAEL==c?(e=c.NextInAEL,null!==e&&(e.PrevInAEL=d),f=d.PrevInAEL,null!==f&&(f.NextInAEL=c),c.PrevInAEL=f,c.NextInAEL=d,d.PrevInAEL=c,d.NextInAEL=e):(e=c.NextInAEL,
f=c.PrevInAEL,c.NextInAEL=d.NextInAEL,null!==c.NextInAEL&&(c.NextInAEL.PrevInAEL=c),c.PrevInAEL=d.PrevInAEL,null!==c.PrevInAEL&&(c.PrevInAEL.NextInAEL=c),d.NextInAEL=e,null!==d.NextInAEL&&(d.NextInAEL.PrevInAEL=d),d.PrevInAEL=f,null!==d.PrevInAEL&&(d.PrevInAEL.NextInAEL=d));null===c.PrevInAEL?this.m_ActiveEdges=c:null===d.PrevInAEL&&(this.m_ActiveEdges=d)}};l.Clipper.prototype.SwapPositionsInSEL=function(c,d){if(null!==c.NextInSEL||null!==c.PrevInSEL)if(null!==d.NextInSEL||null!==d.PrevInSEL){if(c.NextInSEL==
d){var e=d.NextInSEL;null!==e&&(e.PrevInSEL=c);var f=c.PrevInSEL;null!==f&&(f.NextInSEL=d);d.PrevInSEL=f;d.NextInSEL=c;c.PrevInSEL=d;c.NextInSEL=e}else d.NextInSEL==c?(e=c.NextInSEL,null!==e&&(e.PrevInSEL=d),f=d.PrevInSEL,null!==f&&(f.NextInSEL=c),c.PrevInSEL=f,c.NextInSEL=d,d.PrevInSEL=c,d.NextInSEL=e):(e=c.NextInSEL,f=c.PrevInSEL,c.NextInSEL=d.NextInSEL,null!==c.NextInSEL&&(c.NextInSEL.PrevInSEL=c),c.PrevInSEL=d.PrevInSEL,null!==c.PrevInSEL&&(c.PrevInSEL.NextInSEL=c),d.NextInSEL=e,null!==d.NextInSEL&&
(d.NextInSEL.PrevInSEL=d),d.PrevInSEL=f,null!==d.PrevInSEL&&(d.PrevInSEL.NextInSEL=d));null===c.PrevInSEL?this.m_SortedEdges=c:null===d.PrevInSEL&&(this.m_SortedEdges=d)}};l.Clipper.prototype.AddLocalMaxPoly=function(c,d,e){this.AddOutPt(c,e);0==d.WindDelta&&this.AddOutPt(d,e);c.OutIdx==d.OutIdx?(c.OutIdx=-1,d.OutIdx=-1):c.OutIdx<d.OutIdx?this.AppendPolygon(c,d):this.AppendPolygon(d,c)};l.Clipper.prototype.AddLocalMinPoly=function(c,d,e){var f,g;l.ClipperBase.IsHorizontal(d)||c.Dx>d.Dx?(f=this.AddOutPt(c,
e),d.OutIdx=c.OutIdx,c.Side=l.EdgeSide.esLeft,d.Side=l.EdgeSide.esRight,g=c,c=g.PrevInAEL==d?d.PrevInAEL:g.PrevInAEL):(f=this.AddOutPt(d,e),c.OutIdx=d.OutIdx,c.Side=l.EdgeSide.esRight,d.Side=l.EdgeSide.esLeft,g=d,c=g.PrevInAEL==c?c.PrevInAEL:g.PrevInAEL);null!==c&&0<=c.OutIdx&&l.Clipper.TopX(c,e.Y)==l.Clipper.TopX(g,e.Y)&&l.ClipperBase.SlopesEqual(g,c,this.m_UseFullRange)&&0!==g.WindDelta&&0!==c.WindDelta&&(e=this.AddOutPt(c,e),this.AddJoin(f,e,g.Top));return f};l.Clipper.prototype.CreateOutRec=function(){var c=
new l.OutRec;c.Idx=-1;c.IsHole=!1;c.IsOpen=!1;c.FirstLeft=null;c.Pts=null;c.BottomPt=null;c.PolyNode=null;this.m_PolyOuts.push(c);c.Idx=this.m_PolyOuts.length-1;return c};l.Clipper.prototype.AddOutPt=function(c,d){var e=c.Side==l.EdgeSide.esLeft;if(0>c.OutIdx){var f=this.CreateOutRec();f.IsOpen=0===c.WindDelta;var g=new l.OutPt;f.Pts=g;g.Idx=f.Idx;g.Pt.X=d.X;g.Pt.Y=d.Y;g.Next=g;g.Prev=g;f.IsOpen||this.SetHoleState(c,f);c.OutIdx=f.Idx}else{var f=this.m_PolyOuts[c.OutIdx],h=f.Pts;if(e&&l.IntPoint.op_Equality(d,
h.Pt))return h;if(!e&&l.IntPoint.op_Equality(d,h.Prev.Pt))return h.Prev;g=new l.OutPt;g.Idx=f.Idx;g.Pt.X=d.X;g.Pt.Y=d.Y;g.Next=h;g.Prev=h.Prev;g.Prev.Next=g;h.Prev=g;e&&(f.Pts=g)}return g};l.Clipper.prototype.SwapPoints=function(c,d){var e=new l.IntPoint(c.Value);c.Value.X=d.Value.X;c.Value.Y=d.Value.Y;d.Value.X=e.X;d.Value.Y=e.Y};l.Clipper.prototype.HorzSegmentsOverlap=function(c,d,e,f){return c.X>e.X==c.X<f.X?!0:d.X>e.X==d.X<f.X?!0:e.X>c.X==e.X<d.X?!0:f.X>c.X==f.X<d.X?!0:c.X==e.X&&d.X==f.X?!0:c.X==
f.X&&d.X==e.X?!0:!1};l.Clipper.prototype.InsertPolyPtBetween=function(c,d,e){var f=new l.OutPt;f.Pt.X=e.X;f.Pt.Y=e.Y;d==c.Next?(c.Next=f,d.Prev=f,f.Next=d,f.Prev=c):(d.Next=f,c.Prev=f,f.Next=c,f.Prev=d);return f};l.Clipper.prototype.SetHoleState=function(c,d){for(var e=!1,f=c.PrevInAEL;null!==f;)0<=f.OutIdx&&0!=f.WindDelta&&(e=!e,null===d.FirstLeft&&(d.FirstLeft=this.m_PolyOuts[f.OutIdx])),f=f.PrevInAEL;e&&(d.IsHole=!0)};l.Clipper.prototype.GetDx=function(c,d){return c.Y==d.Y?l.ClipperBase.horizontal:
(d.X-c.X)/(d.Y-c.Y)};l.Clipper.prototype.FirstIsBottomPt=function(c,d){for(var e=c.Prev;l.IntPoint.op_Equality(e.Pt,c.Pt)&&e!=c;)e=e.Prev;for(var f=Math.abs(this.GetDx(c.Pt,e.Pt)),e=c.Next;l.IntPoint.op_Equality(e.Pt,c.Pt)&&e!=c;)e=e.Next;for(var g=Math.abs(this.GetDx(c.Pt,e.Pt)),e=d.Prev;l.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Prev;for(var h=Math.abs(this.GetDx(d.Pt,e.Pt)),e=d.Next;l.IntPoint.op_Equality(e.Pt,d.Pt)&&e!=d;)e=e.Next;e=Math.abs(this.GetDx(d.Pt,e.Pt));return f>=h&&f>=e||g>=h&&g>=
e};l.Clipper.prototype.GetBottomPt=function(c){for(var d=null,e=c.Next;e!=c;)e.Pt.Y>c.Pt.Y?(c=e,d=null):e.Pt.Y==c.Pt.Y&&e.Pt.X<=c.Pt.X&&(e.Pt.X<c.Pt.X?(d=null,c=e):e.Next!=c&&e.Prev!=c&&(d=e)),e=e.Next;if(null!==d)for(;d!=e;)for(this.FirstIsBottomPt(e,d)||(c=d),d=d.Next;l.IntPoint.op_Inequality(d.Pt,c.Pt);)d=d.Next;return c};l.Clipper.prototype.GetLowermostRec=function(c,d){null===c.BottomPt&&(c.BottomPt=this.GetBottomPt(c.Pts));null===d.BottomPt&&(d.BottomPt=this.GetBottomPt(d.Pts));var e=c.BottomPt,
f=d.BottomPt;return e.Pt.Y>f.Pt.Y?c:e.Pt.Y<f.Pt.Y?d:e.Pt.X<f.Pt.X?c:e.Pt.X>f.Pt.X?d:e.Next==e?d:f.Next==f?c:this.FirstIsBottomPt(e,f)?c:d};l.Clipper.prototype.Param1RightOfParam2=function(c,d){do if(c=c.FirstLeft,c==d)return!0;while(null!==c);return!1};l.Clipper.prototype.GetOutRec=function(c){for(c=this.m_PolyOuts[c];c!=this.m_PolyOuts[c.Idx];)c=this.m_PolyOuts[c.Idx];return c};l.Clipper.prototype.AppendPolygon=function(c,d){var e=this.m_PolyOuts[c.OutIdx],f=this.m_PolyOuts[d.OutIdx],g;g=this.Param1RightOfParam2(e,
f)?f:this.Param1RightOfParam2(f,e)?e:this.GetLowermostRec(e,f);var h=e.Pts,k=h.Prev,n=f.Pts,p=n.Prev;c.Side==l.EdgeSide.esLeft?(d.Side==l.EdgeSide.esLeft?(this.ReversePolyPtLinks(n),n.Next=h,h.Prev=n,k.Next=p,p.Prev=k,e.Pts=p):(p.Next=h,h.Prev=p,n.Prev=k,k.Next=n,e.Pts=n),h=l.EdgeSide.esLeft):(d.Side==l.EdgeSide.esRight?(this.ReversePolyPtLinks(n),k.Next=p,p.Prev=k,n.Next=h,h.Prev=n):(k.Next=n,n.Prev=k,h.Prev=p,p.Next=h),h=l.EdgeSide.esRight);e.BottomPt=null;g==f&&(f.FirstLeft!=e&&(e.FirstLeft=f.FirstLeft),
e.IsHole=f.IsHole);f.Pts=null;f.BottomPt=null;f.FirstLeft=e;g=c.OutIdx;k=d.OutIdx;c.OutIdx=-1;d.OutIdx=-1;for(n=this.m_ActiveEdges;null!==n;){if(n.OutIdx==k){n.OutIdx=g;n.Side=h;break}n=n.NextInAEL}f.Idx=e.Idx};l.Clipper.prototype.ReversePolyPtLinks=function(c){if(null!==c){var d,e;d=c;do e=d.Next,d.Next=d.Prev,d=d.Prev=e;while(d!=c)}};l.Clipper.SwapSides=function(c,d){var e=c.Side;c.Side=d.Side;d.Side=e};l.Clipper.SwapPolyIndexes=function(c,d){var e=c.OutIdx;c.OutIdx=d.OutIdx;d.OutIdx=e};l.Clipper.prototype.IntersectEdges=
function(c,d,e,f){var g=!f&&null===c.NextInLML&&c.Top.X==e.X&&c.Top.Y==e.Y;f=!f&&null===d.NextInLML&&d.Top.X==e.X&&d.Top.Y==e.Y;var h=0<=c.OutIdx,k=0<=d.OutIdx;if(0===c.WindDelta||0===d.WindDelta)0===c.WindDelta&&0===d.WindDelta?(g||f)&&h&&k&&this.AddLocalMaxPoly(c,d,e):c.PolyTyp==d.PolyTyp&&c.WindDelta!=d.WindDelta&&this.m_ClipType==l.ClipType.ctUnion?0===c.WindDelta?k&&(this.AddOutPt(c,e),h&&(c.OutIdx=-1)):h&&(this.AddOutPt(d,e),k&&(d.OutIdx=-1)):c.PolyTyp!=d.PolyTyp&&(0!==c.WindDelta||1!=Math.abs(d.WindCnt)||
this.m_ClipType==l.ClipType.ctUnion&&0!==d.WindCnt2?0!==d.WindDelta||1!=Math.abs(c.WindCnt)||this.m_ClipType==l.ClipType.ctUnion&&0!==c.WindCnt2||(this.AddOutPt(d,e),k&&(d.OutIdx=-1)):(this.AddOutPt(c,e),h&&(c.OutIdx=-1))),g&&(0>c.OutIdx?this.DeleteFromAEL(c):l.Error("Error intersecting polylines")),f&&(0>d.OutIdx?this.DeleteFromAEL(d):l.Error("Error intersecting polylines"));else{if(c.PolyTyp==d.PolyTyp)if(this.IsEvenOddFillType(c)){var n=c.WindCnt;c.WindCnt=d.WindCnt;d.WindCnt=n}else c.WindCnt=
0===c.WindCnt+d.WindDelta?-c.WindCnt:c.WindCnt+d.WindDelta,d.WindCnt=0===d.WindCnt-c.WindDelta?-d.WindCnt:d.WindCnt-c.WindDelta;else this.IsEvenOddFillType(d)?c.WindCnt2=0===c.WindCnt2?1:0:c.WindCnt2+=d.WindDelta,this.IsEvenOddFillType(c)?d.WindCnt2=0===d.WindCnt2?1:0:d.WindCnt2-=c.WindDelta;var p,q,r;c.PolyTyp==l.PolyType.ptSubject?(p=this.m_SubjFillType,r=this.m_ClipFillType):(p=this.m_ClipFillType,r=this.m_SubjFillType);d.PolyTyp==l.PolyType.ptSubject?(q=this.m_SubjFillType,n=this.m_ClipFillType):
(q=this.m_ClipFillType,n=this.m_SubjFillType);switch(p){case l.PolyFillType.pftPositive:p=c.WindCnt;break;case l.PolyFillType.pftNegative:p=-c.WindCnt;break;default:p=Math.abs(c.WindCnt)}switch(q){case l.PolyFillType.pftPositive:q=d.WindCnt;break;case l.PolyFillType.pftNegative:q=-d.WindCnt;break;default:q=Math.abs(d.WindCnt)}if(h&&k)g||f||0!==p&&1!=p||0!==q&&1!=q||c.PolyTyp!=d.PolyTyp&&this.m_ClipType!=l.ClipType.ctXor?this.AddLocalMaxPoly(c,d,e):(this.AddOutPt(c,e),this.AddOutPt(d,e),l.Clipper.SwapSides(c,
d),l.Clipper.SwapPolyIndexes(c,d));else if(h){if(0===q||1==q)this.AddOutPt(c,e),l.Clipper.SwapSides(c,d),l.Clipper.SwapPolyIndexes(c,d)}else if(k){if(0===p||1==p)this.AddOutPt(d,e),l.Clipper.SwapSides(c,d),l.Clipper.SwapPolyIndexes(c,d)}else if(!(0!==p&&1!=p||0!==q&&1!=q||g||f)){switch(r){case l.PolyFillType.pftPositive:h=c.WindCnt2;break;case l.PolyFillType.pftNegative:h=-c.WindCnt2;break;default:h=Math.abs(c.WindCnt2)}switch(n){case l.PolyFillType.pftPositive:k=d.WindCnt2;break;case l.PolyFillType.pftNegative:k=
-d.WindCnt2;break;default:k=Math.abs(d.WindCnt2)}if(c.PolyTyp!=d.PolyTyp)this.AddLocalMinPoly(c,d,e);else if(1==p&&1==q)switch(this.m_ClipType){case l.ClipType.ctIntersection:0<h&&0<k&&this.AddLocalMinPoly(c,d,e);break;case l.ClipType.ctUnion:0>=h&&0>=k&&this.AddLocalMinPoly(c,d,e);break;case l.ClipType.ctDifference:(c.PolyTyp==l.PolyType.ptClip&&0<h&&0<k||c.PolyTyp==l.PolyType.ptSubject&&0>=h&&0>=k)&&this.AddLocalMinPoly(c,d,e);break;case l.ClipType.ctXor:this.AddLocalMinPoly(c,d,e)}else l.Clipper.SwapSides(c,
d)}g!=f&&(g&&0<=c.OutIdx||f&&0<=d.OutIdx)&&(l.Clipper.SwapSides(c,d),l.Clipper.SwapPolyIndexes(c,d));g&&this.DeleteFromAEL(c);f&&this.DeleteFromAEL(d)}};l.Clipper.prototype.DeleteFromAEL=function(c){var d=c.PrevInAEL,e=c.NextInAEL;if(null!==d||null!==e||c==this.m_ActiveEdges)null!==d?d.NextInAEL=e:this.m_ActiveEdges=e,null!==e&&(e.PrevInAEL=d),c.NextInAEL=null,c.PrevInAEL=null};l.Clipper.prototype.DeleteFromSEL=function(c){var d=c.PrevInSEL,e=c.NextInSEL;if(null!==d||null!==e||c==this.m_SortedEdges)null!==
d?d.NextInSEL=e:this.m_SortedEdges=e,null!==e&&(e.PrevInSEL=d),c.NextInSEL=null,c.PrevInSEL=null};l.Clipper.prototype.UpdateEdgeIntoAEL=function(c){null===c.Value.NextInLML&&l.Error("UpdateEdgeIntoAEL: invalid call");var d=c.Value.PrevInAEL,e=c.Value.NextInAEL;c.Value.NextInLML.OutIdx=c.Value.OutIdx;null!==d?d.NextInAEL=c.Value.NextInLML:this.m_ActiveEdges=c.Value.NextInLML;null!==e&&(e.PrevInAEL=c.Value.NextInLML);c.Value.NextInLML.Side=c.Value.Side;c.Value.NextInLML.WindDelta=c.Value.WindDelta;
c.Value.NextInLML.WindCnt=c.Value.WindCnt;c.Value.NextInLML.WindCnt2=c.Value.WindCnt2;c.Value=c.Value.NextInLML;c.Value.Curr.X=c.Value.Bot.X;c.Value.Curr.Y=c.Value.Bot.Y;c.Value.PrevInAEL=d;c.Value.NextInAEL=e;l.ClipperBase.IsHorizontal(c.Value)||this.InsertScanbeam(c.Value.Top.Y)};l.Clipper.prototype.ProcessHorizontals=function(c){for(var d=this.m_SortedEdges;null!==d;)this.DeleteFromSEL(d),this.ProcessHorizontal(d,c),d=this.m_SortedEdges};l.Clipper.prototype.GetHorzDirection=function(c,d,e,f){c.Bot.X<
c.Top.X?(e.Value=c.Bot.X,f.Value=c.Top.X,d.Value=l.Direction.dLeftToRight):(e.Value=c.Top.X,f.Value=c.Bot.X,d.Value=l.Direction.dRightToLeft)};l.Clipper.prototype.PrepareHorzJoins=function(c,d){var e=this.m_PolyOuts[c.OutIdx].Pts;c.Side!=l.EdgeSide.esLeft&&(e=e.Prev);for(var f=0,g=this.m_GhostJoins.length;f<g;++f){var h=this.m_GhostJoins[f];this.HorzSegmentsOverlap(h.OutPt1.Pt,h.OffPt,c.Bot,c.Top)&&this.AddJoin(h.OutPt1,e,h.OffPt)}d&&(l.IntPoint.op_Equality(e.Pt,c.Top)?this.AddGhostJoin(e,c.Bot):
this.AddGhostJoin(e,c.Top))};l.Clipper.prototype.ProcessHorizontal=function(c,d){var e,f,g;(function(){e={Value:e};f={Value:f};g={Value:g};var d=this.GetHorzDirection(c,e,f,g);e=e.Value;f=f.Value;g=g.Value;return d}).call(this);for(var h=c,k=null;null!==h.NextInLML&&l.ClipperBase.IsHorizontal(h.NextInLML);)h=h.NextInLML;for(null===h.NextInLML&&(k=this.GetMaximaPair(h));;){for(var n=c==h,p=this.GetNextInAEL(c,e);null!==p&&!(p.Curr.X==c.Top.X&&null!==c.NextInLML&&p.Dx<c.NextInLML.Dx);){var q=this.GetNextInAEL(p,
e);if(e==l.Direction.dLeftToRight&&p.Curr.X<=g||e==l.Direction.dRightToLeft&&p.Curr.X>=f){0<=c.OutIdx&&0!=c.WindDelta&&this.PrepareHorzJoins(c,d);if(p==k&&n){e==l.Direction.dLeftToRight?this.IntersectEdges(c,p,p.Top,!1):this.IntersectEdges(p,c,p.Top,!1);0<=k.OutIdx&&l.Error("ProcessHorizontal error");return}if(e==l.Direction.dLeftToRight){var r=new l.IntPoint(p.Curr.X,c.Curr.Y);this.IntersectEdges(c,p,r,!0)}else r=new l.IntPoint(p.Curr.X,c.Curr.Y),this.IntersectEdges(p,c,r,!0);this.SwapPositionsInAEL(c,
p)}else if(e==l.Direction.dLeftToRight&&p.Curr.X>=g||e==l.Direction.dRightToLeft&&p.Curr.X<=f)break;p=q}0<=c.OutIdx&&0!==c.WindDelta&&this.PrepareHorzJoins(c,d);if(null!==c.NextInLML&&l.ClipperBase.IsHorizontal(c.NextInLML))(function(){c={Value:c};var d=this.UpdateEdgeIntoAEL(c);c=c.Value;return d}).call(this),0<=c.OutIdx&&this.AddOutPt(c,c.Bot),function(){e={Value:e};f={Value:f};g={Value:g};var d=this.GetHorzDirection(c,e,f,g);e=e.Value;f=f.Value;g=g.Value;return d}.call(this);else break}null!==
c.NextInLML?0<=c.OutIdx?(h=this.AddOutPt(c,c.Top),function(){c={Value:c};var d=this.UpdateEdgeIntoAEL(c);c=c.Value;return d}.call(this),0!==c.WindDelta&&(k=c.PrevInAEL,q=c.NextInAEL,null!==k&&k.Curr.X==c.Bot.X&&k.Curr.Y==c.Bot.Y&&0!==k.WindDelta&&0<=k.OutIdx&&k.Curr.Y>k.Top.Y&&l.ClipperBase.SlopesEqual(c,k,this.m_UseFullRange)?(q=this.AddOutPt(k,c.Bot),this.AddJoin(h,q,c.Top)):null!==q&&q.Curr.X==c.Bot.X&&q.Curr.Y==c.Bot.Y&&0!==q.WindDelta&&0<=q.OutIdx&&q.Curr.Y>q.Top.Y&&l.ClipperBase.SlopesEqual(c,
q,this.m_UseFullRange)&&(q=this.AddOutPt(q,c.Bot),this.AddJoin(h,q,c.Top)))):function(){c={Value:c};var d=this.UpdateEdgeIntoAEL(c);c=c.Value;return d}.call(this):null!==k?0<=k.OutIdx?(e==l.Direction.dLeftToRight?this.IntersectEdges(c,k,c.Top,!1):this.IntersectEdges(k,c,c.Top,!1),0<=k.OutIdx&&l.Error("ProcessHorizontal error")):(this.DeleteFromAEL(c),this.DeleteFromAEL(k)):(0<=c.OutIdx&&this.AddOutPt(c,c.Top),this.DeleteFromAEL(c))};l.Clipper.prototype.GetNextInAEL=function(c,d){return d==l.Direction.dLeftToRight?
c.NextInAEL:c.PrevInAEL};l.Clipper.prototype.IsMinima=function(c){return null!==c&&c.Prev.NextInLML!=c&&c.Next.NextInLML!=c};l.Clipper.prototype.IsMaxima=function(c,d){return null!==c&&c.Top.Y==d&&null===c.NextInLML};l.Clipper.prototype.IsIntermediate=function(c,d){return c.Top.Y==d&&null!==c.NextInLML};l.Clipper.prototype.GetMaximaPair=function(c){var d=null;l.IntPoint.op_Equality(c.Next.Top,c.Top)&&null===c.Next.NextInLML?d=c.Next:l.IntPoint.op_Equality(c.Prev.Top,c.Top)&&null===c.Prev.NextInLML&&
(d=c.Prev);return null===d||-2!=d.OutIdx&&(d.NextInAEL!=d.PrevInAEL||l.ClipperBase.IsHorizontal(d))?d:null};l.Clipper.prototype.ProcessIntersections=function(c,d){if(null==this.m_ActiveEdges)return!0;try{this.BuildIntersectList(c,d);if(0==this.m_IntersectList.length)return!0;if(1==this.m_IntersectList.length||this.FixupIntersectionOrder())this.ProcessIntersectList();else return!1}catch(e){this.m_SortedEdges=null,this.m_IntersectList.length=0,l.Error("ProcessIntersections error")}this.m_SortedEdges=
null;return!0};l.Clipper.prototype.BuildIntersectList=function(c,d){if(null!==this.m_ActiveEdges){var e=this.m_ActiveEdges;for(this.m_SortedEdges=e;null!==e;)e.PrevInSEL=e.PrevInAEL,e.NextInSEL=e.NextInAEL,e.Curr.X=l.Clipper.TopX(e,d),e=e.NextInAEL;for(var f=!0;f&&null!==this.m_SortedEdges;){f=!1;for(e=this.m_SortedEdges;null!==e.NextInSEL;){var g=e.NextInSEL,h=new l.IntPoint;e.Curr.X>g.Curr.X?(h={Value:h},f=this.IntersectPoint(e,g,h),h=h.Value,!f&&e.Curr.X>g.Curr.X+1&&l.Error("Intersection error"),
h.Y>c&&(h.Y=c,Math.abs(e.Dx)>Math.abs(g.Dx)?h.X=l.Clipper.TopX(g,c):h.X=l.Clipper.TopX(e,c)),f=new l.IntersectNode,f.Edge1=e,f.Edge2=g,f.Pt.X=h.X,f.Pt.Y=h.Y,this.m_IntersectList.push(f),this.SwapPositionsInSEL(e,g),f=!0):e=g}if(null!==e.PrevInSEL)e.PrevInSEL.NextInSEL=null;else break}this.m_SortedEdges=null}};l.Clipper.prototype.EdgesAdjacent=function(c){return c.Edge1.NextInSEL==c.Edge2||c.Edge1.PrevInSEL==c.Edge2};l.Clipper.IntersectNodeSort=function(c,d){return d.Pt.Y-c.Pt.Y};l.Clipper.prototype.FixupIntersectionOrder=
function(){this.m_IntersectList.sort(this.m_IntersectNodeComparer);this.CopyAELToSEL();for(var c=this.m_IntersectList.length,d=0;d<c;d++){if(!this.EdgesAdjacent(this.m_IntersectList[d])){for(var e=d+1;e<c&&!this.EdgesAdjacent(this.m_IntersectList[e]);)e++;if(e==c)return!1;var f=this.m_IntersectList[d];this.m_IntersectList[d]=this.m_IntersectList[e];this.m_IntersectList[e]=f}this.SwapPositionsInSEL(this.m_IntersectList[d].Edge1,this.m_IntersectList[d].Edge2)}return!0};l.Clipper.prototype.ProcessIntersectList=
function(){for(var c=0,d=this.m_IntersectList.length;c<d;c++){var e=this.m_IntersectList[c];this.IntersectEdges(e.Edge1,e.Edge2,e.Pt,!0);this.SwapPositionsInAEL(e.Edge1,e.Edge2)}this.m_IntersectList.length=0};B=function(c){return 0>c?Math.ceil(c-.5):Math.round(c)};G=function(c){return 0>c?Math.ceil(c-.5):Math.floor(c+.5)};L=function(c){return 0>c?-Math.round(Math.abs(c)):Math.round(c)};w=function(c){if(0>c)return c-=.5,-2147483648>c?Math.ceil(c):c|0;c+=.5;return 2147483647<c?Math.floor(c):c|0};l.Clipper.Round=
C?B:A?L:H?w:G;l.Clipper.TopX=function(c,d){return d==c.Top.Y?c.Top.X:c.Bot.X+l.Clipper.Round(c.Dx*(d-c.Bot.Y))};l.Clipper.prototype.IntersectPoint=function(c,d,e){e.Value=new l.IntPoint;var f,g;if(l.ClipperBase.SlopesEqual(c,d,this.m_UseFullRange)||c.Dx==d.Dx)return d.Bot.Y>c.Bot.Y?(e.Value.X=d.Bot.X,e.Value.Y=d.Bot.Y):(e.Value.X=c.Bot.X,e.Value.Y=c.Bot.Y),!1;if(0===c.Delta.X)e.Value.X=c.Bot.X,l.ClipperBase.IsHorizontal(d)?e.Value.Y=d.Bot.Y:(g=d.Bot.Y-d.Bot.X/d.Dx,e.Value.Y=l.Clipper.Round(e.Value.X/
d.Dx+g));else if(0===d.Delta.X)e.Value.X=d.Bot.X,l.ClipperBase.IsHorizontal(c)?e.Value.Y=c.Bot.Y:(f=c.Bot.Y-c.Bot.X/c.Dx,e.Value.Y=l.Clipper.Round(e.Value.X/c.Dx+f));else{f=c.Bot.X-c.Bot.Y*c.Dx;g=d.Bot.X-d.Bot.Y*d.Dx;var h=(g-f)/(c.Dx-d.Dx);e.Value.Y=l.Clipper.Round(h);Math.abs(c.Dx)<Math.abs(d.Dx)?e.Value.X=l.Clipper.Round(c.Dx*h+f):e.Value.X=l.Clipper.Round(d.Dx*h+g)}if(e.Value.Y<c.Top.Y||e.Value.Y<d.Top.Y){if(c.Top.Y>d.Top.Y)return e.Value.Y=c.Top.Y,e.Value.X=l.Clipper.TopX(d,c.Top.Y),e.Value.X<
c.Top.X;e.Value.Y=d.Top.Y;Math.abs(c.Dx)<Math.abs(d.Dx)?e.Value.X=l.Clipper.TopX(c,e.Value.Y):e.Value.X=l.Clipper.TopX(d,e.Value.Y)}return!0};l.Clipper.prototype.ProcessEdgesAtTopOfScanbeam=function(c){for(var d=this.m_ActiveEdges;null!==d;){var e=this.IsMaxima(d,c);e&&(e=this.GetMaximaPair(d),e=null===e||!l.ClipperBase.IsHorizontal(e));if(e){var f=d.PrevInAEL;this.DoMaxima(d);d=null===f?this.m_ActiveEdges:f.NextInAEL}else this.IsIntermediate(d,c)&&l.ClipperBase.IsHorizontal(d.NextInLML)?(function(){d=
{Value:d};var c=this.UpdateEdgeIntoAEL(d);d=d.Value;return c}.call(this),0<=d.OutIdx&&this.AddOutPt(d,d.Bot),this.AddEdgeToSEL(d)):(d.Curr.X=l.Clipper.TopX(d,c),d.Curr.Y=c),this.StrictlySimple&&(f=d.PrevInAEL,0<=d.OutIdx&&0!==d.WindDelta&&null!==f&&0<=f.OutIdx&&f.Curr.X==d.Curr.X&&0!==f.WindDelta&&(e=this.AddOutPt(f,d.Curr),f=this.AddOutPt(d,d.Curr),this.AddJoin(e,f,d.Curr))),d=d.NextInAEL}this.ProcessHorizontals(!0);for(d=this.m_ActiveEdges;null!==d;){if(this.IsIntermediate(d,c)){e=null;0<=d.OutIdx&&
(e=this.AddOutPt(d,d.Top));(function(){d={Value:d};var c=this.UpdateEdgeIntoAEL(d);d=d.Value;return c}).call(this);var f=d.PrevInAEL,g=d.NextInAEL;null!==f&&f.Curr.X==d.Bot.X&&f.Curr.Y==d.Bot.Y&&null!==e&&0<=f.OutIdx&&f.Curr.Y>f.Top.Y&&l.ClipperBase.SlopesEqual(d,f,this.m_UseFullRange)&&0!==d.WindDelta&&0!==f.WindDelta?(f=this.AddOutPt(f,d.Bot),this.AddJoin(e,f,d.Top)):null!==g&&g.Curr.X==d.Bot.X&&g.Curr.Y==d.Bot.Y&&null!==e&&0<=g.OutIdx&&g.Curr.Y>g.Top.Y&&l.ClipperBase.SlopesEqual(d,g,this.m_UseFullRange)&&
0!==d.WindDelta&&0!==g.WindDelta&&(f=this.AddOutPt(g,d.Bot),this.AddJoin(e,f,d.Top))}d=d.NextInAEL}};l.Clipper.prototype.DoMaxima=function(c){var d=this.GetMaximaPair(c);if(null===d)0<=c.OutIdx&&this.AddOutPt(c,c.Top),this.DeleteFromAEL(c);else{for(var e=c.NextInAEL;null!==e&&e!=d;)this.IntersectEdges(c,e,c.Top,!0),this.SwapPositionsInAEL(c,e),e=c.NextInAEL;-1==c.OutIdx&&-1==d.OutIdx?(this.DeleteFromAEL(c),this.DeleteFromAEL(d)):0<=c.OutIdx&&0<=d.OutIdx?this.IntersectEdges(c,d,c.Top,!1):0===c.WindDelta?
(0<=c.OutIdx&&(this.AddOutPt(c,c.Top),c.OutIdx=-1),this.DeleteFromAEL(c),0<=d.OutIdx&&(this.AddOutPt(d,c.Top),d.OutIdx=-1),this.DeleteFromAEL(d)):l.Error("DoMaxima error")}};l.Clipper.ReversePaths=function(c){for(var d=0,e=c.length;d<e;d++)c[d].reverse()};l.Clipper.Orientation=function(c){return 0<=l.Clipper.Area(c)};l.Clipper.prototype.PointCount=function(c){if(null===c)return 0;var d=0,e=c;do d++,e=e.Next;while(e!=c);return d};l.Clipper.prototype.BuildResult=function(c){l.Clear(c);for(var d=0,e=
this.m_PolyOuts.length;d<e;d++){var f=this.m_PolyOuts[d];if(null!==f.Pts){var f=f.Pts.Prev,g=this.PointCount(f);if(!(2>g)){for(var h=Array(g),k=0;k<g;k++)h[k]=f.Pt,f=f.Prev;c.push(h)}}}};l.Clipper.prototype.BuildResult2=function(c){c.Clear();for(var d=0,e=this.m_PolyOuts.length;d<e;d++){var f=this.m_PolyOuts[d],g=this.PointCount(f.Pts);if(!(f.IsOpen&&2>g||!f.IsOpen&&3>g)){this.FixHoleLinkage(f);var h=new l.PolyNode;c.m_AllPolys.push(h);f.PolyNode=h;h.m_polygon.length=g;for(var f=f.Pts.Prev,k=0;k<
g;k++)h.m_polygon[k]=f.Pt,f=f.Prev}}d=0;for(e=this.m_PolyOuts.length;d<e;d++)f=this.m_PolyOuts[d],null!==f.PolyNode&&(f.IsOpen?(f.PolyNode.IsOpen=!0,c.AddChild(f.PolyNode)):null!==f.FirstLeft&&null!=f.FirstLeft.PolyNode?f.FirstLeft.PolyNode.AddChild(f.PolyNode):c.AddChild(f.PolyNode))};l.Clipper.prototype.FixupOutPolygon=function(c){var d=null;c.BottomPt=null;for(var e=c.Pts;;){if(e.Prev==e||e.Prev==e.Next){this.DisposeOutPts(e);c.Pts=null;return}if(l.IntPoint.op_Equality(e.Pt,e.Next.Pt)||l.IntPoint.op_Equality(e.Pt,
e.Prev.Pt)||l.ClipperBase.SlopesEqual(e.Prev.Pt,e.Pt,e.Next.Pt,this.m_UseFullRange)&&(!this.PreserveCollinear||!this.Pt2IsBetweenPt1AndPt3(e.Prev.Pt,e.Pt,e.Next.Pt)))d=null,e.Prev.Next=e.Next,e=e.Next.Prev=e.Prev;else if(e==d)break;else null===d&&(d=e),e=e.Next}c.Pts=e};l.Clipper.prototype.DupOutPt=function(c,d){var e=new l.OutPt;e.Pt.X=c.Pt.X;e.Pt.Y=c.Pt.Y;e.Idx=c.Idx;d?(e.Next=c.Next,e.Prev=c,c.Next.Prev=e,c.Next=e):(e.Prev=c.Prev,e.Next=c,c.Prev.Next=e,c.Prev=e);return e};l.Clipper.prototype.GetOverlap=
function(c,d,e,f,g,h){c<d?e<f?(g.Value=Math.max(c,e),h.Value=Math.min(d,f)):(g.Value=Math.max(c,f),h.Value=Math.min(d,e)):e<f?(g.Value=Math.max(d,e),h.Value=Math.min(c,f)):(g.Value=Math.max(d,f),h.Value=Math.min(c,e));return g.Value<h.Value};l.Clipper.prototype.JoinHorz=function(c,d,e,f,g,h){var k=c.Pt.X>d.Pt.X?l.Direction.dRightToLeft:l.Direction.dLeftToRight;f=e.Pt.X>f.Pt.X?l.Direction.dRightToLeft:l.Direction.dLeftToRight;if(k==f)return!1;if(k==l.Direction.dLeftToRight){for(;c.Next.Pt.X<=g.X&&
c.Next.Pt.X>=c.Pt.X&&c.Next.Pt.Y==g.Y;)c=c.Next;h&&c.Pt.X!=g.X&&(c=c.Next);d=this.DupOutPt(c,!h);l.IntPoint.op_Inequality(d.Pt,g)&&(c=d,c.Pt.X=g.X,c.Pt.Y=g.Y,d=this.DupOutPt(c,!h))}else{for(;c.Next.Pt.X>=g.X&&c.Next.Pt.X<=c.Pt.X&&c.Next.Pt.Y==g.Y;)c=c.Next;h||c.Pt.X==g.X||(c=c.Next);d=this.DupOutPt(c,h);l.IntPoint.op_Inequality(d.Pt,g)&&(c=d,c.Pt.X=g.X,c.Pt.Y=g.Y,d=this.DupOutPt(c,h))}if(f==l.Direction.dLeftToRight){for(;e.Next.Pt.X<=g.X&&e.Next.Pt.X>=e.Pt.X&&e.Next.Pt.Y==g.Y;)e=e.Next;h&&e.Pt.X!=
g.X&&(e=e.Next);f=this.DupOutPt(e,!h);l.IntPoint.op_Inequality(f.Pt,g)&&(e=f,e.Pt.X=g.X,e.Pt.Y=g.Y,f=this.DupOutPt(e,!h))}else{for(;e.Next.Pt.X>=g.X&&e.Next.Pt.X<=e.Pt.X&&e.Next.Pt.Y==g.Y;)e=e.Next;h||e.Pt.X==g.X||(e=e.Next);f=this.DupOutPt(e,h);l.IntPoint.op_Inequality(f.Pt,g)&&(e=f,e.Pt.X=g.X,e.Pt.Y=g.Y,f=this.DupOutPt(e,h))}k==l.Direction.dLeftToRight==h?(c.Prev=e,e.Next=c,d.Next=f,f.Prev=d):(c.Next=e,e.Prev=c,d.Prev=f,f.Next=d);return!0};l.Clipper.prototype.JoinPoints=function(c,d,e){var f=c.OutPt1,
g=new l.OutPt,h=c.OutPt2,k=new l.OutPt;if((k=c.OutPt1.Pt.Y==c.OffPt.Y)&&l.IntPoint.op_Equality(c.OffPt,c.OutPt1.Pt)&&l.IntPoint.op_Equality(c.OffPt,c.OutPt2.Pt)){for(g=c.OutPt1.Next;g!=f&&l.IntPoint.op_Equality(g.Pt,c.OffPt);)g=g.Next;g=g.Pt.Y>c.OffPt.Y;for(k=c.OutPt2.Next;k!=h&&l.IntPoint.op_Equality(k.Pt,c.OffPt);)k=k.Next;if(g==k.Pt.Y>c.OffPt.Y)return!1;g?(g=this.DupOutPt(f,!1),k=this.DupOutPt(h,!0),f.Prev=h,h.Next=f,g.Next=k,k.Prev=g):(g=this.DupOutPt(f,!0),k=this.DupOutPt(h,!1),f.Next=h,h.Prev=
f,g.Prev=k,k.Next=g);c.OutPt1=f;c.OutPt2=g;return!0}if(k){for(g=f;f.Prev.Pt.Y==f.Pt.Y&&f.Prev!=g&&f.Prev!=h;)f=f.Prev;for(;g.Next.Pt.Y==g.Pt.Y&&g.Next!=f&&g.Next!=h;)g=g.Next;if(g.Next==f||g.Next==h)return!1;for(k=h;h.Prev.Pt.Y==h.Pt.Y&&h.Prev!=k&&h.Prev!=g;)h=h.Prev;for(;k.Next.Pt.Y==k.Pt.Y&&k.Next!=h&&k.Next!=f;)k=k.Next;if(k.Next==h||k.Next==f)return!1;var n,p;n={Value:n};p={Value:p};d=this.GetOverlap(f.Pt.X,g.Pt.X,h.Pt.X,k.Pt.X,n,p);n=n.Value;p=p.Value;if(!d)return!1;d=new l.IntPoint;f.Pt.X>=
n&&f.Pt.X<=p?(d.X=f.Pt.X,d.Y=f.Pt.Y,e=f.Pt.X>g.Pt.X):h.Pt.X>=n&&h.Pt.X<=p?(d.X=h.Pt.X,d.Y=h.Pt.Y,e=h.Pt.X>k.Pt.X):g.Pt.X>=n&&g.Pt.X<=p?(d.X=g.Pt.X,d.Y=g.Pt.Y,e=g.Pt.X>f.Pt.X):(d.X=k.Pt.X,d.Y=k.Pt.Y,e=k.Pt.X>h.Pt.X);c.OutPt1=f;c.OutPt2=h;return this.JoinHorz(f,g,h,k,d,e)}for(g=f.Next;l.IntPoint.op_Equality(g.Pt,f.Pt)&&g!=f;)g=g.Next;if(n=g.Pt.Y>f.Pt.Y||!l.ClipperBase.SlopesEqual(f.Pt,g.Pt,c.OffPt,this.m_UseFullRange)){for(g=f.Prev;l.IntPoint.op_Equality(g.Pt,f.Pt)&&g!=f;)g=g.Prev;if(g.Pt.Y>f.Pt.Y||
!l.ClipperBase.SlopesEqual(f.Pt,g.Pt,c.OffPt,this.m_UseFullRange))return!1}for(k=h.Next;l.IntPoint.op_Equality(k.Pt,h.Pt)&&k!=h;)k=k.Next;if(p=k.Pt.Y>h.Pt.Y||!l.ClipperBase.SlopesEqual(h.Pt,k.Pt,c.OffPt,this.m_UseFullRange)){for(k=h.Prev;l.IntPoint.op_Equality(k.Pt,h.Pt)&&k!=h;)k=k.Prev;if(k.Pt.Y>h.Pt.Y||!l.ClipperBase.SlopesEqual(h.Pt,k.Pt,c.OffPt,this.m_UseFullRange))return!1}if(g==f||k==h||g==k||d==e&&n==p)return!1;n?(g=this.DupOutPt(f,!1),k=this.DupOutPt(h,!0),f.Prev=h,h.Next=f,g.Next=k,k.Prev=
g):(g=this.DupOutPt(f,!0),k=this.DupOutPt(h,!1),f.Next=h,h.Prev=f,g.Prev=k,k.Next=g);c.OutPt1=f;c.OutPt2=g;return!0};l.Clipper.GetBounds=function(c){for(var d=0,e=c.length;d<e&&0==c[d].length;)d++;if(d==e)return new l.IntRect(0,0,0,0);var f=new l.IntRect;f.left=c[d][0].X;f.right=f.left;f.top=c[d][0].Y;for(f.bottom=f.top;d<e;d++)for(var g=0,h=c[d].length;g<h;g++)c[d][g].X<f.left?f.left=c[d][g].X:c[d][g].X>f.right&&(f.right=c[d][g].X),c[d][g].Y<f.top?f.top=c[d][g].Y:c[d][g].Y>f.bottom&&(f.bottom=c[d][g].Y);
return f};l.Clipper.prototype.GetBounds2=function(c){var d=c,e=new l.IntRect;e.left=c.Pt.X;e.right=c.Pt.X;e.top=c.Pt.Y;e.bottom=c.Pt.Y;for(c=c.Next;c!=d;)c.Pt.X<e.left&&(e.left=c.Pt.X),c.Pt.X>e.right&&(e.right=c.Pt.X),c.Pt.Y<e.top&&(e.top=c.Pt.Y),c.Pt.Y>e.bottom&&(e.bottom=c.Pt.Y),c=c.Next;return e};l.ClipperBase.prototype.PointInPolygon=l.Clipper.prototype.PointInPolygon=function(){var d=arguments,e=d.length;if(2==e){for(var e=d[0],f=d[1],d=0,g=f;;){var h=f.Pt.X,k=f.Pt.Y,l=f.Next.Pt.X,n=f.Next.Pt.Y;
if(n==e.Y&&(l==e.X||k==e.Y&&l>e.X==h<e.X))return-1;if(k<e.Y!=n<e.Y)if(h>=e.X)if(l>e.X)d=1-d;else{h=(h-e.X)*(n-e.Y)-(l-e.X)*(k-e.Y);if(0==h)return-1;0<h==n>k&&(d=1-d)}else if(l>e.X){h=(h-e.X)*(n-e.Y)-(l-e.X)*(k-e.Y);if(0==h)return-1;0<h==n>k&&(d=1-d)}f=f.Next;if(g==f)break}return d}if(3==e){e=d[0];f=d[1];g=d[2];k=f;d=!1;if(g){do k.Pt.Y>e.Y!=k.Prev.Pt.Y>e.Y&&c.op_LessThan(new c(e.X-k.Pt.X),c.op_Division(c.Int128Mul(k.Prev.Pt.X-k.Pt.X,e.Y-k.Pt.Y),new c(k.Prev.Pt.Y-k.Pt.Y)))&&(d=!d),k=k.Next;while(k!=
f)}else{do k.Pt.Y>e.Y!=k.Prev.Pt.Y>e.Y&&e.X-k.Pt.X<(k.Prev.Pt.X-k.Pt.X)*(e.Y-k.Pt.Y)/(k.Prev.Pt.Y-k.Pt.Y)&&(d=!d),k=k.Next;while(k!=f)}return d}};l.Clipper.prototype.Poly2ContainsPoly1=function(c,d){var e=c;do{var f=this.PointInPolygon(e.Pt,d);if(0<=f)return 0!=f;e=e.Next}while(e!=c);return!0};l.Clipper.prototype.FixupFirstLefts1=function(c,d){for(var e=0,f=this.m_PolyOuts.length;e<f;e++){var g=this.m_PolyOuts[e];null!==g.Pts&&g.FirstLeft==c&&this.Poly2ContainsPoly1(g.Pts,d.Pts)&&(g.FirstLeft=d)}};
l.Clipper.prototype.FixupFirstLefts2=function(c,d){for(var e=0,f=this.m_PolyOuts,g=f.length,h=f[e];e<g;e++,h=f[e])h.FirstLeft==c&&(h.FirstLeft=d)};l.Clipper.ParseFirstLeft=function(c){for(;null!=c&&null==c.Pts;)c=c.FirstLeft;return c};l.Clipper.prototype.JoinCommonEdges=function(){for(var c=0,d=this.m_Joins.length;c<d;c++){var e=this.m_Joins[c],f=this.GetOutRec(e.OutPt1.Idx),g=this.GetOutRec(e.OutPt2.Idx);if(null!=f.Pts&&null!=g.Pts){var h;h=f==g?f:this.Param1RightOfParam2(f,g)?g:this.Param1RightOfParam2(g,
f)?f:this.GetLowermostRec(f,g);if(this.JoinPoints(e,f,g))if(f==g){f.Pts=e.OutPt1;f.BottomPt=null;g=this.CreateOutRec();g.Pts=e.OutPt2;this.UpdateOutPtIdxs(g);if(this.m_UsingPolyTree){h=0;for(var k=this.m_PolyOuts.length;h<k-1;h++){var n=this.m_PolyOuts[h];null!=n.Pts&&l.Clipper.ParseFirstLeft(n.FirstLeft)==f&&n.IsHole!=f.IsHole&&this.Poly2ContainsPoly1(n.Pts,e.OutPt2)&&(n.FirstLeft=g)}}this.Poly2ContainsPoly1(g.Pts,f.Pts)?(g.IsHole=!f.IsHole,g.FirstLeft=f,this.m_UsingPolyTree&&this.FixupFirstLefts2(g,
f),(g.IsHole^this.ReverseSolution)==0<this.Area(g)&&this.ReversePolyPtLinks(g.Pts)):this.Poly2ContainsPoly1(f.Pts,g.Pts)?(g.IsHole=f.IsHole,f.IsHole=!g.IsHole,g.FirstLeft=f.FirstLeft,f.FirstLeft=g,this.m_UsingPolyTree&&this.FixupFirstLefts2(f,g),(f.IsHole^this.ReverseSolution)==0<this.Area(f)&&this.ReversePolyPtLinks(f.Pts)):(g.IsHole=f.IsHole,g.FirstLeft=f.FirstLeft,this.m_UsingPolyTree&&this.FixupFirstLefts1(f,g))}else g.Pts=null,g.BottomPt=null,g.Idx=f.Idx,f.IsHole=h.IsHole,h==g&&(f.FirstLeft=
g.FirstLeft),g.FirstLeft=f,this.m_UsingPolyTree&&this.FixupFirstLefts2(g,f)}}};l.Clipper.prototype.UpdateOutPtIdxs=function(c){var d=c.Pts;do d.Idx=c.Idx,d=d.Prev;while(d!=c.Pts)};l.Clipper.prototype.DoSimplePolygons=function(){for(var c=0;c<this.m_PolyOuts.length;){var d=this.m_PolyOuts[c++],e=d.Pts;if(null!==e){do{for(var f=e.Next;f!=d.Pts;){if(l.IntPoint.op_Equality(e.Pt,f.Pt)&&f.Next!=e&&f.Prev!=e){var g=e.Prev,h=f.Prev;e.Prev=h;h.Next=e;f.Prev=g;g.Next=f;d.Pts=e;g=this.CreateOutRec();g.Pts=f;
this.UpdateOutPtIdxs(g);this.Poly2ContainsPoly1(g.Pts,d.Pts)?(g.IsHole=!d.IsHole,g.FirstLeft=d):this.Poly2ContainsPoly1(d.Pts,g.Pts)?(g.IsHole=d.IsHole,d.IsHole=!g.IsHole,g.FirstLeft=d.FirstLeft,d.FirstLeft=g):(g.IsHole=d.IsHole,g.FirstLeft=d.FirstLeft);f=e}f=f.Next}e=e.Next}while(e!=d.Pts)}}};l.Clipper.Area=function(c){var d=c.length;if(3>d)return 0;for(var e=0,f=0,g=d-1;f<d;++f)e+=(c[g].X+c[f].X)*(c[g].Y-c[f].Y),g=f;return.5*-e};l.Clipper.prototype.Area=function(c){var d=c.Pts;if(null==d)return 0;
var e=0;do e+=(d.Prev.Pt.X+d.Pt.X)*(d.Prev.Pt.Y-d.Pt.Y),d=d.Next;while(d!=c.Pts);return.5*e};l.Clipper.SimplifyPolygon=function(c,d){var e=[],f=new l.Clipper(0);f.StrictlySimple=!0;f.AddPath(c,l.PolyType.ptSubject,!0);f.Execute(l.ClipType.ctUnion,e,d,d);return e};l.Clipper.SimplifyPolygons=function(c,d){"undefined"==typeof d&&(d=l.PolyFillType.pftEvenOdd);var e=[],f=new l.Clipper(0);f.StrictlySimple=!0;f.AddPaths(c,l.PolyType.ptSubject,!0);f.Execute(l.ClipType.ctUnion,e,d,d);return e};l.Clipper.DistanceSqrd=
function(c,d){var e=c.X-d.X,f=c.Y-d.Y;return e*e+f*f};l.Clipper.DistanceFromLineSqrd=function(c,d,e){var f=d.Y-e.Y;e=e.X-d.X;d=f*d.X+e*d.Y;d=f*c.X+e*c.Y-d;return d*d/(f*f+e*e)};l.Clipper.SlopesNearCollinear=function(c,d,e,f){return l.Clipper.DistanceFromLineSqrd(d,c,e)<f};l.Clipper.PointsAreClose=function(c,d,e){var f=c.X-d.X;c=c.Y-d.Y;return f*f+c*c<=e};l.Clipper.ExcludeOp=function(c){var d=c.Prev;d.Next=c.Next;c.Next.Prev=d;d.Idx=0;return d};l.Clipper.CleanPolygon=function(c,d){"undefined"==typeof d&&
(d=1.415);var e=c.length;if(0==e)return[];for(var f=Array(e),g=0;g<e;++g)f[g]=new l.OutPt;for(g=0;g<e;++g)f[g].Pt=c[g],f[g].Next=f[(g+1)%e],f[g].Next.Prev=f[g],f[g].Idx=0;g=d*d;for(f=f[0];0==f.Idx&&f.Next!=f.Prev;)l.Clipper.PointsAreClose(f.Pt,f.Prev.Pt,g)?(f=l.Clipper.ExcludeOp(f),e--):l.Clipper.PointsAreClose(f.Prev.Pt,f.Next.Pt,g)?(l.Clipper.ExcludeOp(f.Next),f=l.Clipper.ExcludeOp(f),e-=2):l.Clipper.SlopesNearCollinear(f.Prev.Pt,f.Pt,f.Next.Pt,g)?(f=l.Clipper.ExcludeOp(f),e--):(f.Idx=1,f=f.Next);
3>e&&(e=0);for(var h=Array(e),g=0;g<e;++g)h[g]=new l.IntPoint(f.Pt),f=f.Next;return h};l.Clipper.CleanPolygons=function(c,d){for(var e=Array(c.length),f=0,g=c.length;f<g;f++)e[f]=l.Clipper.CleanPolygon(c[f],d);return e};l.Clipper.Minkowski=function(c,d,e,f){var g=f?1:0,h=c.length,k=d.length;f=[];if(e)for(e=0;e<k;e++){for(var n=Array(h),p=0,q=c.length,r=c[p];p<q;p++,r=c[p])n[p]=new l.IntPoint(d[e].X+r.X,d[e].Y+r.Y);f.push(n)}else for(e=0;e<k;e++){n=Array(h);p=0;q=c.length;for(r=c[p];p<q;p++,r=c[p])n[p]=
new l.IntPoint(d[e].X-r.X,d[e].Y-r.Y);f.push(n)}c=[];for(e=0;e<=k-2+g;e++)for(p=0;p<=h-1;p++)d=[],d.push(f[e%k][p%h]),d.push(f[(e+1)%k][p%h]),d.push(f[(e+1)%k][(p+1)%h]),d.push(f[e%k][(p+1)%h]),l.Clipper.Orientation(d)||d.reverse(),c.push(d);g=new l.Clipper(0);g.AddPaths(c,l.PolyType.ptSubject,!0);g.Execute(l.ClipType.ctUnion,f,l.PolyFillType.pftNonZero,l.PolyFillType.pftNonZero);return f};l.Clipper.MinkowskiSum=function(c,d,e){return l.Clipper.Minkowski(c,d,!0,e)};l.Clipper.MinkowskiDiff=function(c,
d,e){return l.Clipper.Minkowski(c,d,!1,e)};l.Clipper.PolyTreeToPaths=function(c){var d=[];l.Clipper.AddPolyNodeToPaths(c,l.Clipper.NodeType.ntAny,d);return d};l.Clipper.AddPolyNodeToPaths=function(c,d,e){var f=!0;switch(d){case l.Clipper.NodeType.ntOpen:return;case l.Clipper.NodeType.ntClosed:f=!c.IsOpen}0<c.m_polygon.length&&f&&e.push(c.m_polygon);f=0;c=c.Childs();for(var g=c.length,h=c[f];f<g;f++,h=c[f])l.Clipper.AddPolyNodeToPaths(h,d,e)};l.Clipper.OpenPathsFromPolyTree=function(c){for(var d=new l.Paths,
e=0,f=c.ChildCount();e<f;e++)c.Childs()[e].IsOpen&&d.push(c.Childs()[e].m_polygon);return d};l.Clipper.ClosedPathsFromPolyTree=function(c){var d=new l.Paths;l.Clipper.AddPolyNodeToPaths(c,l.Clipper.NodeType.ntClosed,d);return d};S(l.Clipper,l.ClipperBase);l.Clipper.NodeType={ntAny:0,ntOpen:1,ntClosed:2};l.ClipperOffset=function(c,d){"undefined"==typeof c&&(c=2);"undefined"==typeof d&&(d=l.ClipperOffset.def_arc_tolerance);this.m_destPolys=new l.Paths;this.m_srcPoly=new l.Path;this.m_destPoly=new l.Path;
this.m_normals=[];this.m_StepsPerRad=this.m_miterLim=this.m_cos=this.m_sin=this.m_sinA=this.m_delta=0;this.m_lowest=new l.IntPoint;this.m_polyNodes=new l.PolyNode;this.MiterLimit=c;this.ArcTolerance=d;this.m_lowest.X=-1};l.ClipperOffset.two_pi=6.28318530717959;l.ClipperOffset.def_arc_tolerance=.25;l.ClipperOffset.prototype.Clear=function(){l.Clear(this.m_polyNodes.Childs());this.m_lowest.X=-1};l.ClipperOffset.Round=l.Clipper.Round;l.ClipperOffset.prototype.AddPath=function(c,d,e){var f=c.length-1;
if(!(0>f)){var g=new l.PolyNode;g.m_jointype=d;g.m_endtype=e;if(e==l.EndType.etClosedLine||e==l.EndType.etClosedPolygon)for(;0<f&&l.IntPoint.op_Equality(c[0],c[f]);)f--;g.m_polygon.push(c[0]);var h=0;d=0;for(var k=1;k<=f;k++)l.IntPoint.op_Inequality(g.m_polygon[h],c[k])&&(h++,g.m_polygon.push(c[k]),c[k].Y>g.m_polygon[d].Y||c[k].Y==g.m_polygon[d].Y&&c[k].X<g.m_polygon[d].X)&&(d=h);if(!(e==l.EndType.etClosedPolygon&&2>h||e!=l.EndType.etClosedPolygon&&0>h)&&(this.m_polyNodes.AddChild(g),e==l.EndType.etClosedPolygon))if(0>
this.m_lowest.X)this.m_lowest=new l.IntPoint(0,d);else if(c=this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon[this.m_lowest.Y],g.m_polygon[d].Y>c.Y||g.m_polygon[d].Y==c.Y&&g.m_polygon[d].X<c.X)this.m_lowest=new l.IntPoint(this.m_polyNodes.ChildCount()-1,d)}};l.ClipperOffset.prototype.AddPaths=function(c,d,e){for(var f=0,g=c.length;f<g;f++)this.AddPath(c[f],d,e)};l.ClipperOffset.prototype.FixOrientations=function(){if(0<=this.m_lowest.X&&!l.Clipper.Orientation(this.m_polyNodes.Childs()[this.m_lowest.X].m_polygon))for(var c=
0;c<this.m_polyNodes.ChildCount();c++){var d=this.m_polyNodes.Childs()[c];(d.m_endtype==l.EndType.etClosedPolygon||d.m_endtype==l.EndType.etClosedLine&&l.Clipper.Orientation(d.m_polygon))&&d.m_polygon.reverse()}else for(c=0;c<this.m_polyNodes.ChildCount();c++)d=this.m_polyNodes.Childs()[c],d.m_endtype!=l.EndType.etClosedLine||l.Clipper.Orientation(d.m_polygon)||d.m_polygon.reverse()};l.ClipperOffset.GetUnitNormal=function(c,d){var e=d.X-c.X,f=d.Y-c.Y;if(0==e&&0==f)return new l.DoublePoint(0,0);var g=
1/Math.sqrt(e*e+f*f);return new l.DoublePoint(f*g,-(e*g))};l.ClipperOffset.prototype.DoOffset=function(c){this.m_destPolys=[];this.m_delta=c;if(l.ClipperBase.near_zero(c))for(var d=0;d<this.m_polyNodes.ChildCount();d++){var e=this.m_polyNodes.Childs()[d];e.m_endtype==l.EndType.etClosedPolygon&&this.m_destPolys.push(e.m_polygon)}else{this.m_miterLim=2<this.MiterLimit?2/(this.MiterLimit*this.MiterLimit):.5;var d=0>=this.ArcTolerance?l.ClipperOffset.def_arc_tolerance:this.ArcTolerance>Math.abs(c)*l.ClipperOffset.def_arc_tolerance?
Math.abs(c)*l.ClipperOffset.def_arc_tolerance:this.ArcTolerance,f=3.14159265358979/Math.acos(1-d/Math.abs(c));this.m_sin=Math.sin(l.ClipperOffset.two_pi/f);this.m_cos=Math.cos(l.ClipperOffset.two_pi/f);this.m_StepsPerRad=f/l.ClipperOffset.two_pi;0>c&&(this.m_sin=-this.m_sin);for(d=0;d<this.m_polyNodes.ChildCount();d++){e=this.m_polyNodes.Childs()[d];this.m_srcPoly=e.m_polygon;var g=this.m_srcPoly.length;if(!(0==g||0>=c&&(3>g||e.m_endtype!=l.EndType.etClosedPolygon))){this.m_destPoly=[];if(1==g)if(e.m_jointype==
l.JoinType.jtRound)for(var e=1,g=0,h=1;h<=f;h++){this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[0].X+e*c),l.ClipperOffset.Round(this.m_srcPoly[0].Y+g*c)));var k=e,e=e*this.m_cos-this.m_sin*g,g=k*this.m_sin+g*this.m_cos}else for(g=e=-1,h=0;4>h;++h)this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[0].X+e*c),l.ClipperOffset.Round(this.m_srcPoly[0].Y+g*c))),0>e?e=1:0>g?g=1:e=-1;else{for(h=this.m_normals.length=0;h<g-1;h++)this.m_normals.push(l.ClipperOffset.GetUnitNormal(this.m_srcPoly[h],
this.m_srcPoly[h+1]));e.m_endtype==l.EndType.etClosedLine||e.m_endtype==l.EndType.etClosedPolygon?this.m_normals.push(l.ClipperOffset.GetUnitNormal(this.m_srcPoly[g-1],this.m_srcPoly[0])):this.m_normals.push(new l.DoublePoint(this.m_normals[g-2]));if(e.m_endtype==l.EndType.etClosedPolygon)for(k=g-1,h=0;h<g;h++)k=this.OffsetPoint(h,k,e.m_jointype);else if(e.m_endtype==l.EndType.etClosedLine){k=g-1;for(h=0;h<g;h++)k=this.OffsetPoint(h,k,e.m_jointype);this.m_destPolys.push(this.m_destPoly);this.m_destPoly=
[];k=this.m_normals[g-1];for(h=g-1;0<h;h--)this.m_normals[h]=new l.DoublePoint(-this.m_normals[h-1].X,-this.m_normals[h-1].Y);this.m_normals[0]=new l.DoublePoint(-k.X,-k.Y);k=0;for(h=g-1;0<=h;h--)k=this.OffsetPoint(h,k,e.m_jointype)}else{k=0;for(h=1;h<g-1;++h)k=this.OffsetPoint(h,k,e.m_jointype);e.m_endtype==l.EndType.etOpenButt?(h=g-1,k=new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[h].X+this.m_normals[h].X*c),l.ClipperOffset.Round(this.m_srcPoly[h].Y+this.m_normals[h].Y*c)),this.m_destPoly.push(k),
k=new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[h].X-this.m_normals[h].X*c),l.ClipperOffset.Round(this.m_srcPoly[h].Y-this.m_normals[h].Y*c)),this.m_destPoly.push(k)):(h=g-1,k=g-2,this.m_sinA=0,this.m_normals[h]=new l.DoublePoint(-this.m_normals[h].X,-this.m_normals[h].Y),e.m_endtype==l.EndType.etOpenSquare?this.DoSquare(h,k):this.DoRound(h,k));for(h=g-1;0<h;h--)this.m_normals[h]=new l.DoublePoint(-this.m_normals[h-1].X,-this.m_normals[h-1].Y);this.m_normals[0]=new l.DoublePoint(-this.m_normals[1].X,
-this.m_normals[1].Y);k=g-1;for(h=k-1;0<h;--h)k=this.OffsetPoint(h,k,e.m_jointype);e.m_endtype==l.EndType.etOpenButt?(k=new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[0].X-this.m_normals[0].X*c),l.ClipperOffset.Round(this.m_srcPoly[0].Y-this.m_normals[0].Y*c)),this.m_destPoly.push(k),k=new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[0].X+this.m_normals[0].X*c),l.ClipperOffset.Round(this.m_srcPoly[0].Y+this.m_normals[0].Y*c)),this.m_destPoly.push(k)):(this.m_sinA=0,e.m_endtype==l.EndType.etOpenSquare?
this.DoSquare(0,1):this.DoRound(0,1))}}this.m_destPolys.push(this.m_destPoly)}}}};l.ClipperOffset.prototype.Execute=function(){var c=arguments;if(c[0]instanceof l.PolyTree)if(d=c[0],e=c[1],d.Clear(),this.FixOrientations(),this.DoOffset(e),c=new l.Clipper(0),c.AddPaths(this.m_destPolys,l.PolyType.ptSubject,!0),0<e)c.Execute(l.ClipType.ctUnion,d,l.PolyFillType.pftPositive,l.PolyFillType.pftPositive);else if(e=l.Clipper.GetBounds(this.m_destPolys),f=new l.Path,f.push(new l.IntPoint(e.left-10,e.bottom+
10)),f.push(new l.IntPoint(e.right+10,e.bottom+10)),f.push(new l.IntPoint(e.right+10,e.top-10)),f.push(new l.IntPoint(e.left-10,e.top-10)),c.AddPath(f,l.PolyType.ptSubject,!0),c.ReverseSolution=!0,c.Execute(l.ClipType.ctUnion,d,l.PolyFillType.pftNegative,l.PolyFillType.pftNegative),1==d.ChildCount()&&0<d.Childs()[0].ChildCount())for(c=d.Childs()[0],d.Childs()[0]=c.Childs()[0],e=1;e<c.ChildCount();e++)d.AddChild(c.Childs()[e]);else d.Clear();else{var d=c[0],e=c[1];l.Clear(d);this.FixOrientations();
this.DoOffset(e);c=new l.Clipper(0);c.AddPaths(this.m_destPolys,l.PolyType.ptSubject,!0);if(0<e)c.Execute(l.ClipType.ctUnion,d,l.PolyFillType.pftPositive,l.PolyFillType.pftPositive);else{var e=l.Clipper.GetBounds(this.m_destPolys),f=new l.Path;f.push(new l.IntPoint(e.left-10,e.bottom+10));f.push(new l.IntPoint(e.right+10,e.bottom+10));f.push(new l.IntPoint(e.right+10,e.top-10));f.push(new l.IntPoint(e.left-10,e.top-10));c.AddPath(f,l.PolyType.ptSubject,!0);c.ReverseSolution=!0;c.Execute(l.ClipType.ctUnion,
d,l.PolyFillType.pftNegative,l.PolyFillType.pftNegative);0<d.length&&d.splice(0,1)}}};l.ClipperOffset.prototype.OffsetPoint=function(c,d,e){this.m_sinA=this.m_normals[d].X*this.m_normals[c].Y-this.m_normals[c].X*this.m_normals[d].Y;if(5E-5>this.m_sinA&&-5E-5<this.m_sinA)return d;1<this.m_sinA?this.m_sinA=1:-1>this.m_sinA&&(this.m_sinA=-1);if(0>this.m_sinA*this.m_delta)this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[c].X+this.m_normals[d].X*this.m_delta),l.ClipperOffset.Round(this.m_srcPoly[c].Y+
this.m_normals[d].Y*this.m_delta))),this.m_destPoly.push(new l.IntPoint(this.m_srcPoly[c])),this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[c].X+this.m_normals[c].X*this.m_delta),l.ClipperOffset.Round(this.m_srcPoly[c].Y+this.m_normals[c].Y*this.m_delta)));else switch(e){case l.JoinType.jtMiter:e=1+(this.m_normals[c].X*this.m_normals[d].X+this.m_normals[c].Y*this.m_normals[d].Y);e>=this.m_miterLim?this.DoMiter(c,d,e):this.DoSquare(c,d);break;case l.JoinType.jtSquare:this.DoSquare(c,
d);break;case l.JoinType.jtRound:this.DoRound(c,d)}return c};l.ClipperOffset.prototype.DoSquare=function(c,d){var e=Math.tan(Math.atan2(this.m_sinA,this.m_normals[d].X*this.m_normals[c].X+this.m_normals[d].Y*this.m_normals[c].Y)/4);this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[c].X+this.m_delta*(this.m_normals[d].X-this.m_normals[d].Y*e)),l.ClipperOffset.Round(this.m_srcPoly[c].Y+this.m_delta*(this.m_normals[d].Y+this.m_normals[d].X*e))));this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[c].X+
this.m_delta*(this.m_normals[c].X+this.m_normals[c].Y*e)),l.ClipperOffset.Round(this.m_srcPoly[c].Y+this.m_delta*(this.m_normals[c].Y-this.m_normals[c].X*e))))};l.ClipperOffset.prototype.DoMiter=function(c,d,e){e=this.m_delta/e;this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[c].X+(this.m_normals[d].X+this.m_normals[c].X)*e),l.ClipperOffset.Round(this.m_srcPoly[c].Y+(this.m_normals[d].Y+this.m_normals[c].Y)*e)))};l.ClipperOffset.prototype.DoRound=function(c,d){for(var e=Math.atan2(this.m_sinA,
this.m_normals[d].X*this.m_normals[c].X+this.m_normals[d].Y*this.m_normals[c].Y),e=l.Cast_Int32(l.ClipperOffset.Round(this.m_StepsPerRad*Math.abs(e))),f=this.m_normals[d].X,g=this.m_normals[d].Y,h,k=0;k<e;++k)this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[c].X+f*this.m_delta),l.ClipperOffset.Round(this.m_srcPoly[c].Y+g*this.m_delta))),h=f,f=f*this.m_cos-this.m_sin*g,g=h*this.m_sin+g*this.m_cos;this.m_destPoly.push(new l.IntPoint(l.ClipperOffset.Round(this.m_srcPoly[c].X+
this.m_normals[c].X*this.m_delta),l.ClipperOffset.Round(this.m_srcPoly[c].Y+this.m_normals[c].Y*this.m_delta)))};l.Error=function(c){try{throw Error(c);}catch(d){alert(d.message)}};l.JS={};l.JS.AreaOfPolygon=function(c,d){d||(d=1);return l.Clipper.Area(c)/(d*d)};l.JS.AreaOfPolygons=function(c,d){d||(d=1);for(var e=0,f=0;f<c.length;f++)e+=l.Clipper.Area(c[f]);return e/(d*d)};l.JS.BoundsOfPath=function(c,d){return l.JS.BoundsOfPaths([c],d)};l.JS.BoundsOfPaths=function(c,d){d||(d=1);var e=l.Clipper.GetBounds(c);
e.left/=d;e.bottom/=d;e.right/=d;e.top/=d;return e};l.JS.Clean=function(c,d){if(!(c instanceof Array))return[];var e=c[0]instanceof Array;c=l.JS.Clone(c);if("number"!=typeof d||null===d)return l.Error("Delta is not a number in Clean()."),c;if(0===c.length||1==c.length&&0===c[0].length||0>d)return c;e||(c=[c]);for(var f=c.length,g,h,k,n,p,q,r,s=[],t=0;t<f;t++)if(h=c[t],g=h.length,0!==g)if(3>g)k=h,s.push(k);else{k=h;n=d*d;p=h[0];for(r=q=1;r<g;r++)(h[r].X-p.X)*(h[r].X-p.X)+(h[r].Y-p.Y)*(h[r].Y-p.Y)<=
n||(k[q]=h[r],p=h[r],q++);p=h[q-1];(h[0].X-p.X)*(h[0].X-p.X)+(h[0].Y-p.Y)*(h[0].Y-p.Y)<=n&&q--;q<g&&k.splice(q,g-q);k.length&&s.push(k)}!e&&s.length?s=s[0]:e||0!==s.length?e&&0===s.length&&(s=[[]]):s=[];return s};l.JS.Clone=function(c){if(!(c instanceof Array)||0===c.length)return[];if(1==c.length&&0===c[0].length)return[[]];var d=c[0]instanceof Array;d||(c=[c]);var e=c.length,f,g,h,k,l=Array(e);for(g=0;g<e;g++){f=c[g].length;k=Array(f);for(h=0;h<f;h++)k[h]={X:c[g][h].X,Y:c[g][h].Y};l[g]=k}d||(l=
l[0]);return l};l.JS.Lighten=function(c,d){if(!(c instanceof Array))return[];if("number"!=typeof d||null===d)return l.Error("Tolerance is not a number in Lighten()."),l.JS.Clone(c);if(0===c.length||1==c.length&&0===c[0].length||0>d)return l.JS.Clone(c);c[0]instanceof Array||(c=[c]);var e,f,g,h,k,n,p,q,r,s,t,u,v,w,x,y=c.length,z=d*d,A=[];for(e=0;e<y;e++)if(g=c[e],n=g.length,0!=n){for(h=0;1E6>h;h++){k=[];n=g.length;g[n-1].X!=g[0].X||g[n-1].Y!=g[0].Y?(t=1,g.push({X:g[0].X,Y:g[0].Y}),n=g.length):t=0;
s=[];for(f=0;f<n-2;f++){p=g[f];r=g[f+1];q=g[f+2];w=p.X;x=p.Y;p=q.X-w;u=q.Y-x;if(0!==p||0!==u)v=((r.X-w)*p+(r.Y-x)*u)/(p*p+u*u),1<v?(w=q.X,x=q.Y):0<v&&(w+=p*v,x+=u*v);p=r.X-w;u=r.Y-x;q=p*p+u*u;q<=z&&(s[f+1]=1,f++)}k.push({X:g[0].X,Y:g[0].Y});for(f=1;f<n-1;f++)s[f]||k.push({X:g[f].X,Y:g[f].Y});k.push({X:g[n-1].X,Y:g[n-1].Y});t&&g.pop();if(s.length)g=k;else break}n=k.length;k[n-1].X==k[0].X&&k[n-1].Y==k[0].Y&&k.pop();2<k.length&&A.push(k)}!c[0]instanceof Array&&(A=A[0]);"undefined"==typeof A&&(A=[[]]);
return A};l.JS.PerimeterOfPath=function(c,d,e){if("undefined"==typeof c)return 0;var f=Math.sqrt,g=0,h,k,l=0,n=0,p=c.length;if(2>p)return 0;for(d&&(c[p]=c[0],p++);--p;)h=c[p],l=h.X,h=h.Y,k=c[p-1],n=k.X,k=k.Y,g+=f((l-n)*(l-n)+(h-k)*(h-k));d&&c.pop();return g/e};l.JS.PerimeterOfPaths=function(c,d,e){e||(e=1);for(var f=0,g=0;g<c.length;g++)f+=l.JS.PerimeterOfPath(c[g],d,e);return f};l.JS.ScaleDownPath=function(c,d){var e,f;d||(d=1);for(e=c.length;e--;)f=c[e],f.X/=d,f.Y/=d};l.JS.ScaleDownPaths=function(c,
d){var e,f,g;d||(d=1);for(e=c.length;e--;)for(f=c[e].length;f--;)g=c[e][f],g.X/=d,g.Y/=d};l.JS.ScaleUpPath=function(c,d){var e,f,g=Math.round;d||(d=1);for(e=c.length;e--;)f=c[e],f.X=g(f.X*d),f.Y=g(f.Y*d)};l.JS.ScaleUpPaths=function(c,d){var e,f,g,h=Math.round;d||(d=1);for(e=c.length;e--;)for(f=c[e].length;f--;)g=c[e][f],g.X=h(g.X*d),g.Y=h(g.Y*d)};l.ExPolygons=function(){return[]};l.ExPolygon=function(){this.holes=this.outer=null};l.JS.AddOuterPolyNodeToExPolygons=function(c,d){var e=new l.ExPolygon;
e.outer=c.Contour();var f=c.Childs(),g=f.length;e.holes=Array(g);var h,k,n,p,q;for(k=0;k<g;k++)for(h=f[k],e.holes[k]=h.Contour(),n=0,p=h.Childs(),q=p.length;n<q;n++)h=p[n],l.JS.AddOuterPolyNodeToExPolygons(h,d);d.push(e)};l.JS.ExPolygonsToPaths=function(c){var d,e,f,g,h=new l.Paths;d=0;for(f=c.length;d<f;d++)for(h.push(c[d].outer),e=0,g=c[d].holes.length;e<g;e++)h.push(c[d].holes[e]);return h};l.JS.PolyTreeToExPolygons=function(c){var d=new l.ExPolygons,e,f,g;e=0;f=c.Childs();for(g=f.length;e<g;e++)c=
f[e],l.JS.AddOuterPolyNodeToExPolygons(c,d);return d}})();
//# sourceMappingURL=Cindy.js.map

