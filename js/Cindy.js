var mouse={},move,cskey="",cskeycode=0;movepoint=function(c){void 0!=c.mover&&(m=c.mover,m.sx=mouse.x+c.offset.x,m.sy=mouse.y+c.offset.y,m.sz=1,m.homog=List.realVector([m.sx,m.sy,m.sz]))};movepointscr=function(c,e){m=c;m.sx=e.value[0].value.real;m.sy=e.value[1].value.real;m.sz=1;m.homog=e};
getmover=function(c){for(var e,d=1E6,f,g,h=0;h<csgeo.free.length;h++){var k=csgeo.free[h],l,p;if("P"==k.kind){l=k.sx-c.x;p=k.sy-c.y;var n=Math.sqrt(l*l+p*p)}"C"==k.kind&&(p=csgeo.csnames[k.args[0]],g=k.radius,l=CSNumber.div(p.homog.value[0],p.homog.value[2]).value.real,p=CSNumber.div(p.homog.value[1],p.homog.value[2]).value.real,l-=c.x,p-=c.y,n=Math.sqrt(l*l+p*p)-g.value.real,g=-n,p=l=0,0>n&&(n=-n),n+=1);"L"==k.kind&&(l=List.normalizeZ(k.homog),p=CSNumber,n=p.add(p.mult(l.value[0],p.conjugate(l.value[0])),
p.mult(l.value[1],p.conjugate(l.value[1]))),p=List.scaldiv(p.sqrt(n),l),n=p.value[0].value.real*c.x+p.value[1].value.real*c.y+p.value[2].value.real,l=p.value[0].value.real*n,p=p.value[1].value.real*n,0>n&&(n=-n),n+=1);n<d+.2&&(d=n,e=k,f={x:l,y:p})}return{mover:e,offset:f,offsetrad:g}};
setuplisteners=function(c){function e(c){mouse.down=!1;updateCindy();cs_mouseup();c.preventDefault()}updatePostition=function(c,e){var g=csport.to(c,e);mouse.prevx=mouse.x;mouse.prevy=mouse.y;mouse.x=g[0];mouse.y=g[1];csmouse[0]=mouse.x;csmouse[1]=mouse.y};document.onkeydown=function(c){cs_keypressed(c);return!1};c.onmousedown=function(d){mouse.button=d.which;var e=c.getBoundingClientRect();updatePostition(d.clientX-e.left,d.clientY-e.top);cs_mousedown();move=getmover(mouse);startit();mouse.down=
!0;d.preventDefault()};c.onmouseup=function(c){mouse.down=!1;cs_mouseup();updateCindy();c.preventDefault()};c.onmousemove=function(d){var e=c.getBoundingClientRect();updatePostition(d.clientX-e.left,d.clientY-e.top);mouse.down?(movepoint(move),cs_mousedrag()):cs_mousemove();d.preventDefault()};c.addEventListener("touchstart",function(d){d||(d=event);updatePostition(d.targetTouches[0].pageX-c.offsetLeft,d.targetTouches[0].pageY-c.offsetTop);cs_mousedown();mouse.down=!0;move=getmover(mouse);startit();
d.preventDefault()},!1);c.addEventListener("touchmove",function(d){d||(d=event);updatePostition(d.targetTouches[0].pageX-c.offsetLeft,d.targetTouches[0].pageY-c.offsetTop);mouse.down?(movepoint(move),cs_mousedrag()):cs_mousemove();d.preventDefault()},!0);c.addEventListener("touchend",e,!1);document.body.addEventListener("touchcancel",e,!1);updateCindy()};
window.requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c){window.setTimeout(c,0)};var doit=function(){csanimating&&cs_tick();updateCindy();csticking=csanimating||mouse.down;return!csticking},startit=function(){csticking||(csticking=!0,d3.timer(doit))};
function updateCindy(){recalc();csctx.save();csctx.clearRect(0,0,csw,csh);evaluate(cscompiled.move);render();csctx.restore()}function update(){updateCindy();mouse.down&&requestAnimFrame(update)}
var cs_keypressed=function(c){c=window.event?event:c;c=c.charCode?c.charCode:c.keyCode;cskey=String.fromCharCode(c);cskeycode=c;evaluate(cscompiled.keydown);updateCindy()},cs_mousedown=function(c){evaluate(cscompiled.mousedown)},cs_mouseup=function(c){evaluate(cscompiled.mouseup)},cs_mousedrag=function(c){evaluate(cscompiled.mousedrag)},cs_mousemove=function(c){evaluate(cscompiled.mousemove)},cs_tick=function(c){"undefined"!==typeof lab&&lab.tick();csanimating&&evaluate(cscompiled.tick)};var csconsole,cslib,cscompiled={},csanimating=!1,csticking=!1;dump=function(c){console.log(JSON.stringify(c))};dumpcs=function(c){console.log(niceprint(c))};evalcs=function(c){c=evaluator.parse([General.wrap(c)],[]);c=evaluate(c);dumpcs(c)};evokeCS=function(c){c=condense(c);c=analyse(c,!1);console.log(c);evaluate(c);evaluate(cscompiled.draw)};
createCindy=function(c){csmouse=[100,100];cscount=0;var e,d=document.getElementById(c.canvasname);csctx=d.getContext("2d");"move keydown mousedown mouseup mousedrag init tick".split(" ").forEach(function(d){var f=d+"script";c[f]&&(e=document.getElementById(c[f]).text,e=condense(e),cscompiled[d]=analyse(e,!1))});csw=d.width;csh=d.height;csport.drawingstate.matrix.ty-=csh;csport.drawingstate.initialmatrix.ty-=csh;csgeo={};images={};c.geometry||(c.geometry=[]);csinit(c.geometry);c.behavior||(c.behavior=
[]);"function"==typeof csinitphys&&csinitphys(c.behavior);for(var f in c.images)d=c.images[f],images[f]=new Image,images[f].ready=!1,images[f].onload=function(){images[f].ready=!0;updateCindy()},images[f].src=d;evaluate(cscompiled.init);setuplisteners(document.getElementById(c.canvasname))};backup=[];
var backupGeo=function(){backup=[];for(var c=0;c<csgeo.points.length;c++){var e=csgeo.points[c],d={name:JSON.stringify(e.name),homog:JSON.stringify(e.homog),sx:JSON.stringify(e.sx),sy:JSON.stringify(e.sy),sz:JSON.stringify(e.sz)};"undefined"!==typeof e.behavior&&(d.vx=JSON.stringify(e.behavior.vx),d.vy=JSON.stringify(e.behavior.vy),d.vz=JSON.stringify(e.behavior.vz));backup.push(d)}},restoreGeo=function(){for(var c=0;c<backup.length;c++){name=JSON.parse(backup[c].name);var e=csgeo.csnames[name];e.homog=
JSON.parse(backup[c].homog);e.sx=JSON.parse(backup[c].sx);e.sy=JSON.parse(backup[c].sy);e.sz=JSON.parse(backup[c].sz);"undefined"!==typeof e.behavior&&(e.behavior.vx=JSON.parse(backup[c].vx),e.behavior.vy=JSON.parse(backup[c].vy),e.behavior.vz=JSON.parse(backup[c].vz),e.behavior.fx=0,e.behavior.fy=0,e.behavior.fz=0)}},csplay=function(){csanimating=!0;backupGeo();startit()},cspause=function(){csanimating=!1},csstop=function(){csanimating=!1;restoreGeo()};var Accessor={generalFields:{color:"color",colorhsb:"",size:"size",alpha:"alpha",isshowing:"isshowing",visible:"visible",name:"name",caption:"caption",trace:"trace",tracelength:"",selected:""},getGeoField:function(c,e){return"undefined"!==typeof csgeo.csnames[c]?Accessor.getField(csgeo.csnames[c],e):nada},setGeoField:function(c,e,d){return"undefined"!==typeof csgeo.csnames[c]?Accessor.setField(csgeo.csnames[c],e,d):nada},getField:function(c,e){if("P"==c.kind){if("xy"==e){var d=CSNumber.div(c.homog.value[0],
c.homog.value[2]),f=CSNumber.div(c.homog.value[1],c.homog.value[2]),d=List.turnIntoCSList([d,f]);d.usage="Point";return d}if("homog"==e)return d=List.clone(c.homog),d.usage="Point",d;if("x"==e)return CSNumber.div(c.homog.value[0],c.homog.value[2]);if("y"==e)return CSNumber.div(c.homog.value[1],c.homog.value[2])}if("L"==c.kind){if("homog"==e)return d=List.clone(c.homog),d.usage="Line",d;if("angle"==e)return d=List.eucangle(List.ey,c.homog),d.usage="Angle",d}if(Accessor.generalFields[e])return(d=c[Accessor.generalFields[e]])?
d=General.clone(d):nada;if(c.behavior){if("mass"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.mass);if("radius"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.radius);if("charge"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.charge);if("friction"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.friction);if("vx"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.vx);if("vy"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.vy);
if("v"==e&&"Mass"==c.behavior.type)return List.realVector([c.behavior.vx,c.behavior.vy]);if("fx"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.fx);if("fy"==e&&"Mass"==c.behavior.type)return CSNumber.real(c.behavior.fy);if("f"==e&&"Mass"==c.behavior.type)return List.realVector([c.behavior.fx,c.behavior.fy])}return nada},setField:function(c,e,d){"color"==e&&(c.color=List.clone(d));"size"==e&&(c.size=General.clone(d));"xy"==e&&"P"==c.kind&&c.ismovable&&List._helper.isNumberVecN(d,2)&&(movepointscr(c,
List.turnIntoCSList([d.value[0],d.value[1],CSNumber.real(1)])),recalc());"homog"==e&&"P"==c.kind&&c.ismovable&&List._helper.isNumberVecN(d,2)&&(movepointscr(c,General.clone(d)),recalc());if("angle"==e&&"L"==c.kind){var f=CSNumber.cos(d),g=CSNumber.sin(d),f=List.turnIntoCSList([f,g,CSNumber.real(0)]);c.dir=f;recalc()}c.behavior&&("mass"==e&&"Mass"==c.behavior.type&&"number"==d.ctype&&(c.behavior.mass=d.value.real),"friction"==e&&"Mass"==c.behavior.type&&"number"==d.ctype&&(c.behavior.friction=d.value.real),
"charge"==e&&"Mass"==c.behavior.type&&"number"==d.ctype&&(c.behavior.charge=d.value.real),"radius"==e&&"Mass"==c.behavior.type&&"number"==d.ctype&&(c.behavior.radius=d.value.real),"vx"==e&&"Mass"==c.behavior.type&&"number"==d.ctype&&(c.behavior.vx=d.value.real),"vy"==e&&"Mass"==c.behavior.type&&"number"==d.ctype&&(c.behavior.vy=d.value.real),"v"==e&&"Mass"==c.behavior.type&&List._helper.isNumberVecN(d,2)&&(c.behavior.vx=d.value[0].value.real,c.behavior.vy=d.value[1].value.real))}};var CSNumber={niceprint:function(c){return 0==c.value.imag?""+c.value.real:0<c.value.imag?""+c.value.real+" + i*"+c.value.imag:""+c.value.real+" - i*"+-c.value.imag},complex:function(c,e){return{ctype:"number",value:{real:c,imag:e}}},real:function(c){return{ctype:"number",value:{real:c,imag:0}}},clone:function(c){return{ctype:"number",value:{real:c.value.real,imag:c.value.imag},usage:c.usage}},argmax:function(c,e){return c.value.real*c.value.real+c.value.imag*c.value.imag<e.value.real*e.value.real+
e.value.imag*e.value.imag?e:c},max:function(c,e){return{ctype:"number",value:{real:Math.max(c.value.real,e.value.real),imag:Math.max(c.value.imag,e.value.imag)}}},min:function(c,e){return{ctype:"number",value:{real:Math.min(c.value.real,e.value.real),imag:Math.min(c.value.imag,e.value.imag)}}},add:function(c,e){return{ctype:"number",value:{real:c.value.real+e.value.real,imag:c.value.imag+e.value.imag}}},sub:function(c,e){return{ctype:"number",value:{real:c.value.real-e.value.real,imag:c.value.imag-
e.value.imag}}},neg:function(c){return{ctype:"number",value:{real:-c.value.real,imag:-c.value.imag}}},re:function(c){return{ctype:"number",value:{real:c.value.real,imag:0}}},im:function(c){return{ctype:"number",value:{real:c.value.imag,imag:0}}},conjugate:function(c){return{ctype:"number",value:{real:c.value.real,imag:-c.value.imag}}},round:function(c){return{ctype:"number",value:{real:Math.round(c.value.real),imag:Math.round(c.value.imag)}}},ceil:function(c){return{ctype:"number",value:{real:Math.ceil(c.value.real),
imag:Math.ceil(c.value.imag)}}},floor:function(c){return{ctype:"number",value:{real:Math.floor(c.value.real),imag:Math.floor(c.value.imag)}}},mult:function(c,e){return{ctype:"number",value:{real:c.value.real*e.value.real-c.value.imag*e.value.imag,imag:c.value.real*e.value.imag+c.value.imag*e.value.real}}},abs2:function(c,e){return{ctype:"number",value:{real:c.value.real*c.value.real+c.value.imag*c.value.imag,imag:0}}},abs:function(c){return CSNumber.sqrt(CSNumber.abs2(c))},inv:function(c){var e=c.value.real*
c.value.real+c.value.imag*c.value.imag;0==e&&console.log("DIVISION BY ZERO");return{ctype:"number",value:{real:c.value.real/e,imag:-c.value.imag/e}}},div:function(c,e){return CSNumber.mult(c,CSNumber.inv(e))},eps:1E-7,snap:function(c){var e=c.value.real;c=c.value.imag;Math.floor(e+CSNumber.eps)!=Math.floor(e-CSNumber.eps)&&(e=Math.round(e));Math.floor(c+CSNumber.eps)!=Math.floor(c-CSNumber.eps)&&(c=Math.round(c));return{ctype:"number",value:{real:e,imag:c}}},exp:function(c){var e=Math.exp(c.value.real),
d=e*Math.cos(c.value.imag);c=e*Math.sin(c.value.imag);return{ctype:"number",value:{real:d,imag:c}}},cos:function(c){var e=c.value.real,d=c.value.imag,f=Math.exp(d);c=f*Math.sin(-e);var g=f*Math.cos(-e),f=Math.exp(-d),d=f*Math.sin(e),e=f*Math.cos(e);return{ctype:"number",value:{real:(g+e)/2,imag:(c+d)/2}}},sin:function(c){var e=c.value.real,d=c.value.imag,f=Math.exp(d);c=f*Math.sin(-e);var g=f*Math.cos(-e),f=Math.exp(-d),d=f*Math.sin(e),e=f*Math.cos(e);return{ctype:"number",value:{real:-(c-d)/2,imag:(g-
e)/2}}},tan:function(c){var e=CSNumber.sin(c);c=CSNumber.cos(c);return CSNumber.div(e,c)},arccos:function(c){var e=CSNumber.mult(c,CSNumber.neg(c)),e=CSNumber.sqrt(CSNumber.add(CSNumber.real(1),e));c=CSNumber.add(CSNumber.mult(c,CSNumber.complex(0,1)),e);c=CSNumber.add(CSNumber.mult(CSNumber.log(c),CSNumber.complex(0,1)),CSNumber.real(.5*Math.PI));c.usage="angle";return c},arcsin:function(c){var e=CSNumber.mult(c,CSNumber.neg(c)),e=CSNumber.sqrt(CSNumber.add(CSNumber.real(1),e));c=CSNumber.add(CSNumber.mult(c,
CSNumber.complex(0,1)),e);c=CSNumber.mult(CSNumber.log(c),CSNumber.complex(0,-1));c.usage="angle";return c},arctan:function(c){var e=CSNumber.log(CSNumber.add(CSNumber.mult(c,CSNumber.complex(0,-1)),CSNumber.real(1)));c=CSNumber.log(CSNumber.add(CSNumber.mult(c,CSNumber.complex(0,1)),CSNumber.real(1)));e=CSNumber.mult(CSNumber.sub(e,c),CSNumber.complex(0,.5));e.usage="angle";return e},arctan2:function(c,e){var d=CSNumber.real(Math.atan2(e.value.real,c.value.real));d.usage="angle";return d},sqrt:function(c){var e=
c.value.real,d=c.value.imag;c=Math.sqrt(Math.sqrt(e*e+d*d));e=Math.atan2(d,e);d=c*Math.sin(e/2);return{ctype:"number",value:{real:c*Math.cos(e/2),imag:d}}},log:function(c){var e=c.value.real,d=c.value.imag,f=Math.sqrt(e*e+d*d);c=Math.atan2(d,e);0>d&&(c+=2*Math.PI);0==d&&0>e&&(c=Math.PI);c>Math.PI&&(c-=2*Math.PI);e=Math.log(f);return CSNumber.snap({ctype:"number",value:{real:e,imag:c}})},pow:function(c,e){if(e.value.real==Math.round(e.value.real)&&0==e.value.imag){for(var d={ctype:"number",value:{real:1,
imag:0}},f=0;f<Math.abs(e.value.real);f++)d=CSNumber.mult(d,c);return 0>e.value.real?CSNumber.inv(d):d}return CSNumber.exp(CSNumber.mult(CSNumber.log(c),e))},mod:function(c,e){var d=c.value.real,f=e.value.real,g=c.value.imag,h=e.value.imag,d=d-Math.floor(d/f)*f,g=g-Math.floor(g/h)*h;0==f&&(d=0);0==h&&(g=0);return CSNumber.snap({ctype:"number",value:{real:d,imag:g}})},_helper:{}};CSNumber._helper.seed="NO";CSNumber.eps=1E-10;CSNumber.epsbig=1E-6;
CSNumber._helper.seedrandom=function(c){c-=Math.floor(c);CSNumber._helper.seed=.8*c+.1};CSNumber._helper.rand=function(){if("NO"==CSNumber._helper.seed)return Math.random();var c=CSNumber._helper.seed,c=1E3*Math.sin(1E3*c),c=c-Math.floor(c);return CSNumber._helper.seed=c};CSNumber._helper.randnormal=function(){var c=CSNumber._helper.rand(),e=CSNumber._helper.rand();return Math.sqrt(-2*Math.log(c))*Math.cos(2*Math.PI*e)};
CSNumber._helper.isEqual=function(c,e){return c.value.real==e.value.real&&c.value.imag==e.value.imag};CSNumber._helper.isLessThan=function(c,e){return c.value.real<e.value.real||c.value.real==e.value.real&&c.value.imag<e.value.imag};CSNumber._helper.compare=function(c,e){return CSNumber._helper.isLessThan(c,e)?-1:CSNumber._helper.isEqual(c,e)?0:1};
CSNumber._helper.isAlmostEqual=function(c,e){var d=c.value.real-e.value.real,f=c.value.imag-e.value.imag;return d<CSNumber.eps&&d>-CSNumber.eps&&f<CSNumber.eps&&f>-CSNumber.eps};CSNumber._helper.isZero=function(c){return 0==c.value.real&&0==c.value.imag};CSNumber._helper.isAlmostZero=function(c){var e=c.value.real;c=c.value.imag;return e<CSNumber.eps&&e>-CSNumber.eps&&c<CSNumber.eps&&c>-CSNumber.eps};CSNumber._helper.isReal=function(c){return 0==c.value.imag};
CSNumber._helper.isAlmostReal=function(c){c=c.value.imag;return c<CSNumber.epsbig&&c>-CSNumber.epsbig};CSNumber._helper.isNaN=function(c){return isNaN(c.value.real)||isNaN(c.value.imag)};CSNumber._helper.isAlmostImag=function(c){c=c.value.real;return c<CSNumber.epsbig&&c>-CSNumber.epsbig};var operators={":":20,".":25,"\u00b0":25,_:50,"^":50,"*":100,"/":100,"+":200,"-":200,"!":200,"==":300,"~=":300,"~<":300,"~>":300,"=:=":300,">=":300,"<=":300,"~>=":300,"~<=":300,">":300,"<":300,"<>":300,"&":350,"%":350,"!=":350,"~!=":350,"..":350,"++":370,"--":370,"~~":370,":>":370,"<:":370,"=":400,":=":400,":=_":400,"::=":400,"->":400,",":500,";":500},infixmap={"+":"add","-":"minus","*":"mult","/":"div","^":"pow","\u00b0":"numb_degree",";":"semicolon","=":"assign","..":"sequence",":=":"define","==":"comp_equals",
"!=":"comp_notequals","~=":"comp_almostequals","~!=":"comp_notalmostequals",">":"comp_gt","<":"comp_lt",">=":"comp_ge","<=":"comp_le","~>":"comp_ugt","~<":"comp_ult","~>=":"comp_uge","~<=":"comp_ule","&":"and","%":"or","!":"not",_:"take","++":"concat","~~":"common","--":"remove",":>":"append","<:":"prepend"},niceprint=function(c){if("undefined"===typeof c)return"_??_";if("undefined"==c.ctype)return"_?_";if("number"==c.ctype)return CSNumber.niceprint(c);if("string"==c.ctype||"boolean"==c.ctype)return c.value;
if("list"==c.ctype){for(var e="[",d=0;d<c.value.length;d++)e+=niceprint(evaluate(c.value[d])),d!=c.value.length-1&&(e+=", ");return e+"]"}return"function"==c.ctype?"FUNCTION":"infix"==c.ctype?"INFIX":"modifier"==c.ctype?c.key+"->"+niceprint(c.value):"shape"==c.ctype?c.type:"error"==c.ctype?"Error: "+c.message:"variable"==c.ctype?(console.log("HALLO"),niceprint(c.stack[length.stack])):"geo"==c.ctype?c.value.name:"__"},myfunctions=function(c,e,d){c=myfunctions[c];if(void 0===c)return nada;var f=[];
for(d=0;d<c.arglist.length;d++)f[f.length]=evaluate(e[d]);for(d=0;d<c.arglist.length;d++)namespace.newvar(c.arglist[d].name),namespace.setvar(c.arglist[d].name,f[d]);namespace.pushVstack("*");e=evaluate(c.body);namespace.cleanVstack();for(d=0;d<c.arglist.length;d++)namespace.removevar(c.arglist[d].name);return e},evaluator={_helper:{}};evaluator._helper.eval=function(c,e,d){var f=evaluator[c];return void 0===f?myfunctions(c+e.length,e,d):f(e,d)};
evaluator._helper.clone=function(c){return"list"==c.ctype?List.clone(c):"number"==c.ctype?CSNumber.clone(c):c};evaluator._helper.equals=function(c,e){return"number"==c.ctype&&"number"==e.ctype?{ctype:"boolean",value:c.value.real==e.value.real&&c.value.imag==e.value.imag}:"string"==c.ctype&&"string"==e.ctype||"boolean"==c.ctype&&"boolean"==e.ctype?{ctype:"boolean",value:c.value==e.value}:"list"==c.ctype&&"list"==e.ctype?List.equals(c,e):{ctype:"boolean",value:!1}};var General={_helper:{},order:{undefined:0,boolean:1,number:2,term:3,atomic:4,variable:5,geo:6,string:7,list:8},string:function(c){return{ctype:"string",value:c}},bool:function(c){return{ctype:"boolean",value:c}},isLessThan:function(c,e){return-1==General.compare(c,e)},isEqual:function(c,e){return 0==General.compare(c,e)},compareResults:function(c,e){return General.compare(c.result,e.result)},compare:function(c,e){if(c.ctype!=e.ctype)return General.order[c.ctype]-General.order[e.ctype];if("number"==
c.ctype)return CSNumber._helper.compare(c,e);if("list"==c.ctype)return List._helper.compare(c,e);if("string"==c.ctype)return c.value==e.value?0:c.value<e.value?-1:1;if("boolean"==c.ctype){if(c.value==e.value)return 0;c.value=!1;return 1}},add:function(c,e){return"void"==c.ctype&&"number"==e.ctype?CSNumber.clone(e):"number"==c.ctype&&"number"==e.ctype?CSNumber.add(c,e):"string"==c.ctype||"string"==e.ctype?{ctype:"string",value:niceprint(c)+niceprint(e)}:"list"==c.ctype&&"list"==e.ctype?List.add(c,
e):nada},mult:function(c,e){return"number"==c.ctype&&"number"==e.ctype?CSNumber.mult(c,e):"number"==c.ctype&&"list"==e.ctype?List.scalmult(c,e):"list"==c.ctype&&"number"==e.ctype?List.scalmult(e,c):"list"==c.ctype&&"list"==e.ctype?List.mult(c,e):nada},div:function(c,e){return"number"==c.ctype&&"number"==e.ctype?CSNumber.div(c,e):"list"==c.ctype&&"number"==e.ctype?List.scaldiv(e,c):nada},max:function(c,e){return"number"==c.ctype&&"number"==e.ctype?CSNumber.max(c,e):"list"==c.ctype&&"list"==e.ctype?
List.max(c,e):nada},min:function(c,e){return"number"==c.ctype&&"number"==e.ctype?CSNumber.min(c,e):"list"==c.ctype&&"list"==e.ctype?List.min(c,e):nada},clone:function(c){return"number"==c.ctype?CSNumber.clone(c):"list"==c.ctype?List.clone(c):"boolean"==c.ctype?{ctype:"boolean",value:c.value}:"string"==c.ctype?{ctype:"string",value:c.value}:General.wrap(c)},wrap:function(c){if("number"==typeof c)return CSNumber.real(c);if("object"==typeof c&&void 0!=c.length){for(var e=[],d=0;d<c.length;d++)e[d]=General.wrap(c[d]);
return List.turnIntoCSList(e)}return"string"==typeof c?{ctype:"string",value:c}:"boolean"==typeof c?{ctype:"boolean",value:c}:nada}};var List={_helper:{},turnIntoCSList:function(c){return{ctype:"list",value:c}},realVector:function(c){for(var e=[],d=0;d<c.length;d++)e[e.length]={ctype:"number",value:{real:c[d],imag:0}};return{ctype:"list",value:e}},realMatrix:function(c){for(var e=[],d=0;d<c.length;d++)e[e.length]=List.realVector(c[d]);return List.turnIntoCSList(e)}};List.ex=List.realVector([1,0,0]);List.ey=List.realVector([0,1,0]);List.ez=List.realVector([0,0,1]);List.linfty=List.realVector([0,0,1]);
List.ii=List.turnIntoCSList([CSNumber.complex(1,0),CSNumber.complex(0,1),CSNumber.complex(0,0)]);List.jj=List.turnIntoCSList([CSNumber.complex(1,0),CSNumber.complex(0,-1),CSNumber.complex(0,0)]);List.fundDual=List.realMatrix([[1,0,0],[0,1,0],[0,0,0]]);List.fund=List.realMatrix([[0,0,0],[0,0,0],[0,0,1]]);List.sequence=function(c,e){for(var d=[],f=Math.round(c.value.real);f<Math.round(e.value.real)+1;f++)d[d.length]={ctype:"number",value:{real:f,imag:0}};return{ctype:"list",value:d}};
List.pairs=function(c){for(var e=[],d=0;d<c.value.length-1;d++)for(var f=d+1;f<c.value.length;f++)e[e.length]={ctype:"list",value:[c.value[d],c.value[f]]};return{ctype:"list",value:e}};List.triples=function(c){for(var e=[],d=0;d<c.value.length-2;d++)for(var f=d+1;f<c.value.length-1;f++)for(var g=f+1;g<c.value.length;g++)e[e.length]={ctype:"list",value:[c.value[d],c.value[f],c.value[g]]};return{ctype:"list",value:e}};
List.triples=function(c){for(var e=[],d=0;d<c.value.length-2;d++)for(var f=d+1;f<c.value.length-1;f++)for(var g=f+1;g<c.value.length;g++)e[e.length]={ctype:"list",value:[c.value[d],c.value[f],c.value[g]]};return{ctype:"list",value:e}};List.cycle=function(c){for(var e=[],d=0;d<c.value.length-1;d++)e[e.length]={ctype:"list",value:[c.value[d],c.value[d+1]]};e[e.length]={ctype:"list",value:[c.value[c.value.length-1],c.value[0]]};return{ctype:"list",value:e}};
List.consecutive=function(c){for(var e=[],d=0;d<c.value.length-1;d++)e[e.length]={ctype:"list",value:[c.value[d],c.value[d+1]]};return{ctype:"list",value:e}};List.reverse=function(c){for(var e=[],d=c.value.length-1;0<=d;d--)e[e.length]=c.value[d];return{ctype:"list",value:e}};List.directproduct=function(c,e){for(var d=[],f=0;f<c.value.length;f++)for(var g=0;g<e.value.length;g++)d[d.length]={ctype:"list",value:[c.value[f],e.value[g]]};return{ctype:"list",value:d}};
List.concat=function(c,e){for(var d=[],f=0;f<c.value.length;f++)d[d.length]=c.value[f];for(f=0;f<e.value.length;f++)d[d.length]=e.value[f];return{ctype:"list",value:d}};List.prepend=function(c,e){var d=[];d[d.length]=c;for(var f=0;f<e.value.length;f++)d[d.length]=e.value[f];return{ctype:"list",value:d}};List.append=function(c,e){for(var d=[],f=0;f<c.value.length;f++)d[d.length]=c.value[f];d[d.length]=e;return{ctype:"list",value:d}};
List.contains=function(c,e){for(var d=0;d<c.value.length;d++)if(evaluator._helper.equals(c.value[d],e).value)return{ctype:"boolean",value:!0};return{ctype:"boolean",value:!1}};List.common=function(c,e){for(var d=[],f=0;f<c.value.length;f++){for(var g=!1,h=c.value[f],k=0;k<e.value.length;k++)g=g||evaluator._helper.equals(h,e.value[k]).value;g&&(d[d.length]=c.value[f])}return{ctype:"list",value:d}};
List.remove=function(c,e){for(var d=[],f=0;f<c.value.length;f++){for(var g=!1,h=c.value[f],k=0;k<e.value.length;k++)g=g||evaluator._helper.equals(h,e.value[k]).value;g||(d[d.length]=c.value[f])}return{ctype:"list",value:d}};List._helper.compare=function(c,e){return"number"==c.ctype&&"number"==e.ctype?c.value.real-e.value.real:-1};List.sort1=function(c){c=c.value.sort(General.compare);return List.turnIntoCSList(c)};List._helper.isEqual=function(c,e){return List.equals(c,e).value};
List._helper.isLessThan=function(c,e){for(var d=c.value.length,f=e.value.length,g=0;!(g>=d||g>=f)&&General.isEqual(c.value[g],e.value[g]);)g++;return g==d&&g<f?!0:g==f&&g<d||g==d&&g==f?!1:General.isLessThan(c.value[g],e.value[g])};List._helper.compare=function(c,e){return List._helper.isLessThan(c,e)?-1:List._helper.isEqual(c,e)?0:1};
List.equals=function(c,e){if(c.value.length!=e.value.length)return{ctype:"boolean",value:!1};for(var d=!0,f=0;f<c.value.length;f++)var g=c.value[f],h=e.value[f],d="list"==g.ctype&&"list"==h.ctype?d&&List.equals(g,h).value:d&&evaluator.comp_equals([g,h],[]).value;return{ctype:"boolean",value:d}};
List.almostequals=function(c,e){if(c.value.length!=e.value.length)return{ctype:"boolean",value:!1};for(var d=!0,f=0;f<c.value.length;f++)var g=c.value[f],h=e.value[f],d="list"==g.ctype&&"list"==h.ctype?d&&List.comp_almostequals(g,h).value:d&&evaluator.comp_almostequals([g,h],[]).value;return{ctype:"boolean",value:d}};List._helper.isAlmostReal=function(c){for(var e=!0,d=0;d<c.value.length;d++)var f=c.value[d],e="list"==f.ctype?e&&List._helper.isAlmostReal(f):e&&CSNumber._helper.isAlmostReal(f);return e};
List._helper.isNaN=function(c){for(var e=!1,d=0;d<c.value.length;d++)var f=c.value[d],e="list"==f.ctype?e||List._helper.isNaN(f):e||CSNumber._helper.isNaN(f);return e};List.set=function(c){var e=[];c=c.value.sort(General.compare);for(var d=0;d<c.length;d++)0!=d&&evaluator.comp_equals([e[e.length-1],c[d]],[]).value||(e[e.length]=c[d]);return{ctype:"list",value:e}};
List.genericListMath=function(c,e){if(0==c.value.length)return nada;for(var d=c.value[0],f=1;f<c.value.length;f++)d=General[e](d,c.value[f]);return d};List.maxval=function(c){for(var e=CSNumber.real(0),d=0;d<c.value.length;d++){var f=c.value[d];"number"==f.ctype&&(e=CSNumber.argmax(e,f));"list"==f.ctype&&(e=CSNumber.argmax(e,List.maxval(f)))}return CSNumber.clone(e)};List.normalizeMax=function(c){var e=CSNumber.inv(List.maxval(c));return List.scalmult(e,c)};
List.normalizeZ=function(c){var e=CSNumber.inv(c.value[2]);return List.scalmult(e,c)};List.max=function(c,e){if(c.value.length!=e.value.length)return nada;for(var d=[],f=0;f<c.value.length;f++)d[d.length]=General.max(c.value[f],e.value[f]);return{ctype:"list",value:d}};List.min=function(c,e){if(c.value.length!=e.value.length)return nada;for(var d=[],f=0;f<c.value.length;f++)d[d.length]=General.min(c.value[f],e.value[f]);return{ctype:"list",value:d}};
List.scaldiv=function(c,e){if("number"!=c.ctype)return nada;for(var d=[],f=0;f<e.value.length;f++){var g=e.value[f];d[d.length]="number"==g.ctype?General.div(g,c):"list"==g.ctype?List.scaldiv(c,g):nada}return{ctype:"list",value:d}};List.scalmult=function(c,e){if("number"!=c.ctype)return nada;for(var d=[],f=0;f<e.value.length;f++){var g=e.value[f];d[d.length]="number"==g.ctype?General.mult(g,c):"list"==g.ctype?List.scalmult(c,g):nada}return{ctype:"list",value:d}};
List.add=function(c,e){if(c.value.length!=e.value.length)return nada;for(var d=[],f=0;f<c.value.length;f++){var g=c.value[f],h=e.value[f];d[d.length]="number"==g.ctype&&"number"==h.ctype?General.add(g,h):"list"==g.ctype&&"list"==h.ctype?List.add(g,h):nada}return{ctype:"list",value:d}};
List.sub=function(c,e){if(c.value.length!=e.value.length)return nada;for(var d=[],f=0;f<c.value.length;f++){var g=c.value[f],h=e.value[f];d[d.length]="number"==g.ctype&&"number"==h.ctype?CSNumber.sub(g,h):"list"==g.ctype&&"list"==h.ctype?List.sub(g,h):nada}return{ctype:"list",value:d}};
List.abs2=function(c){for(var e=0,d=0;d<c.value.length;d++){var f=c.value[d];if("number"==f.ctype)e+=CSNumber.abs2(f).value.real;else if("list"==f.ctype)e+=List.abs2(f).value.real;else return nada}return{ctype:"number",value:{real:e,imag:0}}};List.abs=function(c){return CSNumber.sqrt(List.abs2(c))};List.normalizeMaxXX=function(c){for(var e=-1E4,d=CSNumber.real(1),f=0;f<c.value.length;f++){var g=CSNumber.abs(c.value[f]);g.value.real>e&&(d=c.value[f],e=g.value.real)}return List.scaldiv(d,c)};
List.recursive=function(c,e){for(var d=[],f=0;f<c.value.length;f++){var g=evaluateAndVal(c.value[f]);d[d.length]="number"==g.ctype?CSNumber[e](g):"list"==g.ctype?List[e](g):nada}return{ctype:"list",value:d}};List.re=function(c){return List.recursive(c,"re")};List.neg=function(c){return List.recursive(c,"neg")};List.im=function(c){return List.recursive(c,"im")};List.conjugate=function(c){return List.recursive(c,"conjugate")};List.round=function(c){return List.recursive(c,"round")};
List.ceil=function(c){return List.recursive(c,"ceil")};List.floor=function(c){return List.recursive(c,"floor")};List._helper.colNumb=function(c){if("list"!=c.ctype)return-1;for(var e=-1,d=0;d<c.value.length;d++){if("list"!=c.value[d].ctype)return-1;if(0==d)e=c.value[d].value.length;else if(e!=c.value[d].value.length)return-1}return e};List._helper.isNumberVecN=function(c,e){if("list"!=c.ctype||c.value.length!=e)return!1;for(var d=0;d<c.value.length;d++)if("number"!=c.value[d].ctype)return!1;return!0};
List.isNumberVector=function(c){if("list"!=c.ctype)return{ctype:"boolean",value:!1};for(var e=0;e<c.value.length;e++)if("number"!=c.value[e].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};List.isNumberVectorN=function(c,e){if("list"!=c.ctype)return{ctype:"boolean",value:!1};if(c.value)for(var d=0;d<c.value.length;d++)if("number"!=c.value[d].ctype)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};
List.isNumberMatrix=function(c){if(-1==List._helper.colNumb(c))return{ctype:"boolean",value:!1};for(var e=0;e<c.value.length;e++)if(!List.isNumberVector(c.value[e]).value)return{ctype:"boolean",value:!1};return{ctype:"boolean",value:!0}};List.scalproduct=function(c,e){if(c.value.length!=e.value.length)return nada;for(var d={ctype:"number",value:{real:0,imag:0}},f=0;f<e.value.length;f++){var g=c.value[f],h=e.value[f];if("number"==g.ctype&&"number"==h.ctype)d=CSNumber.add(CSNumber.mult(g,h),d);else return nada}return d};
List.productMV=function(c,e){if(c.value[0].value.length!=e.value.length)return nada;for(var d=[],f=0;f<c.value.length;f++){for(var g={ctype:"number",value:{real:0,imag:0}},h=c.value[f],k=0;k<e.value.length;k++){var l=h.value[k],p=e.value[k];if("number"==l.ctype&&"number"==p.ctype)g=CSNumber.add(CSNumber.mult(l,p),g);else return nada}d[d.length]=g}return List.turnIntoCSList(d)};
List.productVM=function(c,e){if(c.value.length!=e.value.length)return nada;for(var d=[],f=0;f<e.value[0].value.length;f++){for(var g={ctype:"number",value:{real:0,imag:0}},h=0;h<c.value.length;h++){var k=c.value[h],l=e.value[h].value[f];if("number"==k.ctype&&"number"==l.ctype)g=CSNumber.add(CSNumber.mult(k,l),g);else return nada}d[d.length]=g}return List.turnIntoCSList(d)};
List.productMM=function(c,e){if(c.value[0].value.length!=e.value.length)return nada;for(var d=[],f=0;f<c.value.length;f++){var g=List.productVM(c.value[f],e);d[d.length]=g}return List.turnIntoCSList(d)};
List.mult=function(c,e){return c.value.length==e.value.length&&List.isNumberVector(c).value&&List.isNumberVector(e).value?List.scalproduct(c,e):List.isNumberMatrix(c).value&&e.value.length==c.value[0].value.length&&List.isNumberVector(e).value?List.productMV(c,e):List.isNumberMatrix(e).value&&c.value.length==e.value.length&&List.isNumberVector(c).value?List.productVM(c,e):List.isNumberMatrix(c).value&&List.isNumberMatrix(e)&&e.value.length==c.value[0].value.length?List.productMM(c,e):nada};
List.projectiveDistMinScal=function(c,e){var d=List.abs(c),f=List.abs(e);if(0==d.value.real||0==f.value.real)return 0;var g=List.conjugate(e),g=List.scalproduct(c,g),g=CSNumber.div(g,CSNumber.abs(g)),d=List.scaldiv(d,c),f=List.scaldiv(f,e),d=List.scalmult(g,d),g=List.abs(List.add(d,f)),f=List.abs(List.sub(d,f));return Math.min(g.value.real,f.value.real)};
List.crossOperator=function(c){var e=CSNumber.clone(c.value[0]),d=CSNumber.clone(c.value[1]);c=CSNumber.clone(c.value[2]);return List.turnIntoCSList([List.turnIntoCSList([CSNumber.real(0),CSNumber.neg(c),d]),List.turnIntoCSList([c,CSNumber.real(0),CSNumber.neg(e)]),List.turnIntoCSList([CSNumber.neg(d),e,CSNumber.real(0)])])};
List.cross=function(c,e){var d=CSNumber.sub(CSNumber.mult(c.value[1],e.value[2]),CSNumber.mult(c.value[2],e.value[1])),f=CSNumber.sub(CSNumber.mult(c.value[2],e.value[0]),CSNumber.mult(c.value[0],e.value[2])),g=CSNumber.sub(CSNumber.mult(c.value[0],e.value[1]),CSNumber.mult(c.value[1],e.value[0]));return List.turnIntoCSList([d,f,g])};
List.veronese=function(c){var e=CSNumber.mult(c.value[0],c.value[0]),d=CSNumber.mult(c.value[1],c.value[1]),f=CSNumber.mult(c.value[2],c.value[2]),g=CSNumber.mult(c.value[0],c.value[1]),h=CSNumber.mult(c.value[0],c.value[2]);c=CSNumber.mult(c.value[1],c.value[2]);return List.turnIntoSCList([e,d,f,g,h,c])};
List.matrixFromVeronese=function(c){var e=CSNumber.clone(c.value[0]),d=CSNumber.clone(c.value[1]),f=CSNumber.clone(c.value[2]),g=CSNumber.div(c.value[3],CSNumber.real(2)),h=CSNumber.div(c.value[4],CSNumber.real(2));c=CSNumber.div(c.value[5],CSNumber.real(2));var k=CSNumber.clone(g),l=CSNumber.clone(h),p=CSNumber.clone(c);return List.turnIntoCSList([List.turnIntoCSList([e,g,h]),List.turnIntoCSList([k,d,c]),List.turnIntoCSList([l,p,f])])};
List.det3=function(c,e,d){return CSNumber.complex(c.value[0].value.real*e.value[1].value.real*d.value[2].value.real-c.value[0].value.imag*e.value[1].value.imag*d.value[2].value.real-c.value[0].value.imag*e.value[1].value.real*d.value[2].value.imag-c.value[0].value.real*e.value[1].value.imag*d.value[2].value.imag+c.value[2].value.real*e.value[0].value.real*d.value[1].value.real-c.value[2].value.imag*e.value[0].value.imag*d.value[1].value.real-c.value[2].value.imag*e.value[0].value.real*d.value[1].value.imag-
c.value[2].value.real*e.value[0].value.imag*d.value[1].value.imag+c.value[1].value.real*e.value[2].value.real*d.value[0].value.real-c.value[1].value.imag*e.value[2].value.imag*d.value[0].value.real-c.value[1].value.imag*e.value[2].value.real*d.value[0].value.imag-c.value[1].value.real*e.value[2].value.imag*d.value[0].value.imag-c.value[0].value.real*e.value[2].value.real*d.value[1].value.real+c.value[0].value.imag*e.value[2].value.imag*d.value[1].value.real+c.value[0].value.imag*e.value[2].value.real*
d.value[1].value.imag+c.value[0].value.real*e.value[2].value.imag*d.value[1].value.imag-c.value[2].value.real*e.value[1].value.real*d.value[0].value.real+c.value[2].value.imag*e.value[1].value.imag*d.value[0].value.real+c.value[2].value.imag*e.value[1].value.real*d.value[0].value.imag+c.value[2].value.real*e.value[1].value.imag*d.value[0].value.imag-c.value[1].value.real*e.value[0].value.real*d.value[2].value.real+c.value[1].value.imag*e.value[0].value.imag*d.value[2].value.real+c.value[1].value.imag*
e.value[0].value.real*d.value[2].value.imag+c.value[1].value.real*e.value[0].value.imag*d.value[2].value.imag,-c.value[0].value.imag*e.value[1].value.imag*d.value[2].value.imag+c.value[0].value.imag*e.value[1].value.real*d.value[2].value.real+c.value[0].value.real*e.value[1].value.real*d.value[2].value.imag+c.value[0].value.real*e.value[1].value.imag*d.value[2].value.real-c.value[2].value.imag*e.value[0].value.imag*d.value[1].value.imag+c.value[2].value.imag*e.value[0].value.real*d.value[1].value.real+
c.value[2].value.real*e.value[0].value.real*d.value[1].value.imag+c.value[2].value.real*e.value[0].value.imag*d.value[1].value.real-c.value[1].value.imag*e.value[2].value.imag*d.value[0].value.imag+c.value[1].value.imag*e.value[2].value.real*d.value[0].value.real+c.value[1].value.real*e.value[2].value.real*d.value[0].value.imag+c.value[1].value.real*e.value[2].value.imag*d.value[0].value.real+c.value[0].value.imag*e.value[2].value.imag*d.value[1].value.imag-c.value[0].value.imag*e.value[2].value.real*
d.value[1].value.real-c.value[0].value.real*e.value[2].value.real*d.value[1].value.imag-c.value[0].value.real*e.value[2].value.imag*d.value[1].value.real+c.value[2].value.imag*e.value[1].value.imag*d.value[0].value.imag-c.value[2].value.imag*e.value[1].value.real*d.value[0].value.real-c.value[2].value.real*e.value[1].value.real*d.value[0].value.imag-c.value[2].value.real*e.value[1].value.imag*d.value[0].value.real+c.value[1].value.imag*e.value[0].value.imag*d.value[2].value.imag-c.value[1].value.imag*
e.value[0].value.real*d.value[2].value.real-c.value[1].value.real*e.value[0].value.real*d.value[2].value.imag-c.value[1].value.real*e.value[0].value.imag*d.value[2].value.real)};
List.eucangle=function(c,e){var d=List.cross(c,List.linfty),f=List.cross(e,List.linfty),g=List.det3(List.ez,d,List.ii),d=List.det3(List.ez,d,List.jj),h=List.det3(List.ez,f,List.ii),f=List.det3(List.ez,f,List.jj),g=CSNumber.div(CSNumber.mult(g,f),CSNumber.mult(h,d)),g=CSNumber.log(g);return g=CSNumber.mult(g,CSNumber.complex(0,.5))};List.clone=function(c){for(var e=[],d=0;d<c.value.length;d++)e[e.length]=evaluator._helper.clone(c.value[d]);return{ctype:"list",value:e,usage:c.usage}};
List.zerovector=function(c){for(var e=[],d=0;d<Math.floor(c.value.real);d++)e[e.length]=0;return List.realVector(e)};List.zeromatrix=function(c,e){for(var d=[],f=0;f<Math.floor(c.value.real);f++)d[d.length]=List.zerovector(e);return List.turnIntoCSList(d)};List.transpose=function(c){for(var e=[],d=c.value[0].value.length,f=c.value.length,g=0;g<d;g++){for(var h=[],k=0;k<f;k++)h[h.length]=c.value[k].value[g];e[e.length]=List.turnIntoCSList(h)}return List.turnIntoCSList(e)};
List.column=function(c,e){for(var d=[],f=c.value.length,g=Math.floor(e.value.real-1),h=0;h<f;h++)d[d.length]=c.value[h].value[g];return List.turnIntoCSList(d)};List.row=function(c,e){for(var d=[],f=c.value[0].value.length,g=Math.floor(e.value.real-1),h=0;h<f;h++)d[d.length]=c.value[g].value[h];return List.turnIntoCSList(d)};
List.inverse=function(c){for(var e=[],d=[],f=c.value.length,g=0;g<f;g++){for(var h=[],k=[],l=0;l<f;l++)h[h.length]=c.value[g].value[l].value.real,k[k.length]=c.value[g].value[l].value.imag;e[e.length]=h;d[d.length]=k}g=new numeric.T(e,d);c=g.inv(g);e=[];for(g=0;g<f;g++){d=[];for(l=0;l<f;l++)d[d.length]=CSNumber.complex(c.x[g][l],c.y[g][l]);e[e.length]=List.turnIntoCSList(d)}return List.turnIntoCSList(e)};
List.det=function(c){for(var e=[],d=[],f=c.value.length,g=0;g<f;g++){for(var h=[],k=[],l=0;l<f;l++)h[h.length]=c.value[g].value[l].value.real,k[k.length]=c.value[g].value[l].value.imag;e[e.length]=h;d[d.length]=k}new numeric.T(e,d);c=numeric.det(e);return CSNumber.real(c)};
List.getField=function(c,e){if("homog"==e){if(List._helper.isNumberVecN(c,3))return c;if(List._helper.isNumberVecN(c,2)){var d=General.clone(c);d.value[2]=CSNumber.real(1);return d}return nada}if("xy"==e)return List._helper.isNumberVecN(c,2)?c:List._helper.isNumberVecN(c,3)?(d=General.clone(c),d.value.pop(),List.scaldiv(c.value[2],d)):nada;if("x"==e){if(List.isNumberVector(c)){d=c.value.length;if(0<d&&3!=d)return CSNumber.clone(c.value[0]);if(3==d)return"Point"==c.usage?CSNumber.div(c.value[0],c.value[2]):
CSNumber.clone(c.value[0])}return nada}if("y"==e){if(List.isNumberVector(c)){d=c.value.length;if(1<d&&3!=d)return CSNumber.clone(c.value[1]);if(3==d)return"Point"==c.usage?CSNumber.div(c.value[1],c.value[2]):CSNumber.clone(c.value[1])}return nada}return"z"==e&&List.isNumberVector(c)&&(d=c.value.length,2<d)?CSNumber.clone(c.value[2]):nada};function Nada(){this.ctype="undefined"}function Void(){this.ctype="void"}function CError(c){this.ctype="error";this.message=c}var nada=new Nada;
function Namespace(){this.vars={pi:{ctype:"variable",stack:[{ctype:"number",value:{real:Math.PI,imag:0}}],name:"pi"},i:{ctype:"variable",stack:[{ctype:"number",value:{real:0,imag:1}}],name:"i"},"true":{ctype:"variable",stack:[{ctype:"boolean",value:!0}],name:"true"},"false":{ctype:"variable",stack:[{ctype:"boolean",value:!1}],name:"false"},"#":{ctype:"variable",stack:[nada],name:"#"}};this.isVariable=function(c){return void 0!==this.vars[c]};this.isVariableName=function(c){if("#"==c||"#1"==c||"#2"==
c)return!0;var e=/^[a-z,A-Z]+$/.test(c[0]);c=/^[0-9,a-z,A-Z]+$/.test(c);return e&&c};this.create=function(c){this.vars[c]={ctype:"variable",stack:[],name:c};return this.vars[c]};this.newvar=function(c){if(void 0===this.vars[c])return this.create(c);this.vars[c].stack.push(nada);return this.vars[c]};this.removevar=function(c){this.vars[c].stack.pop()};this.setvar=function(c,e){var d=this.vars[c].stack;if("undefined"==e.ctype)d[d.length-1]=e;else{var f=evaluator._helper.clone(e);d[d.length-1]=f}};this.setvarnocopy=
function(c,e){var d=this.vars[c].stack;d[d.length-1]=e};this.getvar=function(c){var e=this.vars[c].stack;return 0==e.length&&e[e.length-1]==nada&&"undefined"!==typeof csgeo.csnames[c]?{ctype:"geo",value:csgeo.csnames[c]}:e[e.length-1]};this.dump=function(c){var e=this.vars[c].stack;console.log("*** Dump "+c);for(c=0;c<e.length;c++)console.log(c+":> "+niceprint(e[c]))};this.vstack=[];this.pushVstack=function(c){this.vstack.push(c)};this.popVstack=function(){this.vstack.pop()};this.cleanVstack=function(){for(var c=
this.vstack;0<c.length&&"*"!=c[c.length-1];)this.removevar(c[c.length-1]),c.pop();0<c.length&&c.pop()}}var namespace=new Namespace;evaluator._helper.extractPoint=function(c){var e={ok:!1};if("geo"==c.ctype){var d=c.value;if("P"==d.kind)return e.x=Accessor.getField(d,"x").value.real,e.y=Accessor.getField(d,"y").value.real,e.ok=!0,e}if("list"!=c.ctype)return e;var f=c.value;if(2==f.length&&(c=f[0],d=f[1],"number"==c.ctype&&"number"==d.ctype))return e.x=c.value.real,e.y=d.value.real,e.ok=!0,e;3==f.length&&(c=f[0],d=f[1],f=f[2],"number"==c.ctype&&"number"==d.ctype&&"number"==f.ctype&&(c=CSNumber.div(c,f),d=CSNumber.div(d,f),e.x=
c.value.real,e.y=d.value.real,e.ok=!0));return e};
evaluator.draw=function(c,e){var d,f=csport.drawingstate.pointsize,g=csport.drawingstate.linesize;0>f&&(f=0);0>g&&(g=0);var h=1,k=!1,l,p="rgb(0,0,0)";1!=csport.drawingstate.alpha&&(p="rgba(0,0,0,"+csport.drawingstate.alpha+")");var n=function(c){void 0!==e.size&&(d=evaluate(e.size),"number"==d.ctype&&("P"==c&&(f=d.value.real,0>f&&(f=0)),"L"==c&&(g=d.value.real,0>g&&(g=0))));if("L"==c){if(void 0!==e.dashpattern&&(d=evaluate(e.dashpattern),"list"==d.ctype)){for(var n=[],q=0;q<d.value.length;q++)n[q]=
d.value[q].value.real;evaluator._helper.setDash(n,g);k=!0}void 0!==e.dashtype&&(d=evaluate(e.dashtype),"number"==d.ctype&&(c=Math.floor(d.value.real),evaluator._helper.setDashType(c,g),k=!0));void 0!==e.dashing&&(d=evaluate(e.dashing),"number"==d.ctype&&(n=Math.floor(d.value.real),evaluator._helper.setDash([2*n,n],g),k=!0));void 0!==e.overhang&&(d=evaluate(e.overhang),"number"==d.ctype&&(h=d.value.real))}if(void 0!==e.color||void 0!==e.alpha){var r=q=n=0,s=csport.drawingstate.alpha;"P"==c&&(n=255*
csport.drawingstate.pointcolorraw[0],q=255*csport.drawingstate.pointcolorraw[1],r=255*csport.drawingstate.pointcolorraw[2]);"L"==c&&(n=255*csport.drawingstate.linecolorraw[0],q=255*csport.drawingstate.linecolorraw[1],r=255*csport.drawingstate.linecolorraw[2]);void 0!==e.color&&(d=evaluate(e.color),List.isNumberVector(d).value&&3==d.value.length&&(n=Math.floor(255*d.value[0].value.real),q=Math.floor(255*d.value[1].value.real),r=Math.floor(255*d.value[2].value.real)));void 0!==e.alpha&&(d=evaluate(e.alpha),
"number"==d.ctype&&(s=d.value.real));l="rgba("+n+","+q+","+r+","+s+")";p="rgba(0,0,0,"+s+")"}},q=function(c,d){var e=csport.drawingstate.matrix,f=c.x*e.a-c.y*e.b+e.tx,p=c.x*e.c-c.y*e.d-e.ty,q=d.x*e.a-d.y*e.b+e.tx,r=d.x*e.c-d.y*e.d-e.ty;l=csport.drawingstate.linecolor;n("L");var e=h*f+(1-h)*q,s=h*p+(1-h)*r,f=h*q+(1-h)*f,p=h*r+(1-h)*p;csctx.beginPath();csctx.moveTo(e,s);csctx.lineTo(f,p);csctx.lineWidth=g;csctx.lineCap="round";csctx.strokeStyle=l;csctx.stroke();k&&evaluator._helper.unSetDash()},r=function(c,
d){var e=evaluateAndVal(c),f=evaluateAndVal(d),e=evaluator._helper.extractPoint(e),f=evaluator._helper.extractPoint(f);if(!e.ok||!f.ok)return nada;q(e,f);return nada},s=function(){var c=CSNumber.abs(t.value[0]).value.real,d=CSNumber.abs(t.value[1]).value.real,e=CSNumber.abs(t.value[2]).value.real,f;c>=d&&c>=e&&(f=t.value[0]);d>=c&&d>=e&&(f=t.value[1]);e>=d&&e>=c&&(f=t.value[2]);c=CSNumber.div(t.value[0],f);d=CSNumber.div(t.value[1],f);f=CSNumber.div(t.value[2],f);f=[c.value.real,d.value.real,f.value.real];
Math.abs(f[0])<Math.abs(f[1])?(d=[1,0,30],c=[-1,0,30]):(d=[0,1,30],c=[0,-1,30]);d=[f[1]*d[2]-f[2]*d[1],f[2]*d[0]-f[0]*d[2],f[0]*d[1]-f[1]*d[0]];f=[f[1]*c[2]-f[2]*c[1],f[2]*c[0]-f[0]*c[2],f[0]*c[1]-f[1]*c[0]];q({x:d[0]/d[2],y:d[1]/d[2]},{x:f[0]/f[2],y:f[1]/f[2]})};if(2==c.length)return r(c[0],c[1]);var t=evaluateAndVal(c[0]);return"shape"==t.ctype?evaluator._helper.drawshape(t,e):"Line"==t.usage?s():function(){var c=evaluator._helper.extractPoint(t);if(!c.ok){if(2==t.value.length){r(t.value[0],t.value[1]);
return}return nada}var d=csport.drawingstate.matrix,e=c.x*d.a-c.y*d.b+d.tx,c=c.x*d.c-c.y*d.d-d.ty;l=csport.drawingstate.pointcolor;n("P");csctx.lineWidth=.3*f;csctx.beginPath();csctx.arc(e,c,f,0,2*Math.PI);csctx.fillStyle=l;csctx.fill();csctx.beginPath();csctx.arc(e,c,1.15*f,0,2*Math.PI);csctx.fillStyle=p;csctx.strokeStyle=p;csctx.stroke()}()};evaluator.drawcircle=function(c,e){evaluator._helper.drawcircle(c,e,"D")};evaluator.fillcircle=function(c,e){evaluator._helper.drawcircle(c,e,"F")};
evaluator._helper.drawcircle=function(c,e,d){var f,g=4,h;if(2==c.length){var k=evaluateAndVal(c[0]);c=evaluateAndVal(c[1]);f=evaluator._helper.extractPoint(k);if(f.ok&&"number"==c.ctype){var k=csport.drawingstate.matrix,l=f.x*k.a-f.y*k.b+k.tx,p=f.x*k.c-f.y*k.d-k.ty;h=csport.drawingstate.linecolor;void 0!==e.size&&(f=evaluate(e.size),"number"==f.ctype&&(g=f.value.real,0>g&&(g=0)));if(void 0!==e.color||void 0!==e.alpha){var n=h=0,q=0,r=csport.drawingstate.alpha;h=255*csport.drawingstate.linecolorraw[0];
n=255*csport.drawingstate.linecolorraw[1];q=255*csport.drawingstate.linecolorraw[2];void 0!==e.color&&(f=evaluate(e.color),List.isNumberVector(f).value&&3==f.value.length&&(h=Math.floor(255*f.value[0].value.real),n=Math.floor(255*f.value[1].value.real),q=Math.floor(255*f.value[2].value.real)));void 0!==e.alpha&&(f=evaluate(e.alpha),"number"==f.ctype&&(r=f.value.real));h="rgba("+h+","+n+","+q+","+r+")"}csctx.lineWidth=.3*g;csctx.beginPath();csctx.lineWidth=.4*g;csctx.arc(l,p,c.value.real*k.sdet,0,
2*Math.PI);"D"==d&&(csctx.strokeStyle=h,csctx.stroke());"F"==d&&(csctx.fillStyle=h,csctx.fill());"C"==d&&csctx.clip();e=void 0}else e=nada;return e}return nada};evaluator.drawall=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)for(var f=0;f<d.value.length;f++)evaluator.draw([d.value[f]],e)}return nada};evaluator.connect=function(c,e){evaluator._helper.drawpolygon(c,e,"D",0)};evaluator.drawpoly=function(c,e){evaluator._helper.drawpolygon(c,e,"D",1)};
evaluator.fillpoly=function(c,e){evaluator._helper.drawpolygon(c,e,"F",1)};evaluator.drawpolygon=function(c,e){evaluator._helper.drawpolygon(c,e,"D",1)};evaluator.fillpolygon=function(c,e){evaluator._helper.drawpolygon(c,e,"F",1)};
evaluator._helper.drawpolygon=function(c,e,d,f){var g,h=4,k,l=function(){void 0!==e.size&&(g=evaluate(e.size),"number"==g.ctype&&(h=g.value.real,0>h&&(h=0)));if(void 0!==e.color||void 0!==e.alpha){var c=0,d=0,f=0,l=csport.drawingstate.alpha,c=255*csport.drawingstate.linecolorraw[0],d=255*csport.drawingstate.linecolorraw[1],f=255*csport.drawingstate.linecolorraw[2];void 0!==e.color&&(g=evaluate(e.color),List.isNumberVector(g).value&&3==g.value.length&&(c=Math.floor(255*g.value[0].value.real),d=Math.floor(255*
g.value[1].value.real),f=Math.floor(255*g.value[2].value.real)));void 0!==e.alpha&&(g=evaluate(e.alpha),"number"==g.ctype&&(l=g.value.real));k="rgba("+c+","+d+","+f+","+l+")"}},p=function(){var c=csport.drawingstate.matrix,e=q.value;"D"!=d&&csctx.beginPath();for(var f=0;f<e.length;f++){for(var g=e[f],n=[],p=0;p<g.length;p++){var w=g[p];n[n.length]=[w.X*c.a-w.Y*c.b+c.tx,w.X*c.c-w.Y*c.d-c.ty]}k=csport.drawingstate.linecolor;l();csctx.lineWidth=.3*h;csctx.mozFillRule="evenodd";csctx.lineJoin="round";
"D"==d&&csctx.beginPath();csctx.lineWidth=.4*h;csctx.moveTo(n[0][0],n[0][1]);for(p=1;p<n.length;p++)csctx.lineTo(n[p][0],n[p][1]);"D"==d&&(csctx.closePath(),csctx.strokeStyle=k,csctx.stroke())}"D"!=d&&csctx.closePath();"F"==d&&(csctx.fillStyle=k,csctx.fill());"C"==d&&csctx.clip()},n=function(){for(var c=csport.drawingstate.matrix,e=[],g=0;g<q.value.length;g++){var n=evaluator._helper.extractPoint(q.value[g]);if(!n.ok)return nada;e[e.length]=[n.x*c.a-n.y*c.b+c.tx,n.x*c.c-n.y*c.d-c.ty]}k=csport.drawingstate.linecolor;
l();csctx.lineWidth=.3*h;csctx.mozFillRule="evenodd";csctx.beginPath();csctx.lineWidth=.4*h;csctx.moveTo(e[0][0],e[0][1]);for(g=1;g<e.length;g++)csctx.lineTo(e[g][0],e[g][1]);1==f&&csctx.closePath();"D"==d&&(csctx.strokeStyle=k,csctx.stroke());"F"==d&&(csctx.fillStyle=k,csctx.fill());"C"==d&&csctx.clip()};if(1==c.length){var q=evaluate(c[0]);if("list"==q.ctype)return n();if("shape"==q.ctype)return p()}return nada};
evaluator.drawtext=function(c,e){var d=csport.drawingstate.textsize;0>d&&(d=0);var f="",g="",h="Arial",k=0,l=0,p=0;if(2==c.length){var n=evaluateAndVal(c[0]),q=evaluate(c[1]),r=evaluator._helper.extractPoint(n);if(!r.ok)return nada;var s=csport.drawingstate.matrix,n=r.x*s.a-r.y*s.b+s.tx,r=r.x*s.c-r.y*s.d-s.ty;col=csport.drawingstate.textcolor;void 0!==e.size&&(erg=evaluate(e.size),"number"==erg.ctype&&(d=erg.value.real,0>d&&(d=0)));void 0!==e.bold&&(erg=evaluate(e.bold),"boolean"==erg.ctype&&erg.value&&
(f="bold "));void 0!==e.italics&&(erg=evaluate(e.italics),"boolean"==erg.ctype&&erg.value&&(g="italic "));void 0!==e.family&&(erg=evaluate(e.family),"string"==erg.ctype&&(h=erg.value));void 0!==e.align&&(erg=evaluate(e.align),"string"==erg.ctype&&("left"==erg.value&&(k=0),"right"==erg.value&&(k=1),"mid"==erg.value&&(k=.5)));void 0!==e.x_offset&&(erg=evaluate(e.x_offset),"number"==erg.ctype&&(l=erg.value.real));void 0!==e.y_offset&&(erg=evaluate(e.y_offset),"number"==erg.ctype&&(p=erg.value.real));
void 0!==e.offset&&(erg=evaluate(e.offset),"list"==erg.ctype&&2==erg.value.length&&"number"==erg.value[0].ctype&&"number"==erg.value[1].ctype&&(l=erg.value[0].value.real,p=erg.value[1].value.real));if(void 0!==e.color||void 0!==e.alpha){var t=s=0,v=0,u=csport.drawingstate.alpha,s=255*csport.drawingstate.textcolorraw[0],t=255*csport.drawingstate.textcolorraw[1],v=255*csport.drawingstate.textcolorraw[2];void 0!==e.color&&(erg=evaluate(e.color),List.isNumberVector(erg).value&&3==erg.value.length&&(s=
Math.floor(255*erg.value[0].value.real),t=Math.floor(255*erg.value[1].value.real),v=Math.floor(255*erg.value[2].value.real)));void 0!==e.alpha&&(erg=evaluate(e.alpha),"number"==erg.ctype&&(u=erg.value.real));col="rgba("+s+","+t+","+v+","+u+")"}csctx.fillStyle=col;csctx.font=f+g+Math.round(10*d)/10+"px "+h;d=niceprint(q);f=csctx.measureText(d).width;csctx.fillText(d,n-f*k+l,r-p)}return nada};
evaluator._helper.drawshape=function(c,e){return"polygon"==c.type?evaluator._helper.drawpolygon([c],e,"D",1):"circle"==c.type?evaluator._helper.drawcircle([c.value.value[0],c.value.value[1]],e,"D"):nada};evaluator._helper.fillshape=function(c,e){return"polygon"==c.type?evaluator._helper.drawpolygon([c],e,"F",1):"circle"==c.type?evaluator._helper.drawcircle([c.value.value[0],c.value.value[1]],e,"F"):nada};
evaluator._helper.clipshape=function(c,e){return"polygon"==c.type?evaluator._helper.drawpolygon([c],e,"C",1):"circle"==c.type?evaluator._helper.drawcircle([c.value.value[0],c.value.value[1]],e,"C"):nada};evaluator.fill=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("shape"==d.ctype)return evaluator._helper.fillshape(d,e)}return nada};
evaluator.clip=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("shape"==d.ctype)return evaluator._helper.clipshape(d,e);if("list"==d.ctype)return erg=evaluator.polygon(c,[]),evaluator.clip([erg],[])}return nada};evaluator._helper.setDash=function(c,e){for(var d=Math.sqrt(e),f=0;f<c.length;f++)c[f]*=d;csctx.setLineDash||(csctx.setLineDash=function(){});csctx.webkitLineDash=c;csctx.setLineDash(c);csctx.mozDash=c};
evaluator._helper.unSetDash=function(){csctx.setLineDash||(csctx.setLineDash=function(){});csctx.webkitLineDash=[];csctx.setLineDash([]);csctx.mozDash=[]};evaluator._helper.setDashType=function(c,e){0==c&&evaluator._helper.setDash([]);1==c&&evaluator._helper.setDash([10,10],e);2==c&&evaluator._helper.setDash([10,4],e);3==c&&evaluator._helper.setDash([1,3],e);4==c&&evaluator._helper.setDash([10,5,1,5],e)};
evaluator.plot=function(c,e){var d=!1,f=!1,g=0,h=!1,k=-10,l=10,p=1,n=1E3,q=c[0];if(2==c.length&&"variable"==c[1].ctype)s=c[1].name;else{var r=evaluator._helper.plotvars(q),s="#";-1!=r.indexOf("t")&&(s="t");-1!=r.indexOf("z")&&(s="z");-1!=r.indexOf("y")&&(s="y");-1!=r.indexOf("x")&&(s="x")}namespace.newvar(s);var t=csport.drawingstate.matrix,v=csport.drawingstate.linecolor,u=1;(function(c){void 0!==e.size&&(x=evaluate(e.size),"number"==x.ctype&&(u=x.value.real,0>u&&(u=0)));if(void 0!==e.dashpattern&&
(x=evaluate(e.dashpattern),"list"==x.ctype)){c=[];for(var g=0;g<x.value.length;g++)c[g]=x.value[g].value.real;evaluator._helper.setDash(c,u);d=!0}void 0!==e.dashtype&&(x=evaluate(e.dashtype),"number"==x.ctype&&(c=Math.floor(x.value.real),evaluator._helper.setDashType(c,u),d=!0));void 0!==e.dashing&&(x=evaluate(e.dashing),"number"==x.ctype&&(c=Math.floor(x.value.real),evaluator._helper.setDash([2*c,c],u),d=!0));void 0!==e.connect&&(x=evaluate(e.connect),"boolean"==x.ctype&&(f=x.value));void 0!==e.start&&
(x=evaluate(e.start),"number"==x.ctype&&(k=x.value.real));void 0!==e.stop&&(x=evaluate(e.stop),"number"==x.ctype&&(l=x.value.real));void 0!==e.steps&&(x=evaluate(e.steps),"number"==x.ctype&&(n=x.value.real));if(void 0!==e.color||void 0!==e.alpha){var h=g=c=0,p=csport.drawingstate.alpha;c=255*csport.drawingstate.linecolorraw[0];g=255*csport.drawingstate.linecolorraw[1];h=255*csport.drawingstate.linecolorraw[2];void 0!==e.color&&(x=evaluate(e.color),List.isNumberVector(x).value&&3==x.value.length&&
(c=Math.floor(255*x.value[0].value.real),g=Math.floor(255*x.value[1].value.real),h=Math.floor(255*x.value[2].value.real)));void 0!==e.alpha&&(x=evaluate(e.alpha),"number"==x.ctype&&(p=x.value.real));v="rgba("+c+","+g+","+h+","+p+")"}})();csctx.strokeStyle=v;csctx.lineWidth=u;csctx.lineCap="round";csctx.lineJoin="round";var y=function(c){return"number"==c.ctype&&CSNumber._helper.isAlmostReal(c)},w=function(c,d,e,f,g){},w=function(c,d,e,f,k){g++;d=+d.value.real;k=+f.value.real;f=d*t.a-k*t.b+t.tx;d=
d*t.c-k*t.d-t.ty;c=+c.value.real;k=+e.value.real;e=c*t.a-k*t.b+t.tx;c=c*t.c-k*t.d-t.ty;h?(csctx.lineTo(e,c),csctx.lineTo(f,d)):(csctx.beginPath(),csctx.moveTo(e,c),csctx.lineTo(f,d),h=!0)},A=function(c,d,e,g,k){var l=y(e),n=y(g);if(.001>k)!f&&h&&(csctx.stroke(),h=!1);else if(l||n){var p=CSNumber.real((c.value.real+d.value.real)/2);namespace.setvar(s,p);var r=evaluate(q),t=y(r);if(l&&n&&t){var v=e.value.real,n=r.value.real,t=g.value.real;if(l=1>Math.abs(v+t-2*n)/.2){var u=CSNumber.real((c.value.real+
p.value.real)/2);namespace.setvar(s,u);var u=evaluate(q),x=CSNumber.real((p.value.real+d.value.real)/2);namespace.setvar(s,x);x=evaluate(q).value.real;v=Math.abs(v+n-2*u.value.real)/.2;n=Math.abs(n+t-2*x)/.2;l=l&&1>v&&1>n}l?(w(c,p,e,r,k/2),w(p,d,r,g,k/2)):(A(c,p,e,r,k/2),A(p,d,r,g,k/2))}else A(c,p,e,r,k/2),A(p,d,r,g,k/2)}},z,B,C,h=!1,r=CSNumber.real(14.32);namespace.setvar(s,r);C=evaluate(q);if("number"!=C.ctype){if(List.isNumberVector(C).value&&2==C.value.length){h=!1;p=(l-k)/n;for(r=k;r<l;r+=p){namespace.setvar(s,
CSNumber.real(r));var x=evaluate(q);if(List.isNumberVector(x).value&&2==x.value.length){z=+x.value[0].value.real;B=+x.value[1].value.real;var D=z*t.a-B*t.b+t.tx;z=z*t.c-B*t.d-t.ty;h?csctx.lineTo(D,z):(csctx.beginPath(),csctx.moveTo(D,z),h=!0)}}csctx.stroke();namespace.removevar(s)}d&&evaluator._helper.unSetDash();return nada}for(D=k;D<l+p;D+=p)r=CSNumber.real(D),namespace.setvar(s,r),C=evaluate(q),r.value.real>k&&A(z,r,B,C,p),z=r,B=C;namespace.removevar(s);h&&csctx.stroke();d&&evaluator._helper.unSetDash();
return nada};
evaluator.plotX=function(c,e){var d=c[0],f=evaluator._helper.plotvars(d),g="#";-1!=f.indexOf("t")&&(g="t");-1!=f.indexOf("z")&&(g="z");-1!=f.indexOf("y")&&(g="y");-1!=f.indexOf("x")&&(g="x");namespace.newvar(g);f=csport.drawingstate.matrix;csctx.fillStyle=csport.drawingstate.linecolor;csctx.lineWidth=1;csctx.lineCap="round";for(var h=!1,k=-10;10>k;k+=.01){namespace.setvar(g,CSNumber.real(k));var l=evaluate(d);if("number"==l.ctype){var p=+l.value.real,l=k*f.a-p*f.b+f.tx,p=k*f.c-p*f.d-f.ty;h?csctx.lineTo(l,
p):(csctx.beginPath(),csctx.moveTo(l,p),h=!0)}}csctx.stroke();namespace.removevar(g);return nada};
evaluator._helper.plotvars=function(c){var e=function(c,d){for(var e={},f=c.length-1;0<=f;--f)e[c[f]]=c[f];for(f=d.length-1;0<=f;--f)e[d[f]]=d[f];var f=[],g;for(g in e)e.hasOwnProperty(g)&&f.push(e[g]);return f},d=function(c,d){for(var e=0;e<c.length;e++)c[e]===d&&(c.splice(e,1),e--);return c};if("variable"==c.ctype)return[c.name];if("infix"==c.ctype){var f=evaluator._helper.plotvars(c.args[0]);c=evaluator._helper.plotvars(c.args[1]);return e(f,c)}if("list"==c.ctype){for(var g=c.value,h=[],k=0;k<
g.length;k++)f=evaluator._helper.plotvars(g[k]),h=e(h,f);return h}if("function"==c.ctype){g=c.args;h=[];for(k=0;k<g.length;k++)f=evaluator._helper.plotvars(g[k]),h=e(h,f);"apply"!=c.oper&&"select"!=c.oper&&"forall"!=c.oper&&"sum"!=c.oper&&"product"!=c.oper&&"repeat"!=c.oper&&"min"!=c.oper&&"max"!=c.oper&&"sort"!=c.oper||"variable"!=c.args[1].ctype||(h=d(h,c.args[1].name));return h}return[]};
evaluator.clrscr=function(c,e){0==c.length&&"undefined"!=typeof csw&&"undefined"!=typeof csh&&csctx.clearRect(0,0,csw,csh);return nada};evaluator.repaint=function(c,e){console.log("REPAINT");0==c.length&&updateCindy();return nada};evaluator.seconds=function(c,e){return{ctype:"number",value:{real:(new Date).getTime()/1E3,imag:0}}};
evaluator.err=function(c,e){"undefined"==typeof csconsole&&(csconsole=window.open("","","width=200,height=100"));if("variable"==c[0].ctype){var d=evaluate(namespace.getvar(c[0].name));console.log(c[0].name+" ==> "+niceprint(d));csconsole.document.write(c[0].name+" ==> "+niceprint(d)+"<br>")}else d=evaluate(c[0]),console.log(" ==> "+niceprint(d)),csconsole.document.writeln(" ==> "+niceprint(d)+"<br>");return nada};
evaluator.errc=function(c,e){if("variable"==c[0].ctype){var d=evaluate(namespace.getvar(c[0].name));console.log(c[0].name+" ==> "+niceprint(d))}else d=evaluate(c[0]),console.log(" ==> "+niceprint(d));return nada};evaluator.dump=function(c,e){dump(c[0]);return nada};
evaluator.repeat=function(c,e){var d=evaluateAndVal(c[0]),f=c.length-1,g="#";3==c.length&&"variable"==c[1].ctype&&(g=c[1].name);if("number"!=d.ctype)return nada;var d=Math.round(d.value.real),h=1,k=1,l=d+1,p=!1,n=!1,q=!1;if(void 0!==e.start){var r=evaluate(e.start);"number"==r.ctype&&(p=!0,k=r.value.real)}void 0!==e.step&&(r=evaluate(e.step),"number"==r.ctype&&(q=!0,h=r.value.real));void 0!==e.stop&&(r=evaluate(e.stop),"number"==r.ctype&&(n=!0,l=r.value.real));!p||n||q||(l=h*d+k);p||!n||q||(k=-h*
(d-1)+l,l+=h);p||n||!q||(l=h*d+k);p&&n&&!q&&(h=(l-k)/(d-1),l+=h);p&&!n&&q&&(l=h*d+k);!p&&n&&q&&(k=-h*(d-1)+l,l+=h);p&&n&&q&&(l+=h);(k<=l&&0<h||k>=l&&0>h)&&p&&n&&q&&(d=Math.floor((l-k)/h));namespace.newvar(g);for(var s,l=0;l<d;l++)namespace.setvar(g,{ctype:"number",value:{real:l*h+k,imag:0}}),s=evaluate(c[f]);namespace.removevar(g);return s};evaluator.while=function(c,e){for(var d=c[1],f=c[0],g=evaluate(f),h=nada;"list"!=g.ctype&&g.value;)h=evaluate(d),g=evaluate(f);return h};
evaluator.apply=function(c,e){var d=evaluateAndVal(c[0]);if("list"!=d.ctype)return nada;var f=c.length-1,g="#";3==c.length&&"variable"==c[1].ctype&&(g=c[1].name);var d=d.value,h=[];namespace.newvar(g);for(var k=0;k<d.length;k++)namespace.setvar(g,d[k]),h[h.length]=evaluate(c[f]);namespace.removevar(g);return{ctype:"list",value:h}};
evaluator.forall=function(c,e){var d=evaluateAndVal(c[0]);if("list"!=d.ctype)return nada;var f=c.length-1,g="#";3==c.length&&"variable"==c[1].ctype&&(g=c[1].name);d=d.value;namespace.newvar(g);for(var h,k=0;k<d.length;k++)namespace.setvar(g,d[k]),h=evaluate(c[f]);namespace.removevar(g);return h};
evaluator.select=function(c,e){var d=evaluateAndVal(c[0]);if("list"!=d.ctype)return nada;var f=c.length-1,g="#";3==c.length&&"variable"==c[1].ctype&&(g=c[1].name);var d=d.value,h=[];namespace.newvar(g);for(var k=0;k<d.length;k++){namespace.setvar(g,d[k]);var l=evaluate(c[f]);"boolean"==l.ctype&&1==l.value&&(h[h.length]=d[k])}namespace.removevar(g);return{ctype:"list",value:h}};
evaluator.semicolon=function(c,e){var d="void"==c[0].ctype,f="void"==c[1].ctype;if(d&&f)return nada;if(!d&&f)return evaluate(c[0]);d||f||evaluate(c[0]);return f?nada:evaluate(c[1])};evaluator.createvar=function(c,e){1==c.length&&"variable"==c[0].ctype&&namespace.newvar(c[0].name);return nada};evaluator.local=function(c,e){for(var d=0;d<c.length;d++)"variable"==c[d].ctype&&namespace.newvar(c[d].name);return nada};
evaluator.removevar=function(c,e){if(1==c.length){var d=evaluate(c[0]);"variable"==c[0].ctype&&namespace.removevar(c[0].name);return d}return nada};evaluator.release=function(c,e){if(0==c.length)return nada;for(var d=evaluate(c[c.length-1]),f=0;f<c.length;f++)"variable"==c[f].ctype&&namespace.removevar(c[f].name);return d};evaluator.regional=function(c,e){for(var d=0;d<c.length;d++)if("variable"==c[d].ctype){var f=c[d].name;namespace.newvar(f);namespace.pushVstack(f)}return nada};
evaluator.genList=function(c,e){for(var d=[],f=0;f<c.length;f++)d[d.length]=evaluate(c[f]);return{ctype:"list",value:d}};evaluator._helper.assigntake=function(c,e){var d=evaluate(c.args[0]),f=evaluateAndVal(c.args[1]);if("list"==d.ctype||"string"==d.ctype)if(f=Math.floor(f.value.real),0>f&&(f=d.value.length+f+1),0<f&&f<d.value.length+1)if("list"==d.ctype)d.value[f-1]=evaluate(e);else{var g=d.value,g=g.substring(0,f-1)+niceprint(evaluate(e))+g.substring(f,g.length);d.value=g}return nada};
evaluator._helper.assigndot=function(c,e){var d=evaluate(c.obj),f=c.key;d&&f&&Accessor.setField(d.value,f,evaluate(e));return nada};evaluator._helper.assignlist=function(c,e){var d=c.length,f=e.length;f<d&&(d=f);for(f=0;f<d;f++)evaluator.assign([c[f],e[f]],[])};
evaluator.assign=function(c,e){var d="undefined"==c[1].ctype;if("undefined"==c[0].ctype||d)return nada;"variable"==c[0].ctype&&namespace.setvar(c[0].name,evaluate(c[1]));"infix"==c[0].ctype&&"_"==c[0].oper&&evaluator._helper.assigntake(c[0],c[1]);"field"==c[0].ctype&&evaluator._helper.assigndot(c[0],c[1]);"function"==c[0].ctype&&"genList"==c[0].oper&&(d=evaluate(c[1]),"list"==d.ctype&&evaluator._helper.assignlist(c[0].args,d.value));return c[0].value};
evaluator.define=function(c,e){var d="undefined"==c[1].ctype;if("undefined"==c[0].ctype||d)return nada;if("function"==c[0].ctype){var d=c[0].oper,f=c[0].args;myfunctions[d+f.length]={oper:d,body:c[1],arglist:f}}return nada};evaluator.if=function(c,e){var d=evaluateAndVal(c[0]);if("boolean"==d.ctype){if(1==d.value)return evaluate(c[1]);if(3==c.length)return evaluate(c[2])}return nada};
evaluator.comp_equals=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype?{ctype:"boolean",value:d.value.real==f.value.real&&d.value.imag==f.value.imag}:"string"==d.ctype&&"string"==f.ctype||"boolean"==d.ctype&&"boolean"==f.ctype?{ctype:"boolean",value:d.value==f.value}:"list"==d.ctype&&"list"==f.ctype?List.equals(d,f):{ctype:"boolean",value:!1}};evaluator.comp_notequals=function(c,e){var d=evaluator.comp_equals(c,e);d.value=!d.value;return d};
evaluator.comp_almostequals=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype?{ctype:"boolean",value:CSNumber._helper.isAlmostEqual(d,f)}:"string"==d.ctype&&"string"==f.ctype||"boolean"==d.ctype&&"boolean"==f.ctype?{ctype:"boolean",value:d.value==f.value}:"list"==d.ctype&&"list"==f.ctype?List.almostequals(d,f):{ctype:"boolean",value:!1}};
evaluator.and=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"boolean"==d.ctype&&"boolean"==f.ctype?{ctype:"boolean",value:d.value&&f.value}:nada};evaluator.or=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"boolean"==d.ctype&&"boolean"==f.ctype?{ctype:"boolean",value:d.value||f.value}:nada};
evaluator.xor=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"boolean"==d.ctype&&"boolean"==f.ctype?{ctype:"boolean",value:d.value!=f.value}:nada};evaluator.not=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"void"==d.ctype&&"boolean"==f.ctype?{ctype:"boolean",value:!f.value}:nada};evaluator.numb_degree=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"void"==f.ctype?CSNumber.mult(d,CSNumber.real(Math.PI/180)):nada};
evaluator.comp_notalmostequals=function(c,e){var d=evaluator.comp_almostequals(c,e);d.value=!d.value;return d};evaluator.comp_ugt=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real>f.value.real+CSNumber.eps}:nada};
evaluator.comp_uge=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real>f.value.real-CSNumber.eps}:nada};
evaluator.comp_ult=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real<f.value.real-CSNumber.eps}:nada};
evaluator.comp_ule=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real<f.value.real+CSNumber.eps}:nada};
evaluator.comp_gt=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real>f.value.real}:"string"==d.ctype&&"string"==f.ctype?{ctype:"boolean",value:d.value>f.value}:nada};
evaluator.comp_ge=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real>=f.value.real}:"string"==d.ctype&&"string"==f.ctype?{ctype:"boolean",value:d.value>=f.value}:nada};
evaluator.comp_le=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real<=f.value.real}:"string"==d.ctype&&"string"==f.ctype?{ctype:"boolean",value:d.value<=f.value}:nada};
evaluator.comp_lt=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:d.value.real<f.value.real}:"string"==d.ctype&&"string"==f.ctype?{ctype:"boolean",value:d.value<f.value}:nada};evaluator.sequence=function(c,e){var d=evaluate(c[0]),f=evaluate(c[1]);return"number"==d.ctype&&"number"==f.ctype?List.sequence(d,f):nada};
evaluator._helper.genericListMath1=function(c,e){var d=evaluateAndVal(c[0]);if("list"!=d.ctype)return nada;var f=c.length-1,g="#";3==c.length&&"variable"==c[1].ctype&&(g=c[1].name);d=d.value;if(0==d.length)return nada;namespace.newvar(g);namespace.setvar(g,d[0]);for(var h=evaluate(c[f]),k=1;k<d.length;k++){namespace.setvar(g,d[k]);var l=evaluate(c[f]),h=General[e](h,l)}namespace.removevar(g);return h};
evaluator._helper.genericListMath=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return erg=List.genericListMath(d,e)}return evaluator._helper.genericListMath1(c,e)};evaluator.product=function(c,e){return evaluator._helper.genericListMath(c,"mult")};evaluator.sum=function(c,e){return evaluator._helper.genericListMath(c,"add")};evaluator.max=function(c,e){return evaluator._helper.genericListMath(c,"max")};
evaluator.min=function(c,e){return evaluator._helper.genericListMath(c,"min")};evaluator.add=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return General.add(d,f)};evaluator.minus=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"void"==d.ctype&&"number"==f.ctype?CSNumber.neg(f):"void"==d.ctype&&"list"==f.ctype?List.neg(f):"number"==d.ctype&&"number"==f.ctype?CSNumber.sub(d,f):"list"==d.ctype&&"list"==f.ctype?List.sub(d,f):nada};
evaluator.mult=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return General.mult(d,f)};evaluator.div=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return General.div(d,f)};evaluator.mod=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype?CSNumber.mod(d,f):nada};evaluator.pow=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype?CSNumber.pow(d,f):nada};
evaluator.exp=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.exp(d):nada};evaluator.sin=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.sin(d):nada};evaluator.sqrt=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.sqrt(d):nada};evaluator.cos=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.cos(d):nada};
evaluator.tan=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.tan(d):nada};evaluator.arccos=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.arccos(d):nada};evaluator.arcsin=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.arcsin(d):nada};evaluator.arctan=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.arctan(d):nada};
evaluator.arctan2=function(c,e){if(2==c.length){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);if("number"==d.ctype&&"number"==f.ctype)return CSNumber.arctan2(d,f)}return 1==c.length&&(d=evaluateAndVal(c[0]),"list"==d.ctype&&2==d.value.length&&(d=d.value,"number"==d[0].ctype&&"number"==d[1].ctype))?evaluator.arctan2(d,e):nada};evaluator.log=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber.log(d):nada};
evaluator.recursive=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?CSNumber[e](d):"list"==d.ctype?List[e](d):nada};evaluator.im=function(c,e){return evaluator.recursive(c,"im")};evaluator.re=function(c,e){return evaluator.recursive(c,"re")};evaluator.conjugate=function(c,e){return evaluator.recursive(c,"conjugate")};evaluator.round=function(c,e){return evaluator.recursive(c,"round")};evaluator.ceil=function(c,e){return evaluator.recursive(c,"ceil")};
evaluator.floor=function(c,e){return evaluator.recursive(c,"floor")};evaluator.abs=function(c,e){return evaluator.recursive(c,"abs")};evaluator.random=function(c,e){if(0==c.length)return CSNumber.real(CSNumber._helper.rand());if(1==c.length){var d=evaluateAndVal(c[0]);if("number"==d.ctype)return CSNumber.complex(d.value.real*CSNumber._helper.rand(),d.value.imag*CSNumber._helper.rand())}return nada};
evaluator.random=function(c,e){if(0==c.length)return CSNumber.real(CSNumber._helper.rand());if(1==c.length){var d=evaluateAndVal(c[0]);if("number"==d.ctype)return CSNumber.complex(d.value.real*CSNumber._helper.rand(),d.value.imag*CSNumber._helper.rand())}return nada};evaluator.seedrandom=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"number"==d.ctype&&CSNumber._helper.seedrandom(d.value.real)}return nada};
evaluator.randomnormal=function(c,e){return 0==c.length?CSNumber.real(CSNumber._helper.randnormal()):nada};evaluator.randominteger=function(c,e){return evaluator.randomint(c,e)};evaluator.randombool=function(c,e){return 0==c.length?.5<CSNumber._helper.rand()?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}:nada};evaluator.isreal=function(c,e){if(1==c.length){var d=evaluate(c[0]);return"number"==d.ctype&&CSNumber._helper.isAlmostReal(d)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}}return nada};
evaluator.isinteger=function(c,e){if(1==c.length){var d=evaluate(c[0]);return"number"==d.ctype&&CSNumber._helper.isAlmostReal(d)&&d.value.real==Math.floor(d.value.real)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}}return nada};evaluator.iseven=function(c,e){if(1==c.length){var d=evaluate(c[0]);return"number"==d.ctype&&CSNumber._helper.isAlmostReal(d)&&d.value.real/2==Math.floor(d.value.real/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}}return nada};
evaluator.isodd=function(c,e){if(1==c.length){var d=evaluate(c[0]);return"number"==d.ctype&&CSNumber._helper.isAlmostReal(d)&&(d.value.real-1)/2==Math.floor((d.value.real-1)/2)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}}return nada};evaluator.iscomplex=function(c,e){return 1==c.length?"number"==evaluate(c[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}:nada};
evaluator.isstring=function(c,e){return 1==c.length?"string"==evaluate(c[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}:nada};evaluator.islist=function(c,e){return 1==c.length?"list"==evaluate(c[0]).ctype?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}:nada};evaluator.ismatrix=function(c,e){if(1==c.length){var d=evaluate(c[0]);return-1!=List._helper.colNumb(d)?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}}return nada};
evaluator.isnumbermatrix=function(c,e){if(1==c.length){var d=evaluate(c[0]);return List.isNumberMatrix(d).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}}return nada};evaluator.isnumbervector=function(c,e){if(1==c.length){var d=evaluate(c[0]);return List.isNumberVector(d).value?{ctype:"boolean",value:!0}:{ctype:"boolean",value:!1}}return nada};
evaluator.matrixrowcolumn=function(c,e){if(1==c.length){var d=evaluate(c[0]);if(-1!=List._helper.colNumb(d))return List.realVector([d.value.length,d.value[0].value.length])}return nada};
evaluator.complex=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);if("list"==d.ctype&&List.isNumberVector(d)){if(2==d.value.length){var f=d.value[0],g=d.value[1];return CSNumber.complex(f.value.real-g.value.imag,g.value.real+f.value.imag)}if(3==d.value.length)return f=d.value[0],g=d.value[1],d=d.value[2],f=CSNumber.div(f,d),g=CSNumber.div(g,d),CSNumber.complex(f.value.real-g.value.imag,g.value.real+f.value.imag)}}return nada};
evaluator.gauss=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);if("number"==d.ctype)return List.realVector([d.value.real,d.value.imag])}return nada};evaluator.cross=function(c,e){if(2==c.length){var d=evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]);if(d!=nada&&f!=nada){var g=List.cross(d,f);g.usage="None";"Point"==d.usage&&"Point"==f.usage&&(g.usage="Line");"Line"==d.usage&&"Line"==f.usage&&(g.usage="Point");return g}}return nada};
evaluator.cross=function(c,e){if(2==c.length){var d=evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]);if(d!=nada&&f!=nada){var g=List.cross(d,f);g.usage="None";"Point"==d.usage&&"Point"==f.usage&&(g.usage="Line");"Line"==d.usage&&"Line"==f.usage&&(g.usage="Point");return g}}return nada};
evaluator.para=function(c,e){if(2==c.length){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]),g=evaluateAndHomog(d),h=evaluateAndHomog(f);if(d!=nada&&f!=nada){var f=f.usage,k=g,l=h;if("Line"==d.usage||"Point"==f)k=h,l=g;d=List.cross(List.cross(List.linfty,l),k);d.usage="Line";return d}}return nada};
evaluator.perp=function(c,e){if(2==c.length){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]),g=evaluateAndHomog(d),h=evaluateAndHomog(f);if(d!=nada&&f!=nada){var k=f.usage,f=g,l=h;if("Line"==d.usage||"Point"==k)f=h,l=g;d=List.cross(List.linfty,l);d.value=[d.value[1],CSNumber.neg(d.value[0]),d.value[2]];d=List.cross(d,f);d.usage="Line";return d}}return 1==c.length&&(d=evaluateAndVal(c[0]),List._helper.isNumberVecN(d,2))?(d.value=[CSNumber.neg(d.value[1]),d.value[0]],d):nada};
evaluator.parallel=function(c,e){return evaluator.para(c,e)};evaluator.perpendicular=function(c,e){return evaluator.perp(c,e)};evaluator.meet=function(c,e){if(2==c.length){var d=evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]);if(d!=nada&&f!=nada)return d=List.cross(d,f),d.usage="Point",d}return nada};evaluator.join=function(c,e){if(2==c.length){var d=evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]);if(d!=nada&&f!=nada)return d=List.cross(d,f),d.usage="Line",d}return nada};
evaluator.dist=function(c,e){if(2==c.length){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]),d=evaluator.minus([d,f],[]);return evaluator.abs([d],[])}return nada};evaluator.point=function(c,e){if(1==c.length){var d=evaluate(c[0]);if(List._helper.isNumberVecN(d,3)||List._helper.isNumberVecN(d,2))d.usage="Point"}return d};evaluator.line=function(c,e){if(1==c.length){var d=evaluate(c[0]);List._helper.isNumberVecN(d,3)&&(d.usage="Line")}return d};
evaluator.det=function(c,e){if(3==c.length){var d=evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]),g=evaluateAndHomog(c[2]);if(d!=nada&&f!=nada&&g!=nada)return List.det3(d,f,g)}return nada};
evaluator.area=function(c,e){if(3==c.length){var d=evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]),g=evaluateAndHomog(c[2]);if(d!=nada&&f!=nada&&g!=nada){var h=d.value[2],k=f.value[2],l=g.value[2];if(!CSNumber._helper.isAlmostZero(h)&&!CSNumber._helper.isAlmostZero(k)&&!CSNumber._helper.isAlmostZero(l))return d=List.scaldiv(h,d),f=List.scaldiv(k,f),g=List.scaldiv(l,g),d=List.det3(d,f,g),d.value.real*=.5,d.value.imag*=.5,d}}return nada};
evaluator.inverse=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);if("list"==d.ctype){var f=List._helper.colNumb(d);if(-1!=f&&f==d.value.length)return List.inverse(d)}}return nada};evaluator.det=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);if("list"==d.ctype){var f=List._helper.colNumb(d);if(-1!=f&&f==d.value.length)return List.det(d)}}return nada};
evaluator.take=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluateAndVal(c[1]);if("number"==f.ctype){var g=Math.floor(f.value.real);if("list"==d.ctype||"string"==d.ctype)return 0>g&&(g=d.value.length+g+1),0<g&&g<d.value.length+1?"list"==d.ctype?d.value[g-1]:{ctype:"string",value:d.value.charAt(g-1)}:nada}if("list"==f.ctype){for(var g=[],h=0;h<f.value.length;h++){var k=evaluateAndVal(f.value[h]);g[h]=evaluator.take([d,k],[])}return List.turnIntoCSList(g)}}return nada};
evaluator.length=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype||"string"==d.ctype)return CSNumber.real(d.value.length)}return nada};evaluator.pairs=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return List.pairs(d)}return nada};evaluator.triples=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return List.triples(d)}return nada};evaluator.cycle=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return List.cycle(d)}return nada};
evaluator.consecutive=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return List.consecutive(d)}return nada};evaluator.reverse=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return List.reverse(d)}return nada};evaluator.directproduct=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("list"==d.ctype&&"list"==f.ctype)return List.directproduct(d,f)}return nada};
evaluator.concat=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("list"==d.ctype&&"list"==f.ctype)return List.concat(d,f);if("shape"==d.ctype&&"shape"==f.ctype)return evaluator._helper.shapeconcat(d,f)}return nada};evaluator.common=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("list"==d.ctype&&"list"==f.ctype)return List.common(d,f);if("shape"==d.ctype&&"shape"==f.ctype)return evaluator._helper.shapecommon(d,f)}return nada};
evaluator.remove=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("list"==d.ctype&&"list"==f.ctype)return List.remove(d,f);if("shape"==d.ctype&&"shape"==f.ctype)return evaluator._helper.shaperemove(d,f)}return nada};evaluator.append=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("list"==d.ctype)return List.append(d,f)}return nada};
evaluator.prepend=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("list"==f.ctype)return List.prepend(d,f)}return nada};evaluator.contains=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("list"==d.ctype)return List.contains(d,f)}return nada};
evaluator._helper.sort2=function(c,e){var d=evaluateAndVal(c[0]);if("list"!=d.ctype)return nada;var f=c.length-1,g="#";3==c.length&&"variable"==c[1].ctype&&(g=c[1].name);var d=d.value,h=[];namespace.newvar(g);for(var k=0;k<d.length;k++)namespace.setvar(g,d[k]),h[h.length]={val:d[k],result:evaluate(c[f])};namespace.removevar(g);h.sort(General.compareResults);f=[];for(k=0;k<d.length;k++)f[f.length]=h[f.length].val;return{ctype:"list",value:f}};
evaluator.sort=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return List.sort1(d)}return evaluator._helper.sort2(c,e)};evaluator.set=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype)return List.set(d)}return nada};evaluator.zeromatrix=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==d.ctype&&"number"==f.ctype?List.zeromatrix(d,f):nada};
evaluator.zerovector=function(c,e){var d=evaluateAndVal(c[0]);return"number"==d.ctype?List.zerovector(d):nada};evaluator.transpose=function(c,e){var d=evaluateAndVal(c[0]);return"list"==d.ctype&&-1!=List._helper.colNumb(d)?List.transpose(d):nada};evaluator.row=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==f.ctype&&"list"==d.ctype&&-1!=List._helper.colNumb(d)?List.row(d,f):nada};
evaluator.column=function(c,e){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]);return"number"==f.ctype&&"list"==d.ctype&&-1!=List._helper.colNumb(d)?List.column(d,f):nada};evaluator.red=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("number"==d.ctype)return d=Math.min(1,Math.max(0,d.value.real)),List.realVector([d,0,0])}return nada};evaluator.green=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("number"==d.ctype)return d=Math.min(1,Math.max(0,d.value.real)),List.realVector([0,d,0])}return nada};
evaluator.blue=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("number"==d.ctype)return d=Math.min(1,Math.max(0,d.value.real)),List.realVector([0,0,d])}return nada};evaluator.grey=function(c,e){return evaluator.gray(c,e)};evaluator.gray=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("number"==d.ctype)return d=Math.min(1,Math.max(0,d.value.real)),List.realVector([d,d,d])}return nada};
evaluator._helper.HSVtoRGB=function(c,e,d){var f,g,h,k,l,p;c&&void 0===e&&void 0===d&&(e=c.s,d=c.v,c=c.h);k=Math.floor(6*c);l=6*c-k;c=d*(1-e);p=d*(1-l*e);e=d*(1-(1-l)*e);switch(k%6){case 0:f=d;g=e;h=c;break;case 1:f=p;g=d;h=c;break;case 2:f=c;g=d;h=e;break;case 3:f=c;g=p;h=d;break;case 4:f=e;g=c;h=d;break;case 5:f=d,g=c,h=p}return List.realVector([f,g,h])};
evaluator.hue=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("number"==d.ctype)return d=d.value.real,d-=Math.floor(d),evaluator._helper.HSVtoRGB(d,1,1)}return nada};
evaluator._helper.shapeconvert=function(c){if("circle"==c.type){var e=c.value.value[0],d=General.div(e,e.value[2]),e=d.value[0].value.real,f=d.value[1].value.real;c=c.value.value[1].value.real;for(var d=[],g=2*Math.PI/36,h=0;36>h;h++)d[h]={X:e+Math.cos(h*g)*c,Y:f+Math.sin(h*g)*c};return[d]}if("polygon"==c.type){erg=[];for(h=0;h<c.value.length;h++){pol=c.value[h];d=[];for(e=0;e<pol.length;e++)d[e]={X:pol[e].X,Y:pol[e].Y};erg[h]=d}return erg}};
evaluator._helper.shapeop=function(c,e,d){c=evaluator._helper.shapeconvert(c);var f=evaluator._helper.shapeconvert(e);ClipperLib.JS.ScaleUpPaths(c,1E3);ClipperLib.JS.ScaleUpPaths(f,1E3);e=new ClipperLib.Clipper;e.AddPaths(c,ClipperLib.PolyType.ptSubject,!0);e.AddPaths(f,ClipperLib.PolyType.ptClip,!0);var f=c=ClipperLib.PolyFillType.pftNonZero,g=new ClipperLib.Paths;e.Execute(d,g,c,f);ClipperLib.JS.ScaleDownPaths(g,1E3);return{ctype:"shape",type:"polygon",value:g}};
evaluator._helper.shapecommon=function(c,e){return evaluator._helper.shapeop(c,e,ClipperLib.ClipType.ctIntersection)};evaluator._helper.shaperemove=function(c,e){return evaluator._helper.shapeop(c,e,ClipperLib.ClipType.ctDifference)};evaluator._helper.shapeconcat=function(c,e){return evaluator._helper.shapeop(c,e,ClipperLib.ClipType.ctUnion)};evaluator.key=function(c,e){return 0==c.length?{ctype:"string",value:cskey}:nada};
evaluator.keycode=function(c,e){return 0==c.length?CSNumber.real(cskeycode):nada};evaluator.mouse=function(c,e){return 0==c.length?List.realVector([csmouse[0],csmouse[1]]):nada};evaluator.mover=function(c,e){return 0==c.length&&move&&move.mover?{ctype:"geo",value:move.mover,type:"P"}:nada};evaluator.translate=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"list"==d.ctype&&List.isNumberVector(d)&&2==d.value.length&&csport.translate(d.value[0].value.real,d.value[1].value.real)}return nada};
evaluator.rotate=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"number"==d.ctype&&csport.rotate(d.value.real)}return nada};evaluator.scale=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"number"==d.ctype&&csport.scale(d.value.real)}return nada};evaluator.greset=function(c,e){if(0==c.length){var d=csgstorage.stack.length;csport.greset();for(var f=0;f<d;f++)csctx.restore()}return nada};evaluator.gsave=function(c,e){0==c.length&&(csport.gsave(),csctx.save());return nada};
evaluator.grestore=function(c,e){0==c.length&&(csport.grestore(),csctx.restore());return nada};evaluator.color=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"list"==d.ctype&&List.isNumberVector(d).value&&csport.setcolor(d)}return nada};evaluator.linecolor=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"list"==d.ctype&&List.isNumberVector(d).value&&csport.setlinecolor(d)}return nada};
evaluator.pointcolor=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"list"==d.ctype&&List.isNumberVector(d).value&&csport.setpointcolor(d)}return nada};evaluator.alpha=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"number"==d.ctype&&csport.setalpha(d)}return nada};evaluator.pointsize=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"number"==d.ctype&&csport.setpointsize(d)}return nada};
evaluator.linesize=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"number"==d.ctype&&csport.setlinesize(d)}return nada};evaluator.textsize=function(c,e){if(1==c.length){var d=evaluateAndVal(c[0]);"number"==d.ctype&&csport.settextsize(d)}return nada};
evaluator.replace=function(c,e){if(3==c.length){var d=evaluate(c[0]),f=evaluate(c[1]),g=evaluate(c[2]);if("string"==d.ctype&&"string"==f.ctype&&"string"==g.ctype){var h=d.value,h=h.replace(new RegExp(f.value,"g"),g.value);return{ctype:"string",value:h}}}if(2==c.length){var k,l,g=function(c,d,e){var f="";l=k=-1;for(var g=0;g<d.length;g++){var h=d[g][0],n=c.indexOf(h,e);-1!=n&&(-1==k?(f=h,k=n,l=g):n<k&&(f=h,k=n,l=g))}return f},d=evaluate(c[0]),f=evaluate(c[1]);if("string"==d.ctype&&"list"==f.ctype){for(var h=
d.value,d=[],p=0;p<f.value.length;p++){var n=f.value[p];"list"==n.ctype&&2==n.value.length&&"string"==n.value[0].ctype&&"string"==n.value[1].ctype&&(d[d.length]=[n.value[0].value,n.value[1].value])}k=-1;for(f=g(h,d,0);-1!=k;)h=h.substring(0,k)+d[l][1]+h.substring(k+f.length,h.length),f=k+d[l][1].length,f=g(h,d,f)}return{ctype:"string",value:h}}return nada};
evaluator.substring=function(c,e){if(3==c.length){var d=evaluate(c[0]),f=evaluateAndVal(c[1]),g=evaluateAndVal(c[2]);if("string"==d.ctype&&"number"==f.ctype&&"number"==g.ctype)return{ctype:"string",value:d.value.substring(Math.floor(f.value.real),Math.floor(g.value.real))}}return nada};
evaluator.tokenize=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("string"==d.ctype&&"string"==f.ctype){var g=!0;if(void 0!==e.autoconvert){var h=evaluate(e.autoconvert);"boolean"==h.ctype&&(g=h.value)}f=d.value.split(f.value);d=[];for(h=0;h<f.length;h++){var k=f[h];if(g){var l=parseFloat(k);isNaN(l)||(k=l)}d[h]={ctype:"string",value:k}}return List.turnIntoCSList(d)}if("string"==d.ctype&&"list"==f.ctype){if(0==f.value.length)return d;d=f.value[0];tli=List.turnIntoCSList(g);
k=evaluator.tokenize([c[0],d],e).value;d=[];for(h=0;h<k.length;h++){g=[];for(l=1;l<f.value.length;l++)g[l-1]=f.value[l];tli=List.turnIntoCSList(g);d[h]=evaluator.tokenize([k[h],tli],e)}return List.turnIntoCSList(d)}}return nada};
evaluator.indexof=function(c,e){if(2==c.length){var d=evaluate(c[0]),f=evaluate(c[1]);if("string"==d.ctype&&"string"==f.ctype)return d=d.value,f=f.value,d=d.indexOf(f),CSNumber.real(d+1)}if(3==c.length){var d=evaluate(c[0]),f=evaluate(c[1]),g=evaluate(c[2]);if("string"==d.ctype&&"string"==f.ctype&&"number"==g.ctype)return d=d.value,f=f.value,g=Math.round(g.value.real),d=d.indexOf(f,g-1),CSNumber.real(d+1)}return nada};
evaluator.parse=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("string"==d.ctype)return d=condense(d.value),d=analyse(d),evaluate(d)}return nada};evaluator._helper.basismap=function(c,e,d,f){var g=List.turnIntoCSList([c,e,d]),g=List.inverse(List.transpose(g));f=General.mult(g,f);g=List.turnIntoCSList([General.mult(f.value[0],c),General.mult(f.value[1],e),General.mult(f.value[2],d)]);return List.transpose(g)};
evaluator.map=function(c,e){if(8==c.length){var d=evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]),g=evaluateAndHomog(c[2]),h=evaluateAndHomog(c[3]),k=evaluateAndHomog(c[4]),l=evaluateAndHomog(c[5]),p=evaluateAndHomog(c[6]),n=evaluateAndHomog(c[7]);if(k!=nada&&l!=nada&&p!=nada&&n!=nada&&d!=nada&&f!=nada&&g!=nada&&h!=nada)return k=evaluator._helper.basismap(k,l,p,n),d=evaluator._helper.basismap(d,f,g,h),erg=General.mult(k,List.inverse(d)),List.normalizeMax(erg)}if(6==c.length){var d=evaluateAndHomog(c[0]),
f=evaluateAndHomog(c[1]),g=evaluateAndHomog(c[2]),n=List.realVector([0,0,1]),q=List.cross,h=q(q(g,q(n,q(d,f))),q(f,q(n,q(d,g)))),k=evaluateAndHomog(c[3]),l=evaluateAndHomog(c[4]),p=evaluateAndHomog(c[5]),n=q(q(p,q(n,q(k,l))),q(l,q(n,q(k,p))));if(k!=nada&&l!=nada&&p!=nada&&n!=nada&&d!=nada&&f!=nada&&g!=nada&&h!=nada)return k=evaluator._helper.basismap(k,l,p,n),d=evaluator._helper.basismap(d,f,g,h),erg=General.mult(k,List.inverse(d)),List.normalizeMax(erg)}return 4==c.length&&(g=List.ii,h=List.jj,d=
evaluateAndHomog(c[0]),f=evaluateAndHomog(c[1]),k=evaluateAndHomog(c[2]),l=evaluateAndHomog(c[3]),k!=nada&&l!=nada&&d!=nada&&f!=nada)||2==c.length&&(g=List.ii,h=List.jj,d=evaluateAndHomog(c[0]),f=General.add(List.realVector([1,0,0]),d),k=evaluateAndHomog(c[1]),l=General.add(List.realVector([1,0,0]),k),k!=nada&&l!=nada&&d!=nada&&f!=nada)?(k=evaluator._helper.basismap(k,l,g,h),d=evaluator._helper.basismap(d,f,g,h),erg=General.mult(k,List.inverse(d)),List.normalizeMax(erg)):nada};
evaluator.pointreflect=function(c,e){if(1==c.length){var d=List.ii,f=List.jj,g=evaluateAndHomog(c[0]),h=General.add(List.realVector([1,0,0]),g),k=General.add(List.realVector([-1,0,0]),g);if(k!=nada&&g!=nada&&h!=nada)return k=evaluator._helper.basismap(g,k,d,f),d=evaluator._helper.basismap(g,h,d,f),erg=General.mult(k,List.inverse(d)),List.normalizeMax(erg)}return nada};
evaluator.linereflect=function(c,e){if(1==c.length){var d=List.ii,f=List.jj,g=evaluateAndHomog(c[0]),h=List.realVector([Math.random(),Math.random(),Math.random()]),k=List.realVector([Math.random(),Math.random(),Math.random()]),h=List.cross(h,g),k=List.cross(k,g);if(g!=nada&&h!=nada)return g=evaluator._helper.basismap(h,k,d,f),d=evaluator._helper.basismap(h,k,f,d),d=General.mult(g,List.inverse(d)),List.normalizeMax(d)}return nada};
evaluator._helper.extractPointVec=function(c){var e={ok:!1};if("geo"==c.ctype){var d=c.value;if("P"==d.kind)return e.x=Accessor.getField(d,"x"),e.y=Accessor.getField(d,"y"),e.z=CSNumber.real(1),e.ok=!0,e}if("list"!=c.ctype)return e;var f=c.value;if(2==f.length&&(c=f[0],d=f[1],"number"==c.ctype&&"number"==d.ctype))return e.x=CSNumber.clone(c),e.y=CSNumber.clone(d),e.z=CSNumber.real(1),e.ok=!0,e;3==f.length&&(c=f[0],d=f[1],f=f[2],"number"==c.ctype&&"number"==d.ctype&&"number"==f.ctype&&(e.x=CSNumber.div(c,
f),e.y=CSNumber.div(d,f),e.z=CSNumber.real(1),e.ok=!0));return e};evaluator.polygon=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype){for(var f=[],g=0;g<d.value.length;g++){var h=evaluator._helper.extractPoint(d.value[g]);if(!h.ok)return nada;f[f.length]={X:h.x,Y:h.y}}return{ctype:"shape",type:"polygon",value:[f]}}}return nada};
evaluator.circle=function(c,e){if(2==c.length){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]),d=evaluator._helper.extractPointVec(d);if(!d.ok||"number"!=f.ctype)return nada;d=List.turnIntoCSList([d.x,d.y,d.z]);return{ctype:"shape",type:"circle",value:List.turnIntoCSList([d,f])}}return nada};
evaluator.screen=function(c,e){if(0==c.length){var d=csport.drawingstate.initialmatrix,f=function(c,e){var f=c-d.tx,l=e+d.ty;return{X:(f*d.d-l*d.b)/d.det,Y:-(-f*d.c+l*d.a)/d.det}};return{ctype:"shape",type:"polygon",value:[[f(0,0),f(csw,0),f(csw,csh),f(0,csh)]]}}return nada};evaluator.allpoints=function(c,e){if(0==c.length){erg=[];for(var d=0;d<csgeo.points.length;d++)erg[d]={ctype:"geo",value:csgeo.points[d],type:"P"};return{ctype:"list",value:erg}}return nada};
evaluator.allmasses=function(c,e){if(0==c.length){erg=[];for(var d=0;d<masses.length;d++)erg[d]={ctype:"geo",value:masses[d],type:"P"};return{ctype:"list",value:erg}}return nada};evaluator.alllines=function(c,e){if(0==c.length){erg=[];for(var d=0;d<csgeo.lines.length;d++)erg[d]={ctype:"geo",value:csgeo.lines[d],type:"L"};return{ctype:"list",value:erg}}return nada};
evaluator.halfplane=function(c,e){if(2==c.length){var d=evaluateAndVal(c[0]),f=evaluateAndVal(c[1]),g=evaluateAndHomog(d),h=evaluateAndHomog(f);if(d!=nada&&f!=nada){var k=f.usage,f=h;if("Line"==d.usage||"Point"==k)g=h,f=d;d=List.realVector([0,0,1]);d=List.cross(d,f);d.value=[d.value[1],CSNumber.neg(d.value[0]),d.value[2]];d=List.cross(d,g);d=List.cross(f,d);d=General.div(d,d.value[2]);g=General.div(g,g.value[2]);g=List.sub(g,d);f=List.abs(g);g=General.div(g,f);f=d.value[0].value.real;d=d.value[1].value.real;
h=1E3*g.value[0].value.real;g=1E3*g.value[1].value.real;return{ctype:"shape",type:"polygon",value:[[{X:f+g/2,Y:d-h/2},{X:f+g/2+h,Y:d-h/2+g},{X:f-g/2+h,Y:d+h/2+g},{X:f-g/2,Y:d+h/2}]]}}}return nada};
evaluator.convexhull3d=function(c,e){if(1==c.length){var d=evaluate(c[0]);if("list"==d.ctype){for(var f=d.value,g=[],d=0;d<f.length;d++)if(List._helper.isNumberVecN(f[d],3))for(var h=0;3>h;h++)g.push(f[d].value[h].value.real);h=convexhull(g);f=h[0];g=[];for(d=0;d<f.length;d+=3)g.push(List.realVector([f[d],f[d+1],f[d+2]]));for(var f=List.turnIntoCSList(g),g=h[1],k=[],d=0;d<g.length;d++){for(h=0;h<g[d].length;h++)g[d][h]++;k.push(List.realVector(g[d]))}d=List.turnIntoCSList(k);return List.turnIntoCSList([f,
d])}}return nada};evaluator._helper.extractReferenceX=function(c,e){};
evaluator.drawimage=function(c,e){var d=function(){var c=1,d=1,f=1,k=1,l=0,t=1,v=evaluator._helper.extractPoint(g);if(!v.ok||"string"!=h.ctype)return nada;csctx.save();void 0!==e.angle&&(erg=evaluate(e.angle),"number"==erg.ctype&&(l=erg.value.real));void 0!==e.rotation&&(erg=evaluate(e.rotation),"number"==erg.ctype&&(l=erg.value.real));void 0!==e.scale&&(erg=evaluateAndVal(e.scale),"number"==erg.ctype&&(d=c=erg.value.real),List.isNumberVector(erg).value&&2==erg.value.length&&(c=erg.value[0].value.real,
d=erg.value[1].value.real));void 0!==e.scalex&&(erg=evaluate(e.scalex),"number"==erg.ctype&&(c=erg.value.real));void 0!==e.scaley&&(erg=evaluate(e.scaley),"number"==erg.ctype&&(d=erg.value.real));void 0!==e.flipx&&(erg=evaluate(e.flipx),"boolean"==erg.ctype&&erg.value&&(f=-1));void 0!==e.flipy&&(erg=evaluate(e.flipy),"boolean"==erg.ctype&&erg.value&&(k=-1));void 0!==e.alpha&&(erg=evaluate(e.alpha),"number"==erg.ctype&&(t=erg.value.real));var u=csport.drawingstate.matrix,y=csport.drawingstate.initialmatrix,
w=images[h.value].width,A=images[h.value].height,z=v.x*u.a-v.y*u.b+u.tx,B=v.x*u.c-v.y*u.d-u.ty,C=(v.x+1)*u.a-v.y*u.b+u.tx-z,u=(v.x+1)*u.c-v.y*u.d-u.ty-B,x=(v.x+1)*y.a-v.y*y.b+y.tx-(v.x*y.a-v.y*y.b+y.tx),y=(v.x+1)*y.c-v.y*y.d-y.ty-(v.x*y.c-v.y*y.d-y.ty),v=Math.sqrt(C*C+u*u)/Math.sqrt(x*x+y*y),C=-Math.atan2(C,u)+Math.atan2(x,y);1!=t&&(csctx.globalAlpha=t);csctx.translate(z,B);csctx.scale(c*f*v,d*k*v);csctx.rotate(l+C);csctx.translate(-z,-B);csctx.translate(-w/2,-A/2);csctx.drawImage(images[h.value],
z,B);csctx.globalAlpha=1;csctx.restore()},f=function(){var c=1,d=1,f=1,r=1,s=evaluator._helper.extractPoint(g),t=evaluator._helper.extractPoint(k),v;if(!s.ok||!t.ok||"string"!=h.ctype)return nada;if(void 0!==images&&"undefined"!=images[h.value]){var u=images[h.value].width,y=images[h.value].height;if(0==l)v={},v.x=s.x-(t.y-s.y),v.y=s.y+(t.x-s.x),r=y/u;else if(v=evaluator._helper.extractPoint(l),!s.ok)return nada;csctx.save();void 0!==e.alpha&&(erg=evaluate(e.alpha),"number"==erg.ctype&&(c=erg.value.real));
void 0!==e.aspect&&(erg=evaluate(e.aspect),"number"==erg.ctype&&(r=erg.value.real));void 0!==e.flipx&&(erg=evaluate(e.flipx),"boolean"==erg.ctype&&erg.value&&(d=-1));void 0!==e.flipy&&(erg=evaluate(e.flipy),"boolean"==erg.ctype&&erg.value&&(f=-1));var w=csport.drawingstate.matrix;1!=c&&(csctx.globalAlpha=c);c=s.x*w.a-s.y*w.b+w.tx;s=s.x*w.c-s.y*w.d-w.ty;csctx.transform(t.x*w.a-t.y*w.b+w.tx-c,t.x*w.c-t.y*w.d-w.ty-s,v.x*w.a-v.y*w.b+w.tx-c,v.x*w.c-v.y*w.d-w.ty-s,c,s);csctx.scale(1/u,-1/y*r);csctx.translate(u/
2,-y/2);csctx.scale(d,f);csctx.translate(-u/2,y/2);csctx.translate(0,-y);csctx.drawImage(images[h.value],0,0);csctx.globalAlpha=1;csctx.restore()}};if(2==c.length){var g=evaluateAndVal(c[0]),h=evaluateAndVal(c[1]);return d()}if(3==c.length){var g=evaluateAndVal(c[0]),k=evaluateAndVal(c[1]),l=0,h=evaluateAndVal(c[2]);return f()}return 4==c.length?(g=evaluateAndVal(c[0]),k=evaluateAndVal(c[1]),l=evaluateAndVal(c[2]),h=evaluateAndVal(c[3]),f()):nada};evaluator.sound={};evaluator.sound.lines=[0,0,0,0,0,0,0,0,0,0,0,0];evaluator.playsin=function(c,e){var d=evaluateAndVal(c[0]),f=0;if("number"==d.ctype){void 0!==e.line&&(erg=evaluate(e.line),"number"==erg.ctype&&(f=Math.floor(erg.value.real),0>f&&(f=0),10<f&&(inenumber=10)));var g=evaluator.sound.lines,d=d.value.real;0==g[f]?g[f]=T("sin",{freq:d,mul:.6}).play():g[f].set({freq:d})}return nada};var evaluate=function(c){if("undefined"===typeof c)return nada;if("infix"==c.ctype)return evaluator._helper.eval(infixmap[c.oper],c.args,[]);if("variable"==c.ctype)return namespace.getvar(c.name);if("void"==c.ctype||"geo"==c.ctype||"number"==c.ctype||"boolean"==c.ctype||"string"==c.ctype||"list"==c.ctype||"undefined"==c.ctype||"shape"==c.ctype)return c;if("field"==c.ctype){var e=evaluate(c.obj);return"geo"==e.ctype?Accessor.getField(e.value,c.key):"list"==e.ctype?List.getField(e,c.key):nada}return"function"==
c.ctype?evaluator._helper.eval(c.oper,c.args,c.modifs):nada},evaluateAndVal=function(c){c=evaluate(c);if("geo"==c.ctype){var e=c.value;if("P"==e.kind)return Accessor.getField(e,"xy")}return c},evaluateAndHomog=function(c){c=evaluate(c);if("geo"==c.ctype){var e=c.value;if("P"==e.kind)return Accessor.getField(e,"homog");if("L"==e.kind)return c}return List._helper.isNumberVecN(c,3)?c:List._helper.isNumberVecN(c,2)?(c=General.clone(c),c.value[2]=CSNumber.real(1),c):nada},condense=function(c){for(var e=
!1,d=!1,f="",g=0;g<c.length;g++){var h=c[g];'"'!=h||d||(e=!e);"/"==h&&g!=c.length-1&&"/"==c[g+1]&&(d=!0);"\n"==h&&(d=!1);if(" "!==h&&"\t"!==h&&"\n"!==h&&"\f"!==h&&"\r"!==h&&!d||e)f+=h}return f},report=function(c,e){var d=Array(e+1).join(".");"infix"==c.ctype&&(console.log(d+"INFIX: "+c.oper),console.log(d+"ARG 1 "),report(c.args[0],e+1),console.log(d+"ARG 2 "),report(c.args[1],e+1));"number"==c.ctype&&console.log(d+"NUMBER: "+CSNumber.niceprint(c));"variable"==c.ctype&&console.log(d+"VARIABLE: "+
c.name);"undefined"==c.ctype&&console.log(d+"UNDEF");"void"==c.ctype&&console.log(d+"VOID");"string"==c.ctype&&console.log(d+"STRING: "+c.value);"shape"==c.ctype&&console.log(d+"SHAPE: "+c.type);"modifier"==c.ctype&&console.log(d+"MODIF: "+c.key);if("list"==c.ctype){console.log(d+"LIST ");for(var f=c.value,g=0;g<f.length;g++)console.log(d+"EL"+g),report(f[g],e+1)}if("function"==c.ctype){console.log(d+"FUNCTION: "+c.oper);f=c.args;for(g=0;g<f.length;g++)console.log(d+"ARG"+g),report(f[g],e+1);var f=
c.modifs,h;for(h in f)console.log(d+"MODIF:"+h),report(f[h],e+1)}"error"==c.ctype&&console.log(d+"ERROR: "+c.message)},generateInfix=function(c,e,d){var f={ctype:"infix"};f.oper=c;f.args=[e,d];return f},modifierOp=function(c,e,d){var f=c.substring(0,e);c=analyse(c.substring(e+d.length),!1);return"error"==c.ctype?c:{ctype:"modifier",key:f,value:c}},definitionDot=function(c,e,d){if(isNumber(c)){var f={};f.value={real:parseFloat(c),imag:0};f.ctype="number";return f}f=analyse(c.substring(0,e),!1);c=c.substring(e+
d.length);return{ctype:"field",obj:f,key:c}},validDefinabaleFunction=function(c){if("function"!=c.ctype)return!1;for(var e=0;e<c.args.length;e++)if("variable"!=c.args[e].ctype)return!1;for(e=0;e<c.args.length-1;e++)for(var d=e+1;d<c.args.length;d++)if(c.args[e].name==c.args[d].name)return!1;return!0},definitionOp=function(c,e,d){var f=c.substring(0,e),f=analyse(f,!0);return"error"==f.ctype?f:"variable"==f.cstring||validDefinabaleFunction(f)?(c=c.substring(e+d.length),c=analyse(c,!1),"error"==c.ctype?
c:generateInfix(d,f,c)):new CError("Function not definable")},infixOp=function(c,e,d){var f=analyse(c.substring(0,e),!1);c=analyse(c.substring(e+d.length),!1);return"error"==f.ctype?f:"error"==c.ctype?c:generateInfix(d,f,c)},isPureNumber=function(c){return""!=c&&!isNaN(c)},isNumber=function(c){var e=c.indexOf("."),d=c.lastIndexOf(".");return e!=d?!1:-1==e?isPureNumber(c):isPureNumber(c.substring(0,e))||isPureNumber(c.substring(e+1))},somethingelse=function(c){if(""==c)return new Void;if('"'==c.charAt(0)&&
'"'==c.charAt(c.length-1))return{ctype:"string",value:c.substring(1,c.length-1)};if(isPureNumber(c))return{ctype:"number",value:{real:parseInt(c),imag:0}};if(namespace.isVariable(c))return namespace.vars[c];if(namespace.isVariableName(c)){var e=namespace.create(c);namespace.setvar(c,nada);return e}return nada},isOpener=function(c){return"["==c||"("==c||"{"==c||"|"==c},isCloser=function(c){return"]"==c||")"==c||"}"==c||"|"==c},isBracketPair=function(c){return"[]"==c||"()"==c||"{}"==c||"||"==c},funct=
function(c,e,d){var f=[];d=[];var g={},h=c.substring(0,e),k=c.length,l=0,p=e+1,n=!1,q=!1;for(e=p;e<k;e++){var r=c[e];'"'==r&&(n=!n);!n&&(!isOpener(r)||"|"==r&&q?isCloser(r)&&("|"!=r||q)&&(l--,"|"==r&&(q=!1)):(l++,"|"==r&&(q=!0)),","==r&&0==l||-1==l)&&(p=c.substring(p,e),f[f.length]=p,1!=f.length||-1!=l||f[0].length||(f=[]),p=e+1)}for(e=0;e<f.length;e++){c=analyse(f[e],!1);if("error"==c.ctype)return c;"modifier"==c.ctype?g[c.key]=c.value:d[d.length]=c}c={ctype:"function"};c.oper=h;c.args=d;c.modifs=
g;return c},parseList=function(c){var e,d=[],f=[];e=c+",";var g=e.length,h=0,k=0,l=!1,p=!1;for(c=k;c<g;c++){var n;n=e[c];'"'==n&&(p=!p);!p&&(!isOpener(n)||"|"==n&&l?isCloser(n)&&("|"!=n||l)&&(h--,"|"==n&&(l=!1)):(h++,"|"==n&&(l=!0)),","==n&&0==h||-1==h)&&(k=e.substring(k,c),d[d.length]=k,k=c+1)}for(c=0;c<d.length;c++)if(e=d[c],""==e)f[f.length]="nil";else{e=analyse(e,!1);if("error"==e.ctype)return e;f[f.length]=e}d={ctype:"function",oper:"genList"};d.args=f;d.modifs=[];return d},bracket=function(c){if("|"==
c[0]){c=parseList(c.substring(1,c.length-1));var e=c.args.length;return 1==e?(c.oper="abs",c):2==e?(c.oper="dist",c):nada}return"()"==c||"[]"==c?e={ctype:"list",value:[]}:"["==c[0]?parseList(c.substring(1,c.length-1)):"("==c[0]&&(e=parseList(c.substring(1,c.length-1)),1<e.args.length)?e:e=analyse(c.substring(1,c.length-1),!1)},analyse=function(c,e){for(var d=!1,f="",g=-1,h=-1,k="",l=0,p=0,n=" ",q=" ",r=0,s=!1,t=c.length,v=0;v<t;v++){var u,y=" ",w=" ";0<r&&r--;u=c[v];v+1<t&&(y=c[v+1]);v+2<t&&(w=c[v+
2]);'"'==u&&(d=!d);if(!d){if(isOpener(u)&&("|"!=u||!s))"|"==u&&(s=!0),f+=u,l++,1==l&&p++," "==n&&(n=u);else if(isCloser(u)&&("|"!=u||s)){"|"==u&&(s=!1);if(0==l)return new CError("close without open");if(isBracketPair(f[f.length-1]+u))l--,f=f.substring(0,f.length-1),q=u;else return new CError("unmatched brackets")}if(0==f.length){var A=-1,z="";"undefined"!=typeof operators[u+y+w]&&0==r?(z=u+y+w,r=3):"undefined"!=typeof operators[u+y]&&0==r?(z=""+u+y,r=2):"undefined"!=typeof operators[u]&&0==r&&(z=
""+u,r=1);""!=z&&(A=operators[z]);A>=h&&(h=A,g=v,k=z,0<=A&&(v+=z.length-1))}}}if(0!=l)return new CError("open without close");d=c.indexOf(n);q=c.lastIndexOf(q);return 0==l&&-1<h?"->"==k?modifierOp(c,g,k):"."==k?definitionDot(c,g,k):":="==k?definitionOp(c,g,k):infixOp(c,g,k):0==l&&1==p&&q==c.length-1?0==d?bracket(c,this):funct(c,d,e):somethingelse(c)};var defaultAppearance={clip:"none",pointColor:[1,0,0],lineColor:[0,0,1],pointSize:5,lineSize:2,alpha:1,overhangLine:1.1,overhangSeg:1,dimDependent:1};
function csinit(c){function e(c){c.size=CSNumber.real(c.size||defaultAppearance.pointSize);"Free"!=c.type?(c.color=List.realVector(c.color||defaultAppearance.pointColor),c.color=List.scalmult(CSNumber.real(defaultAppearance.dimDependent),c.color)):c.color=List.realVector(c.color||defaultAppearance.pointColor);c.alpha=CSNumber.real(c.alpha||defaultAppearance.alpha)}function d(c){c.size=CSNumber.real(c.size||defaultAppearance.lineSize);c.color=List.realVector(c.color||defaultAppearance.lineColor);c.alpha=
CSNumber.real(c.alpha||defaultAppearance.alpha);c.clip=General.string(c.clip||defaultAppearance.clip);c.overhang=CSNumber.real(c.overhang||defaultAppearance.overhangLine)}function f(c){d(c);c.clip=General.string("end");c.overhang=CSNumber.real(c.overhang||defaultAppearance.overhangSeg)}csgeo.gslp=c;csgeo.csnames={};for(var g=0;g<csgeo.gslp.length;g++)csgeo.csnames[csgeo.gslp[g].name]=csgeo.gslp[g],csgeo.gslp[g].kind=geoOpMap[csgeo.gslp[g].type],csgeo.gslp[g].incidences=[],csgeo.gslp[g].isshowing=
!0,csgeo.gslp[g].movable=!1,csgeo.gslp[g].inited=!1;csgeo.points=[];csgeo.lines=[];csgeo.conics=[];csgeo.free=[];csgeo.ctp=0;csgeo.ctf=0;csgeo.ctl=0;for(g=csgeo.ctc=0;g<csgeo.gslp.length;g++){if("P"==csgeo.gslp[g].kind){var h=csgeo.gslp[g];csgeo.points[csgeo.ctp]=h;e(h);csgeo.ctp+=1}"L"==csgeo.gslp[g].kind&&(h=csgeo.gslp[g],csgeo.lines[csgeo.ctl]=h,d(h),csgeo.ctl+=1);"C"==csgeo.gslp[g].kind&&(h=csgeo.gslp[g],csgeo.conics[csgeo.ctc]=h,d(h),csgeo.ctc+=1);"S"==csgeo.gslp[g].kind&&(h=csgeo.gslp[g],csgeo.lines[csgeo.ctl]=
h,f(h),csgeo.ctl+=1);h=csgeo.gslp[g].type;if("Free"==h||"PointOnLine"==h||"PointOnCircle"==h||"PointOnSegment"==h){var k=csgeo.gslp[g];k.pos&&(2==k.pos.length&&(k.sx=k.pos[0],k.sy=k.pos[1],k.sz=1),3==k.pos.length&&(k.sx=k.pos[0],k.sy=k.pos[1],k.sz=k.pos[2]));k.homog=List.realVector([c[g].sx,c[g].sy,c[g].sz]);k.isfinite=0!=k.sz;k.ismovable=!0;"PointOnCircle"==h&&(k.angle=CSNumber.real(k.angle));csgeo.free[csgeo.ctf]=k;csgeo.ctf+=1}if("CircleMr"==h||"CircleMFixedr"==h)k=csgeo.gslp[g],k.radius=CSNumber.real(k.radius),
csgeo.free[csgeo.ctf]=k,csgeo.ctf+=1;"Through"==h&&(k=csgeo.gslp[g],k.dir=General.wrap(k.dir),csgeo.free[csgeo.ctf]=k,csgeo.ctf+=1)}guessIncidences()}
function onSegment(c,e){var d=csgeo.csnames[e.args[0]].homog,f=csgeo.csnames[e.args[1]].homog,g=c.homog,h=CSNumber.div(d.value[0],d.value[2]),k=CSNumber.div(d.value[1],d.value[2]),d=CSNumber.div(f.value[0],f.value[2]),f=CSNumber.div(f.value[1],f.value[2]),l=CSNumber.div(g.value[0],g.value[2]),p=CSNumber.div(g.value[1],g.value[2]);return CSNumber._helper.isAlmostReal(h)&&CSNumber._helper.isAlmostReal(k)&&CSNumber._helper.isAlmostReal(d)&&CSNumber._helper.isAlmostReal(f)&&CSNumber._helper.isAlmostReal(l)&&
CSNumber._helper.isAlmostReal(p)?(h=h.value.real,k=k.value.real,d=d.value.real,f=f.value.real,l=l.value.real,p=p.value.real,g=Math.sqrt((h-d)*(h-d)+(k-f)*(k-f)),h=Math.sqrt((h-l)*(h-l)+(k-p)*(k-p)),d=Math.sqrt((d-l)*(d-l)+(f-p)*(f-p)),h=g-h-d,1E-15>h*h):!1}function isShowing(c,e){c.isshowing=!0;if(c.args)for(var d=0;d<c.args.length;d++)if(!csgeo.csnames[c.args[d]].isshowing){c.isshowing=!1;return}e.visiblecheck&&e.visiblecheck(c)}
function recalc(){csport.reset();for(var c=csgeo.gslp,e=0;e<c.length;e++){var d=c[e],f=geoOps[d.type];f(d);isShowing(d,f)}}function guessIncidences(){recalc();for(var c=0;c<csgeo.lines.length;c++)for(var e=csgeo.lines[c],d=0;d<csgeo.points.length;d++){var f=csgeo.points[d],g=List.scaldiv(List.abs(f.homog),f.homog),h=List.scaldiv(List.abs(e.homog),e.homog);1E-13>CSNumber.abs(List.scalproduct(g,h)).value.real&&(f.incidences.push(e.name),e.incidences.push(f.name))}}
function render(){for(var c=function(c){c.isshowing&&List._helper.isAlmostReal(c.homog)&&evaluator.draw([c.homog],{size:c.size,color:c.color,alpha:c.alpha})},e=function(c){if(c.isshowing){var d=c.matrix,e=d.value[2].value[0].value.real,f=d.value[0].value[0].value.real,p=d.value[2].value[1].value.real,n=-e/f,q=-p/d.value[1].value[1].value.real,d=(f*(n*n+q*q)+2*e*n+2*p*q+d.value[2].value[2].value.real)/f,d=Math.sqrt(0<d?d:-d);evaluator.drawcircle([List.realVector([n,q]),CSNumber.real(d)],{size:c.size,
color:c.color,alpha:c.alpha})}},d=function(c){if(c.isshowing&&List._helper.isAlmostReal(c.homog)){"none"==c.clip.value&&evaluator.draw([c.homog],{size:c.size,color:c.color,alpha:c.alpha});if("end"==c.clip.value){var d=csgeo.csnames[c.args[0]],e=csgeo.csnames[c.args[1]];evaluator.draw([d.homog,e.homog],{size:c.size,color:c.color,alpha:c.alpha})}if("inci"==c.clip.value){for(var d=[1E6,0],e=[-1E6,0],f=[1E6,0],p=[-1E6,0],n=0;n<c.incidences.length;n++){var q=csgeo.csnames[c.incidences[n]].homog,r=q.value[0],
s=q.value[1],t=q.value[2];CSNumber._helper.isAlmostZero(t)||(r=CSNumber.div(r,t),s=CSNumber.div(s,t),CSNumber._helper.isAlmostReal(r)&&CSNumber._helper.isAlmostReal(s)&&(r.value.real<d[0]&&(d=[r.value.real,q]),r.value.real>e[0]&&(e=[r.value.real,q]),s.value.real<f[0]&&(f=[s.value.real,q]),s.value.real>p[0]&&(p=[s.value.real,q])))}e[0]-d[0]>p[0]-f[0]?(d=d[1],e=e[1]):(d=f[1],e=p[1]);d!=e?evaluator.draw([d,e],{size:c.size,color:c.color,alpha:c.alpha,overhang:c.overhang}):evaluator.draw([c.homog],{size:c.size,
color:c.color,alpha:c.alpha})}}},f=0;f<csgeo.conics.length;f++)e(csgeo.conics[f]);for(f=0;f<csgeo.lines.length;f++)d(csgeo.lines[f]);for(f=0;f<csgeo.points.length;f++)c(csgeo.points[f])};geoOps={_helper:{}};var geoOpMap={};geoOps.Join=function(c){c.homog=List.cross(csgeo.csnames[c.args[0]].homog,csgeo.csnames[c.args[1]].homog);c.homog=List.normalizeMax(c.homog);c.homog.usage="Line"};geoOpMap.Join="L";geoOps.Segment=function(c){c.homog=List.cross(csgeo.csnames[c.args[0]].homog,csgeo.csnames[c.args[1]].homog);c.homog=List.normalizeMax(c.homog);c.homog.usage="Line"};geoOpMap.Segment="S";
geoOps.Meet=function(c){c.homog=List.cross(csgeo.csnames[c.args[0]].homog,csgeo.csnames[c.args[1]].homog);c.homog=List.normalizeMax(c.homog);c.homog.usage="Point"};geoOps.Meet.visiblecheck=function(c){var e=!0,d=csgeo.csnames[c.args[0]],f=csgeo.csnames[c.args[1]];"Segment"==d.type&&(e=onSegment(c,d));e&&"Segment"==d.type&&(e=onSegment(c,f));c.isshowing=e};geoOpMap.Meet="P";
geoOps.Mid=function(c){var e=csgeo.csnames[c.args[0]].homog,d=csgeo.csnames[c.args[1]].homog,f=List.cross(e,d),g=List.cross(f,List.linfty),h=List.det3(e,g,f),f=List.det3(d,g,f),e=List.scalmult(f,e),d=List.scalmult(h,d);c.homog=List.add(e,d);c.homog=List.normalizeMax(c.homog);c.homog.usage="Point"};geoOpMap.Mid="P";
geoOps.Perp=function(c){var e=csgeo.csnames[c.args[1]].homog,d=List.cross(List.linfty,csgeo.csnames[c.args[0]].homog);d.value=[d.value[1],CSNumber.neg(d.value[0]),d.value[2]];c.homog=List.cross(d,e);c.homog=List.normalizeMax(c.homog);c.homog.usage="Line"};geoOpMap.Perp="L";geoOps.Para=function(c){var e=csgeo.csnames[c.args[1]].homog;c.homog=List.cross(List.cross(List.linfty,csgeo.csnames[c.args[0]].homog),e);c.homog=List.normalizeMax(c.homog);c.homog.usage="Line"};geoOpMap.Para="L";
geoOps.Horizontal=function(c){c.homog=List.cross(List.ex,csgeo.csnames[c.args[0]].homog);c.homog=List.normalizeMax(c.homog);c.homog.usage="Line"};geoOpMap.Horizontal="L";geoOps.Vertical=function(c){c.homog=List.cross(List.ey,csgeo.csnames[c.args[0]].homog);c.homog=List.normalizeMax(c.homog);c.homog.usage="Line"};geoOpMap.Vertical="L";
geoOps.Through=function(c){var e=List.normalizeZ(csgeo.csnames[c.args[0]].homog);move&&move.mover==c&&(c.dir=List.realVector([e.value[0].value.real-mouse.x+move.offset.x,e.value[1].value.real-mouse.y+move.offset.y,0]));c.homog=List.cross(c.dir,e);c.homog=List.normalizeMax(c.homog);c.homog.usage="Line"};geoOpMap.Through="L";geoOps.Free=function(c){};geoOpMap.Free="P";
geoOps.PointOnLine=function(c){var e=csgeo.csnames[c.args[0]].homog,d=c.homog,f=List.cross(List.linfty,e);f.value=[f.value[1],CSNumber.neg(f.value[0]),f.value[2]];d=List.cross(f,d);c.homog=List.cross(d,e);c.homog=List.normalizeMax(c.homog);c.homog.usage="Point";e=CSNumber.div(c.homog.value[0],c.homog.value[2]);d=CSNumber.div(c.homog.value[1],c.homog.value[2]);c.sx=e.value.real;c.sy=d.value.real;c.sz=1};geoOpMap.PointOnLine="P";
geoOps.PointOnCircle=function(c){var e=csgeo.csnames[c.args[0]],d=geoOps._helper.IntersectLC(List.linfty,e.matrix),f=General.mult(e.matrix,d[0]),d=General.mult(e.matrix,d[1]),d=List.normalizeZ(List.cross(f,d));move&&move.mover==c&&(c.angle=CSNumber.real(Math.atan2(-(d.value[1].value.real-mouse.y-move.offset.y),-(d.value[0].value.real-mouse.x-move.offset.x))));f=c.angle;f=List.turnIntoCSList([CSNumber.cos(f),CSNumber.sin(f),CSNumber.real(0)]);f=List.scalmult(CSNumber.real(10),f);f=List.add(d,f);ln=
List.cross(f,d);var e=geoOps._helper.IntersectLC(ln,e.matrix),d=List.normalizeZ(e[0]),g=List.normalizeZ(e[1]),d=List.abs2(List.sub(f,d)),f=List.abs2(List.sub(f,g)),g=e[0];d.value.real>f.value.real&&(g=e[1]);c.homog=g;c.homog=List.normalizeMax(c.homog);c.homog.usage="Point";e=CSNumber.div(c.homog.value[0],c.homog.value[2]);f=CSNumber.div(c.homog.value[1],c.homog.value[2]);c.sx=e.value.real;c.sy=f.value.real;c.sz=1};geoOpMap.PointOnCircle="P";
geoOps.PointOnSegment=function(c){var e=csgeo.csnames[c.args[0]].homog,d=csgeo.csnames[csgeo.csnames[c.args[0]].args[0]].homog,f=csgeo.csnames[csgeo.csnames[c.args[0]].args[1]].homog,g=c.homog,h=CSNumber.div(d.value[0],d.value[2]),d=CSNumber.div(d.value[1],d.value[2]),k=CSNumber.div(f.value[0],f.value[2]),f=CSNumber.div(f.value[1],f.value[2]),l=CSNumber.div(g.value[0],g.value[2]),g=CSNumber.div(g.value[1],g.value[2]);if(!move||move.mover==c){var p=c.homog,n=List.cross(List.linfty,e);n.value=[n.value[1],
CSNumber.neg(n.value[0]),n.value[2]];p=List.cross(n,p);c.homog=List.cross(p,e);c.homog=List.normalizeMax(c.homog);c.homog.usage="Point";var n=h.value.real,q=d.value.real,e=k.value.real,p=f.value.real,r=l.value.real,g=g.value.real,l=Math.sqrt((n-e)*(n-e)+(q-p)*(q-p)),n=Math.sqrt((n-r)*(n-r)+(q-g)*(q-g)),g=Math.sqrt((e-r)*(e-r)+(p-g)*(p-g)),e=n/l;n>l&&(e=1);g>l&&(e=0);c.param=CSNumber.real(e)}k=CSNumber.sub(k,h);h=CSNumber.add(h,CSNumber.mult(c.param,k));f=CSNumber.sub(f,d);d=CSNumber.add(d,CSNumber.mult(c.param,
f));f=CSNumber.real(1);c.homog=List.turnIntoCSList([h,d,f]);c.homog=List.normalizeMax(c.homog);c.homog.usage="Point";d=CSNumber.div(c.homog.value[0],c.homog.value[2]);h=CSNumber.div(c.homog.value[1],c.homog.value[2]);c.sx=d.value.real;c.sy=h.value.real;c.sz=1};geoOpMap.PointOnSegment="P";geoOps._helper.CenterOfConic=function(c){var e=geoOps._helper.IntersectLC(List.linfty,c),d=General.mult(c,e[0]);c=General.mult(c,e[1]);return List.cross(d,c)};
geoOps.CenterOfConic=function(c){var e=geoOps._helper.CenterOfConic(csgeo.csnames[c.args[0]].matrix);c.homog=e;c.homog=List.normalizeMax(c.homog);c.homog.usage="Point"};geoOpMap.CenterOfConic="P";geoOps._helper.CircleMP=function(c,e){var d=List.crossOperator(c),f=List.transpose(d),d=General.mult(f,General.mult(List.fundDual,d)),g=General.mult(General.mult(e,d),e),f=General.mult(General.mult(e,List.fund),e),g=General.mult(g,List.fund),d=General.mult(f,d);return List.sub(g,d)};
geoOps.CircleMP=function(c){c.matrix=geoOps._helper.CircleMP(csgeo.csnames[c.args[0]].homog,csgeo.csnames[c.args[1]].homog);c.matrix=List.normalizeMax(c.matrix);c.matrix.usage="Circle"};geoOpMap.CircleMP="C";
geoOps.CircleMr=function(c){var e=csgeo.csnames[c.args[0]].homog,e=List.scaldiv(e.value[2],e);if(move&&move.mover==c){var d=e.value[0].value.real-mouse.x,f=e.value[1].value.real-mouse.y;rad=Math.sqrt(d*d+f*f);c.radius=CSNumber.real(rad+move.offsetrad)}d=List.turnIntoCSList([c.radius,CSNumber.real(0),CSNumber.real(0)]);d=List.add(d,e);c.matrix=geoOps._helper.CircleMP(e,d);c.matrix=List.normalizeMax(c.matrix);c.matrix.usage="Circle"};geoOpMap.CircleMr="C";
geoOps.CircleMFixedr=function(c){var e=csgeo.csnames[c.args[0]].homog,e=List.scaldiv(e.value[2],e),d=List.turnIntoCSList([c.radius,CSNumber.real(0),CSNumber.real(0)]),d=List.add(d,e);c.matrix=geoOps._helper.CircleMP(e,d);c.matrix=List.normalizeMax(c.matrix);c.matrix.usage="Circle"};geoOpMap.CircleMFixedr="C";
geoOps._helper.ConicBy5=function(c,e,d,f,g,h){c=List.turnIntoCSList([List.cross(d,f)]);var k=List.turnIntoCSList([List.cross(e,g)]);e=List.turnIntoCSList([List.cross(e,d)]);g=List.turnIntoCSList([List.cross(f,g)]);f=General.mult(List.transpose(k),c);g=General.mult(List.transpose(g),e);f=List.add(f,List.transpose(f));g=List.add(g,List.transpose(g));c=General.mult(General.mult(h,f),h);h=General.mult(General.mult(h,g),h);g=General.mult(c,g);h=General.mult(h,f);return List.sub(g,h)};
geoOps.ConicBy5=function(c){var e=geoOps._helper.ConicBy5(c,csgeo.csnames[c.args[0]].homog,csgeo.csnames[c.args[1]].homog,csgeo.csnames[c.args[2]].homog,csgeo.csnames[c.args[3]].homog,csgeo.csnames[c.args[4]].homog);c.matrix=e;c.matrix=List.normalizeMax(c.matrix);c.matrix.usage="Conic"};geoOpMap.ConicBy5="C";
geoOps.CircleBy3=function(c){var e=geoOps._helper.ConicBy5(c,csgeo.csnames[c.args[0]].homog,csgeo.csnames[c.args[1]].homog,List.ii,List.jj,csgeo.csnames[c.args[2]].homog);c.matrix=List.normalizeMax(e);c.matrix.usage="Circle"};geoOpMap.CircleBy3="C";
geoOps._helper.tracing2=function(c,e,d,f,g){var h=List.projectiveDistMinScal(d,c);d=List.projectiveDistMinScal(d,e);var k=List.projectiveDistMinScal(f,c);f=List.projectiveDistMinScal(f,e);g.results=h+f<d+k?List.turnIntoCSList([c,e]):List.turnIntoCSList([e,c])};
geoOps._helper.tracing2X=function(c,e,d,f,g){var h=0,k=List.projectiveDistMinScal(d,c),l=List.projectiveDistMinScal(d,e),p=List.projectiveDistMinScal(f,c),n=List.projectiveDistMinScal(f,e);d=List.projectiveDistMinScal(d,f);f=List.projectiveDistMinScal(c,e);var q=1E-6<d;return d/3>k+n&&f/3>k+n?(g.results=List.turnIntoCSList([c,e]),0+h):d/3>l+p&&f/3>l+p?(g.results=List.turnIntoCSList([e,c]),0+h):1E-5>f?(q&&(h=2),g.results=List.turnIntoCSList([c,e]),0+h):q&&2!=h?1+h:(g.results=List.turnIntoCSList([c,
e]),0+h)};
geoOps._helper.IntersectLC=function(c,e){var d=CSNumber,f=List.crossOperator(c),g=List.transpose(f),g=General.mult(g,General.mult(e,f)),h=g.value[0].value[0],k=g.value[0].value[1],l=g.value[0].value[2],p=g.value[1].value[0],n=g.value[1].value[1],q=g.value[1].value[2],r=g.value[2].value[0],s=g.value[2].value[1],t=g.value[2].value[2],v=c.value[0],u=c.value[1],y=c.value[2],w=d.abs(v).value.real,A=d.abs(u).value.real,z=d.abs(y).value.real,B;z>=w&&z>=A&&(B=d.div(d.sqrt(d.sub(d.mult(k,p),d.mult(h,n))),
y));w>=A&&w>=z&&(B=d.div(d.sqrt(d.sub(d.mult(q,s),d.mult(n,t))),v));A>=w&&A>=z&&(B=d.div(d.sqrt(d.sub(d.mult(r,l),d.mult(t,h))),u));f=List.add(g,List.scalmult(B,f));d=f.value[0];d=List.normalizeMax(d);d.usage="Point";f=List.transpose(f);f=f.value[0];f=List.normalizeMax(f);f.usage="Point";return[d,f]};
geoOps.IntersectLC=function(c){var e=geoOps._helper.IntersectLC(csgeo.csnames[c.args[0]].homog,csgeo.csnames[c.args[1]].matrix),d=e[0],e=e[1];c.inited?(geoOps._helper.tracing2(d,e,c.check1,c.check2,c),List._helper.isNaN(c.results.value[0])||List._helper.isNaN(c.results.value[1])||(c.check1=c.results.value[0],c.check2=c.results.value[1])):(c.check1=d,c.check2=e,c.inited=!0,c.results=List.turnIntoCSList([d,e]))};geoOpMap.IntersectLC="T";
geoOps.IntersectCirCir=function(c){var e=csgeo.csnames[c.args[0]].matrix,d=csgeo.csnames[c.args[1]].matrix,f=List.scalmult(d.value[0].value[0],e.value[2]),d=List.scalmult(e.value[0].value[0],d.value[2]),f=List.sub(f,d);f.value[2]=CSNumber.mult(CSNumber.real(.5),f.value[2]);f=List.normalizeMax(f);f=geoOps._helper.IntersectLC(f,e);e=f[0];f=f[1];c.inited?(geoOps._helper.tracing2(e,f,c.check1,c.check2,c),c.check1=c.results.value[0],c.check2=c.results.value[1]):(c.check1=e,c.check2=f,c.inited=!0,c.results=
List.turnIntoCSList([e,f]))};geoOpMap.IntersectCirCir="T";geoOps.SelectP=function(c){var e=csgeo.csnames[c.args[0]];c.inited||(c.inited=!0);c.homog=e.results.value[c.index-1]};geoOpMap.SelectP="P";var geoscripts={};var csgstorage={},csport={drawingstate:{}};csport.drawingstate.linecolor="rgb(0,0,255)";csport.drawingstate.linecolorraw=[0,0,1];csport.drawingstate.pointcolor="rgb(255,200,0)";csport.drawingstate.pointcolorraw=[1,.78,0];csport.drawingstate.textcolor="rgb(0,0,0)";csport.drawingstate.textcolorraw=[0,0,0];csport.drawingstate.alpha=1;csport.drawingstate.pointsize=4;csport.drawingstate.linesize=1;csport.drawingstate.textsize=20;csport.drawingstate.matrix={};csport.drawingstate.matrix.a=25;
csport.drawingstate.matrix.b=0;csport.drawingstate.matrix.c=0;csport.drawingstate.matrix.d=25;csport.drawingstate.matrix.tx=250;csport.drawingstate.matrix.ty=250;csport.drawingstate.matrix.det=csport.drawingstate.matrix.a*csport.drawingstate.matrix.d-csport.drawingstate.matrix.b*csport.drawingstate.matrix.c;csport.drawingstate.matrix.sdet=Math.sqrt(csport.drawingstate.matrix.det);csport.drawingstate.initialmatrix={};csport.drawingstate.initialmatrix.a=csport.drawingstate.matrix.a;
csport.drawingstate.initialmatrix.b=csport.drawingstate.matrix.b;csport.drawingstate.initialmatrix.c=csport.drawingstate.matrix.c;csport.drawingstate.initialmatrix.d=csport.drawingstate.matrix.d;csport.drawingstate.initialmatrix.tx=csport.drawingstate.matrix.tx;csport.drawingstate.initialmatrix.ty=csport.drawingstate.matrix.ty;csport.drawingstate.initialmatrix.det=csport.drawingstate.matrix.det;csport.drawingstate.initialmatrix.sdet=csport.drawingstate.matrix.sdet;
csport.clone=function(c){if(null==c||"object"!=typeof c)return c;var e=c.constructor(),d;for(d in c)e[d]=csport.clone(c[d]);return e};csgstorage.backup=csport.clone(csport.drawingstate);csgstorage.stack=[];var back=csport.clone(csport.drawingstate);
csport.reset=function(){csport.drawingstate.matrix.a=csport.drawingstate.initialmatrix.a;csport.drawingstate.matrix.b=csport.drawingstate.initialmatrix.b;csport.drawingstate.matrix.c=csport.drawingstate.initialmatrix.c;csport.drawingstate.matrix.d=csport.drawingstate.initialmatrix.d;csport.drawingstate.matrix.tx=csport.drawingstate.initialmatrix.tx;csport.drawingstate.matrix.ty=csport.drawingstate.initialmatrix.ty;csport.drawingstate.matrix.det=csport.drawingstate.initialmatrix.det;csport.drawingstate.matrix.sdet=
csport.drawingstate.initialmatrix.sdet};csport.from=function(c,e,d){c/=d;e/=d;d=csport.drawingstate.matrix;return[c*d.a-e*d.b+d.tx,c*d.c-e*d.d-d.ty]};csport.to=function(c,e){var d=csport.drawingstate.matrix,f=c-d.tx,g=e+d.ty;return[(f*d.d-g*d.b)/d.det,-(-f*d.c+g*d.a)/d.det,1]};csport.dumpTrafo=function(){var c=function(c){return Math.round(1E3*c)/1E3};m=csport.drawingstate.matrix;console.log("a:"+c(m.a)+" b:"+c(m.b)+" c:"+c(m.c)+" d:"+c(m.d)+" tx:"+c(m.ty)+" ty:"+c(m.tx))};
csport.applyMat=function(c,e,d,f,g,h){m=csport.drawingstate.matrix;var k=m.b*c+m.d*e,l=m.a*d+m.c*f;d=m.b*d+m.d*f;f=m.a*g+m.c*h+m.tx;g=m.b*g+m.d*h+m.ty;m.a=m.a*c+m.c*e;m.b=k;m.c=l;m.d=d;m.tx=f;m.ty=g;m.det=csport.drawingstate.matrix.a*csport.drawingstate.matrix.d-csport.drawingstate.matrix.b*csport.drawingstate.matrix.c;m.sdet=Math.sqrt(csport.drawingstate.matrix.det)};csport.translate=function(c,e){csport.applyMat(1,0,0,1,c,e)};
csport.rotate=function(c){var e=Math.cos(c);c=Math.sin(c);csport.applyMat(e,c,-c,e,0,0)};csport.scale=function(c){csport.applyMat(c,0,0,c,0,0)};csport.gsave=function(){csgstorage.stack.push(csport.clone(csport.drawingstate))};csport.grestore=function(){0!=csgstorage.stack.length&&(csport.drawingstate=csgstorage.stack.pop())};csport.greset=function(){csport.drawingstate=csport.clone(csgstorage.backup);csport.drawingstate.matrix.ty-=csh;csport.drawingstate.initialmatrix.ty-=csh;csgstorage.stack=[]};
csport.setcolor=function(c){var e=c.value[0].value.real,d=c.value[1].value.real;c=c.value[2].value.real;1==csport.drawingstate.alpha?(csport.drawingstate.linecolor="rgb("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+")",csport.drawingstate.linecolorraw=[e,d,c],csport.drawingstate.pointcolor="rgb("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+")"):(csport.drawingstate.linecolor="rgb("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+","+csport.drawingstate.alpha+
")",csport.drawingstate.linecolorraw=[e,d,c],csport.drawingstate.pointcolor="rgb("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+","+csport.drawingstate.alpha+")");csport.drawingstate.pointcolorraw=[e,d,c]};
csport.setlinecolor=function(c){var e=c.value[0].value.real,d=c.value[1].value.real;c=c.value[2].value.real;csport.drawingstate.linecolor=1==csport.drawingstate.alpha?"rgb("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+")":"rgba("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+","+csport.drawingstate.alpha+")";csport.drawingstate.linecolorraw=[e,d,c]};
csport.settextcolor=function(c){var e=c.value[0].value.real,d=c.value[1].value.real;c=c.value[2].value.real;csport.drawingstate.textcolor=1==csport.drawingstate.alpha?"rgb("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+")":"rgba("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+","+csport.drawingstate.alpha+")";csport.drawingstate.textcolorraw=[e,d,c]};
csport.setpointcolor=function(c){var e=c.value[0].value.real,d=c.value[1].value.real;c=c.value[2].value.real;csport.drawingstate.linecolor=1==csport.drawingstate.alpha?"rgb("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+")":"rgba("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*c)+","+csport.drawingstate.alpha+")";csport.drawingstate.pointcolorraw=[e,d,c]};
csport.setalpha=function(c){c=c.value.real;var e=csport.drawingstate.linecolorraw[0],d=csport.drawingstate.linecolorraw[1],f=csport.drawingstate.linecolorraw[2];csport.drawingstate.linecolor="rgba("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*f)+","+c+")";e=csport.drawingstate.pointcolorraw[0];d=csport.drawingstate.pointcolorraw[1];f=csport.drawingstate.pointcolorraw[2];csport.drawingstate.pointcolor="rgba("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*f)+","+c+")";e=
csport.drawingstate.textcolorraw[0];d=csport.drawingstate.textcolorraw[1];f=csport.drawingstate.textcolorraw[2];csport.drawingstate.textcolor="rgba("+Math.floor(255*e)+","+Math.floor(255*d)+","+Math.floor(255*f)+","+c+")";csport.drawingstate.alpha=c};csport.setpointsize=function(c){csport.drawingstate.pointsize=c.value.real};csport.setlinesize=function(c){csport.drawingstate.linesize=c.value.real};csport.settextsize=function(c){csport.drawingstate.textsize=c.value.real};var lab={},doPri45={a:[[],[.2],[.075,.225],[44/45,-56/15,32/9],[19372/6561,-25360/2187,64448/6561,-212/729],[9017/3168,-355/33,46732/5247,49/176,-5103/18656],[35/384,0,500/1113,125/192,-2187/6784,11/84]],dt:[0,.2,.3,.8,8/9,1,1],b1:[35/384,0,500/1113,125/192,-2187/6784,11/84,0],b2:[5179/57600,0,7571/16695,.6140625,-92097/339200,187/2100,.025],size:7},rk=doPri45,behaviors,masses=[];
function csinitphys(c){behaviors=c;masses=[];behaviors.forEach(function(c){if(c.name){var d=c.name;csgeo.csnames[d]&&(csgeo.csnames[d].behavior=c.behavior,labObjects[c.behavior.type].init(c.behavior,csgeo.csnames[d]),"Mass"==c.behavior.type&&masses.push(csgeo.csnames[d]))}else labObjects[c.behavior.type].init(c.behavior)})}lab.tick=function(){for(var c=0;c<labObjects.env.accuracy;c++)lab.tick1(labObjects.env.deltat/labObjects.env.accuracy)};
lab.tick1=function(c){for(var e=c,d=0;0<c&&d<.999*c||0>c&&d>.999*c;)e=lab.oneRKStep(e),d+=e,e=Math.min(2*e,c-d),e=Math.max(e,1E-16),lab.restorePosition(),lab.doCollisions(),lab.calculateForces(),lab.moveToFinalPos();return!0};lab.restorePosition=function(){behaviors.forEach(function(c){beh=c.behavior;labObjects[beh.type].restorePos(beh,rk.size+2)})};lab.doCollisions=function(){behaviors.forEach(function(c){beh=c.behavior;labObjects[beh.type].doCollisions(beh)})};
lab.calculateForces=function(){behaviors.forEach(function(c){beh=c.behavior;labObjects[beh.type].calculateForces(beh)})};lab.moveToFinalPos=function(){behaviors.forEach(function(c){beh=c.behavior;labObjects[beh.type].move(beh)})};
lab.oneRKStep=function(c){for(var e=function(c){behaviors.forEach(function(d){beh=d.behavior;labObjects[beh.type].initRK(beh,c);labObjects[beh.type].storePosition(beh)})},d=function(c){behaviors.forEach(function(d){beh=d.behavior;labObjects[beh.type].setToTimestep(beh,rk.dt[c])})},f=function(c){behaviors.forEach(function(d){beh=d.behavior;labObjects[beh.type].proceedMotion(beh,rk.dt[c],c,rk.a[c])})},g=function(){behaviors.forEach(function(c){beh=c.behavior;labObjects[beh.type].resetForces(beh)})},
h=function(c){behaviors.forEach(function(d){beh=d.behavior;labObjects[beh.type].calculateDelta(beh,c)})},k=function(d){var e=0;behaviors.forEach(function(c){beh=c.behavior;c=rk.size;labObjects[beh.type].proceedMotion(beh,rk.dt[c-1],c,rk.b1);labObjects[beh.type].savePos(beh,c+1);labObjects[beh.type].proceedMotion(beh,rk.dt[c-1],c,rk.b2);labObjects[beh.type].savePos(beh,c+2);e+=labObjects[beh.type].sqDist(beh,c+1,c+2)});return e=Math.sqrt(e)/c},l=function(c){behaviors.forEach(function(c){beh=c.behavior;
labObjects[beh.type].recallPosition(beh)})},p=rk.size,n=!1;!n;){e(c);for(var q=0;q<p;q++)d(q),f(q),g(),lab.calculateForces(),h(q);.001<k(c)&&1E-7<c?(c/=2,l()):n=!0}return c};labObjects={Mass:{init:function(c,e){c.vel=[0,0,0];c.pos=[0,0,0,0];c.el=e;"undefined"===typeof c.mass&&(c.mass=1);"undefined"===typeof c.charge&&(c.charge=0);"undefined"===typeof c.friction&&(c.friction=0);c.lnfrict=0;"undefined"===typeof c.limitspeed&&(c.limitspeed=!1);"undefined"===typeof c.fixed&&(c.fixed=!1);"undefined"===typeof c.radius&&(c.radius=1);c.internalmove=!1;c.fx=0;c.fy=0;c.fz=0;c.vx=c.vx||0;c.vy=c.vy||0;c.vz=c.vz||0;c.mtype=0;c.env=labObjects.env;c.deltat=0;c.mx=0;c.my=0;c.mz=0;c.mvx=
0;c.mvy=0;c.mvz=0;c.dx=[0,0,0,0,0,0,0,0,0,0];c.dy=[0,0,0,0,0,0,0,0,0,0];c.dz=[0,0,0,0,0,0,0,0,0,0];c.dvx=[0,0,0,0,0,0,0,0,0,0];c.dvy=[0,0,0,0,0,0,0,0,0,0];c.dvz=[0,0,0,0,0,0,0,0,0,0];c.midx=0;c.midy=0;c.midz=0;c.lx=0;c.ly=0;c.lz=0},resetForces:function(c){c.fx=0;c.fy=0;c.fz=0},getBlock:!1,setToTimestep:function(c,e,d){},initRK:function(c,e){var d=evaluator._helper.extractPoint(c.el.homog);c.x=d.x;c.y=d.y;c.z=0;c.xo=c.x;c.yo=c.y;c.zo=c.z;c.vxo=c.vx;c.vyo=c.vy;c.vzo=c.vz;c.deltat=e;c.fx=0;c.fy=0;c.fz=
0},setVelocity:function(c,e,d,f){f||(f=0);c.vx=e;c.vy=d;c.vz=f},move:function(c){c.pos=[c.x,c.y,1];c.internalmove=!0;move&&mouse.down&&c.el==move.mover||(c.el.homog=List.realVector(c.pos));c.el.sx=c.x;c.el.sy=c.y;c.internalmove=!1},proceedMotion:function(c,e,d,f){if(!c.fixed)for(c.x=c.mx,c.y=c.my,c.z=c.mz,c.vx=c.mvx,c.vy=c.mvy,c.vz=c.mvz,e=0;e<d;e++)c.x+=f[e]*c.dx[e]*c.deltat,c.y+=f[e]*c.dy[e]*c.deltat,c.z+=f[e]*c.dz[e]*c.deltat,c.vx+=f[e]*c.dvx[e]*c.deltat,c.vy+=f[e]*c.dvy[e]*c.deltat,c.vz+=f[e]*
c.dvz[e]*c.deltat},calculateForces:function(c){var e=Math.sqrt(c.vx*c.vx+c.vy*c.vy+c.vz*c.vz);c.lnfrict=-Math.log((1-c.friction)*(1-c.env.friction)*(.1<e&&c.limitSpeed?.1/e:1));c.fx+=-c.vx*c.lnfrict*c.mass;c.fy+=-c.vy*c.lnfrict*c.mass;c.fz+=-c.vz*c.lnfrict*c.mass},calculateDelta:function(c,e){c.dx[e]=c.vx;c.dy[e]=c.vy;c.dz[e]=c.vz;c.dvx[e]=c.fx/c.mass;c.dvy[e]=c.fy/c.mass;c.dvz[e]=c.fz/c.mass},savePos:function(c,e){c.dx[e]=c.x;c.dy[e]=c.y;c.dz[e]=c.z;c.dvx[e]=c.vx;c.dvy[e]=c.vy;c.dvz[e]=c.vz},restorePos:function(c,
e){c.fixed||(c.x=c.dx[e],c.y=c.dy[e],c.z=c.dz[e],c.vx=c.dvx[e],c.vy=c.dvy[e],c.vz=c.dvz[e])},sqDist:function(c,e,d){var f=(c.dx[e]-c.dx[d])*(c.dx[e]-c.dx[d]),f=f+(c.dy[e]-c.dy[d])*(c.dy[e]-c.dy[d]),f=f+(c.dz[e]-c.dz[d])*(c.dz[e]-c.dz[d]),f=f+(c.dvx[e]-c.dvx[d])*(c.dvx[e]-c.dvx[d]),f=f+(c.dvy[e]-c.dvy[d])*(c.dvy[e]-c.dvy[d]);return f+=(c.dvz[e]-c.dvz[d])*(c.dvz[e]-c.dvz[d])},kineticEnergy:function(c){return.5*c.mass*(c.vx[i]*c.vx[i]+c.vy[i]*c.vy[i]+c.vz[i]*c.vz[i])},storePosition:function(c){c.mx=
c.x;c.my=c.y;c.mz=c.z;c.mvx=c.vx;c.mvy=c.vy;c.mvz=c.vz},recallPosition:function(c){c.fixed||(c.x=c.mx,c.y=c.my,c.z=c.mz,c.vx=c.mvx,c.vy=c.mvy,c.vz=c.mvz)},doCollisions:function(c){}},Sun:{init:function(c,e){c.vel=[0,0,0];c.pos=[0,0,0,0];c.el=e;"undefined"===typeof c.mass&&(c.mass=10);"undefined"===typeof c.friction&&(c.friction=0);c.charge=0;c.x=0;c.y=0;c.z=0},resetForces:function(c){},getBlock:!1,setToTimestep:function(c,e,d){},initRK:function(c,e){var d=evaluator._helper.extractPoint(c.el.homog);
c.x=d.x;c.y=d.y;c.z=0},setVelocity:function(c,e,d,f){},move:function(c){},proceedMotion:function(c,e,d,f){},calculateDelta:function(c,e){},calculateForces:function(c){for(var e=c.x,d=c.y,f=c.z,g=0;g<masses.length;g++){var h=masses[g],k=h.behavior.x,l=h.behavior.y,p=h.behavior.z,n=Math.sqrt((e-k)*(e-k)+(d-l)*(d-l)+(f-p)*(f-p)),l=(d-l)*c.mass*h.behavior.mass/(n*n*n),p=(f-p)*c.mass*h.behavior.mass/(n*n*n);h.behavior.fx+=(e-k)*c.mass*h.behavior.mass/(n*n*n)*h.behavior.mass;h.behavior.fy+=l*h.behavior.mass;
h.behavior.fz+=p*h.behavior.mass}},savePos:function(c,e){},restorePos:function(c,e){},sqDist:function(c,e,d){},kineticEnergy:function(c){},storePosition:function(c){},recallPosition:function(c){},doCollisions:function(c){}},Spring:{init:function(c,e){c.el=e;"undefined"===typeof c.strength&&(c.strength=1);"undefined"===typeof c.amplitude&&(c.amplitude=0);"undefined"===typeof c.phase&&(c.phase=0);"undefined"===typeof c.speed&&(c.speed=1);"undefined"===typeof c.l0&&(c.l0=0);"undefined"===typeof c.stype&&
(c.stype=1);"undefined"===typeof c.readOnInit&&(c.readOnInit=!1);c.namea=e.args[0];c.nameb=e.args[1];c.ma=csgeo.csnames[c.namea];c.mb=csgeo.csnames[c.nameb];var d=evaluator._helper.extractPoint(c.ma.homog),f=evaluator._helper.extractPoint(c.mb.homog);c.l0=Math.sqrt((d.x-f.x)*(d.x-f.x)+(d.y-f.y)*(d.y-f.y));c.env=labObjects.env},resetForces:function(c){},getBlock:!1,setToTimestep:function(c,e,d){},initRK:function(c,e){},setVelocity:function(c,e,d,f){},move:function(c){},proceedMotion:function(c,e,d,
f){},calculateForces:function(c){var e,d,f,g;!c.ma.behavior||move&&mouse.down&&c.ma==move.mover?(d=evaluator._helper.extractPoint(c.ma.homog),e=d.x,f=d.y):(e=c.ma.behavior.x,f=c.ma.behavior.y);!c.mb.behavior||move&&mouse.down&&c.mb==move.mover?(g=evaluator._helper.extractPoint(c.mb.homog),d=g.x,g=g.y):(d=c.mb.behavior.x,g=c.mb.behavior.y);var h=Math.sqrt((e-d)*(e-d)+(f-g)*(f-g)),k=c.l0,l=c.stype;1==l&&(k=0);var p=0;if(2==l||3==l)p=c.ma.behavior.mass*c.mb.behavior.mass*c.strength;2==l&&(p=-p);if(0==
h||0!=l&&1!=l)if(null!=a&&null!=b&&0!=h){if(h*=h*h,2==l||3==l)fx=(e-d)*p/h,fy=(f-g)*p/h}else fx=fy=0;else fx=-(e-d)*c.strength*(h-k)/h*c.env.springstrength,fy=-(f-g)*c.strength*(h-k)/h*c.env.springstrength;c.ma.behavior&&(c.ma.behavior.fx+=fx,c.ma.behavior.fy+=fy);c.mb.behavior&&(c.mb.behavior.fx-=fx,c.mb.behavior.fy-=fy)},calculateDelta:function(c,e){},savePos:function(c,e){},restorePos:function(c,e){},sqDist:function(c,e,d){},kineticEnergy:function(c){},storePosition:function(c){},recallPosition:function(c){},
doCollisions:function(c){}},det:function(c,e,d,f,g,h){return d*h-g*f+g*e-c*h+c*f-d*e},Bouncer:{init:function(c,e){c.el=e;"undefined"===typeof c.xdamp&&(c.xdamp=0);"undefined"===typeof c.ydamp&&(c.ydamp=0);"undefined"===typeof c.motorchanger&&(c.motorchanger=!0);c.namea=e.args[0];c.nameb=e.args[1];c.ma=csgeo.csnames[c.namea];c.mb=csgeo.csnames[c.nameb];var d=evaluator._helper.extractPoint(c.ma.homog),f=evaluator._helper.extractPoint(c.mb.homog);c.x1o=d.x;c.y1o=d.y;c.x2o=f.x;c.y2o=f.y;c.env=labObjects.env},
resetForces:function(c){},getBlock:!1,setToTimestep:function(c,e,d){},initRK:function(c,e){c.deltat=e},setVelocity:function(c,e,d,f){},move:function(c){},proceedMotion:function(c,e,d,f){},calculateForces:function(c){},calculateDelta:function(c,e){},savePos:function(c,e){},restorePos:function(c,e){},sqDist:function(c,e,d){},kineticEnergy:function(c){},storePosition:function(c){},recallPosition:function(c){},doCollisions:function(c){for(var e=evaluator._helper.extractPoint(c.ma.homog),d=evaluator._helper.extractPoint(c.mb.homog),
f=e.x,e=e.y,g=d.x,d=d.y,h=c.x1o,k=c.y1o,l=c.x2o,p=c.y2o,n=Math.sqrt((f-g)*(f-g)+(e-d)*(e-d)),q=(f-g)/n,n=(e-d)/n,r=0;r<masses.length;r++){var s=masses[r],t=s.behavior.xo,v=s.behavior.yo,u=s.behavior.x,y=s.behavior.y,w=CSNumber.mult(CSNumber.complex(h,k),CSNumber.complex(g,d)),A=CSNumber.mult(CSNumber.complex(l,p),CSNumber.complex(f,e)),w=CSNumber.sub(w,A),A=CSNumber.mult(CSNumber.complex(t,v),CSNumber.complex(f,e)),w=CSNumber.add(w,A),A=CSNumber.mult(CSNumber.complex(t,v),CSNumber.complex(g,d)),w=
CSNumber.sub(w,A),A=CSNumber.sub(CSNumber.complex(h,k),CSNumber.complex(l,p)),w=CSNumber.div(w,A);0>labObjects.det(f,e,g,d,u,y)*labObjects.det(f,e,g,d,w.value.real,w.value.imag)&&0>labObjects.det(f,e,u,y,w.value.real,w.value.imag)*labObjects.det(g,d,u,y,w.value.real,w.value.imag)&&(v=s.behavior.mvx+c.deltat*(-w.value.real+s.behavior.xo),u=s.behavior.mvy+c.deltat*(-w.value.imag+s.behavior.yo),t=q*v+n*u,v=n*v-q*u,s.behavior.x=w.value.real,s.behavior.y=w.value.imag,s.behavior.vx=q*t*(1-c.xdamp),s.behavior.vy=
n*t*(1-c.xdamp),s.behavior.vx+=-n*v*(1-c.ydamp),s.behavior.vy+=q*v*(1-c.ydamp))}c.x1o=f;c.y1o=e;c.x2o=g;c.y2o=d}},Environment:{init:function(c){"undefined"===typeof c.gravity&&(c.gravity=0);"undefined"===typeof c.friction&&(c.friction=0);"undefined"===typeof c.springstrength&&(c.springstrength=1);"undefined"===typeof c.accuracy&&(c.accuracy=10);"undefined"===typeof c.deltat&&(c.deltat=.3);"undefined"===typeof c.charges&&(c.charges=!1);"undefined"===typeof c.balls&&(c.balls=!1);"undefined"===typeof c.newton&&
(c.newton=!1);"undefined"===typeof c.ballInteractionBoosting&&(c.ballInteractionBoosting=0);labObjects.env=c},resetForces:function(c){},getBlock:!1,setToTimestep:function(c,e,d){},initRK:function(c,e){},setVelocity:function(c,e,d,f){},move:function(c){},proceedMotion:function(c,e,d,f){},calculateForces:function(c){if(c.newton)for(var e=0;e<masses.length-1;e++)for(var d=masses[e],f=d.behavior.x,g=d.behavior.y,h=e+1;h<masses.length;h++){var k=masses[h],l=k.behavior.x,p=k.behavior.y,n=Math.sqrt((f-l)*
(f-l)+(g-p)*(g-p)),l=(f-l)*d.behavior.mass*k.behavior.mass/(n*n*n),p=(g-p)*d.behavior.mass*k.behavior.mass/(n*n*n);d.behavior.fx-=l;d.behavior.fy-=p;k.behavior.fx+=l;k.behavior.fy+=p}if(c.charges)for(e=0;e<masses.length-1;e++)for(d=masses[e],f=d.behavior.x,g=d.behavior.y,h=e+1;h<masses.length;h++)k=masses[h],l=k.behavior.x,p=k.behavior.y,n=Math.sqrt((f-l)*(f-l)+(g-p)*(g-p)),l=(f-l)*d.behavior.charge*k.behavior.charge/(n*n*n),p=(g-p)*d.behavior.charge*k.behavior.charge/(n*n*n),d.behavior.fx+=l,d.behavior.fy+=
p,k.behavior.fx-=l,k.behavior.fy-=p;if(c.balls)for(e=0;e<masses.length-1;e++)if(d=masses[e],0!=d.behavior.radius)for(f=d.behavior.x,g=d.behavior.y,h=e+1;h<masses.length;h++)if(k=masses[h],0!=k.behavior.radius){var l=k.behavior.x,p=k.behavior.y,q=d.behavior.radius+k.behavior.radius,n=Math.sqrt((f-l)*(f-l)+(g-p)*(g-p));0==c.ballInteractionBoosting?(l=(f-l)/(n*n*n)*(n>q?0:(n-q)*(n-q)),p=(g-p)/(n*n*n)*(n>q?0:(n-q)*(n-q))):1==ballInteractionBoosting?(l=(f-l)/(n*n*n*n)*(n>q?0:(n-q)*(n-q)),p=(g-p)/(n*n*
n*n)*(n>q?0:(n-q)*(n-q))):(l=(f-l)/(n*n*n*n*n)*(n>q?0:(n-q)*(n-q)),p=(g-p)/(n*n*n*n*n)*(n>q?0:(n-q)*(n-q)));d.behavior.fx+=l;d.behavior.fy+=p;k.behavior.fx-=l;k.behavior.fy-=p}for(e=0;e<masses.length;e++)d=masses[e],d.behavior.fx+=0,d.behavior.fy+=c.gravity,d.behavior.fz+=0},calculateDelta:function(c,e){},savePos:function(c,e){},restorePos:function(c,e){},sqDist:function(c,e,d){},kineticEnergy:function(c){},storePosition:function(c){},recallPosition:function(c){},doCollisions:function(c){}}};
