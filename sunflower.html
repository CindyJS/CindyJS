<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
            <title>Cindy JS</title>
            <script type="text/javascript" src="libgeo/GeoOps.js"></script>
            
            <script type="text/javascript" src="lib/Namespace.js"></script>
            <script type="text/javascript" src="lib/Number.js"></script>
            <script type="text/javascript" src="lib/List.js"></script>
            <script type="text/javascript" src="lib/Essentials.js"></script>
            <script type="text/javascript" src="lib/Operators.js"></script>
            <script type="text/javascript" src="lib/OpDrawing.js"></script>
            <script type="text/javascript" src="lib/Parser.js"></script>
            
            <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
            <style type="text/css">
                svg {
                    
                    position: absolute;
                    top: 100px;
                    left: 60px;
                    margin: 0;
                    padding: 0;
                    width: 500px;
                    height: 500px;
                    
                    
                }
                
                canvas {
                    
                    position: absolute;
                    top: 100px;
                    left: 60px;
                    margin: 0;
                    padding: 0;
                    width: 500;
                    height: 500;
                    
                    
                }
                </style>
            </head>
	<body style="font-family:Arial;">
        <h1>CindyJS: A simple sunflower</h1>
        
        
        <script id='firstDrawing' type='cindyscript'>
            //    s=seconds();
            //  draw((0,0));
            
            
            repeat(500,i,
                   w=i*pi/180*(137.508+off*0.02);
                   p=(pt1,pt2)+(cos(w),sin(w))*0.3*sqrt(i);
                   a=i;
                   draw(p,size->sqrt(i));
                   );
            // err(a);
            //   err(seconds()-s);
            
            </script>
        
        
        
        
        
        <canvas id="CSCanvas" width="500" height="500"
            style="border:2px solid #000000;">
        </canvas>
        
        
		<script type="text/javascript">
            
			//Width and height
			var w = 500;
			var h = 500;
            var csnames;
            
            
			var gslp=[
                      {name:"A", kind:"P", type:"Free", px:250,py:250,pz:1},
                      {name:"B", kind:"P", type:"Free", px:250,py:30,pz:1}
                      ];
            
            csnames={};
			for( var k=0; k<gslp.length; k++ ) {
				csnames[gslp[k].name]=k;
			};
            
			var points=[];
			var lines=[];
			var free=[];
			var ctp=0;
			var ctf=0;
			var ctl=0;
			for( var k=0; k<gslp.length; k++ ) {
				if(gslp[k].kind=="P"){
					points[ctp]=gslp[k];
                   	ctp+=1;
				}
				if(gslp[k].kind=="L"){
					lines[ctl]=gslp[k];
                   	ctl+=1;
				}
				if(gslp[k].type=="Free"){
					free[ctf]=gslp[k];
                   	ctf+=1;
				}
                
			};
            
            
            
			recalc();
            
            
			var dataset = {
				nodes: free,
				edges: []
			};
            
			//Initialize a default force layout, using the nodes and edges in dataset
			var eventhandler = d3.layout.force()
            .nodes(dataset.nodes)
            .links(dataset.edges)
            .size([w, h])
            .linkDistance([80])
            .charge([0])
            .gravity([.000])
            .start();
            
			var colors = d3.scale.category10();
            
			//Create SVG element
			var svg = d3.select("body")
            .append("svg")
            .attr("width", w)
            .attr("height", h);
            //						.style("background","#DDE");
			
			//Create edges as lines
			var edges = svg.selectAll("line")
            .data(lines)
            .enter()
            .append("line")
            .style("stroke", "#000")
            .style("stroke-width", 3);
			
			//Create nodes as circles
			var nodes = svg.selectAll("circle")
            .data(points)
            .enter()
            .append("circle")
            .attr("r", 7)
            .style("fill", function(d,i) {
                   if (d.type=="Free") {return "blue";}
                   return "red";})
            .style("stroke", "black")
            .style("stroke-width", 2)
            .call(eventhandler.drag);
			
            
            
            
			render();
            
			
            
			//Every time the simulation "ticks", this will be called
			eventhandler.on("tick", function() {
                     
                     gslp[1].py=30;
                     
                     recalc();
                     namespace.vars.pt1={'ctype':'variable',
                     'stack':[{'ctype':'number','value':{'real':(-250+gslp[0].px)/25.0,'imag':0}}],
                     'name':'pt1'
                     };
                     namespace.vars.pt2={'ctype':'variable',
                     'stack':[{'ctype':'number','value':{'real':(250-gslp[0].py)/25.0,'imag':0}}],
                     'name':'pt1'
                     };
                     
                     namespace.vars.off={'ctype':'variable',
                     'stack':[{'ctype':'number','value':{'real':(-250+gslp[1].px)/25.0,'imag':0}}],
                     'name':'off'
                     };
                     render();
                     csctx.clearRect ( 0   , 0 , 500 , 500 );
                     evaluate(erg);
                     
                     });
            
            
            
            
            
            
            </script>
        
        
        
        
        
 
        
        
        <script type="text/javascript">
            
            var c=document.getElementById("CSCanvas");
            var csctx=c.getContext("2d");
            //  csctx.fillStyle="#FF0000";
            //  csctx.fillRect(0,0,150,75);
            var cscode=document.getElementById("firstDrawing").text;
            
            
            
            
            var seconds = new Date().getTime() / 1000;
            
            console.log(cscode);
            
            cscode=condense(cscode);
            //  console.log(cscode);
            var erg=analyse(cscode,false);
            //  report(erg,0);
            if(erg.ctype=='error'){
                report(erg,0);
            }
            //  console.log(niceprint(erg));
            console.log('=========  RUNNING  =========');
            if(erg.ctype!='error') {
                var eval=evaluate(erg);
                //   report(eval,0);
                console.log('=========  RESULT  =========');
                console.log(niceprint(eval));
            }
            var needed = new Date().getTime() / 1000-seconds;
            console.log("Needed: "+needed+" seconds");
            
            
            </script>
        
        
        
        
        
	</body>
</html>